{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///app/saas-core/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient({\n  log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\n})\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,sNAAY,CAAC;IAC/D,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEA,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 71, "column": 0}, "map": {"version":3,"sources":["file:///app/saas-core/src/app/api/tenants/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { prisma } from '@/lib/prisma'\nimport { v4 as uuidv4 } from 'uuid'\n\n// GET /api/tenants - List all tenants (Super Admin only in production)\nexport async function GET(request: NextRequest) {\n  try {\n    const tenants = await prisma.tenant.findMany({\n      include: {\n        branding: true,\n        _count: {\n          select: { users: true }\n        }\n      },\n      orderBy: { createdAt: 'desc' }\n    })\n\n    return NextResponse.json({\n      success: true,\n      tenants\n    })\n  } catch (error) {\n    console.error('Failed to fetch tenants:', error)\n    return NextResponse.json(\n      { success: false, error: 'Failed to fetch tenants' },\n      { status: 500 }\n    )\n  }\n}\n\n// POST /api/tenants - Create a new tenant\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const {\n      name,\n      slug,\n      customDomain,\n      appName,\n      logoUrl,\n      faviconUrl,\n      primaryColor,\n      secondaryColor\n    } = body\n\n    // Validate required fields\n    if (!name || !slug) {\n      return NextResponse.json(\n        { success: false, error: 'Name and slug are required' },\n        { status: 400 }\n      )\n    }\n\n    // Validate slug format (alphanumeric and hyphens only)\n    if (!/^[a-z0-9-]+$/.test(slug)) {\n      return NextResponse.json(\n        { success: false, error: 'Slug must contain only lowercase letters, numbers, and hyphens' },\n        { status: 400 }\n      )\n    }\n\n    // Check for existing slug\n    const existingSlug = await prisma.tenant.findUnique({\n      where: { slug }\n    })\n    if (existingSlug) {\n      return NextResponse.json(\n        { success: false, error: 'This subdomain is already taken' },\n        { status: 409 }\n      )\n    }\n\n    // Check for existing custom domain if provided\n    if (customDomain) {\n      const existingDomain = await prisma.tenant.findUnique({\n        where: { customDomain }\n      })\n      if (existingDomain) {\n        return NextResponse.json(\n          { success: false, error: 'This custom domain is already in use' },\n          { status: 409 }\n        )\n      }\n    }\n\n    // Create tenant with branding in a transaction\n    const tenantId = uuidv4()\n    const brandingId = uuidv4()\n\n    const tenant = await prisma.tenant.create({\n      data: {\n        id: tenantId,\n        name,\n        slug,\n        customDomain: customDomain || null,\n        branding: {\n          create: {\n            id: brandingId,\n            appName: appName || name,\n            logoUrl: logoUrl || null,\n            faviconUrl: faviconUrl || null,\n            primaryColor: primaryColor || '#6366f1',\n            secondaryColor: secondaryColor || '#8b5cf6'\n          }\n        }\n      },\n      include: {\n        branding: true\n      }\n    })\n\n    return NextResponse.json({\n      success: true,\n      tenant\n    }, { status: 201 })\n\n  } catch (error: any) {\n    console.error('Failed to create tenant:', error)\n    \n    // Handle Prisma unique constraint errors\n    if (error.code === 'P2002') {\n      return NextResponse.json(\n        { success: false, error: 'A tenant with this slug or domain already exists' },\n        { status: 409 }\n      )\n    }\n\n    return NextResponse.json(\n      { success: false, error: 'Failed to create tenant' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAGO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,UAAU,MAAM,gJAAM,CAAC,MAAM,CAAC,QAAQ,CAAC;YAC3C,SAAS;gBACP,UAAU;gBACV,QAAQ;oBACN,QAAQ;wBAAE,OAAO;oBAAK;gBACxB;YACF;YACA,SAAS;gBAAE,WAAW;YAAO;QAC/B;QAEA,OAAO,gKAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gKAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAA0B,GACnD;YAAE,QAAQ;QAAI;IAElB;AACF;AAGO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EACJ,IAAI,EACJ,IAAI,EACJ,YAAY,EACZ,OAAO,EACP,OAAO,EACP,UAAU,EACV,YAAY,EACZ,cAAc,EACf,GAAG;QAEJ,2BAA2B;QAC3B,IAAI,CAAC,QAAQ,CAAC,MAAM;YAClB,OAAO,gKAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAA6B,GACtD;gBAAE,QAAQ;YAAI;QAElB;QAEA,uDAAuD;QACvD,IAAI,CAAC,eAAe,IAAI,CAAC,OAAO;YAC9B,OAAO,gKAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAiE,GAC1F;gBAAE,QAAQ;YAAI;QAElB;QAEA,0BAA0B;QAC1B,MAAM,eAAe,MAAM,gJAAM,CAAC,MAAM,CAAC,UAAU,CAAC;YAClD,OAAO;gBAAE;YAAK;QAChB;QACA,IAAI,cAAc;YAChB,OAAO,gKAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAkC,GAC3D;gBAAE,QAAQ;YAAI;QAElB;QAEA,+CAA+C;QAC/C,IAAI,cAAc;YAChB,MAAM,iBAAiB,MAAM,gJAAM,CAAC,MAAM,CAAC,UAAU,CAAC;gBACpD,OAAO;oBAAE;gBAAa;YACxB;YACA,IAAI,gBAAgB;gBAClB,OAAO,gKAAY,CAAC,IAAI,CACtB;oBAAE,SAAS;oBAAO,OAAO;gBAAuC,GAChE;oBAAE,QAAQ;gBAAI;YAElB;QACF;QAEA,+CAA+C;QAC/C,MAAM,WAAW,IAAA,mMAAM;QACvB,MAAM,aAAa,IAAA,mMAAM;QAEzB,MAAM,SAAS,MAAM,gJAAM,CAAC,MAAM,CAAC,MAAM,CAAC;YACxC,MAAM;gBACJ,IAAI;gBACJ;gBACA;gBACA,cAAc,gBAAgB;gBAC9B,UAAU;oBACR,QAAQ;wBACN,IAAI;wBACJ,SAAS,WAAW;wBACpB,SAAS,WAAW;wBACpB,YAAY,cAAc;wBAC1B,cAAc,gBAAgB;wBAC9B,gBAAgB,kBAAkB;oBACpC;gBACF;YACF;YACA,SAAS;gBACP,UAAU;YACZ;QACF;QAEA,OAAO,gKAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;QACF,GAAG;YAAE,QAAQ;QAAI;IAEnB,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,4BAA4B;QAE1C,yCAAyC;QACzC,IAAI,MAAM,IAAI,KAAK,SAAS;YAC1B,OAAO,gKAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAmD,GAC5E;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gKAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAA0B,GACnD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}