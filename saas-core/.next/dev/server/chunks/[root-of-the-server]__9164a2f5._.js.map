{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///app/saas-core/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient({\n  log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\n})\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,sNAAY,CAAC;IAC/D,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEA,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 65, "column": 0}, "map": {"version":3,"sources":["file:///app/saas-core/src/lib/tenant-resolver.ts"],"sourcesContent":["import { prisma } from './prisma'\nimport { TenantWithBranding } from './tenant-context'\n\n/**\n * Resolves tenant from hostname (subdomain or custom domain)\n * \n * Examples:\n * - acme.saascore.com -> resolves tenant with slug \"acme\"\n * - app.acme.com -> resolves tenant with customDomain \"app.acme.com\"\n * - saascore.com -> no tenant (super admin or landing page)\n */\nexport async function resolveTenantFromHost(hostname: string): Promise<TenantWithBranding | null> {\n  // Remove port if present\n  const host = hostname.split(':')[0]\n  \n  // Check for custom domain first\n  let tenant = await prisma.tenant.findUnique({\n    where: { customDomain: host, isActive: true },\n    include: { branding: true }\n  })\n  \n  if (tenant) return tenant\n  \n  // Extract subdomain from host\n  // Pattern: subdomain.domain.tld or subdomain.preview.emergentagent.com\n  const parts = host.split('.')\n  \n  // Need at least 3 parts for a subdomain (sub.domain.tld)\n  if (parts.length >= 3) {\n    const subdomain = parts[0]\n    \n    // Skip common non-tenant subdomains\n    if (['www', 'api', 'app', 'admin', 'preview'].includes(subdomain)) {\n      return null\n    }\n    \n    tenant = await prisma.tenant.findUnique({\n      where: { slug: subdomain, isActive: true },\n      include: { branding: true }\n    })\n    \n    if (tenant) return tenant\n  }\n  \n  return null\n}\n\n/**\n * Resolves tenant by slug directly\n */\nexport async function resolveTenantBySlug(slug: string): Promise<TenantWithBranding | null> {\n  return prisma.tenant.findUnique({\n    where: { slug, isActive: true },\n    include: { branding: true }\n  })\n}\n\n/**\n * Resolves tenant by ID\n */\nexport async function resolveTenantById(id: string): Promise<TenantWithBranding | null> {\n  return prisma.tenant.findUnique({\n    where: { id, isActive: true },\n    include: { branding: true }\n  })\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAWO,eAAe,sBAAsB,QAAgB;IAC1D,yBAAyB;IACzB,MAAM,OAAO,SAAS,KAAK,CAAC,IAAI,CAAC,EAAE;IAEnC,gCAAgC;IAChC,IAAI,SAAS,MAAM,gJAAM,CAAC,MAAM,CAAC,UAAU,CAAC;QAC1C,OAAO;YAAE,cAAc;YAAM,UAAU;QAAK;QAC5C,SAAS;YAAE,UAAU;QAAK;IAC5B;IAEA,IAAI,QAAQ,OAAO;IAEnB,8BAA8B;IAC9B,uEAAuE;IACvE,MAAM,QAAQ,KAAK,KAAK,CAAC;IAEzB,yDAAyD;IACzD,IAAI,MAAM,MAAM,IAAI,GAAG;QACrB,MAAM,YAAY,KAAK,CAAC,EAAE;QAE1B,oCAAoC;QACpC,IAAI;YAAC;YAAO;YAAO;YAAO;YAAS;SAAU,CAAC,QAAQ,CAAC,YAAY;YACjE,OAAO;QACT;QAEA,SAAS,MAAM,gJAAM,CAAC,MAAM,CAAC,UAAU,CAAC;YACtC,OAAO;gBAAE,MAAM;gBAAW,UAAU;YAAK;YACzC,SAAS;gBAAE,UAAU;YAAK;QAC5B;QAEA,IAAI,QAAQ,OAAO;IACrB;IAEA,OAAO;AACT;AAKO,eAAe,oBAAoB,IAAY;IACpD,OAAO,gJAAM,CAAC,MAAM,CAAC,UAAU,CAAC;QAC9B,OAAO;YAAE;YAAM,UAAU;QAAK;QAC9B,SAAS;YAAE,UAAU;QAAK;IAC5B;AACF;AAKO,eAAe,kBAAkB,EAAU;IAChD,OAAO,gJAAM,CAAC,MAAM,CAAC,UAAU,CAAC;QAC9B,OAAO;YAAE;YAAI,UAAU;QAAK;QAC5B,SAAS;YAAE,UAAU;QAAK;IAC5B;AACF"}},
    {"offset": {"line": 144, "column": 0}, "map": {"version":3,"sources":["file:///app/saas-core/src/app/api/tenants/resolve/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { resolveTenantFromHost, resolveTenantBySlug } from '@/lib/tenant-resolver'\n\n// GET /api/tenants/resolve - Resolve tenant from host or slug\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const slug = searchParams.get('slug')\n    const host = searchParams.get('host') || request.headers.get('host')\n\n    let tenant = null\n\n    // Try slug first\n    if (slug) {\n      tenant = await resolveTenantBySlug(slug)\n    }\n    // Then try host resolution\n    else if (host) {\n      tenant = await resolveTenantFromHost(host)\n    }\n\n    if (!tenant) {\n      return NextResponse.json({\n        success: true,\n        tenant: null,\n        message: 'No tenant resolved - showing default/super admin view'\n      })\n    }\n\n    return NextResponse.json({\n      success: true,\n      tenant: {\n        id: tenant.id,\n        name: tenant.name,\n        slug: tenant.slug,\n        customDomain: tenant.customDomain,\n        branding: tenant.branding\n      }\n    })\n  } catch (error) {\n    console.error('Failed to resolve tenant:', error)\n    return NextResponse.json(\n      { success: false, error: 'Failed to resolve tenant' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAGO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,OAAO,aAAa,GAAG,CAAC;QAC9B,MAAM,OAAO,aAAa,GAAG,CAAC,WAAW,QAAQ,OAAO,CAAC,GAAG,CAAC;QAE7D,IAAI,SAAS;QAEb,iBAAiB;QACjB,IAAI,MAAM;YACR,SAAS,MAAM,IAAA,yKAAmB,EAAC;QACrC,OAEK,IAAI,MAAM;YACb,SAAS,MAAM,IAAA,2KAAqB,EAAC;QACvC;QAEA,IAAI,CAAC,QAAQ;YACX,OAAO,gKAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,QAAQ;gBACR,SAAS;YACX;QACF;QAEA,OAAO,gKAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,QAAQ;gBACN,IAAI,OAAO,EAAE;gBACb,MAAM,OAAO,IAAI;gBACjB,MAAM,OAAO,IAAI;gBACjB,cAAc,OAAO,YAAY;gBACjC,UAAU,OAAO,QAAQ;YAC3B;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,gKAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAA2B,GACpD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}