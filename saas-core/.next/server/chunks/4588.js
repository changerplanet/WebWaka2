"use strict";exports.id=4588,exports.ids=[4588],exports.modules={56238:(e,t,i)=>{i.d(t,{xW:()=>c,eE:()=>o,KS:()=>p,qk:()=>n,_B:()=>m,G0:()=>l,ah:()=>u});var a=i(53524);let r=["TenantMembership","TenantDomain","AuditLog"],s=[];function d(e){let t={...e,timestamp:new Date};s.push(t),s.length>1e3&&s.shift(),console.error("[TENANT ISOLATION VIOLATION]",JSON.stringify(t,null,2))}function n(){return[...s]}function o(){s.length=0}class c extends Error{constructor(e,t,i,a){super(e),this.model=t,this.action=i,this.context=a,this.name="TenantIsolationError"}}function l(e,t,i,a){if(r.includes(e)){if(i?.bypassIsolation===!0){if(!i.isSuperAdmin){let r="Bypass isolation attempted without SUPER_ADMIN role";throw d({model:e,action:t,context:i,query:{queryTenantId:a},reason:r}),new c(r,e,t,i)}return}if(!i?.isSuperAdmin){if(!i){let r="No tenant context provided for tenant-scoped query";throw d({model:e,action:t,context:i,query:{queryTenantId:a},reason:r}),new c(r,e,t,i)}if(!i.tenantId){let r="No tenantId in context for tenant-scoped query";throw d({model:e,action:t,context:i,query:{queryTenantId:a},reason:r}),new c(r,e,t,i)}if(a&&a!==i.tenantId){let r=`Cross-tenant access attempt: query tenantId (${a}) != context tenantId (${i.tenantId})`;throw d({model:e,action:t,context:i,query:{queryTenantId:a},reason:r}),new c(r,e,t,i)}}}}function p(e,t,i,a=!1){return{tenantId:e,userId:t,isSuperAdmin:i,bypassIsolation:a}}function u(e,t){return{...e,tenantId:t}}let m=globalThis.prisma??new a.PrismaClient({log:["error"]})},84588:(e,t,i)=>{i.d(t,{$p:()=>y,Bf:()=>u,Cn:()=>I,Ox:()=>r,nA:()=>l,ri:()=>p,rt:()=>c,tc:()=>g,vp:()=>m});var a=i(56238);function r(e){return`${e}_${Date.now().toString(36)}${Math.random().toString(36).substring(2,9)}`}function s(e){return null==e?null:Number(e)}function d(e){return{id:e.id,tenantId:e.tenantId,name:e.name,description:e.description,countries:e.countries||[],states:e.states||[],postalCodes:e.postalCodes||[],cities:e.cities||[],isDefault:e.isDefault,isActive:e.isActive,priority:e.priority,rates:(e.rates||[]).map(n),createdAt:e.createdAt?.toISOString(),updatedAt:e.updatedAt?.toISOString()}}function n(e){return{id:e.id,zoneId:e.zoneId,name:e.name,description:e.description,carrier:e.carrier,rateType:e.rateType,flatRate:s(e.flatRate),weightRate:s(e.weightRate),baseWeightFee:s(e.baseWeightFee),percentageRate:s(e.percentageRate),perItemRate:s(e.perItemRate),minWeight:s(e.minWeight),maxWeight:s(e.maxWeight),minOrderTotal:s(e.minOrderTotal),maxOrderTotal:s(e.maxOrderTotal),freeAbove:s(e.freeAbove),minDays:e.minDays,maxDays:e.maxDays,allowedProductIds:e.allowedProductIds||[],excludedProductIds:e.excludedProductIds||[],allowedCategoryIds:e.allowedCategoryIds||[],excludedCategoryIds:e.excludedCategoryIds||[],isActive:e.isActive,priority:e.priority}}async function o(e){return[await a._B.svmShippingZone.create({data:{tenantId:e,name:"US Domestic",description:"Shipping within the United States",countries:["US"],states:[],postalCodes:[],cities:[],isDefault:!1,isActive:!0,priority:100,rates:{create:[{name:"Standard Shipping",description:"5-7 business days",carrier:"USPS",rateType:"FLAT",flatRate:5.99,freeAbove:50,minDays:5,maxDays:7,isActive:!0,priority:0,allowedProductIds:[],excludedProductIds:[],allowedCategoryIds:[],excludedCategoryIds:[]},{name:"Express Shipping",description:"2-3 business days",carrier:"UPS",rateType:"FLAT",flatRate:12.99,freeAbove:100,minDays:2,maxDays:3,isActive:!0,priority:1,allowedProductIds:[],excludedProductIds:[],allowedCategoryIds:[],excludedCategoryIds:[]},{name:"Overnight",description:"Next business day",carrier:"FedEx",rateType:"FLAT",flatRate:24.99,minDays:1,maxDays:1,isActive:!0,priority:2,allowedProductIds:[],excludedProductIds:[],allowedCategoryIds:[],excludedCategoryIds:[]}]}},include:{rates:!0}}),await a._B.svmShippingZone.create({data:{tenantId:e,name:"Canada",description:"Shipping to Canada",countries:["CA"],states:[],postalCodes:[],cities:[],isDefault:!1,isActive:!0,priority:90,rates:{create:[{name:"Standard Shipping",description:"7-14 business days",carrier:"USPS",rateType:"FLAT",flatRate:9.99,freeAbove:75,minDays:7,maxDays:14,isActive:!0,priority:0,allowedProductIds:[],excludedProductIds:[],allowedCategoryIds:[],excludedCategoryIds:[]},{name:"Express Shipping",description:"3-5 business days",carrier:"UPS",rateType:"FLAT",flatRate:19.99,minDays:3,maxDays:5,isActive:!0,priority:1,allowedProductIds:[],excludedProductIds:[],allowedCategoryIds:[],excludedCategoryIds:[]}]}},include:{rates:!0}}),await a._B.svmShippingZone.create({data:{tenantId:e,name:"International",description:"Worldwide shipping (default)",countries:[],states:[],postalCodes:[],cities:[],isDefault:!0,isActive:!0,priority:0,rates:{create:[{name:"International Standard",description:"14-21 business days",carrier:"USPS",rateType:"FLAT",flatRate:19.99,minDays:14,maxDays:21,isActive:!0,priority:0,allowedProductIds:[],excludedProductIds:[],allowedCategoryIds:[],excludedCategoryIds:[]},{name:"International Express",description:"5-10 business days",carrier:"DHL",rateType:"FLAT",flatRate:39.99,minDays:5,maxDays:10,isActive:!0,priority:1,allowedProductIds:[],excludedProductIds:[],allowedCategoryIds:[],excludedCategoryIds:[]}]}},include:{rates:!0}})].map(d)}async function c(e){let t=await a._B.svmShippingZone.findMany({where:{tenantId:e},include:{rates:!0},orderBy:{priority:"desc"}});return t.length>0?t.map(d):o(e)}async function l(e,t){let i=await a._B.svmShippingZone.findFirst({where:{id:t,tenantId:e},include:{rates:!0}});return i?d(i):null}async function p(e){await a._B.svmShippingZone.create({data:{id:e.id,tenantId:e.tenantId,name:e.name,description:e.description||null,countries:e.countries,states:e.states,postalCodes:e.postalCodes,cities:e.cities,isDefault:e.isDefault,isActive:e.isActive,priority:e.priority,rates:{create:e.rates.map(e=>({id:e.id,name:e.name,description:e.description,carrier:e.carrier,rateType:e.rateType,flatRate:e.flatRate,weightRate:e.weightRate,baseWeightFee:e.baseWeightFee,percentageRate:e.percentageRate,perItemRate:e.perItemRate,minWeight:e.minWeight,maxWeight:e.maxWeight,minOrderTotal:e.minOrderTotal,maxOrderTotal:e.maxOrderTotal,freeAbove:e.freeAbove,minDays:e.minDays,maxDays:e.maxDays,allowedProductIds:e.allowedProductIds||[],excludedProductIds:e.excludedProductIds||[],allowedCategoryIds:e.allowedCategoryIds||[],excludedCategoryIds:e.excludedCategoryIds||[],isActive:e.isActive,priority:e.priority}))}}})}async function u(e,t,i){return await a._B.svmShippingZone.findFirst({where:{id:t,tenantId:e}})?d(await a._B.svmShippingZone.update({where:{id:t},data:{name:i.name,description:i.description,countries:i.countries,states:i.states,postalCodes:i.postalCodes,cities:i.cities,isDefault:i.isDefault,isActive:i.isActive,priority:i.priority},include:{rates:!0}})):null}async function m(e,t){let i=await a._B.svmShippingZone.findFirst({where:{id:t,tenantId:e},include:{rates:!0}});return i?(await a._B.svmShippingZone.delete({where:{id:t}}),d(i)):null}async function y(e,t,i){return await a._B.svmShippingZone.findFirst({where:{id:t,tenantId:e}})?n(await a._B.svmShippingRate.create({data:{id:i.id,zoneId:t,name:i.name,description:i.description,carrier:i.carrier,rateType:i.rateType,flatRate:i.flatRate,weightRate:i.weightRate,baseWeightFee:i.baseWeightFee,percentageRate:i.percentageRate,perItemRate:i.perItemRate,minWeight:i.minWeight,maxWeight:i.maxWeight,minOrderTotal:i.minOrderTotal,maxOrderTotal:i.maxOrderTotal,freeAbove:i.freeAbove,minDays:i.minDays,maxDays:i.maxDays,allowedProductIds:i.allowedProductIds||[],excludedProductIds:i.excludedProductIds||[],allowedCategoryIds:i.allowedCategoryIds||[],excludedCategoryIds:i.excludedCategoryIds||[],isActive:i.isActive,priority:i.priority}})):null}async function g(e,t,i,r){return await a._B.svmShippingZone.findFirst({where:{id:t,tenantId:e}})&&await a._B.svmShippingRate.findFirst({where:{id:i,zoneId:t}})?n(await a._B.svmShippingRate.update({where:{id:i},data:{name:r.name,description:r.description,carrier:r.carrier,rateType:r.rateType,flatRate:r.flatRate,weightRate:r.weightRate,baseWeightFee:r.baseWeightFee,percentageRate:r.percentageRate,perItemRate:r.perItemRate,minWeight:r.minWeight,maxWeight:r.maxWeight,minOrderTotal:r.minOrderTotal,maxOrderTotal:r.maxOrderTotal,freeAbove:r.freeAbove,minDays:r.minDays,maxDays:r.maxDays,allowedProductIds:r.allowedProductIds,excludedProductIds:r.excludedProductIds,allowedCategoryIds:r.allowedCategoryIds,excludedCategoryIds:r.excludedCategoryIds,isActive:r.isActive,priority:r.priority}})):null}async function I(e,t,i){if(!await a._B.svmShippingZone.findFirst({where:{id:t,tenantId:e}}))return null;let r=await a._B.svmShippingRate.findFirst({where:{id:i,zoneId:t}});return r?(await a._B.svmShippingRate.delete({where:{id:i}}),n(r)):null}}};