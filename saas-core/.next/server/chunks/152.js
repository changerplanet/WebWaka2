exports.id=152,exports.ids=[152],exports.modules={3035:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,2994,23)),Promise.resolve().then(n.t.bind(n,6114,23)),Promise.resolve().then(n.t.bind(n,9727,23)),Promise.resolve().then(n.t.bind(n,9671,23)),Promise.resolve().then(n.t.bind(n,1868,23)),Promise.resolve().then(n.t.bind(n,4759,23))},7858:(e,t,n)=>{Promise.resolve().then(n.bind(n,660))},660:(e,t,n)=>{"use strict";n.d(t,{PWAProvider:()=>s});var a=n(326),r=n(7577),i=n(6862);let o=(0,r.createContext)(null);function s({children:e}){let t=(0,i.kr)(),{registration:n,updateAvailable:r,update:s,triggerSync:l,clearTenantCache:c}=(0,i.j3)();return a.jsx(o.Provider,{value:{isOnline:t,updateAvailable:r,update:s,triggerSync:l,clearTenantCache:c},children:e})}},6862:(e,t,n)=>{"use strict";n.d(t,{fh:()=>w,kr:()=>m,j3:()=>y});var a=n(7577);let r=["USER_DELETE","USER_INVITE","PERMISSION_CHANGE","PAYMENT_PROCESS","TENANT_DELETE","ADMIN_ACTION"],i={ACTIONS:"offlineActions",CACHE:"cachedData",META:"syncMeta"},o=null;function s(){return o||(o=new Promise((e,t)=>{if("undefined"==typeof indexedDB){t(Error("IndexedDB not available"));return}let n=indexedDB.open("saas-core-offline",1);n.onerror=()=>{console.error("Failed to open IndexedDB:",n.error),t(n.error)},n.onsuccess=()=>{e(n.result)},n.onupgradeneeded=e=>{let t=e.target.result;if(!t.objectStoreNames.contains(i.ACTIONS)){let e=t.createObjectStore(i.ACTIONS,{keyPath:"id"});e.createIndex("byTenant","tenantId",{unique:!1}),e.createIndex("byStatus","syncStatus",{unique:!1}),e.createIndex("byTenantStatus",["tenantId","syncStatus"],{unique:!1}),e.createIndex("byTimestamp","clientTimestamp",{unique:!1})}if(!t.objectStoreNames.contains(i.CACHE)){let e=t.createObjectStore(i.CACHE,{keyPath:["tenantId","key"]});e.createIndex("byTenant","tenantId",{unique:!1}),e.createIndex("byExpiry","expiresAt",{unique:!1})}t.objectStoreNames.contains(i.META)||t.createObjectStore(i.META,{keyPath:"key"})}}))}async function l(){return s()}async function c(e){let t=await l(),n={...e,id:crypto.randomUUID(),clientTimestamp:Date.now(),syncStatus:"pending",retryCount:0};return new Promise((e,a)=>{let r=t.transaction(i.ACTIONS,"readwrite").objectStore(i.ACTIONS).add(n);r.onsuccess=()=>e(n),r.onerror=()=>a(r.error)})}async function u(e){let t=await l();return new Promise((n,a)=>{let r=t.transaction(i.ACTIONS,"readonly").objectStore(i.ACTIONS).index("byTenant").getAll(IDBKeyRange.only(e));r.onsuccess=()=>{let e=r.result;e.sort((e,t)=>e.clientTimestamp-t.clientTimestamp),n(e)},r.onerror=()=>a(r.error)})}async function d(e,t){let n=await l();return new Promise((a,r)=>{let o=n.transaction(i.ACTIONS,"readwrite").objectStore(i.ACTIONS).index("byTenant").openCursor(IDBKeyRange.only(e)),s=0;o.onsuccess=()=>{let e=o.result;if(e){let n=e.value;(!t||n.syncStatus===t)&&(e.delete(),s++),e.continue()}else a(s)},o.onerror=()=>r(o.error)})}async function p(e){let t=await l();return new Promise((n,a)=>{let r=t.transaction(i.ACTIONS,"readwrite").objectStore(i.ACTIONS).index("byTenantStatus").openCursor(IDBKeyRange.only([e,"failed"])),o=0;r.onsuccess=()=>{let e=r.result;if(e){let t=e.value;t.syncStatus="pending",t.retryCount=0,t.errorMessage=void 0,e.update(t),o++,e.continue()}else n(o)},r.onerror=()=>a(r.error)})}async function f(e){let t=await u(e);return{pending:t.filter(e=>"pending"===e.syncStatus).length,syncing:t.filter(e=>"syncing"===e.syncStatus).length,synced:t.filter(e=>"synced"===e.syncStatus).length,failed:t.filter(e=>"failed"===e.syncStatus).length,conflict:t.filter(e=>"conflict"===e.syncStatus).length,total:t.length}}function m(){let[e,t]=(0,a.useState)("undefined"==typeof navigator||navigator.onLine);return e}function y(){let[e,t]=(0,a.useState)(null),[n,r]=(0,a.useState)(!1),i=(0,a.useCallback)(()=>{e?.waiting&&(e.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload())},[e]),o=(0,a.useCallback)(()=>{if(e){let t=new MessageChannel;e.active?.postMessage({type:"TRIGGER_SYNC"},[t.port2])}},[e]),s=(0,a.useCallback)(t=>{if(e){let n=new MessageChannel;e.active?.postMessage({type:"CLEAR_TENANT_CACHE",data:{tenantSlug:t}},[n.port2])}},[e]);return{registration:e,updateAvailable:n,update:i,triggerSync:o,clearTenantCache:s}}function w(e){let[t,n]=(0,a.useState)([]),[i,o]=(0,a.useState)({pending:0,syncing:0,synced:0,failed:0,conflict:0,total:0}),[l,y]=(0,a.useState)(!0),w=m(),h=(0,a.useCallback)(async()=>{try{await s();let[t,a]=await Promise.all([u(e),f(e)]);n(t),o(a)}catch(e){console.error("Failed to load offline actions:",e)}finally{y(!1)}},[e]);return{actions:t,stats:i,loading:l,isOnline:w,queue:(0,a.useCallback)(async(t,n,a,i,o,l,u)=>{if(r.includes(t))throw Error(`Action type ${t} is not allowed offline`);await s();let d=await c({tenantId:e,userId:o,type:t,endpoint:n,method:a,payload:i,resourceId:l,resourceVersion:u});return await h(),d},[e,h]),retryFailed:(0,a.useCallback)(async()=>{await s();let t=await p(e);return await h(),t},[e,h]),clear:(0,a.useCallback)(async t=>{await s();let n=await d(e,t);return await h(),n},[e,h]),refresh:h}}},731:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>y,generateMetadata:()=>f,viewport:()=>m});var a=n(9510),r=n(5317),i=n.n(r);n(5023);var o=n(1615),s=n(6238),l=n(2315);let c={id:"default",name:"SaaS Core",slug:"default",appName:"SaaS Core",logoUrl:null,faviconUrl:null,primaryColor:"#6366f1",secondaryColor:"#8b5cf6"};async function u(){try{let e=await (0,o.headers)(),t=await (0,o.cookies)(),n=e.get("x-tenant-slug")||t.get("tenant_slug")?.value,a=e.get("x-tenant-id"),r=e.get("host")||"",i=null;if(n&&(i=await (0,l.G_)(n)),!i&&r&&(i=await (0,l.FZ)(r)),!i&&a){let e=await s._B.tenant.findFirst({where:{id:a,status:"ACTIVE"},include:{domains:!0}});e&&(i={tenant:e,resolvedVia:"header"})}if(!i)return c;let u=i.tenant;return{id:u.id,name:u.name,slug:u.slug,appName:u.appName,logoUrl:u.logoUrl,faviconUrl:u.faviconUrl,primaryColor:u.primaryColor,secondaryColor:u.secondaryColor}}catch(e){return console.error("Failed to get tenant branding:",e),c}}var d=n(8570);(0,d.createProxy)(String.raw`/app/saas-core/src/components/PWAProvider.tsx#usePWA`);let p=(0,d.createProxy)(String.raw`/app/saas-core/src/components/PWAProvider.tsx#PWAProvider`);async function f(){let e=await u();return{title:e.appName,description:`${e.appName} - Multi-Tenant SaaS Platform`,manifest:`/manifest.json?tenant=${e.slug}`,icons:{icon:e.faviconUrl||"/favicon.ico",apple:e.faviconUrl||`/api/icons/icon-192?tenant=${e.slug}`},appleWebApp:{capable:!0,statusBarStyle:"default",title:e.appName}}}let m={width:"device-width",initialScale:1,maximumScale:1,themeColor:"#6366f1"};async function y({children:e}){let t=await u(),n=function(e){let t=e=>{let t=/^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(e);if(!t)return"239 84% 67%";let n=parseInt(t[1],16)/255,a=parseInt(t[2],16)/255,r=parseInt(t[3],16)/255,i=Math.max(n,a,r),o=Math.min(n,a,r),s=0,l=0,c=(i+o)/2;if(i!==o){let e=i-o;switch(l=c>.5?e/(2-i-o):e/(i+o),i){case n:s=((a-r)/e+(a<r?6:0))/6;break;case a:s=((r-n)/e+2)/6;break;case r:s=((n-a)/e+4)/6}}return`${Math.round(360*s)} ${Math.round(100*l)}% ${Math.round(100*c)}%`};return`
    :root {
      --brand-primary: ${e.primaryColor};
      --brand-secondary: ${e.secondaryColor};
      --primary: ${t(e.primaryColor)};
      --ring: ${t(e.primaryColor)};
    }
  `}(t);return(0,a.jsxs)("html",{lang:"en",children:[(0,a.jsxs)("head",{children:[a.jsx("style",{dangerouslySetInnerHTML:{__html:n}}),a.jsx("meta",{name:"theme-color",content:t.primaryColor}),a.jsx("meta",{name:"apple-mobile-web-app-capable",content:"yes"}),a.jsx("meta",{name:"apple-mobile-web-app-status-bar-style",content:"default"}),a.jsx("link",{rel:"apple-touch-icon",href:`/api/icons/icon-192?tenant=${t.slug}`})]}),a.jsx("body",{className:i().className,children:a.jsx(p,{children:e})})]})}},6238:(e,t,n)=>{"use strict";n.d(t,{xW:()=>c,eE:()=>l,KS:()=>d,qk:()=>s,_B:()=>f,G0:()=>u,ah:()=>p});var a=n(3524);let r=["TenantMembership","TenantDomain","AuditLog"],i=[];function o(e){let t={...e,timestamp:new Date};i.push(t),i.length>1e3&&i.shift(),console.error("[TENANT ISOLATION VIOLATION]",JSON.stringify(t,null,2))}function s(){return[...i]}function l(){i.length=0}class c extends Error{constructor(e,t,n,a){super(e),this.model=t,this.action=n,this.context=a,this.name="TenantIsolationError"}}function u(e,t,n,a){if(r.includes(e)){if(n?.bypassIsolation===!0){if(!n.isSuperAdmin){let r="Bypass isolation attempted without SUPER_ADMIN role";throw o({model:e,action:t,context:n,query:{queryTenantId:a},reason:r}),new c(r,e,t,n)}return}if(!n?.isSuperAdmin){if(!n){let r="No tenant context provided for tenant-scoped query";throw o({model:e,action:t,context:n,query:{queryTenantId:a},reason:r}),new c(r,e,t,n)}if(!n.tenantId){let r="No tenantId in context for tenant-scoped query";throw o({model:e,action:t,context:n,query:{queryTenantId:a},reason:r}),new c(r,e,t,n)}if(a&&a!==n.tenantId){let r=`Cross-tenant access attempt: query tenantId (${a}) != context tenantId (${n.tenantId})`;throw o({model:e,action:t,context:n,query:{queryTenantId:a},reason:r}),new c(r,e,t,n)}}}}function d(e,t,n,a=!1){return{tenantId:e,userId:t,isSuperAdmin:n,bypassIsolation:a}}function p(e,t){return{...e,tenantId:t}}let f=globalThis.prisma??new a.PrismaClient({log:["error"]})},2315:(e,t,n)=>{"use strict";n.d(t,{FZ:()=>r,G_:()=>i});var a=n(6238);async function r(e){let t=e.split(":")[0].toLowerCase(),n=await a._B.tenantDomain.findFirst({where:{domain:t,type:"CUSTOM",status:"VERIFIED"},include:{tenant:{include:{domains:!0}}}});if(n&&"ACTIVE"===n.tenant.status)return{tenant:n.tenant,resolvedVia:"custom_domain",domain:t};let r=t.split(".");if(r.length>=3){let e=r[0];if(!["www","api","app","admin","preview","localhost"].includes(e)){let t=await a._B.tenantDomain.findFirst({where:{domain:e,type:"SUBDOMAIN",status:"VERIFIED"},include:{tenant:{include:{domains:!0}}}});if(t&&"ACTIVE"===t.tenant.status)return{tenant:t.tenant,resolvedVia:"subdomain",domain:e};let n=await a._B.tenant.findFirst({where:{slug:e,status:"ACTIVE"},include:{domains:!0}});if(n)return{tenant:n,resolvedVia:"subdomain",domain:e}}}return null}async function i(e){let t=await a._B.tenantDomain.findFirst({where:{domain:e.toLowerCase(),type:"SUBDOMAIN"},include:{tenant:{include:{domains:!0}}}});if(t&&"ACTIVE"===t.tenant.status)return{tenant:t.tenant,resolvedVia:"query",domain:e};let n=await a._B.tenant.findFirst({where:{slug:e.toLowerCase(),status:"ACTIVE"},include:{domains:!0}});return n?{tenant:n,resolvedVia:"query",domain:e}:null}},5023:()=>{}};