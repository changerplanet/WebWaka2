"use strict";(()=>{var e={};e.id=2870,e.ids=[2870],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},80309:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>f,patchFetch:()=>h,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var i={};n.r(i),n.d(i,{GET:()=>d});var a=n(49303),r=n(88716),s=n(60670),o=n(87070),l=n(32315);async function d(e,{params:t}){try{let{size:n}=await t,{searchParams:i}=new URL(e.url),a=i.get("tenant"),r=parseInt(n.replace("icon-",""));if(isNaN(r)||r<16||r>1024)return o.NextResponse.json({error:"Invalid size"},{status:400});let s="#6366f1",d="#8b5cf6",u="S";if(a){let e=await (0,l.G_)(a);e&&(s=e.tenant.primaryColor,d=e.tenant.secondaryColor,u=e.tenant.appName.charAt(0).toUpperCase())}let c=`
      <svg xmlns="http://www.w3.org/2000/svg" width="${r}" height="${r}" viewBox="0 0 ${r} ${r}">
        <defs>
          <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:${s};stop-opacity:1" />
            <stop offset="100%" style="stop-color:${d};stop-opacity:1" />
          </linearGradient>
        </defs>
        <rect width="${r}" height="${r}" rx="${.2*r}" fill="url(#grad)"/>
        <text 
          x="50%" 
          y="50%" 
          dominant-baseline="central" 
          text-anchor="middle" 
          font-family="system-ui, -apple-system, sans-serif" 
          font-weight="bold" 
          font-size="${.5*r}" 
          fill="white"
        >${u}</text>
      </svg>
    `.trim();return new o.NextResponse(c,{headers:{"Content-Type":"image/svg+xml","Cache-Control":"public, max-age=86400",Vary:"Accept"}})}catch(t){console.error("Failed to generate icon:",t);let e=`
      <svg xmlns="http://www.w3.org/2000/svg" width="192" height="192" viewBox="0 0 192 192">
        <rect width="192" height="192" rx="38" fill="#6366f1"/>
        <text x="50%" y="50%" dominant-baseline="central" text-anchor="middle" font-family="sans-serif" font-weight="bold" font-size="96" fill="white">S</text>
      </svg>
    `.trim();return new o.NextResponse(e,{headers:{"Content-Type":"image/svg+xml","Cache-Control":"no-cache"}})}}let u=new a.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/icons/[size]/route",pathname:"/api/icons/[size]",filename:"route",bundlePath:"app/api/icons/[size]/route"},resolvedPagePath:"/app/saas-core/src/app/api/icons/[size]/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:c,staticGenerationAsyncStorage:p,serverHooks:m}=u,f="/api/icons/[size]/route";function h(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}},56238:(e,t,n)=>{n.d(t,{xW:()=>d,eE:()=>l,KS:()=>c,qk:()=>o,_B:()=>m,G0:()=>u,ah:()=>p});var i=n(53524);let a=["TenantMembership","TenantDomain","AuditLog"],r=[];function s(e){let t={...e,timestamp:new Date};r.push(t),r.length>1e3&&r.shift(),console.error("[TENANT ISOLATION VIOLATION]",JSON.stringify(t,null,2))}function o(){return[...r]}function l(){r.length=0}class d extends Error{constructor(e,t,n,i){super(e),this.model=t,this.action=n,this.context=i,this.name="TenantIsolationError"}}function u(e,t,n,i){if(a.includes(e)){if(n?.bypassIsolation===!0){if(!n.isSuperAdmin){let a="Bypass isolation attempted without SUPER_ADMIN role";throw s({model:e,action:t,context:n,query:{queryTenantId:i},reason:a}),new d(a,e,t,n)}return}if(!n?.isSuperAdmin){if(!n){let a="No tenant context provided for tenant-scoped query";throw s({model:e,action:t,context:n,query:{queryTenantId:i},reason:a}),new d(a,e,t,n)}if(!n.tenantId){let a="No tenantId in context for tenant-scoped query";throw s({model:e,action:t,context:n,query:{queryTenantId:i},reason:a}),new d(a,e,t,n)}if(i&&i!==n.tenantId){let a=`Cross-tenant access attempt: query tenantId (${i}) != context tenantId (${n.tenantId})`;throw s({model:e,action:t,context:n,query:{queryTenantId:i},reason:a}),new d(a,e,t,n)}}}}function c(e,t,n,i=!1){return{tenantId:e,userId:t,isSuperAdmin:n,bypassIsolation:i}}function p(e,t){return{...e,tenantId:t}}let m=globalThis.prisma??new i.PrismaClient({log:["error"]})},32315:(e,t,n)=>{n.d(t,{FZ:()=>a,G_:()=>r,sP:()=>s});var i=n(56238);async function a(e){let t=e.split(":")[0].toLowerCase(),n=await i._B.tenantDomain.findFirst({where:{domain:t,type:"CUSTOM",status:"VERIFIED"},include:{tenant:{include:{domains:!0}}}});if(n&&"ACTIVE"===n.tenant.status)return{tenant:n.tenant,resolvedVia:"custom_domain",domain:t};let a=t.split(".");if(a.length>=3){let e=a[0];if(!["www","api","app","admin","preview","localhost"].includes(e)){let t=await i._B.tenantDomain.findFirst({where:{domain:e,type:"SUBDOMAIN",status:"VERIFIED"},include:{tenant:{include:{domains:!0}}}});if(t&&"ACTIVE"===t.tenant.status)return{tenant:t.tenant,resolvedVia:"subdomain",domain:e};let n=await i._B.tenant.findFirst({where:{slug:e,status:"ACTIVE"},include:{domains:!0}});if(n)return{tenant:n,resolvedVia:"subdomain",domain:e}}}return null}async function r(e){let t=await i._B.tenantDomain.findFirst({where:{domain:e.toLowerCase(),type:"SUBDOMAIN"},include:{tenant:{include:{domains:!0}}}});if(t&&"ACTIVE"===t.tenant.status)return{tenant:t.tenant,resolvedVia:"query",domain:e};let n=await i._B.tenant.findFirst({where:{slug:e.toLowerCase(),status:"ACTIVE"},include:{domains:!0}});return n?{tenant:n,resolvedVia:"query",domain:e}:null}let s=async function(e){return i._B.tenant.findUnique({where:{slug:e},include:{domains:!0}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),i=t.X(0,[9380,5972],()=>n(80309));module.exports=i})();