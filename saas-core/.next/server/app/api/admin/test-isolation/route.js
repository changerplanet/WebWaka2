"use strict";(()=>{var e={};e.id=3395,e.ids=[3395],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6005:e=>{e.exports=require("node:crypto")},5784:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>g,patchFetch:()=>f,requestAsyncStorage:()=>y,routeModule:()=>h,serverHooks:()=>x,staticGenerationAsyncStorage:()=>m});var r={};s.r(r),s.d(r,{DELETE:()=>c,GET:()=>d,POST:()=>l});var n=s(49303),a=s(88716),o=s(60670),i=s(87070),u=s(56238),p=s(70340);async function d(e){try{let e=await (0,p.s3)();if(!e.authorized)return i.NextResponse.json({success:!1,error:e.error},{status:e.status});let t=(0,u.qk)();return i.NextResponse.json({success:!0,violationCount:t.length,violations:t.slice(-50)})}catch(e){return console.error("Failed to get violation logs:",e),i.NextResponse.json({success:!1,error:"Failed to get violation logs"},{status:500})}}async function l(e){try{let e=await (0,p.s3)();if(!e.authorized)return i.NextResponse.json({success:!1,error:e.error},{status:e.status});let t=[];(0,u.eE)();let s=await u._B.tenant.findMany({take:2});if(s.length<2)return i.NextResponse.json({success:!1,error:"Need at least 2 tenants for isolation testing"},{status:400});let r=s[0],n=s[1];try{(0,u.G0)("TenantMembership","findMany",null),await u._B.tenantMembership.findMany(),t.push({test:"Query without tenant context",passed:!1,error:"Should have thrown"})}catch(e){e instanceof u.xW?t.push({test:"Query without tenant context",passed:!0}):t.push({test:"Query without tenant context",passed:!1,error:String(e)})}try{let e=(0,u.KS)(r.id,"test-user",!1);(0,u.G0)("TenantMembership","findMany",e,n.id),t.push({test:"Cross-tenant query attempt",passed:!1,error:"Should have thrown"})}catch(e){e instanceof u.xW?t.push({test:"Cross-tenant query attempt",passed:!0}):t.push({test:"Cross-tenant query attempt",passed:!1,error:String(e)})}try{let e=(0,u.KS)(r.id,"test-user",!1);(0,u.G0)("TenantMembership","findMany",e,r.id),await u._B.tenantMembership.findMany({where:(0,u.ah)({},r.id)}),t.push({test:"Valid tenant-scoped query",passed:!0})}catch(e){t.push({test:"Valid tenant-scoped query",passed:!1,error:String(e)})}try{let s=(0,u.KS)(null,e.user.id,!0);(0,u.G0)("TenantMembership","findMany",s),await u._B.tenantMembership.findMany(),t.push({test:"Super admin cross-tenant query",passed:!0})}catch(e){t.push({test:"Super admin cross-tenant query",passed:!1,error:String(e)})}try{let e=(0,u.KS)(r.id,"test-user",!1,!0);(0,u.G0)("TenantMembership","findMany",e),t.push({test:"Non-admin bypass attempt",passed:!1,error:"Should have thrown"})}catch(e){e instanceof u.xW?t.push({test:"Non-admin bypass attempt",passed:!0}):t.push({test:"Non-admin bypass attempt",passed:!1,error:String(e)})}try{let s=(0,u.KS)(null,e.user.id,!0,!0);(0,u.G0)("TenantMembership","findMany",s),await u._B.tenantMembership.findMany(),t.push({test:"Super admin explicit bypass",passed:!0})}catch(e){t.push({test:"Super admin explicit bypass",passed:!1,error:String(e)})}try{(0,u.G0)("User","findMany",null),await u._B.user.findMany({take:1}),t.push({test:"Global model query without context",passed:!0})}catch(e){t.push({test:"Global model query without context",passed:!1,error:String(e)})}try{let e=(0,u.KS)(null,"test-user",!1);(0,u.G0)("TenantMembership","findMany",e),t.push({test:"Regular user without tenantId",passed:!1,error:"Should have thrown"})}catch(e){e instanceof u.xW?t.push({test:"Regular user without tenantId",passed:!0}):t.push({test:"Regular user without tenantId",passed:!1,error:String(e)})}let a=(0,u.qk)(),o=t.every(e=>e.passed);return i.NextResponse.json({success:!0,allPassed:o,results:t,violationsLogged:a.length,violations:a.slice(-10)})}catch(e){return console.error("Failed to run isolation tests:",e),i.NextResponse.json({success:!1,error:"Failed to run isolation tests: "+String(e)},{status:500})}}async function c(e){try{let e=await (0,p.s3)();if(!e.authorized)return i.NextResponse.json({success:!1,error:e.error},{status:e.status});return(0,u.eE)(),i.NextResponse.json({success:!0,message:"Violation logs cleared"})}catch(e){return console.error("Failed to clear violation logs:",e),i.NextResponse.json({success:!1,error:"Failed to clear violation logs"},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/test-isolation/route",pathname:"/api/admin/test-isolation",filename:"route",bundlePath:"app/api/admin/test-isolation/route"},resolvedPagePath:"/app/saas-core/src/app/api/admin/test-isolation/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:y,staticGenerationAsyncStorage:m,serverHooks:x}=h,g="/api/admin/test-isolation/route";function f(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:m})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[9380,5972,6970,340],()=>s(5784));module.exports=r})();