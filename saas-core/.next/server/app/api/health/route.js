"use strict";(()=>{var e={};e.id=8829,e.ids=[8829],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13186:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>m,patchFetch:()=>f,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>d});var r={};n.r(r),n.d(r,{GET:()=>p});var a=n(49303),o=n(88716),s=n(60670),i=n(87070),u=n(56238);async function p(){try{return await u._B.$queryRaw`SELECT 1`,i.NextResponse.json({status:"healthy",database:"connected",timestamp:new Date().toISOString(),version:"1.0.0"})}catch(e){return console.error("Health check failed:",e),i.NextResponse.json({status:"unhealthy",database:"disconnected",error:e instanceof Error?e.message:"Unknown database error",timestamp:new Date().toISOString()},{status:503})}}let c=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/health/route",pathname:"/api/health",filename:"route",bundlePath:"app/api/health/route"},resolvedPagePath:"/app/saas-core/src/app/api/health/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:h}=c,m="/api/health/route";function f(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:d})}},56238:(e,t,n)=>{n.d(t,{xW:()=>p,eE:()=>u,KS:()=>l,qk:()=>i,_B:()=>h,G0:()=>c,ah:()=>d});var r=n(53524);let a=["TenantMembership","TenantDomain","AuditLog"],o=[];function s(e){let t={...e,timestamp:new Date};o.push(t),o.length>1e3&&o.shift(),console.error("[TENANT ISOLATION VIOLATION]",JSON.stringify(t,null,2))}function i(){return[...o]}function u(){o.length=0}class p extends Error{constructor(e,t,n,r){super(e),this.model=t,this.action=n,this.context=r,this.name="TenantIsolationError"}}function c(e,t,n,r){if(a.includes(e)){if(n?.bypassIsolation===!0){if(!n.isSuperAdmin){let a="Bypass isolation attempted without SUPER_ADMIN role";throw s({model:e,action:t,context:n,query:{queryTenantId:r},reason:a}),new p(a,e,t,n)}return}if(!n?.isSuperAdmin){if(!n){let a="No tenant context provided for tenant-scoped query";throw s({model:e,action:t,context:n,query:{queryTenantId:r},reason:a}),new p(a,e,t,n)}if(!n.tenantId){let a="No tenantId in context for tenant-scoped query";throw s({model:e,action:t,context:n,query:{queryTenantId:r},reason:a}),new p(a,e,t,n)}if(r&&r!==n.tenantId){let a=`Cross-tenant access attempt: query tenantId (${r}) != context tenantId (${n.tenantId})`;throw s({model:e,action:t,context:n,query:{queryTenantId:r},reason:a}),new p(a,e,t,n)}}}}function l(e,t,n,r=!1){return{tenantId:e,userId:t,isSuperAdmin:n,bypassIsolation:r}}function d(e,t){return{...e,tenantId:t}}let h=globalThis.prisma??new r.PrismaClient({log:["error"]})}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[9380,5972],()=>n(13186));module.exports=r})();