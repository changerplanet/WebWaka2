"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/wallets/route";
exports.ids = ["app/api/wallets/route"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fwallets%2Froute&page=%2Fapi%2Fwallets%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fwallets%2Froute.ts&appDir=%2Fapp%2Fsaas-core%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp%2Fsaas-core&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fwallets%2Froute&page=%2Fapi%2Fwallets%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fwallets%2Froute.ts&appDir=%2Fapp%2Fsaas-core%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp%2Fsaas-core&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _app_saas_core_src_app_api_wallets_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/wallets/route.ts */ \"(rsc)/./src/app/api/wallets/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/wallets/route\",\n        pathname: \"/api/wallets\",\n        filename: \"route\",\n        bundlePath: \"app/api/wallets/route\"\n    },\n    resolvedPagePath: \"/app/saas-core/src/app/api/wallets/route.ts\",\n    nextConfigOutput,\n    userland: _app_saas_core_src_app_api_wallets_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/wallets/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZ3YWxsZXRzJTJGcm91dGUmcGFnZT0lMkZhcGklMkZ3YWxsZXRzJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGd2FsbGV0cyUyRnJvdXRlLnRzJmFwcERpcj0lMkZhcHAlMkZzYWFzLWNvcmUlMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRmFwcCUyRnNhYXMtY29yZSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDTDtBQUN4RTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL3NhYXMtY29yZS8/YmI2MCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvYXBwL3NhYXMtY29yZS9zcmMvYXBwL2FwaS93YWxsZXRzL3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS93YWxsZXRzL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvd2FsbGV0c1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvd2FsbGV0cy9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9hcHAvc2Fhcy1jb3JlL3NyYy9hcHAvYXBpL3dhbGxldHMvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL3dhbGxldHMvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fwallets%2Froute&page=%2Fapi%2Fwallets%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fwallets%2Froute.ts&appDir=%2Fapp%2Fsaas-core%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp%2Fsaas-core&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/wallets/route.ts":
/*!**************************************!*\
  !*** ./src/app/api/wallets/route.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./src/lib/prisma.ts\");\n/* harmony import */ var _lib_commerce_wallet_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/commerce-wallet-service */ \"(rsc)/./src/lib/commerce-wallet-service.ts\");\n/**\n * Commerce Wallets API\n * \n * GET /api/wallets - List wallets for tenant\n * POST /api/wallets - Create a new wallet\n */ \n\n\n/**\n * GET /api/wallets\n * List wallets for tenant with optional filters\n */ async function GET(request) {\n    try {\n        const { searchParams } = new URL(request.url);\n        const tenantId = searchParams.get(\"tenantId\");\n        const type = searchParams.get(\"type\");\n        const customerId = searchParams.get(\"customerId\");\n        const vendorId = searchParams.get(\"vendorId\");\n        const status = searchParams.get(\"status\");\n        const limit = parseInt(searchParams.get(\"limit\") || \"50\");\n        const offset = parseInt(searchParams.get(\"offset\") || \"0\");\n        if (!tenantId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"tenantId is required\"\n            }, {\n                status: 400\n            });\n        }\n        // Build where clause\n        const where = {\n            tenantId\n        };\n        if (type) where.type = type;\n        if (customerId) where.customerId = customerId;\n        if (vendorId) where.vendorId = vendorId;\n        if (status) where.status = status;\n        const [wallets, total] = await Promise.all([\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.commerceWallet.findMany({\n                where,\n                orderBy: {\n                    createdAt: \"desc\"\n                },\n                skip: offset,\n                take: limit\n            }),\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.commerceWallet.count({\n                where\n            })\n        ]);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            wallets: wallets.map((w)=>({\n                    id: w.id,\n                    tenantId: w.tenantId,\n                    type: w.type,\n                    customerId: w.customerId,\n                    vendorId: w.vendorId,\n                    balance: Number(w.balance),\n                    pendingBalance: Number(w.pendingBalance),\n                    availableBalance: Number(w.availableBalance),\n                    currency: w.currency,\n                    status: w.status,\n                    metadata: w.metadata,\n                    createdAt: w.createdAt.toISOString(),\n                    updatedAt: w.updatedAt.toISOString()\n                })),\n            pagination: {\n                total,\n                limit,\n                offset\n            }\n        });\n    } catch (error) {\n        console.error(\"[Wallets] Error listing wallets:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\n/**\n * POST /api/wallets\n * Create a new wallet or get existing one\n */ async function POST(request) {\n    try {\n        const body = await request.json();\n        const { tenantId, type, customerId, vendorId, currency, metadata } = body;\n        if (!tenantId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"tenantId is required\"\n            }, {\n                status: 400\n            });\n        }\n        if (!type || ![\n            \"CUSTOMER\",\n            \"VENDOR\",\n            \"PLATFORM\"\n        ].includes(type)) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"type must be CUSTOMER, VENDOR, or PLATFORM\"\n            }, {\n                status: 400\n            });\n        }\n        // Validate owner based on type\n        if (type === \"CUSTOMER\" && !customerId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"customerId is required for CUSTOMER wallet\"\n            }, {\n                status: 400\n            });\n        }\n        if (type === \"VENDOR\" && !vendorId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"vendorId is required for VENDOR wallet\"\n            }, {\n                status: 400\n            });\n        }\n        if (type === \"PLATFORM\" && (customerId || vendorId)) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"PLATFORM wallet should not have customerId or vendorId\"\n            }, {\n                status: 400\n            });\n        }\n        const wallet = await (0,_lib_commerce_wallet_service__WEBPACK_IMPORTED_MODULE_2__.getOrCreateWallet)({\n            tenantId,\n            type,\n            customerId,\n            vendorId,\n            currency,\n            metadata\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            wallet: {\n                id: wallet.id,\n                tenantId: wallet.tenantId,\n                type: wallet.type,\n                customerId: wallet.customerId,\n                vendorId: wallet.vendorId,\n                balance: Number(wallet.balance),\n                pendingBalance: Number(wallet.pendingBalance),\n                availableBalance: Number(wallet.availableBalance),\n                currency: wallet.currency,\n                status: wallet.status,\n                metadata: wallet.metadata,\n                createdAt: wallet.createdAt.toISOString(),\n                updatedAt: wallet.updatedAt.toISOString()\n            }\n        }, {\n            status: 201\n        });\n    } catch (error) {\n        console.error(\"[Wallets] Error creating wallet:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: error instanceof Error ? error.message : \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O2dCQUNiMUIsVUFBVXdDLE9BQU94QyxRQUFRO2dCQUN6QkUsTUFBTXNDLE9BQU90QyxJQUFJO2dCQUNqQkMsWUFBWXFDLE9BQU9yQyxVQUFVO2dCQUM3QkMsVUFBVW9DLE9BQU9wQyxRQUFRO2dCQUN6QnVCLFNBQVNDLE9BQU9ZLE9BQU9iLE9BQU87Z0JBQzlCRSxnQkFBZ0JELE9BQU9ZLE9BQU9YLGNBQWM7Z0JBQzVDQyxrQkFBa0JGLE9BQU9ZLE9BQU9WLGdCQUFnQjtnQkFDaERDLFVBQVVTLE9BQU9ULFFBQVE7Z0JBQ3pCMUIsUUFBUW1DLE9BQU9uQyxNQUFNO2dCQUNyQjJCLFVBQVVRLE9BQU9SLFFBQVE7Z0JBQ3pCWixXQUFXb0IsT0FBT3BCLFNBQVMsQ0FBQ2EsV0FBVztnQkFDdkNDLFdBQVdNLE9BQU9OLFNBQVMsQ0FBQ0QsV0FBVztZQUN6QztRQUNGLEdBQUc7WUFBRTVCLFFBQVE7UUFBSTtJQUVuQixFQUFFLE9BQU9NLE9BQU87UUFDZHlCLFFBQVF6QixLQUFLLENBQUMsb0NBQW9DQTtRQUNsRCxPQUFPbkIscURBQVlBLENBQUNpQixJQUFJLENBQ3RCO1lBQUVDLFNBQVM7WUFBT0MsT0FBT0EsaUJBQWlCOEIsUUFBUTlCLE1BQU0rQixPQUFPLEdBQUc7UUFBd0IsR0FDMUY7WUFBRXJDLFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2Fhcy1jb3JlLy4vc3JjL2FwcC9hcGkvd2FsbGV0cy9yb3V0ZS50cz8wYjE3Il0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29tbWVyY2UgV2FsbGV0cyBBUElcbiAqIFxuICogR0VUIC9hcGkvd2FsbGV0cyAtIExpc3Qgd2FsbGV0cyBmb3IgdGVuYW50XG4gKiBQT1NUIC9hcGkvd2FsbGV0cyAtIENyZWF0ZSBhIG5ldyB3YWxsZXRcbiAqL1xuXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICdAL2xpYi9wcmlzbWEnXG5pbXBvcnQgeyBnZXRPckNyZWF0ZVdhbGxldCB9IGZyb20gJ0AvbGliL2NvbW1lcmNlLXdhbGxldC1zZXJ2aWNlJ1xuXG50eXBlIENvbW1lcmNlV2FsbGV0VHlwZSA9ICdDVVNUT01FUicgfCAnVkVORE9SJyB8ICdQTEFURk9STSdcblxuLyoqXG4gKiBHRVQgL2FwaS93YWxsZXRzXG4gKiBMaXN0IHdhbGxldHMgZm9yIHRlbmFudCB3aXRoIG9wdGlvbmFsIGZpbHRlcnNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKVxuICAgIGNvbnN0IHRlbmFudElkID0gc2VhcmNoUGFyYW1zLmdldCgndGVuYW50SWQnKVxuICAgIGNvbnN0IHR5cGUgPSBzZWFyY2hQYXJhbXMuZ2V0KCd0eXBlJykgYXMgQ29tbWVyY2VXYWxsZXRUeXBlIHwgbnVsbFxuICAgIGNvbnN0IGN1c3RvbWVySWQgPSBzZWFyY2hQYXJhbXMuZ2V0KCdjdXN0b21lcklkJylcbiAgICBjb25zdCB2ZW5kb3JJZCA9IHNlYXJjaFBhcmFtcy5nZXQoJ3ZlbmRvcklkJylcbiAgICBjb25zdCBzdGF0dXMgPSBzZWFyY2hQYXJhbXMuZ2V0KCdzdGF0dXMnKVxuICAgIGNvbnN0IGxpbWl0ID0gcGFyc2VJbnQoc2VhcmNoUGFyYW1zLmdldCgnbGltaXQnKSB8fCAnNTAnKVxuICAgIGNvbnN0IG9mZnNldCA9IHBhcnNlSW50KHNlYXJjaFBhcmFtcy5nZXQoJ29mZnNldCcpIHx8ICcwJylcblxuICAgIGlmICghdGVuYW50SWQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICd0ZW5hbnRJZCBpcyByZXF1aXJlZCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgLy8gQnVpbGQgd2hlcmUgY2xhdXNlXG4gICAgY29uc3Qgd2hlcmU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0geyB0ZW5hbnRJZCB9XG4gICAgaWYgKHR5cGUpIHdoZXJlLnR5cGUgPSB0eXBlXG4gICAgaWYgKGN1c3RvbWVySWQpIHdoZXJlLmN1c3RvbWVySWQgPSBjdXN0b21lcklkXG4gICAgaWYgKHZlbmRvcklkKSB3aGVyZS52ZW5kb3JJZCA9IHZlbmRvcklkXG4gICAgaWYgKHN0YXR1cykgd2hlcmUuc3RhdHVzID0gc3RhdHVzXG5cbiAgICBjb25zdCBbd2FsbGV0cywgdG90YWxdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgcHJpc21hLmNvbW1lcmNlV2FsbGV0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgc2tpcDogb2Zmc2V0LFxuICAgICAgICB0YWtlOiBsaW1pdFxuICAgICAgfSksXG4gICAgICBwcmlzbWEuY29tbWVyY2VXYWxsZXQuY291bnQoeyB3aGVyZSB9KVxuICAgIF0pXG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHdhbGxldHM6IHdhbGxldHMubWFwKHcgPT4gKHtcbiAgICAgICAgaWQ6IHcuaWQsXG4gICAgICAgIHRlbmFudElkOiB3LnRlbmFudElkLFxuICAgICAgICB0eXBlOiB3LnR5cGUsXG4gICAgICAgIGN1c3RvbWVySWQ6IHcuY3VzdG9tZXJJZCxcbiAgICAgICAgdmVuZG9ySWQ6IHcudmVuZG9ySWQsXG4gICAgICAgIGJhbGFuY2U6IE51bWJlcih3LmJhbGFuY2UpLFxuICAgICAgICBwZW5kaW5nQmFsYW5jZTogTnVtYmVyKHcucGVuZGluZ0JhbGFuY2UpLFxuICAgICAgICBhdmFpbGFibGVCYWxhbmNlOiBOdW1iZXIody5hdmFpbGFibGVCYWxhbmNlKSxcbiAgICAgICAgY3VycmVuY3k6IHcuY3VycmVuY3ksXG4gICAgICAgIHN0YXR1czogdy5zdGF0dXMsXG4gICAgICAgIG1ldGFkYXRhOiB3Lm1ldGFkYXRhLFxuICAgICAgICBjcmVhdGVkQXQ6IHcuY3JlYXRlZEF0LnRvSVNPU3RyaW5nKCksXG4gICAgICAgIHVwZGF0ZWRBdDogdy51cGRhdGVkQXQudG9JU09TdHJpbmcoKVxuICAgICAgfSkpLFxuICAgICAgcGFnaW5hdGlvbjogeyB0b3RhbCwgbGltaXQsIG9mZnNldCB9XG4gICAgfSlcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tXYWxsZXRzXSBFcnJvciBsaXN0aW5nIHdhbGxldHM6JywgZXJyb3IpXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApXG4gIH1cbn1cblxuLyoqXG4gKiBQT1NUIC9hcGkvd2FsbGV0c1xuICogQ3JlYXRlIGEgbmV3IHdhbGxldCBvciBnZXQgZXhpc3Rpbmcgb25lXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpXG4gICAgY29uc3QgeyB0ZW5hbnRJZCwgdHlwZSwgY3VzdG9tZXJJZCwgdmVuZG9ySWQsIGN1cnJlbmN5LCBtZXRhZGF0YSB9ID0gYm9keVxuXG4gICAgaWYgKCF0ZW5hbnRJZCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ3RlbmFudElkIGlzIHJlcXVpcmVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBpZiAoIXR5cGUgfHwgIVsnQ1VTVE9NRVInLCAnVkVORE9SJywgJ1BMQVRGT1JNJ10uaW5jbHVkZXModHlwZSkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICd0eXBlIG11c3QgYmUgQ1VTVE9NRVIsIFZFTkRPUiwgb3IgUExBVEZPUk0nIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIG93bmVyIGJhc2VkIG9uIHR5cGVcbiAgICBpZiAodHlwZSA9PT0gJ0NVU1RPTUVSJyAmJiAhY3VzdG9tZXJJZCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ2N1c3RvbWVySWQgaXMgcmVxdWlyZWQgZm9yIENVU1RPTUVSIHdhbGxldCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgaWYgKHR5cGUgPT09ICdWRU5ET1InICYmICF2ZW5kb3JJZCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ3ZlbmRvcklkIGlzIHJlcXVpcmVkIGZvciBWRU5ET1Igd2FsbGV0JyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBpZiAodHlwZSA9PT0gJ1BMQVRGT1JNJyAmJiAoY3VzdG9tZXJJZCB8fCB2ZW5kb3JJZCkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdQTEFURk9STSB3YWxsZXQgc2hvdWxkIG5vdCBoYXZlIGN1c3RvbWVySWQgb3IgdmVuZG9ySWQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IHdhbGxldCA9IGF3YWl0IGdldE9yQ3JlYXRlV2FsbGV0KHtcbiAgICAgIHRlbmFudElkLFxuICAgICAgdHlwZSxcbiAgICAgIGN1c3RvbWVySWQsXG4gICAgICB2ZW5kb3JJZCxcbiAgICAgIGN1cnJlbmN5LFxuICAgICAgbWV0YWRhdGFcbiAgICB9KVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICB3YWxsZXQ6IHtcbiAgICAgICAgaWQ6IHdhbGxldC5pZCxcbiAgICAgICAgdGVuYW50SWQ6IHdhbGxldC50ZW5hbnRJZCxcbiAgICAgICAgdHlwZTogd2FsbGV0LnR5cGUsXG4gICAgICAgIGN1c3RvbWVySWQ6IHdhbGxldC5jdXN0b21lcklkLFxuICAgICAgICB2ZW5kb3JJZDogd2FsbGV0LnZlbmRvcklkLFxuICAgICAgICBiYWxhbmNlOiBOdW1iZXIod2FsbGV0LmJhbGFuY2UpLFxuICAgICAgICBwZW5kaW5nQmFsYW5jZTogTnVtYmVyKHdhbGxldC5wZW5kaW5nQmFsYW5jZSksXG4gICAgICAgIGF2YWlsYWJsZUJhbGFuY2U6IE51bWJlcih3YWxsZXQuYXZhaWxhYmxlQmFsYW5jZSksXG4gICAgICAgIGN1cnJlbmN5OiB3YWxsZXQuY3VycmVuY3ksXG4gICAgICAgIHN0YXR1czogd2FsbGV0LnN0YXR1cyxcbiAgICAgICAgbWV0YWRhdGE6IHdhbGxldC5tZXRhZGF0YSxcbiAgICAgICAgY3JlYXRlZEF0OiB3YWxsZXQuY3JlYXRlZEF0LnRvSVNPU3RyaW5nKCksXG4gICAgICAgIHVwZGF0ZWRBdDogd2FsbGV0LnVwZGF0ZWRBdC50b0lTT1N0cmluZygpXG4gICAgICB9XG4gICAgfSwgeyBzdGF0dXM6IDIwMSB9KVxuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1dhbGxldHNdIEVycm9yIGNyZWF0aW5nIHdhbGxldDonLCBlcnJvcilcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKVxuICB9XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwicHJpc21hIiwiZ2V0T3JDcmVhdGVXYWxsZXQiLCJHRVQiLCJyZXF1ZXN0Iiwic2VhcmNoUGFyYW1zIiwiVVJMIiwidXJsIiwidGVuYW50SWQiLCJnZXQiLCJ0eXBlIiwiY3VzdG9tZXJJZCIsInZlbmRvcklkIiwic3RhdHVzIiwibGltaXQiLCJwYXJzZUludCIsIm9mZnNldCIsImpzb24iLCJzdWNjZXNzIiwiZXJyb3IiLCJ3aGVyZSIsIndhbGxldHMiLCJ0b3RhbCIsIlByb21pc2UiLCJhbGwiLCJjb21tZXJjZVdhbGxldCIsImZpbmRNYW55Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsInNraXAiLCJ0YWtlIiwiY291bnQiLCJtYXAiLCJ3IiwiaWQiLCJiYWxhbmNlIiwiTnVtYmVyIiwicGVuZGluZ0JhbGFuY2UiLCJhdmFpbGFibGVCYWxhbmNlIiwiY3VycmVuY3kiLCJtZXRhZGF0YSIsInRvSVNPU3RyaW5nIiwidXBkYXRlZEF0IiwicGFnaW5hdGlvbiIsImNvbnNvbGUiLCJQT1NUIiwiYm9keSIsImluY2x1ZGVzIiwid2FsbGV0IiwiRXJyb3IiLCJtZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/wallets/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/commerce-wallet-service.ts":
/*!********************************************!*\
  !*** ./src/lib/commerce-wallet-service.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   captureHold: () => (/* binding */ captureHold),\n/* harmony export */   createHold: () => (/* binding */ createHold),\n/* harmony export */   createLedgerEntry: () => (/* binding */ createLedgerEntry),\n/* harmony export */   creditWallet: () => (/* binding */ creditWallet),\n/* harmony export */   debitWallet: () => (/* binding */ debitWallet),\n/* harmony export */   getLedgerEntries: () => (/* binding */ getLedgerEntries),\n/* harmony export */   getOrCreateWallet: () => (/* binding */ getOrCreateWallet),\n/* harmony export */   getWallet: () => (/* binding */ getWallet),\n/* harmony export */   getWalletWithLedger: () => (/* binding */ getWalletWithLedger),\n/* harmony export */   recalculateBalance: () => (/* binding */ recalculateBalance),\n/* harmony export */   releaseHold: () => (/* binding */ releaseHold),\n/* harmony export */   transferFunds: () => (/* binding */ transferFunds)\n/* harmony export */ });\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./src/lib/prisma.ts\");\n/**\n * Commerce Wallet Service\n * \n * Ledger-based wallet operations for Customer, Vendor, and Platform wallets.\n * All balance changes go through the ledger - wallet.balance is just a cache.\n */ \n/**\n * Get or create a wallet for an owner\n */ async function getOrCreateWallet(params) {\n    const { tenantId, type, customerId, vendorId, currency = \"USD\", metadata } = params;\n    // Build where clause for findFirst (handles nullable fields better)\n    const whereClause = {\n        tenantId,\n        type,\n        customerId: customerId || null,\n        vendorId: vendorId || null\n    };\n    // Try to find existing wallet\n    let wallet = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.commerceWallet.findFirst({\n        where: whereClause\n    });\n    if (!wallet) {\n        // Create new wallet\n        wallet = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.commerceWallet.create({\n            data: {\n                tenantId,\n                type,\n                customerId: customerId || null,\n                vendorId: vendorId || null,\n                currency,\n                balance: 0,\n                pendingBalance: 0,\n                availableBalance: 0,\n                metadata: metadata || undefined\n            }\n        });\n    }\n    return wallet;\n}\n/**\n * Get wallet by ID\n */ async function getWallet(walletId) {\n    return _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.commerceWallet.findUnique({\n        where: {\n            id: walletId\n        }\n    });\n}\n/**\n * Get wallet with recent ledger entries\n */ async function getWalletWithLedger(walletId, limit = 50) {\n    const wallet = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.commerceWallet.findUnique({\n        where: {\n            id: walletId\n        },\n        include: {\n            ledgerEntries: {\n                orderBy: {\n                    createdAt: \"desc\"\n                },\n                take: limit\n            }\n        }\n    });\n    return wallet;\n}\n/**\n * Create a ledger entry and update wallet balance\n * This is the core function - ALL balance changes go through here\n */ async function createLedgerEntry(params) {\n    const { walletId, entryType, amount, description, referenceType, referenceId, counterpartyWalletId, holdId, idempotencyKey, metadata, createdBy } = params;\n    // Use transaction to ensure atomicity\n    return _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n        // Get wallet with lock\n        const wallet = await tx.commerceWallet.findUnique({\n            where: {\n                id: walletId\n            }\n        });\n        if (!wallet) {\n            throw new Error(`Wallet not found: ${walletId}`);\n        }\n        if (wallet.status !== \"ACTIVE\") {\n            throw new Error(`Wallet is not active: ${wallet.status}`);\n        }\n        // Check for duplicate idempotency key\n        const existingEntry = await tx.commerceWalletLedger.findUnique({\n            where: {\n                idempotencyKey\n            }\n        });\n        if (existingEntry) {\n            // Return existing entry (idempotent)\n            return {\n                entry: existingEntry,\n                wallet,\n                isDuplicate: true\n            };\n        }\n        // Calculate new balances based on entry type\n        let newBalance = Number(wallet.balance);\n        let newPendingBalance = Number(wallet.pendingBalance);\n        // Determine if this is a credit, debit, or hold operation\n        if (entryType.startsWith(\"CREDIT_\")) {\n            newBalance += amount;\n        } else if (entryType.startsWith(\"DEBIT_\")) {\n            // Check sufficient balance for debits\n            if (newBalance < amount) {\n                throw new Error(`Insufficient balance. Available: ${newBalance}, Required: ${amount}`);\n            }\n            newBalance -= amount;\n        } else if (entryType === \"HOLD_CREATED\") {\n            // Hold reduces available balance but not total balance\n            if (Number(wallet.availableBalance) < amount) {\n                throw new Error(`Insufficient available balance for hold. Available: ${wallet.availableBalance}, Required: ${amount}`);\n            }\n            newPendingBalance += amount;\n        } else if (entryType === \"HOLD_RELEASED\") {\n            // Release hold back to available\n            newPendingBalance -= amount;\n        } else if (entryType === \"HOLD_CAPTURED\") {\n            // Convert hold to actual debit\n            newPendingBalance -= amount;\n            newBalance -= amount;\n        }\n        const newAvailableBalance = newBalance - newPendingBalance;\n        // Create ledger entry\n        const entry = await tx.commerceWalletLedger.create({\n            data: {\n                walletId,\n                entryType,\n                status: \"COMPLETED\",\n                amount: entryType.startsWith(\"DEBIT_\") || entryType === \"HOLD_CAPTURED\" ? -amount : amount,\n                currency: wallet.currency,\n                balanceAfter: newBalance,\n                pendingBalanceAfter: newPendingBalance,\n                availableBalanceAfter: newAvailableBalance,\n                referenceType,\n                referenceId,\n                counterpartyWalletId,\n                holdId,\n                idempotencyKey,\n                description,\n                metadata: metadata || undefined,\n                createdBy\n            }\n        });\n        // Update wallet balance cache\n        const updatedWallet = await tx.commerceWallet.update({\n            where: {\n                id: walletId\n            },\n            data: {\n                balance: newBalance,\n                pendingBalance: newPendingBalance,\n                availableBalance: newAvailableBalance\n            }\n        });\n        return {\n            entry,\n            wallet: updatedWallet,\n            isDuplicate: false\n        };\n    });\n}\n/**\n * Transfer funds between wallets\n */ async function transferFunds(params) {\n    const { fromWalletId, toWalletId, amount, description, referenceType, referenceId, idempotencyKey, createdBy } = params;\n    if (amount <= 0) {\n        throw new Error(\"Transfer amount must be positive\");\n    }\n    // Use transaction for atomic transfer\n    return _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n        // Get both wallets\n        const fromWallet = await tx.commerceWallet.findUnique({\n            where: {\n                id: fromWalletId\n            }\n        });\n        const toWallet = await tx.commerceWallet.findUnique({\n            where: {\n                id: toWalletId\n            }\n        });\n        if (!fromWallet) throw new Error(`Source wallet not found: ${fromWalletId}`);\n        if (!toWallet) throw new Error(`Destination wallet not found: ${toWalletId}`);\n        if (fromWallet.status !== \"ACTIVE\") throw new Error(`Source wallet is not active`);\n        if (toWallet.status !== \"ACTIVE\") throw new Error(`Destination wallet is not active`);\n        if (Number(fromWallet.availableBalance) < amount) {\n            throw new Error(`Insufficient balance. Available: ${fromWallet.availableBalance}, Required: ${amount}`);\n        }\n        // Check idempotency\n        const existingDebit = await tx.commerceWalletLedger.findUnique({\n            where: {\n                idempotencyKey: `${idempotencyKey}_debit`\n            }\n        });\n        if (existingDebit) {\n            return {\n                success: true,\n                isDuplicate: true\n            };\n        }\n        // Create debit entry (from wallet)\n        const newFromBalance = Number(fromWallet.balance) - amount;\n        const newFromAvailable = newFromBalance - Number(fromWallet.pendingBalance);\n        await tx.commerceWalletLedger.create({\n            data: {\n                walletId: fromWalletId,\n                entryType: \"DEBIT_TRANSFER_OUT\",\n                status: \"COMPLETED\",\n                amount: -amount,\n                currency: fromWallet.currency,\n                balanceAfter: newFromBalance,\n                pendingBalanceAfter: Number(fromWallet.pendingBalance),\n                availableBalanceAfter: newFromAvailable,\n                referenceType,\n                referenceId,\n                counterpartyWalletId: toWalletId,\n                idempotencyKey: `${idempotencyKey}_debit`,\n                description: description || `Transfer to wallet ${toWalletId}`,\n                createdBy\n            }\n        });\n        await tx.commerceWallet.update({\n            where: {\n                id: fromWalletId\n            },\n            data: {\n                balance: newFromBalance,\n                availableBalance: newFromAvailable\n            }\n        });\n        // Create credit entry (to wallet)\n        const newToBalance = Number(toWallet.balance) + amount;\n        const newToAvailable = newToBalance - Number(toWallet.pendingBalance);\n        await tx.commerceWalletLedger.create({\n            data: {\n                walletId: toWalletId,\n                entryType: \"CREDIT_TRANSFER_IN\",\n                status: \"COMPLETED\",\n                amount: amount,\n                currency: toWallet.currency,\n                balanceAfter: newToBalance,\n                pendingBalanceAfter: Number(toWallet.pendingBalance),\n                availableBalanceAfter: newToAvailable,\n                referenceType,\n                referenceId,\n                counterpartyWalletId: fromWalletId,\n                idempotencyKey: `${idempotencyKey}_credit`,\n                description: description || `Transfer from wallet ${fromWalletId}`,\n                createdBy\n            }\n        });\n        await tx.commerceWallet.update({\n            where: {\n                id: toWalletId\n            },\n            data: {\n                balance: newToBalance,\n                availableBalance: newToAvailable\n            }\n        });\n        return {\n            success: true,\n            isDuplicate: false\n        };\n    });\n}\n/**\n * Credit a wallet (add funds)\n */ async function creditWallet(walletId, amount, entryType, idempotencyKey, options) {\n    if (!entryType.startsWith(\"CREDIT_\")) {\n        throw new Error(`Invalid credit entry type: ${entryType}`);\n    }\n    return createLedgerEntry({\n        walletId,\n        entryType,\n        amount,\n        idempotencyKey,\n        ...options\n    });\n}\n/**\n * Debit a wallet (remove funds)\n */ async function debitWallet(walletId, amount, entryType, idempotencyKey, options) {\n    if (!entryType.startsWith(\"DEBIT_\")) {\n        throw new Error(`Invalid debit entry type: ${entryType}`);\n    }\n    return createLedgerEntry({\n        walletId,\n        entryType,\n        amount,\n        idempotencyKey,\n        ...options\n    });\n}\n/**\n * Create a hold on wallet funds\n */ async function createHold(walletId, amount, holdId, options) {\n    return createLedgerEntry({\n        walletId,\n        entryType: \"HOLD_CREATED\",\n        amount,\n        holdId,\n        idempotencyKey: `hold_create_${holdId}`,\n        ...options\n    });\n}\n/**\n * Release a hold (return funds to available)\n */ async function releaseHold(walletId, amount, holdId, options) {\n    return createLedgerEntry({\n        walletId,\n        entryType: \"HOLD_RELEASED\",\n        amount,\n        holdId,\n        idempotencyKey: `hold_release_${holdId}`,\n        ...options\n    });\n}\n/**\n * Capture a hold (convert to actual debit)\n */ async function captureHold(walletId, amount, holdId, options) {\n    return createLedgerEntry({\n        walletId,\n        entryType: \"HOLD_CAPTURED\",\n        amount,\n        holdId,\n        idempotencyKey: `hold_capture_${holdId}`,\n        ...options\n    });\n}\n/**\n * Recalculate wallet balance from ledger (for reconciliation)\n */ async function recalculateBalance(walletId) {\n    const entries = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.commerceWalletLedger.findMany({\n        where: {\n            walletId,\n            status: \"COMPLETED\"\n        },\n        orderBy: {\n            createdAt: \"asc\"\n        }\n    });\n    let balance = 0;\n    let pendingBalance = 0;\n    const holds = {};\n    for (const entry of entries){\n        if (entry.entryType.startsWith(\"CREDIT_\")) {\n            balance += Number(entry.amount);\n        } else if (entry.entryType.startsWith(\"DEBIT_\")) {\n            balance += Number(entry.amount) // amount is negative for debits\n            ;\n        } else if (entry.entryType === \"HOLD_CREATED\" && entry.holdId) {\n            holds[entry.holdId] = Number(entry.amount);\n            pendingBalance += Number(entry.amount);\n        } else if (entry.entryType === \"HOLD_RELEASED\" && entry.holdId) {\n            pendingBalance -= holds[entry.holdId] || Number(entry.amount);\n            delete holds[entry.holdId];\n        } else if (entry.entryType === \"HOLD_CAPTURED\" && entry.holdId) {\n            balance += Number(entry.amount) // negative amount\n            ;\n            pendingBalance -= holds[entry.holdId] || Math.abs(Number(entry.amount));\n            delete holds[entry.holdId];\n        }\n    }\n    const availableBalance = balance - pendingBalance;\n    // Update wallet\n    const wallet = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.commerceWallet.update({\n        where: {\n            id: walletId\n        },\n        data: {\n            balance,\n            pendingBalance,\n            availableBalance\n        }\n    });\n    return {\n        wallet,\n        calculatedBalance: balance,\n        pendingBalance,\n        availableBalance,\n        entryCount: entries.length\n    };\n}\n/**\n * Get ledger entries for a wallet\n */ async function getLedgerEntries(walletId, options) {\n    const { limit = 50, offset = 0, entryType, referenceType, referenceId, startDate, endDate } = options || {};\n    const where = {\n        walletId\n    };\n    if (entryType) where.entryType = entryType;\n    if (referenceType) where.referenceType = referenceType;\n    if (referenceId) where.referenceId = referenceId;\n    if (startDate || endDate) {\n        where.createdAt = {};\n        if (startDate) where.createdAt.gte = startDate;\n        if (endDate) where.createdAt.lte = endDate;\n    }\n    const [entries, total] = await Promise.all([\n        _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.commerceWalletLedger.findMany({\n            where,\n            orderBy: {\n                createdAt: \"desc\"\n            },\n            skip: offset,\n            take: limit\n        }),\n        _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.commerceWalletLedger.count({\n            where\n        })\n    ]);\n    return {\n        entries,\n        total,\n        limit,\n        offset\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2NvbW1lcmNlLXdhbGxldC1zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7Ozs7Q0FLQyxHQUVvQztBQTZDckM7O0NBRUMsR0FDTSxlQUFlQyxrQkFBa0JDLE1BQTBCO0lBQ2hFLE1BQU0sRUFBRUMsUUFBUSxFQUFFQyxJQUFJLEVBQUVDLFVBQVUsRUFBRUMsUUFBUSxFQUFFQyxXQUFXLEtBQUssRUFBRUMsUUFBUSxFQUFFLEdBQUdOO0lBRTdFLG9FQUFvRTtJQUNwRSxNQUFNTyxjQUFjO1FBQ2xCTjtRQUNBQztRQUNBQyxZQUFZQSxjQUFjO1FBQzFCQyxVQUFVQSxZQUFZO0lBQ3hCO0lBRUEsOEJBQThCO0lBQzlCLElBQUlJLFNBQVMsTUFBTVYsK0NBQU1BLENBQUNXLGNBQWMsQ0FBQ0MsU0FBUyxDQUFDO1FBQUVDLE9BQU9KO0lBQVk7SUFFeEUsSUFBSSxDQUFDQyxRQUFRO1FBQ1gsb0JBQW9CO1FBQ3BCQSxTQUFTLE1BQU1WLCtDQUFNQSxDQUFDVyxjQUFjLENBQUNHLE1BQU0sQ0FBQztZQUMxQ0MsTUFBTTtnQkFDSlo7Z0JBQ0FDO2dCQUNBQyxZQUFZQSxjQUFjO2dCQUMxQkMsVUFBVUEsWUFBWTtnQkFDdEJDO2dCQUNBUyxTQUFTO2dCQUNUQyxnQkFBZ0I7Z0JBQ2hCQyxrQkFBa0I7Z0JBQ2xCVixVQUFVQSxZQUFZVztZQUN4QjtRQUNGO0lBQ0Y7SUFFQSxPQUFPVDtBQUNUO0FBRUE7O0NBRUMsR0FDTSxlQUFlVSxVQUFVQyxRQUFnQjtJQUM5QyxPQUFPckIsK0NBQU1BLENBQUNXLGNBQWMsQ0FBQ1csVUFBVSxDQUFDO1FBQ3RDVCxPQUFPO1lBQUVVLElBQUlGO1FBQVM7SUFDeEI7QUFDRjtBQUVBOztDQUVDLEdBQ00sZUFBZUcsb0JBQW9CSCxRQUFnQixFQUFFSSxRQUFRLEVBQUU7SUFDcEUsTUFBTWYsU0FBUyxNQUFNViwrQ0FBTUEsQ0FBQ1csY0FBYyxDQUFDVyxVQUFVLENBQUM7UUFDcERU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WUFDTnhELE1BQU1MO1FBQ1I7UUFDQXpCLCtDQUFNQSxDQUFDOEMsb0JBQW9CLENBQUNpRCxLQUFLLENBQUM7WUFBRWxGO1FBQU07S0FDM0M7SUFFRCxPQUFPO1FBQUVnRTtRQUFTYztRQUFPbEU7UUFBTzZEO0lBQU87QUFDekMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zYWFzLWNvcmUvLi9zcmMvbGliL2NvbW1lcmNlLXdhbGxldC1zZXJ2aWNlLnRzPzcyNWYiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb21tZXJjZSBXYWxsZXQgU2VydmljZVxuICogXG4gKiBMZWRnZXItYmFzZWQgd2FsbGV0IG9wZXJhdGlvbnMgZm9yIEN1c3RvbWVyLCBWZW5kb3IsIGFuZCBQbGF0Zm9ybSB3YWxsZXRzLlxuICogQWxsIGJhbGFuY2UgY2hhbmdlcyBnbyB0aHJvdWdoIHRoZSBsZWRnZXIgLSB3YWxsZXQuYmFsYW5jZSBpcyBqdXN0IGEgY2FjaGUuXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnQC9saWIvcHJpc21hJ1xuaW1wb3J0IHsgUHJpc21hIH0gZnJvbSAnQHByaXNtYS9jbGllbnQnXG5cbnR5cGUgQ29tbWVyY2VXYWxsZXRUeXBlID0gJ0NVU1RPTUVSJyB8ICdWRU5ET1InIHwgJ1BMQVRGT1JNJ1xudHlwZSBMZWRnZXJFbnRyeVR5cGUgPSBcbiAgfCAnQ1JFRElUX09SREVSX1BBWU1FTlQnIHwgJ0NSRURJVF9SRUZVTkQnIHwgJ0NSRURJVF9TQUxFX1BST0NFRURTJyBcbiAgfCAnQ1JFRElUX1BMQVRGT1JNX0ZFRScgfCAnQ1JFRElUX0FESlVTVE1FTlQnIHwgJ0NSRURJVF9UUkFOU0ZFUl9JTicgfCAnQ1JFRElUX1BBWU9VVF9SRVZFUlNBTCdcbiAgfCAnREVCSVRfT1JERVJfUEFZTUVOVCcgfCAnREVCSVRfVkVORE9SX0NPTU1JU1NJT04nIHwgJ0RFQklUX1BMQVRGT1JNX0ZFRSdcbiAgfCAnREVCSVRfUEFZT1VUJyB8ICdERUJJVF9BREpVU1RNRU5UJyB8ICdERUJJVF9UUkFOU0ZFUl9PVVQnIHwgJ0RFQklUX0NIQVJHRUJBQ0snXG4gIHwgJ0hPTERfQ1JFQVRFRCcgfCAnSE9MRF9SRUxFQVNFRCcgfCAnSE9MRF9DQVBUVVJFRCdcblxuaW50ZXJmYWNlIENyZWF0ZVdhbGxldFBhcmFtcyB7XG4gIHRlbmFudElkOiBzdHJpbmdcbiAgdHlwZTogQ29tbWVyY2VXYWxsZXRUeXBlXG4gIGN1c3RvbWVySWQ/OiBzdHJpbmdcbiAgdmVuZG9ySWQ/OiBzdHJpbmdcbiAgY3VycmVuY3k/OiBzdHJpbmdcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxufVxuXG5pbnRlcmZhY2UgTGVkZ2VyRW50cnlQYXJhbXMge1xuICB3YWxsZXRJZDogc3RyaW5nXG4gIGVudHJ5VHlwZTogTGVkZ2VyRW50cnlUeXBlXG4gIGFtb3VudDogbnVtYmVyIC8vIFBvc2l0aXZlIGZvciBjcmVkaXRzLCBuZWdhdGl2ZSBmb3IgZGViaXRzXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nXG4gIHJlZmVyZW5jZVR5cGU/OiBzdHJpbmdcbiAgcmVmZXJlbmNlSWQ/OiBzdHJpbmdcbiAgY291bnRlcnBhcnR5V2FsbGV0SWQ/OiBzdHJpbmdcbiAgaG9sZElkPzogc3RyaW5nXG4gIGlkZW1wb3RlbmN5S2V5OiBzdHJpbmdcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuICBjcmVhdGVkQnk/OiBzdHJpbmdcbn1cblxuaW50ZXJmYWNlIFRyYW5zZmVyUGFyYW1zIHtcbiAgZnJvbVdhbGxldElkOiBzdHJpbmdcbiAgdG9XYWxsZXRJZDogc3RyaW5nXG4gIGFtb3VudDogbnVtYmVyXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nXG4gIHJlZmVyZW5jZVR5cGU/OiBzdHJpbmdcbiAgcmVmZXJlbmNlSWQ/OiBzdHJpbmdcbiAgaWRlbXBvdGVuY3lLZXk6IHN0cmluZ1xuICBjcmVhdGVkQnk/OiBzdHJpbmdcbn1cblxuLyoqXG4gKiBHZXQgb3IgY3JlYXRlIGEgd2FsbGV0IGZvciBhbiBvd25lclxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0T3JDcmVhdGVXYWxsZXQocGFyYW1zOiBDcmVhdGVXYWxsZXRQYXJhbXMpIHtcbiAgY29uc3QgeyB0ZW5hbnRJZCwgdHlwZSwgY3VzdG9tZXJJZCwgdmVuZG9ySWQsIGN1cnJlbmN5ID0gJ1VTRCcsIG1ldGFkYXRhIH0gPSBwYXJhbXNcblxuICAvLyBCdWlsZCB3aGVyZSBjbGF1c2UgZm9yIGZpbmRGaXJzdCAoaGFuZGxlcyBudWxsYWJsZSBmaWVsZHMgYmV0dGVyKVxuICBjb25zdCB3aGVyZUNsYXVzZSA9IHtcbiAgICB0ZW5hbnRJZCxcbiAgICB0eXBlLFxuICAgIGN1c3RvbWVySWQ6IGN1c3RvbWVySWQgfHwgbnVsbCxcbiAgICB2ZW5kb3JJZDogdmVuZG9ySWQgfHwgbnVsbFxuICB9XG5cbiAgLy8gVHJ5IHRvIGZpbmQgZXhpc3Rpbmcgd2FsbGV0XG4gIGxldCB3YWxsZXQgPSBhd2FpdCBwcmlzbWEuY29tbWVyY2VXYWxsZXQuZmluZEZpcnN0KHsgd2hlcmU6IHdoZXJlQ2xhdXNlIH0pXG5cbiAgaWYgKCF3YWxsZXQpIHtcbiAgICAvLyBDcmVhdGUgbmV3IHdhbGxldFxuICAgIHdhbGxldCA9IGF3YWl0IHByaXNtYS5jb21tZXJjZVdhbGxldC5jcmVhdGUoe1xuICAgICAgZGF0YToge1xuICAgICAgICB0ZW5hbnRJZCxcbiAgICAgICAgdHlwZSxcbiAgICAgICAgY3VzdG9tZXJJZDogY3VzdG9tZXJJZCB8fCBudWxsLFxuICAgICAgICB2ZW5kb3JJZDogdmVuZG9ySWQgfHwgbnVsbCxcbiAgICAgICAgY3VycmVuY3ksXG4gICAgICAgIGJhbGFuY2U6IDAsXG4gICAgICAgIHBlbmRpbmdCYWxhbmNlOiAwLFxuICAgICAgICBhdmFpbGFibGVCYWxhbmNlOiAwLFxuICAgICAgICBtZXRhZGF0YTogbWV0YWRhdGEgfHwgdW5kZWZpbmVkXG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIHJldHVybiB3YWxsZXRcbn1cblxuLyoqXG4gKiBHZXQgd2FsbGV0IGJ5IElEXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRXYWxsZXQod2FsbGV0SWQ6IHN0cmluZykge1xuICByZXR1cm4gcHJpc21hLmNvbW1lcmNlV2FsbGV0LmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7IGlkOiB3YWxsZXRJZCB9XG4gIH0pXG59XG5cbi8qKlxuICogR2V0IHdhbGxldCB3aXRoIHJlY2VudCBsZWRnZXIgZW50cmllc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0V2FsbGV0V2l0aExlZGdlcih3YWxsZXRJZDogc3RyaW5nLCBsaW1pdCA9IDUwKSB7XG4gIGNvbnN0IHdhbGxldCA9IGF3YWl0IHByaXNtYS5jb21tZXJjZVdhbGxldC5maW5kVW5pcXVlKHtcbiAgICB3aGVyZTogeyBpZDogd2FsbGV0SWQgfSxcbiAgICBpbmNsdWRlOiB7XG4gICAgICBsZWRnZXJFbnRyaWVzOiB7XG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgdGFrZTogbGltaXRcbiAgICAgIH1cbiAgICB9XG4gIH0pXG4gIHJldHVybiB3YWxsZXRcbn1cblxuLyoqXG4gKiBDcmVhdGUgYSBsZWRnZXIgZW50cnkgYW5kIHVwZGF0ZSB3YWxsZXQgYmFsYW5jZVxuICogVGhpcyBpcyB0aGUgY29yZSBmdW5jdGlvbiAtIEFMTCBiYWxhbmNlIGNoYW5nZXMgZ28gdGhyb3VnaCBoZXJlXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVMZWRnZXJFbnRyeShwYXJhbXM6IExlZGdlckVudHJ5UGFyYW1zKSB7XG4gIGNvbnN0IHtcbiAgICB3YWxsZXRJZCxcbiAgICBlbnRyeVR5cGUsXG4gICAgYW1vdW50LFxuICAgIGRlc2NyaXB0aW9uLFxuICAgIHJlZmVyZW5jZVR5cGUsXG4gICAgcmVmZXJlbmNlSWQsXG4gICAgY291bnRlcnBhcnR5V2FsbGV0SWQsXG4gICAgaG9sZElkLFxuICAgIGlkZW1wb3RlbmN5S2V5LFxuICAgIG1ldGFkYXRhLFxuICAgIGNyZWF0ZWRCeVxuICB9ID0gcGFyYW1zXG5cbiAgLy8gVXNlIHRyYW5zYWN0aW9uIHRvIGVuc3VyZSBhdG9taWNpdHlcbiAgcmV0dXJuIHByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgLy8gR2V0IHdhbGxldCB3aXRoIGxvY2tcbiAgICBjb25zdCB3YWxsZXQgPSBhd2FpdCB0eC5jb21tZXJjZVdhbGxldC5maW5kVW5pcXVlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiB3YWxsZXRJZCB9XG4gICAgfSlcblxuICAgIGlmICghd2FsbGV0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFdhbGxldCBub3QgZm91bmQ6ICR7d2FsbGV0SWR9YClcbiAgICB9XG5cbiAgICBpZiAod2FsbGV0LnN0YXR1cyAhPT0gJ0FDVElWRScpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgV2FsbGV0IGlzIG5vdCBhY3RpdmU6ICR7d2FsbGV0LnN0YXR1c31gKVxuICAgIH1cblxuICAgIC8vIENoZWNrIGZvciBkdXBsaWNhdGUgaWRlbXBvdGVuY3kga2V5XG4gICAgY29uc3QgZXhpc3RpbmdFbnRyeSA9IGF3YWl0IHR4LmNvbW1lcmNlV2FsbGV0TGVkZ2VyLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgaWRlbXBvdGVuY3lLZXkgfVxuICAgIH0pXG5cbiAgICBpZiAoZXhpc3RpbmdFbnRyeSkge1xuICAgICAgLy8gUmV0dXJuIGV4aXN0aW5nIGVudHJ5IChpZGVtcG90ZW50KVxuICAgICAgcmV0dXJuIHsgZW50cnk6IGV4aXN0aW5nRW50cnksIHdhbGxldCwgaXNEdXBsaWNhdGU6IHRydWUgfVxuICAgIH1cblxuICAgIC8vIENhbGN1bGF0ZSBuZXcgYmFsYW5jZXMgYmFzZWQgb24gZW50cnkgdHlwZVxuICAgIGxldCBuZXdCYWxhbmNlID0gTnVtYmVyKHdhbGxldC5iYWxhbmNlKVxuICAgIGxldCBuZXdQZW5kaW5nQmFsYW5jZSA9IE51bWJlcih3YWxsZXQucGVuZGluZ0JhbGFuY2UpXG5cbiAgICAvLyBEZXRlcm1pbmUgaWYgdGhpcyBpcyBhIGNyZWRpdCwgZGViaXQsIG9yIGhvbGQgb3BlcmF0aW9uXG4gICAgaWYgKGVudHJ5VHlwZS5zdGFydHNXaXRoKCdDUkVESVRfJykpIHtcbiAgICAgIG5ld0JhbGFuY2UgKz0gYW1vdW50XG4gICAgfSBlbHNlIGlmIChlbnRyeVR5cGUuc3RhcnRzV2l0aCgnREVCSVRfJykpIHtcbiAgICAgIC8vIENoZWNrIHN1ZmZpY2llbnQgYmFsYW5jZSBmb3IgZGViaXRzXG4gICAgICBpZiAobmV3QmFsYW5jZSA8IGFtb3VudCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEluc3VmZmljaWVudCBiYWxhbmNlLiBBdmFpbGFibGU6ICR7bmV3QmFsYW5jZX0sIFJlcXVpcmVkOiAke2Ftb3VudH1gKVxuICAgICAgfVxuICAgICAgbmV3QmFsYW5jZSAtPSBhbW91bnRcbiAgICB9IGVsc2UgaWYgKGVudHJ5VHlwZSA9PT0gJ0hPTERfQ1JFQVRFRCcpIHtcbiAgICAgIC8vIEhvbGQgcmVkdWNlcyBhdmFpbGFibGUgYmFsYW5jZSBidXQgbm90IHRvdGFsIGJhbGFuY2VcbiAgICAgIGlmIChOdW1iZXIod2FsbGV0LmF2YWlsYWJsZUJhbGFuY2UpIDwgYW1vdW50KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgSW5zdWZmaWNpZW50IGF2YWlsYWJsZSBiYWxhbmNlIGZvciBob2xkLiBBdmFpbGFibGU6ICR7d2FsbGV0LmF2YWlsYWJsZUJhbGFuY2V9LCBSZXF1aXJlZDogJHthbW91bnR9YClcbiAgICAgIH1cbiAgICAgIG5ld1BlbmRpbmdCYWxhbmNlICs9IGFtb3VudFxuICAgIH0gZWxzZSBpZiAoZW50cnlUeXBlID09PSAnSE9MRF9SRUxFQVNFRCcpIHtcbiAgICAgIC8vIFJlbGVhc2UgaG9sZCBiYWNrIHRvIGF2YWlsYWJsZVxuICAgICAgbmV3UGVuZGluZ0JhbGFuY2UgLT0gYW1vdW50XG4gICAgfSBlbHNlIGlmIChlbnRyeVR5cGUgPT09ICdIT0xEX0NBUFRVUkVEJykge1xuICAgICAgLy8gQ29udmVydCBob2xkIHRvIGFjdHVhbCBkZWJpdFxuICAgICAgbmV3UGVuZGluZ0JhbGFuY2UgLT0gYW1vdW50XG4gICAgICBuZXdCYWxhbmNlIC09IGFtb3VudFxuICAgIH1cblxuICAgIGNvbnN0IG5ld0F2YWlsYWJsZUJhbGFuY2UgPSBuZXdCYWxhbmNlIC0gbmV3UGVuZGluZ0JhbGFuY2VcblxuICAgIC8vIENyZWF0ZSBsZWRnZXIgZW50cnlcbiAgICBjb25zdCBlbnRyeSA9IGF3YWl0IHR4LmNvbW1lcmNlV2FsbGV0TGVkZ2VyLmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIHdhbGxldElkLFxuICAgICAgICBlbnRyeVR5cGUsXG4gICAgICAgIHN0YXR1czogJ0NPTVBMRVRFRCcsXG4gICAgICAgIGFtb3VudDogZW50cnlUeXBlLnN0YXJ0c1dpdGgoJ0RFQklUXycpIHx8IGVudHJ5VHlwZSA9PT0gJ0hPTERfQ0FQVFVSRUQnID8gLWFtb3VudCA6IGFtb3VudCxcbiAgICAgICAgY3VycmVuY3k6IHdhbGxldC5jdXJyZW5jeSxcbiAgICAgICAgYmFsYW5jZUFmdGVyOiBuZXdCYWxhbmNlLFxuICAgICAgICBwZW5kaW5nQmFsYW5jZUFmdGVyOiBuZXdQZW5kaW5nQmFsYW5jZSxcbiAgICAgICAgYXZhaWxhYmxlQmFsYW5jZUFmdGVyOiBuZXdBdmFpbGFibGVCYWxhbmNlLFxuICAgICAgICByZWZlcmVuY2VUeXBlLFxuICAgICAgICByZWZlcmVuY2VJZCxcbiAgICAgICAgY291bnRlcnBhcnR5V2FsbGV0SWQsXG4gICAgICAgIGhvbGRJZCxcbiAgICAgICAgaWRlbXBvdGVuY3lLZXksXG4gICAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgICBtZXRhZGF0YTogbWV0YWRhdGEgfHwgdW5kZWZpbmVkLFxuICAgICAgICBjcmVhdGVkQnlcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgLy8gVXBkYXRlIHdhbGxldCBiYWxhbmNlIGNhY2hlXG4gICAgY29uc3QgdXBkYXRlZFdhbGxldCA9IGF3YWl0IHR4LmNvbW1lcmNlV2FsbGV0LnVwZGF0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogd2FsbGV0SWQgfSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgYmFsYW5jZTogbmV3QmFsYW5jZSxcbiAgICAgICAgcGVuZGluZ0JhbGFuY2U6IG5ld1BlbmRpbmdCYWxhbmNlLFxuICAgICAgICBhdmFpbGFibGVCYWxhbmNlOiBuZXdBdmFpbGFibGVCYWxhbmNlXG4gICAgICB9XG4gICAgfSlcblxuICAgIHJldHVybiB7IGVudHJ5LCB3YWxsZXQ6IHVwZGF0ZWRXYWxsZXQsIGlzRHVwbGljYXRlOiBmYWxzZSB9XG4gIH0pXG59XG5cbi8qKlxuICogVHJhbnNmZXIgZnVuZHMgYmV0d2VlbiB3YWxsZXRzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB0cmFuc2ZlckZ1bmRzKHBhcmFtczogVHJhbnNmZXJQYXJhbXMpIHtcbiAgY29uc3Qge1xuICAgIGZyb21XYWxsZXRJZCxcbiAgICB0b1dhbGxldElkLFxuICAgIGFtb3VudCxcbiAgICBkZXNjcmlwdGlvbixcbiAgICByZWZlcmVuY2VUeXBlLFxuICAgIHJlZmVyZW5jZUlkLFxuICAgIGlkZW1wb3RlbmN5S2V5LFxuICAgIGNyZWF0ZWRCeVxuICB9ID0gcGFyYW1zXG5cbiAgaWYgKGFtb3VudCA8PSAwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdUcmFuc2ZlciBhbW91bnQgbXVzdCBiZSBwb3NpdGl2ZScpXG4gIH1cblxuICAvLyBVc2UgdHJhbnNhY3Rpb24gZm9yIGF0b21pYyB0cmFuc2ZlclxuICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAvLyBHZXQgYm90aCB3YWxsZXRzXG4gICAgY29uc3QgZnJvbVdhbGxldCA9IGF3YWl0IHR4LmNvbW1lcmNlV2FsbGV0LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZDogZnJvbVdhbGxldElkIH0gfSlcbiAgICBjb25zdCB0b1dhbGxldCA9IGF3YWl0IHR4LmNvbW1lcmNlV2FsbGV0LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZDogdG9XYWxsZXRJZCB9IH0pXG5cbiAgICBpZiAoIWZyb21XYWxsZXQpIHRocm93IG5ldyBFcnJvcihgU291cmNlIHdhbGxldCBub3QgZm91bmQ6ICR7ZnJvbVdhbGxldElkfWApXG4gICAgaWYgKCF0b1dhbGxldCkgdGhyb3cgbmV3IEVycm9yKGBEZXN0aW5hdGlvbiB3YWxsZXQgbm90IGZvdW5kOiAke3RvV2FsbGV0SWR9YClcbiAgICBpZiAoZnJvbVdhbGxldC5zdGF0dXMgIT09ICdBQ1RJVkUnKSB0aHJvdyBuZXcgRXJyb3IoYFNvdXJjZSB3YWxsZXQgaXMgbm90IGFjdGl2ZWApXG4gICAgaWYgKHRvV2FsbGV0LnN0YXR1cyAhPT0gJ0FDVElWRScpIHRocm93IG5ldyBFcnJvcihgRGVzdGluYXRpb24gd2FsbGV0IGlzIG5vdCBhY3RpdmVgKVxuICAgIGlmIChOdW1iZXIoZnJvbVdhbGxldC5hdmFpbGFibGVCYWxhbmNlKSA8IGFtb3VudCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnN1ZmZpY2llbnQgYmFsYW5jZS4gQXZhaWxhYmxlOiAke2Zyb21XYWxsZXQuYXZhaWxhYmxlQmFsYW5jZX0sIFJlcXVpcmVkOiAke2Ftb3VudH1gKVxuICAgIH1cblxuICAgIC8vIENoZWNrIGlkZW1wb3RlbmN5XG4gICAgY29uc3QgZXhpc3RpbmdEZWJpdCA9IGF3YWl0IHR4LmNvbW1lcmNlV2FsbGV0TGVkZ2VyLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgaWRlbXBvdGVuY3lLZXk6IGAke2lkZW1wb3RlbmN5S2V5fV9kZWJpdGAgfVxuICAgIH0pXG4gICAgaWYgKGV4aXN0aW5nRGViaXQpIHtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGlzRHVwbGljYXRlOiB0cnVlIH1cbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgZGViaXQgZW50cnkgKGZyb20gd2FsbGV0KVxuICAgIGNvbnN0IG5ld0Zyb21CYWxhbmNlID0gTnVtYmVyKGZyb21XYWxsZXQuYmFsYW5jZSkgLSBhbW91bnRcbiAgICBjb25zdCBuZXdGcm9tQXZhaWxhYmxlID0gbmV3RnJvbUJhbGFuY2UgLSBOdW1iZXIoZnJvbVdhbGxldC5wZW5kaW5nQmFsYW5jZSlcblxuICAgIGF3YWl0IHR4LmNvbW1lcmNlV2FsbGV0TGVkZ2VyLmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIHdhbGxldElkOiBmcm9tV2FsbGV0SWQsXG4gICAgICAgIGVudHJ5VHlwZTogJ0RFQklUX1RSQU5TRkVSX09VVCcsXG4gICAgICAgIHN0YXR1czogJ0NPTVBMRVRFRCcsXG4gICAgICAgIGFtb3VudDogLWFtb3VudCxcbiAgICAgICAgY3VycmVuY3k6IGZyb21XYWxsZXQuY3VycmVuY3ksXG4gICAgICAgIGJhbGFuY2VBZnRlcjogbmV3RnJvbUJhbGFuY2UsXG4gICAgICAgIHBlbmRpbmdCYWxhbmNlQWZ0ZXI6IE51bWJlcihmcm9tV2FsbGV0LnBlbmRpbmdCYWxhbmNlKSxcbiAgICAgICAgYXZhaWxhYmxlQmFsYW5jZUFmdGVyOiBuZXdGcm9tQXZhaWxhYmxlLFxuICAgICAgICByZWZlcmVuY2VUeXBlLFxuICAgICAgICByZWZlcmVuY2VJZCxcbiAgICAgICAgY291bnRlcnBhcnR5V2FsbGV0SWQ6IHRvV2FsbGV0SWQsXG4gICAgICAgIGlkZW1wb3RlbmN5S2V5OiBgJHtpZGVtcG90ZW5jeUtleX1fZGViaXRgLFxuICAgICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gfHwgYFRyYW5zZmVyIHRvIHdhbGxldCAke3RvV2FsbGV0SWR9YCxcbiAgICAgICAgY3JlYXRlZEJ5XG4gICAgICB9XG4gICAgfSlcblxuICAgIGF3YWl0IHR4LmNvbW1lcmNlV2FsbGV0LnVwZGF0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogZnJvbVdhbGxldElkIH0sXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGJhbGFuY2U6IG5ld0Zyb21CYWxhbmNlLFxuICAgICAgICBhdmFpbGFibGVCYWxhbmNlOiBuZXdGcm9tQXZhaWxhYmxlXG4gICAgICB9XG4gICAgfSlcblxuICAgIC8vIENyZWF0ZSBjcmVkaXQgZW50cnkgKHRvIHdhbGxldClcbiAgICBjb25zdCBuZXdUb0JhbGFuY2UgPSBOdW1iZXIodG9XYWxsZXQuYmFsYW5jZSkgKyBhbW91bnRcbiAgICBjb25zdCBuZXdUb0F2YWlsYWJsZSA9IG5ld1RvQmFsYW5jZSAtIE51bWJlcih0b1dhbGxldC5wZW5kaW5nQmFsYW5jZSlcblxuICAgIGF3YWl0IHR4LmNvbW1lcmNlV2FsbGV0TGVkZ2VyLmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIHdhbGxldElkOiB0b1dhbGxldElkLFxuICAgICAgICBlbnRyeVR5cGU6ICdDUkVESVRfVFJBTlNGRVJfSU4nLFxuICAgICAgICBzdGF0dXM6ICdDT01QTEVURUQnLFxuICAgICAgICBhbW91bnQ6IGFtb3VudCxcbiAgICAgICAgY3VycmVuY3k6IHRvV2FsbGV0LmN1cnJlbmN5LFxuICAgICAgICBiYWxhbmNlQWZ0ZXI6IG5ld1RvQmFsYW5jZSxcbiAgICAgICAgcGVuZGluZ0JhbGFuY2VBZnRlcjogTnVtYmVyKHRvV2FsbGV0LnBlbmRpbmdCYWxhbmNlKSxcbiAgICAgICAgYXZhaWxhYmxlQmFsYW5jZUFmdGVyOiBuZXdUb0F2YWlsYWJsZSxcbiAgICAgICAgcmVmZXJlbmNlVHlwZSxcbiAgICAgICAgcmVmZXJlbmNlSWQsXG4gICAgICAgIGNvdW50ZXJwYXJ0eVdhbGxldElkOiBmcm9tV2FsbGV0SWQsXG4gICAgICAgIGlkZW1wb3RlbmN5S2V5OiBgJHtpZGVtcG90ZW5jeUtleX1fY3JlZGl0YCxcbiAgICAgICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uIHx8IGBUcmFuc2ZlciBmcm9tIHdhbGxldCAke2Zyb21XYWxsZXRJZH1gLFxuICAgICAgICBjcmVhdGVkQnlcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgYXdhaXQgdHguY29tbWVyY2VXYWxsZXQudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiB0b1dhbGxldElkIH0sXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGJhbGFuY2U6IG5ld1RvQmFsYW5jZSxcbiAgICAgICAgYXZhaWxhYmxlQmFsYW5jZTogbmV3VG9BdmFpbGFibGVcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgaXNEdXBsaWNhdGU6IGZhbHNlIH1cbiAgfSlcbn1cblxuLyoqXG4gKiBDcmVkaXQgYSB3YWxsZXQgKGFkZCBmdW5kcylcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWRpdFdhbGxldChcbiAgd2FsbGV0SWQ6IHN0cmluZyxcbiAgYW1vdW50OiBudW1iZXIsXG4gIGVudHJ5VHlwZTogTGVkZ2VyRW50cnlUeXBlLFxuICBpZGVtcG90ZW5jeUtleTogc3RyaW5nLFxuICBvcHRpb25zPzoge1xuICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nXG4gICAgcmVmZXJlbmNlVHlwZT86IHN0cmluZ1xuICAgIHJlZmVyZW5jZUlkPzogc3RyaW5nXG4gICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuICAgIGNyZWF0ZWRCeT86IHN0cmluZ1xuICB9XG4pIHtcbiAgaWYgKCFlbnRyeVR5cGUuc3RhcnRzV2l0aCgnQ1JFRElUXycpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGNyZWRpdCBlbnRyeSB0eXBlOiAke2VudHJ5VHlwZX1gKVxuICB9XG5cbiAgcmV0dXJuIGNyZWF0ZUxlZGdlckVudHJ5KHtcbiAgICB3YWxsZXRJZCxcbiAgICBlbnRyeVR5cGUsXG4gICAgYW1vdW50LFxuICAgIGlkZW1wb3RlbmN5S2V5LFxuICAgIC4uLm9wdGlvbnNcbiAgfSlcbn1cblxuLyoqXG4gKiBEZWJpdCBhIHdhbGxldCAocmVtb3ZlIGZ1bmRzKVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGViaXRXYWxsZXQoXG4gIHdhbGxldElkOiBzdHJpbmcsXG4gIGFtb3VudDogbnVtYmVyLFxuICBlbnRyeVR5cGU6IExlZGdlckVudHJ5VHlwZSxcbiAgaWRlbXBvdGVuY3lLZXk6IHN0cmluZyxcbiAgb3B0aW9ucz86IHtcbiAgICBkZXNjcmlwdGlvbj86IHN0cmluZ1xuICAgIHJlZmVyZW5jZVR5cGU/OiBzdHJpbmdcbiAgICByZWZlcmVuY2VJZD86IHN0cmluZ1xuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbiAgICBjcmVhdGVkQnk/OiBzdHJpbmdcbiAgfVxuKSB7XG4gIGlmICghZW50cnlUeXBlLnN0YXJ0c1dpdGgoJ0RFQklUXycpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGRlYml0IGVudHJ5IHR5cGU6ICR7ZW50cnlUeXBlfWApXG4gIH1cblxuICByZXR1cm4gY3JlYXRlTGVkZ2VyRW50cnkoe1xuICAgIHdhbGxldElkLFxuICAgIGVudHJ5VHlwZSxcbiAgICBhbW91bnQsXG4gICAgaWRlbXBvdGVuY3lLZXksXG4gICAgLi4ub3B0aW9uc1xuICB9KVxufVxuXG4vKipcbiAqIENyZWF0ZSBhIGhvbGQgb24gd2FsbGV0IGZ1bmRzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVIb2xkKFxuICB3YWxsZXRJZDogc3RyaW5nLFxuICBhbW91bnQ6IG51bWJlcixcbiAgaG9sZElkOiBzdHJpbmcsXG4gIG9wdGlvbnM/OiB7XG4gICAgZGVzY3JpcHRpb24/OiBzdHJpbmdcbiAgICByZWZlcmVuY2VUeXBlPzogc3RyaW5nXG4gICAgcmVmZXJlbmNlSWQ/OiBzdHJpbmdcbiAgICBjcmVhdGVkQnk/OiBzdHJpbmdcbiAgfVxuKSB7XG4gIHJldHVybiBjcmVhdGVMZWRnZXJFbnRyeSh7XG4gICAgd2FsbGV0SWQsXG4gICAgZW50cnlUeXBlOiAnSE9MRF9DUkVBVEVEJyxcbiAgICBhbW91bnQsXG4gICAgaG9sZElkLFxuICAgIGlkZW1wb3RlbmN5S2V5OiBgaG9sZF9jcmVhdGVfJHtob2xkSWR9YCxcbiAgICAuLi5vcHRpb25zXG4gIH0pXG59XG5cbi8qKlxuICogUmVsZWFzZSBhIGhvbGQgKHJldHVybiBmdW5kcyB0byBhdmFpbGFibGUpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZWxlYXNlSG9sZChcbiAgd2FsbGV0SWQ6IHN0cmluZyxcbiAgYW1vdW50OiBudW1iZXIsXG4gIGhvbGRJZDogc3RyaW5nLFxuICBvcHRpb25zPzoge1xuICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nXG4gICAgY3JlYXRlZEJ5Pzogc3RyaW5nXG4gIH1cbikge1xuICByZXR1cm4gY3JlYXRlTGVkZ2VyRW50cnkoe1xuICAgIHdhbGxldElkLFxuICAgIGVudHJ5VHlwZTogJ0hPTERfUkVMRUFTRUQnLFxuICAgIGFtb3VudCxcbiAgICBob2xkSWQsXG4gICAgaWRlbXBvdGVuY3lLZXk6IGBob2xkX3JlbGVhc2VfJHtob2xkSWR9YCxcbiAgICAuLi5vcHRpb25zXG4gIH0pXG59XG5cbi8qKlxuICogQ2FwdHVyZSBhIGhvbGQgKGNvbnZlcnQgdG8gYWN0dWFsIGRlYml0KVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2FwdHVyZUhvbGQoXG4gIHdhbGxldElkOiBzdHJpbmcsXG4gIGFtb3VudDogbnVtYmVyLFxuICBob2xkSWQ6IHN0cmluZyxcbiAgb3B0aW9ucz86IHtcbiAgICBkZXNjcmlwdGlvbj86IHN0cmluZ1xuICAgIHJlZmVyZW5jZVR5cGU/OiBzdHJpbmdcbiAgICByZWZlcmVuY2VJZD86IHN0cmluZ1xuICAgIGNyZWF0ZWRCeT86IHN0cmluZ1xuICB9XG4pIHtcbiAgcmV0dXJuIGNyZWF0ZUxlZGdlckVudHJ5KHtcbiAgICB3YWxsZXRJZCxcbiAgICBlbnRyeVR5cGU6ICdIT0xEX0NBUFRVUkVEJyxcbiAgICBhbW91bnQsXG4gICAgaG9sZElkLFxuICAgIGlkZW1wb3RlbmN5S2V5OiBgaG9sZF9jYXB0dXJlXyR7aG9sZElkfWAsXG4gICAgLi4ub3B0aW9uc1xuICB9KVxufVxuXG4vKipcbiAqIFJlY2FsY3VsYXRlIHdhbGxldCBiYWxhbmNlIGZyb20gbGVkZ2VyIChmb3IgcmVjb25jaWxpYXRpb24pXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZWNhbGN1bGF0ZUJhbGFuY2Uod2FsbGV0SWQ6IHN0cmluZykge1xuICBjb25zdCBlbnRyaWVzID0gYXdhaXQgcHJpc21hLmNvbW1lcmNlV2FsbGV0TGVkZ2VyLmZpbmRNYW55KHtcbiAgICB3aGVyZTogeyBcbiAgICAgIHdhbGxldElkLFxuICAgICAgc3RhdHVzOiAnQ09NUExFVEVEJ1xuICAgIH0sXG4gICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdhc2MnIH1cbiAgfSlcblxuICBsZXQgYmFsYW5jZSA9IDBcbiAgbGV0IHBlbmRpbmdCYWxhbmNlID0gMFxuICBjb25zdCBob2xkczogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG5cbiAgZm9yIChjb25zdCBlbnRyeSBvZiBlbnRyaWVzKSB7XG4gICAgaWYgKGVudHJ5LmVudHJ5VHlwZS5zdGFydHNXaXRoKCdDUkVESVRfJykpIHtcbiAgICAgIGJhbGFuY2UgKz0gTnVtYmVyKGVudHJ5LmFtb3VudClcbiAgICB9IGVsc2UgaWYgKGVudHJ5LmVudHJ5VHlwZS5zdGFydHNXaXRoKCdERUJJVF8nKSkge1xuICAgICAgYmFsYW5jZSArPSBOdW1iZXIoZW50cnkuYW1vdW50KSAvLyBhbW91bnQgaXMgbmVnYXRpdmUgZm9yIGRlYml0c1xuICAgIH0gZWxzZSBpZiAoZW50cnkuZW50cnlUeXBlID09PSAnSE9MRF9DUkVBVEVEJyAmJiBlbnRyeS5ob2xkSWQpIHtcbiAgICAgIGhvbGRzW2VudHJ5LmhvbGRJZF0gPSBOdW1iZXIoZW50cnkuYW1vdW50KVxuICAgICAgcGVuZGluZ0JhbGFuY2UgKz0gTnVtYmVyKGVudHJ5LmFtb3VudClcbiAgICB9IGVsc2UgaWYgKGVudHJ5LmVudHJ5VHlwZSA9PT0gJ0hPTERfUkVMRUFTRUQnICYmIGVudHJ5LmhvbGRJZCkge1xuICAgICAgcGVuZGluZ0JhbGFuY2UgLT0gaG9sZHNbZW50cnkuaG9sZElkXSB8fCBOdW1iZXIoZW50cnkuYW1vdW50KVxuICAgICAgZGVsZXRlIGhvbGRzW2VudHJ5LmhvbGRJZF1cbiAgICB9IGVsc2UgaWYgKGVudHJ5LmVudHJ5VHlwZSA9PT0gJ0hPTERfQ0FQVFVSRUQnICYmIGVudHJ5LmhvbGRJZCkge1xuICAgICAgYmFsYW5jZSArPSBOdW1iZXIoZW50cnkuYW1vdW50KSAvLyBuZWdhdGl2ZSBhbW91bnRcbiAgICAgIHBlbmRpbmdCYWxhbmNlIC09IGhvbGRzW2VudHJ5LmhvbGRJZF0gfHwgTWF0aC5hYnMoTnVtYmVyKGVudHJ5LmFtb3VudCkpXG4gICAgICBkZWxldGUgaG9sZHNbZW50cnkuaG9sZElkXVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGF2YWlsYWJsZUJhbGFuY2UgPSBiYWxhbmNlIC0gcGVuZGluZ0JhbGFuY2VcblxuICAvLyBVcGRhdGUgd2FsbGV0XG4gIGNvbnN0IHdhbGxldCA9IGF3YWl0IHByaXNtYS5jb21tZXJjZVdhbGxldC51cGRhdGUoe1xuICAgIHdoZXJlOiB7IGlkOiB3YWxsZXRJZCB9LFxuICAgIGRhdGE6IHtcbiAgICAgIGJhbGFuY2UsXG4gICAgICBwZW5kaW5nQmFsYW5jZSxcbiAgICAgIGF2YWlsYWJsZUJhbGFuY2VcbiAgICB9XG4gIH0pXG5cbiAgcmV0dXJuIHsgd2FsbGV0LCBjYWxjdWxhdGVkQmFsYW5jZTogYmFsYW5jZSwgcGVuZGluZ0JhbGFuY2UsIGF2YWlsYWJsZUJhbGFuY2UsIGVudHJ5Q291bnQ6IGVudHJpZXMubGVuZ3RoIH1cbn1cblxuLyoqXG4gKiBHZXQgbGVkZ2VyIGVudHJpZXMgZm9yIGEgd2FsbGV0XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRMZWRnZXJFbnRyaWVzKFxuICB3YWxsZXRJZDogc3RyaW5nLFxuICBvcHRpb25zPzoge1xuICAgIGxpbWl0PzogbnVtYmVyXG4gICAgb2Zmc2V0PzogbnVtYmVyXG4gICAgZW50cnlUeXBlPzogTGVkZ2VyRW50cnlUeXBlXG4gICAgcmVmZXJlbmNlVHlwZT86IHN0cmluZ1xuICAgIHJlZmVyZW5jZUlkPzogc3RyaW5nXG4gICAgc3RhcnREYXRlPzogRGF0ZVxuICAgIGVuZERhdGU/OiBEYXRlXG4gIH1cbikge1xuICBjb25zdCB7IGxpbWl0ID0gNTAsIG9mZnNldCA9IDAsIGVudHJ5VHlwZSwgcmVmZXJlbmNlVHlwZSwgcmVmZXJlbmNlSWQsIHN0YXJ0RGF0ZSwgZW5kRGF0ZSB9ID0gb3B0aW9ucyB8fCB7fVxuXG4gIGNvbnN0IHdoZXJlOiBQcmlzbWEuQ29tbWVyY2VXYWxsZXRMZWRnZXJXaGVyZUlucHV0ID0geyB3YWxsZXRJZCB9XG5cbiAgaWYgKGVudHJ5VHlwZSkgd2hlcmUuZW50cnlUeXBlID0gZW50cnlUeXBlXG4gIGlmIChyZWZlcmVuY2VUeXBlKSB3aGVyZS5yZWZlcmVuY2VUeXBlID0gcmVmZXJlbmNlVHlwZVxuICBpZiAocmVmZXJlbmNlSWQpIHdoZXJlLnJlZmVyZW5jZUlkID0gcmVmZXJlbmNlSWRcbiAgaWYgKHN0YXJ0RGF0ZSB8fCBlbmREYXRlKSB7XG4gICAgd2hlcmUuY3JlYXRlZEF0ID0ge31cbiAgICBpZiAoc3RhcnREYXRlKSB3aGVyZS5jcmVhdGVkQXQuZ3RlID0gc3RhcnREYXRlXG4gICAgaWYgKGVuZERhdGUpIHdoZXJlLmNyZWF0ZWRBdC5sdGUgPSBlbmREYXRlXG4gIH1cblxuICBjb25zdCBbZW50cmllcywgdG90YWxdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgIHByaXNtYS5jb21tZXJjZVdhbGxldExlZGdlci5maW5kTWFueSh7XG4gICAgICB3aGVyZSxcbiAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgIHNraXA6IG9mZnNldCxcbiAgICAgIHRha2U6IGxpbWl0XG4gICAgfSksXG4gICAgcHJpc21hLmNvbW1lcmNlV2FsbGV0TGVkZ2VyLmNvdW50KHsgd2hlcmUgfSlcbiAgXSlcblxuICByZXR1cm4geyBlbnRyaWVzLCB0b3RhbCwgbGltaXQsIG9mZnNldCB9XG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwiZ2V0T3JDcmVhdGVXYWxsZXQiLCJwYXJhbXMiLCJ0ZW5hbnRJZCIsInR5cGUiLCJjdXN0b21lcklkIiwidmVuZG9ySWQiLCJjdXJyZW5jeSIsIm1ldGFkYXRhIiwid2hlcmVDbGF1c2UiLCJ3YWxsZXQiLCJjb21tZXJjZVdhbGxldCIsImZpbmRGaXJzdCIsIndoZXJlIiwiY3JlYXRlIiwiZGF0YSIsImJhbGFuY2UiLCJwZW5kaW5nQmFsYW5jZSIsImF2YWlsYWJsZUJhbGFuY2UiLCJ1bmRlZmluZWQiLCJnZXRXYWxsZXQiLCJ3YWxsZXRJZCIsImZpbmRVbmlxdWUiLCJpZCIsImdldFdhbGxldFdpdGhMZWRnZXIiLCJsaW1pdCIsImluY2x1ZGUiLCJsZWRnZXJFbnRyaWVzIiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsInRha2UiLCJjcmVhdGVMZWRnZXJFbnRyeSIsImVudHJ5VHlwZSIsImFtb3VudCIsImRlc2NyaXB0aW9uIiwicmVmZXJlbmNlVHlwZSIsInJlZmVyZW5jZUlkIiwiY291bnRlcnBhcnR5V2FsbGV0SWQiLCJob2xkSWQiLCJpZGVtcG90ZW5jeUtleSIsImNyZWF0ZWRCeSIsIiR0cmFuc2FjdGlvbiIsInR4IiwiRXJyb3IiLCJzdGF0dXMiLCJleGlzdGluZ0VudHJ5IiwiY29tbWVyY2VXYWxsZXRMZWRnZXIiLCJlbnRyeSIsImlzRHVwbGljYXRlIiwibmV3QmFsYW5jZSIsIk51bWJlciIsIm5ld1BlbmRpbmdCYWxhbmNlIiwic3RhcnRzV2l0aCIsIm5ld0F2YWlsYWJsZUJhbGFuY2UiLCJiYWxhbmNlQWZ0ZXIiLCJwZW5kaW5nQmFsYW5jZUFmdGVyIiwiYXZhaWxhYmxlQmFsYW5jZUFmdGVyIiwidXBkYXRlZFdhbGxldCIsInVwZGF0ZSIsInRyYW5zZmVyRnVuZHMiLCJmcm9tV2FsbGV0SWQiLCJ0b1dhbGxldElkIiwiZnJvbVdhbGxldCIsInRvV2FsbGV0IiwiZXhpc3RpbmdEZWJpdCIsInN1Y2Nlc3MiLCJuZXdGcm9tQmFsYW5jZSIsIm5ld0Zyb21BdmFpbGFibGUiLCJuZXdUb0JhbGFuY2UiLCJuZXdUb0F2YWlsYWJsZSIsImNyZWRpdFdhbGxldCIsIm9wdGlvbnMiLCJkZWJpdFdhbGxldCIsImNyZWF0ZUhvbGQiLCJyZWxlYXNlSG9sZCIsImNhcHR1cmVIb2xkIiwicmVjYWxjdWxhdGVCYWxhbmNlIiwiZW50cmllcyIsImZpbmRNYW55IiwiaG9sZHMiLCJNYXRoIiwiYWJzIiwiY2FsY3VsYXRlZEJhbGFuY2UiLCJlbnRyeUNvdW50IiwibGVuZ3RoIiwiZ2V0TGVkZ2VyRW50cmllcyIsIm9mZnNldCIsInN0YXJ0RGF0ZSIsImVuZERhdGUiLCJndGUiLCJsdGUiLCJ0b3RhbCIsIlByb21pc2UiLCJhbGwiLCJza2lwIiwiY291bnQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/commerce-wallet-service.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/prisma.ts":
/*!***************************!*\
  !*** ./src/lib/prisma.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PARTNER_SCOPED_MODELS: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.PARTNER_SCOPED_MODELS),\n/* harmony export */   PLATFORM_MODELS: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.PLATFORM_MODELS),\n/* harmony export */   TENANT_SCOPED_MODELS: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.TENANT_SCOPED_MODELS),\n/* harmony export */   TenantIsolationError: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.TenantIsolationError),\n/* harmony export */   clearViolationLogs: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.clearViolationLogs),\n/* harmony export */   createPartnerContext: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.createPartnerContext),\n/* harmony export */   createTenantContext: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.createTenantContext),\n/* harmony export */   getViolationLogs: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.getViolationLogs),\n/* harmony export */   isPartnerScopedModel: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.isPartnerScopedModel),\n/* harmony export */   isTenantScopedModel: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.isTenantScopedModel),\n/* harmony export */   logViolation: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.logViolation),\n/* harmony export */   prisma: () => (/* binding */ prisma),\n/* harmony export */   validatePartnerAccess: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.validatePartnerAccess),\n/* harmony export */   validateTenantAccess: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.validateTenantAccess),\n/* harmony export */   withPartnerData: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.withPartnerData),\n/* harmony export */   withPartnerFilter: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.withPartnerFilter),\n/* harmony export */   withTenantData: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.withTenantData),\n/* harmony export */   withTenantFilter: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.withTenantFilter)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./tenant-isolation */ \"(rsc)/./src/lib/tenant-isolation.ts\");\n\nconst globalForPrisma = globalThis;\nconst prisma = globalForPrisma.prisma ?? new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient({\n    log:  true ? [\n        \"error\",\n        \"warn\"\n    ] : 0\n});\nif (true) globalForPrisma.prisma = prisma;\n// Re-export tenant isolation utilities\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3ByaXNtYS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBNkM7QUFFN0MsTUFBTUMsa0JBQWtCQztBQUlqQixNQUFNQyxTQUFTRixnQkFBZ0JFLE1BQU0sSUFBSSxJQUFJSCx3REFBWUEsQ0FBQztJQUMvREksS0FBS0MsS0FBeUIsR0FBZ0I7UUFBQztRQUFTO0tBQU8sR0FBRyxDQUFTO0FBQzdFLEdBQUU7QUFFRixJQUFJQSxJQUF5QixFQUFjSixnQkFBZ0JFLE1BQU0sR0FBR0E7QUFFcEUsdUNBQXVDO0FBd0JaIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2Fhcy1jb3JlLy4vc3JjL2xpYi9wcmlzbWEudHM/MDFkNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tICdAcHJpc21hL2NsaWVudCdcblxuY29uc3QgZ2xvYmFsRm9yUHJpc21hID0gZ2xvYmFsVGhpcyBhcyB1bmtub3duIGFzIHtcbiAgcHJpc21hOiBQcmlzbWFDbGllbnQgfCB1bmRlZmluZWRcbn1cblxuZXhwb3J0IGNvbnN0IHByaXNtYSA9IGdsb2JhbEZvclByaXNtYS5wcmlzbWEgPz8gbmV3IFByaXNtYUNsaWVudCh7XG4gIGxvZzogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBbJ2Vycm9yJywgJ3dhcm4nXSA6IFsnZXJyb3InXSxcbn0pXG5cbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSBnbG9iYWxGb3JQcmlzbWEucHJpc21hID0gcHJpc21hXG5cbi8vIFJlLWV4cG9ydCB0ZW5hbnQgaXNvbGF0aW9uIHV0aWxpdGllc1xuZXhwb3J0IHtcbiAgdmFsaWRhdGVUZW5hbnRBY2Nlc3MsXG4gIHZhbGlkYXRlUGFydG5lckFjY2VzcyxcbiAgY3JlYXRlVGVuYW50Q29udGV4dCxcbiAgY3JlYXRlUGFydG5lckNvbnRleHQsXG4gIHdpdGhUZW5hbnRGaWx0ZXIsXG4gIHdpdGhUZW5hbnREYXRhLFxuICB3aXRoUGFydG5lckZpbHRlcixcbiAgd2l0aFBhcnRuZXJEYXRhLFxuICBUZW5hbnRJc29sYXRpb25FcnJvcixcbiAgaXNUZW5hbnRTY29wZWRNb2RlbCxcbiAgaXNQYXJ0bmVyU2NvcGVkTW9kZWwsXG4gIGdldFZpb2xhdGlvbkxvZ3MsXG4gIGNsZWFyVmlvbGF0aW9uTG9ncyxcbiAgbG9nVmlvbGF0aW9uLFxuICBURU5BTlRfU0NPUEVEX01PREVMUyxcbiAgUEFSVE5FUl9TQ09QRURfTU9ERUxTLFxuICBQTEFURk9STV9NT0RFTFMsXG4gIHR5cGUgVGVuYW50Q29udGV4dCxcbiAgdHlwZSBQYXJ0bmVyQ29udGV4dCxcbiAgdHlwZSBUZW5hbnRTY29wZWRNb2RlbCxcbiAgdHlwZSBQYXJ0bmVyU2NvcGVkTW9kZWwsXG4gIHR5cGUgUGxhdGZvcm1Nb2RlbFxufSBmcm9tICcuL3RlbmFudC1pc29sYXRpb24nXG4iXSwibmFtZXMiOlsiUHJpc21hQ2xpZW50IiwiZ2xvYmFsRm9yUHJpc21hIiwiZ2xvYmFsVGhpcyIsInByaXNtYSIsImxvZyIsInByb2Nlc3MiLCJ2YWxpZGF0ZVRlbmFudEFjY2VzcyIsInZhbGlkYXRlUGFydG5lckFjY2VzcyIsImNyZWF0ZVRlbmFudENvbnRleHQiLCJjcmVhdGVQYXJ0bmVyQ29udGV4dCIsIndpdGhUZW5hbnRGaWx0ZXIiLCJ3aXRoVGVuYW50RGF0YSIsIndpdGhQYXJ0bmVyRmlsdGVyIiwid2l0aFBhcnRuZXJEYXRhIiwiVGVuYW50SXNvbGF0aW9uRXJyb3IiLCJpc1RlbmFudFNjb3BlZE1vZGVsIiwiaXNQYXJ0bmVyU2NvcGVkTW9kZWwiLCJnZXRWaW9sYXRpb25Mb2dzIiwiY2xlYXJWaW9sYXRpb25Mb2dzIiwibG9nVmlvbGF0aW9uIiwiVEVOQU5UX1NDT1BFRF9NT0RFTFMiLCJQQVJUTkVSX1NDT1BFRF9NT0RFTFMiLCJQTEFURk9STV9NT0RFTFMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/prisma.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/tenant-isolation.ts":
/*!*************************************!*\
  !*** ./src/lib/tenant-isolation.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PARTNER_SCOPED_MODELS: () => (/* binding */ PARTNER_SCOPED_MODELS),\n/* harmony export */   PLATFORM_MODELS: () => (/* binding */ PLATFORM_MODELS),\n/* harmony export */   TENANT_SCOPED_MODELS: () => (/* binding */ TENANT_SCOPED_MODELS),\n/* harmony export */   TenantIsolationError: () => (/* binding */ TenantIsolationError),\n/* harmony export */   clearViolationLogs: () => (/* binding */ clearViolationLogs),\n/* harmony export */   createPartnerContext: () => (/* binding */ createPartnerContext),\n/* harmony export */   createTenantContext: () => (/* binding */ createTenantContext),\n/* harmony export */   getViolationLogs: () => (/* binding */ getViolationLogs),\n/* harmony export */   isPartnerScopedModel: () => (/* binding */ isPartnerScopedModel),\n/* harmony export */   isTenantScopedModel: () => (/* binding */ isTenantScopedModel),\n/* harmony export */   logViolation: () => (/* binding */ logViolation),\n/* harmony export */   validatePartnerAccess: () => (/* binding */ validatePartnerAccess),\n/* harmony export */   validateTenantAccess: () => (/* binding */ validateTenantAccess),\n/* harmony export */   withPartnerData: () => (/* binding */ withPartnerData),\n/* harmony export */   withPartnerFilter: () => (/* binding */ withPartnerFilter),\n/* harmony export */   withTenantData: () => (/* binding */ withTenantData),\n/* harmony export */   withTenantFilter: () => (/* binding */ withTenantFilter)\n/* harmony export */ });\n/**\n * Tenant Isolation Enforcement\n * \n * This module provides strict tenant data isolation at the database level.\n * Instead of Prisma middleware (which has async context issues), this uses\n * application-level validation before queries are executed.\n * \n * Features:\n * - Pre-query validation functions\n * - SUPER_ADMIN bypass with explicit flag\n * - Violation logging and hard failure\n * - Safe query builders that enforce tenant scoping\n */ // Models that require tenant isolation (tenant-scoped)\nconst TENANT_SCOPED_MODELS = [\n    \"TenantMembership\",\n    \"TenantDomain\",\n    \"AuditLog\"\n];\n// Models that require partner isolation (partner-scoped)\n// These are separate from tenant isolation - partners are platform-level\nconst PARTNER_SCOPED_MODELS = [\n    \"PartnerUser\",\n    \"PartnerAgreement\",\n    \"PartnerReferralCode\",\n    \"PartnerReferral\",\n    \"PartnerEarning\"\n];\n// Platform-level models (no isolation, Super Admin only)\nconst PLATFORM_MODELS = [\n    \"Partner\",\n    \"User\",\n    \"Tenant\",\n    \"Session\",\n    \"MagicLink\"\n];\nconst violations = [];\nconst MAX_VIOLATION_LOGS = 1000;\nfunction logViolation(violation) {\n    const log = {\n        ...violation,\n        timestamp: new Date()\n    };\n    violations.push(log);\n    if (violations.length > MAX_VIOLATION_LOGS) {\n        violations.shift();\n    }\n    console.error(\"[TENANT ISOLATION VIOLATION]\", JSON.stringify(log, null, 2));\n}\nfunction getViolationLogs() {\n    return [\n        ...violations\n    ];\n}\nfunction clearViolationLogs() {\n    violations.length = 0;\n}\n/**\n * Tenant Isolation Error\n */ class TenantIsolationError extends Error {\n    constructor(message, model, action, context){\n        super(message);\n        this.model = model;\n        this.action = action;\n        this.context = context;\n        this.name = \"TenantIsolationError\";\n    }\n}\n/**\n * Check if a model is tenant-scoped\n */ function isTenantScopedModel(model) {\n    return TENANT_SCOPED_MODELS.includes(model);\n}\n/**\n * Validate tenant context before executing a query\n * This should be called before any tenant-scoped database operation\n */ function validateTenantAccess(model, action, context, queryTenantId) {\n    // Skip validation for global models\n    if (!isTenantScopedModel(model)) {\n        return;\n    }\n    // Allow explicit bypass (for migrations, admin tools, etc.)\n    if (context?.bypassIsolation === true) {\n        if (!context.isSuperAdmin) {\n            const reason = \"Bypass isolation attempted without SUPER_ADMIN role\";\n            logViolation({\n                model,\n                action,\n                context,\n                query: {\n                    queryTenantId\n                },\n                reason\n            });\n            throw new TenantIsolationError(reason, model, action, context);\n        }\n        return;\n    }\n    // SUPER_ADMIN can access all data\n    if (context?.isSuperAdmin) {\n        return;\n    }\n    // No context = violation\n    if (!context) {\n        const reason = \"No tenant context provided for tenant-scoped query\";\n        logViolation({\n            model,\n            action,\n            context,\n            query: {\n                queryTenantId\n            },\n            reason\n        });\n        throw new TenantIsolationError(reason, model, action, context);\n    }\n    // No tenantId in context = violation\n    if (!context.tenantId) {\n        const reason = \"No tenantId in context for tenant-scoped query\";\n        logViolation({\n            model,\n            action,\n            context,\n            query: {\n                queryTenantId\n            },\n            reason\n        });\n        throw new TenantIsolationError(reason, model, action, context);\n    }\n    // If query specifies a tenantId, it must match context\n    if (queryTenantId && queryTenantId !== context.tenantId) {\n        const reason = `Cross-tenant access attempt: query tenantId (${queryTenantId}) != context tenantId (${context.tenantId})`;\n        logViolation({\n            model,\n            action,\n            context,\n            query: {\n                queryTenantId\n            },\n            reason\n        });\n        throw new TenantIsolationError(reason, model, action, context);\n    }\n}\n/**\n * Create a tenant context from user session\n */ function createTenantContext(tenantId, userId, isSuperAdmin, bypassIsolation = false) {\n    return {\n        tenantId,\n        userId,\n        isSuperAdmin,\n        bypassIsolation\n    };\n}\n/**\n * Create a partner context from user session\n */ function createPartnerContext(partnerId, userId, isSuperAdmin, isPartnerOwner = false, isPartnerAdmin = false, bypassIsolation = false) {\n    return {\n        partnerId,\n        userId,\n        isSuperAdmin,\n        isPartnerOwner,\n        isPartnerAdmin,\n        bypassIsolation\n    };\n}\n/**\n * Ensure a WHERE clause includes the correct tenantId\n */ function withTenantFilter(where, tenantId) {\n    return {\n        ...where,\n        tenantId\n    };\n}\n/**\n * Ensure data being created includes the correct tenantId\n */ function withTenantData(data, tenantId) {\n    return {\n        ...data,\n        tenantId\n    };\n}\n/**\n * Check if a model is partner-scoped\n */ function isPartnerScopedModel(model) {\n    return PARTNER_SCOPED_MODELS.includes(model);\n}\n/**\n * Validate partner context before executing a query\n * This should be called before any partner-scoped database operation\n */ function validatePartnerAccess(model, action, context, queryPartnerId) {\n    // Skip validation for non-partner models\n    if (!isPartnerScopedModel(model)) {\n        return;\n    }\n    // Allow explicit bypass (for migrations, admin tools, etc.)\n    if (context?.bypassIsolation === true) {\n        if (!context.isSuperAdmin) {\n            const reason = \"Partner bypass isolation attempted without SUPER_ADMIN role\";\n            logViolation({\n                model,\n                action,\n                context: context,\n                query: {\n                    queryPartnerId\n                },\n                reason\n            });\n            throw new TenantIsolationError(reason, model, action, context);\n        }\n        return;\n    }\n    // SUPER_ADMIN can access all partner data\n    if (context?.isSuperAdmin) {\n        return;\n    }\n    // No context = violation\n    if (!context) {\n        const reason = \"No partner context provided for partner-scoped query\";\n        logViolation({\n            model,\n            action,\n            context: null,\n            query: {\n                queryPartnerId\n            },\n            reason\n        });\n        throw new TenantIsolationError(reason, model, action, null);\n    }\n    // No partnerId in context = violation\n    if (!context.partnerId) {\n        const reason = \"No partnerId in context for partner-scoped query\";\n        logViolation({\n            model,\n            action,\n            context: context,\n            query: {\n                queryPartnerId\n            },\n            reason\n        });\n        throw new TenantIsolationError(reason, model, action, context);\n    }\n    // If query specifies a partnerId, it must match context\n    if (queryPartnerId && queryPartnerId !== context.partnerId) {\n        const reason = `Cross-partner access attempt: query partnerId (${queryPartnerId}) != context partnerId (${context.partnerId})`;\n        logViolation({\n            model,\n            action,\n            context: context,\n            query: {\n                queryPartnerId\n            },\n            reason\n        });\n        throw new TenantIsolationError(reason, model, action, context);\n    }\n}\n/**\n * Ensure a WHERE clause includes the correct partnerId\n */ function withPartnerFilter(where, partnerId) {\n    return {\n        ...where,\n        partnerId\n    };\n}\n/**\n * Ensure data being created includes the correct partnerId\n */ function withPartnerData(data, partnerId) {\n    return {\n        ...data,\n        partnerId\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3RlbmFudC1pc29sYXRpb24udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7O0NBWUMsR0FFRCx1REFBdUQ7QUFDaEQsTUFBTUEsdUJBQXVCO0lBQ2xDO0lBQ0E7SUFDQTtDQUVELENBQVM7QUFFVix5REFBeUQ7QUFDekQseUVBQXlFO0FBQ2xFLE1BQU1DLHdCQUF3QjtJQUNuQztJQUNBO0lBQ0E7SUFDQTtJQUNBO0NBQ0QsQ0FBUztBQUVWLHlEQUF5RDtBQUNsRCxNQUFNQyxrQkFBa0I7SUFDN0I7SUFDQTtJQUNBO0lBQ0E7SUFDQTtDQUNELENBQVM7QUFrQ1YsTUFBTUMsYUFBNkIsRUFBRTtBQUNyQyxNQUFNQyxxQkFBcUI7QUFFcEIsU0FBU0MsYUFBYUMsU0FBMEM7SUFDckUsTUFBTUMsTUFBb0I7UUFDeEIsR0FBR0QsU0FBUztRQUNaRSxXQUFXLElBQUlDO0lBQ2pCO0lBRUFOLFdBQVdPLElBQUksQ0FBQ0g7SUFFaEIsSUFBSUosV0FBV1EsTUFBTSxHQUFHUCxvQkFBb0I7UUFDMUNELFdBQVdTLEtBQUs7SUFDbEI7SUFFQUMsUUFBUUMsS0FBSyxDQUFDLGdDQUFnQ0MsS0FBS0MsU0FBUyxDQUFDVCxLQUFLLE1BQU07QUFDMUU7QUFFTyxTQUFTVTtJQUNkLE9BQU87V0FBSWQ7S0FBVztBQUN4QjtBQUVPLFNBQVNlO0lBQ2RmLFdBQVdRLE1BQU0sR0FBRztBQUN0QjtBQUVBOztDQUVDLEdBQ00sTUFBTVEsNkJBQTZCQztJQUN4Q0MsWUFDRUMsT0FBZSxFQUNmLEtBQW9CLEVBQ3BCLE1BQXFCLEVBQ3JCLE9BQW9DLENBQ3BDO1FBQ0EsS0FBSyxDQUFDQTthQUpDQyxRQUFBQTthQUNBQyxTQUFBQTthQUNBQyxVQUFBQTtRQUdQLElBQUksQ0FBQ0MsSUFBSSxHQUFHO0lBQ2Q7QUFDRjtBQUVBOztDQUVDLEdBQ00sU0FBU0Msb0JBQW9CSixLQUFhO0lBQy9DLE9BQU92QixxQkFBcUI0QixRQUFRLENBQUNMO0FBQ3ZDO0FBRUE7OztDQUdDLEdBQ00sU0FBU00scUJBQ2ROLEtBQWEsRUFDYkMsTUFBYyxFQUNkQyxPQUE2QixFQUM3QkssYUFBNkI7SUFFN0Isb0NBQW9DO0lBQ3BDLElBQUksQ0FBQ0gsb0JBQW9CSixRQUFRO1FBQy9CO0lBQ0Y7SUFFQSw0REFBNEQ7SUFDNUQsSUFBSUUsU0FBU00sb0JBQW9CLE1BQU07UUFDckMsSUFBSSxDQUFDTixRQUFRTyxZQUFZLEVBQUU7WUFDekIsTUFBTUMsU0FBUztZQUNmNUIsYUFBYTtnQkFBRWtCO2dCQUFPQztnQkFBUUM7Z0JBQVNTLE9BQU87b0JBQUVKO2dCQUFjO2dCQUFHRztZQUFPO1lBQ3hFLE1BQU0sSUFBSWQscUJBQXFCYyxRQUFRVixPQUFPQyxRQUFRQztRQUN4RDtRQUNBO0lBQ0Y7SUFFQSxrQ0FBa0M7SUFDbEMsSUFBSUEsU0FBU08sY0FBYztRQUN6QjtJQUNGO0lBRUEseUJBQXlCO0lBQ3pCLElBQUksQ0FBQ1AsU0FBUztRQUNaLE1BQU1RLFNBQVM7UUFDZjVCLGFBQWE7WUFBRWtCO1lBQU9DO1lBQVFDO1lBQVNTLE9BQU87Z0JBQUVKO1lBQWM7WUFBR0c7UUFBTztRQUN4RSxNQUFNLElBQUlkLHFCQUFxQmMsUUFBUVYsT0FBT0MsUUFBUUM7SUFDeEQ7SUFFQSxxQ0FBcUM7SUFDckMsSUFBSSxDQUFDQSxRQUFRVSxRQUFRLEVBQUU7UUFDckIsTUFBTUYsU0FBUztRQUNmNUIsYUFBYTtZQUFFa0I7WUFBT0M7WUFBUUM7WUFBU1MsT0FBTztnQkFBRUo7WUFBYztZQUFHRztRQUFPO1FBQ3hFLE1BQU0sSUFBSWQscUJBQXFCYyxRQUFRVixPQUFPQyxRQUFRQztJQUN4RDtJQUVBLHVEQUF1RDtJQUN2RCxJQUFJSyxpQkFBaUJBLGtCQUFrQkwsUUFBUVUsUUFBUSxFQUFFO1FBQ3ZELE1BQU1GLFNBQVMsQ0FBQyw2Q0FBNkMsRUFBRUgsY0FBYyx1QkFBdUIsRUFBRUwsUUFBUVUsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUN6SDlCLGFBQWE7WUFBRWtCO1lBQU9DO1lBQVFDO1lBQVNTLE9BQU87Z0JBQUVKO1lBQWM7WUFBR0c7UUFBTztRQUN4RSxNQUFNLElBQUlkLHFCQUFxQmMsUUFBUVYsT0FBT0MsUUFBUUM7SUFDeEQ7QUFDRjtBQUVBOztDQUVDLEdBQ00sU0FBU1csb0JBQ2RELFFBQXVCLEVBQ3ZCRSxNQUFxQixFQUNyQkwsWUFBcUIsRUFDckJELGtCQUEyQixLQUFLO0lBRWhDLE9BQU87UUFDTEk7UUFDQUU7UUFDQUw7UUFDQUQ7SUFDRjtBQUNGO0FBRUE7O0NBRUMsR0FDTSxTQUFTTyxxQkFDZEMsU0FBd0IsRUFDeEJGLE1BQXFCLEVBQ3JCTCxZQUFxQixFQUNyQlEsaUJBQTBCLEtBQUssRUFDL0JDLGlCQUEwQixLQUFLLEVBQy9CVixrQkFBMkIsS0FBSztJQUVoQyxPQUFPO1FBQ0xRO1FBQ0FGO1FBQ0FMO1FBQ0FRO1FBQ0FDO1FBQ0FWO0lBQ0Y7QUFDRjtBQUVBOztDQUVDLEdBQ00sU0FBU1csaUJBQ2RDLEtBQVEsRUFDUlIsUUFBZ0I7SUFFaEIsT0FBTztRQUNMLEdBQUdRLEtBQUs7UUFDUlI7SUFDRjtBQUNGO0FBRUE7O0NBRUMsR0FDTSxTQUFTUyxlQUNkQyxJQUFPLEVBQ1BWLFFBQWdCO0lBRWhCLE9BQU87UUFDTCxHQUFHVSxJQUFJO1FBQ1BWO0lBQ0Y7QUFDRjtBQUVBOztDQUVDLEdBQ00sU0FBU1cscUJBQXFCdkIsS0FBYTtJQUNoRCxPQUFPdEIsc0JBQXNCMkIsUUFBUSxDQUFDTDtBQUN4QztBQUVBOzs7Q0FHQyxHQUNNLFNBQVN3QixzQkFDZHhCLEtBQWEsRUFDYkMsTUFBYyxFQUNkQyxPQUE4QixFQUM5QnVCLGNBQThCO0lBRTlCLHlDQUF5QztJQUN6QyxJQUFJLENBQUNGLHFCQUFxQnZCLFFBQVE7UUFDaEM7SUFDRjtJQUVBLDREQUE0RDtJQUM1RCxJQUFJRSxTQUFTTSxvQkFBb0IsTUFBTTtRQUNyQyxJQUFJLENBQUNOLFFBQVFPLFlBQVksRUFBRTtZQUN6QixNQUFNQyxTQUFTO1lBQ2Y1QixhQUFhO2dCQUFFa0I7Z0JBQU9DO2dCQUFRQyxTQUFTQTtnQkFBZ0JTLE9BQU87b0JBQUVjO2dCQUFlO2dCQUFHZjtZQUFPO1lBQ3pGLE1BQU0sSUFBSWQscUJBQXFCYyxRQUFRVixPQUFPQyxRQUFRQztRQUN4RDtRQUNBO0lBQ0Y7SUFFQSwwQ0FBMEM7SUFDMUMsSUFBSUEsU0FBU08sY0FBYztRQUN6QjtJQUNGO0lBRUEseUJBQXlCO0lBQ3pCLElBQUksQ0FBQ1AsU0FBUztRQUNaLE1BQU1RLFNBQVM7UUFDZjVCLGFBQWE7WUFBRWtCO1lBQU9DO1lBQVFDLFNBQVM7WUFBTVMsT0FBTztnQkFBRWM7WUFBZTtZQUFHZjtRQUFPO1FBQy9FLE1BQU0sSUFBSWQscUJBQXFCYyxRQUFRVixPQUFPQyxRQUFRO0lBQ3hEO0lBRUEsc0NBQXNDO0lBQ3RDLElBQUksQ0FBQ0MsUUFBUWMsU0FBUyxFQUFFO1FBQ3RCLE1BQU1OLFNBQVM7UUFDZjVCLGFBQWE7WUFBRWtCO1lBQU9DO1lBQVFDLFNBQVNBO1lBQWdCUyxPQUFPO2dCQUFFYztZQUFlO1lBQUdmO1FBQU87UUFDekYsTUFBTSxJQUFJZCxxQkFBcUJjLFFBQVFWLE9BQU9DLFFBQVFDO0lBQ3hEO0lBRUEsd0RBQXdEO0lBQ3hELElBQUl1QixrQkFBa0JBLG1CQUFtQnZCLFFBQVFjLFNBQVMsRUFBRTtRQUMxRCxNQUFNTixTQUFTLENBQUMsK0NBQStDLEVBQUVlLGVBQWUsd0JBQXdCLEVBQUV2QixRQUFRYyxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBQzlIbEMsYUFBYTtZQUFFa0I7WUFBT0M7WUFBUUMsU0FBU0E7WUFBZ0JTLE9BQU87Z0JBQUVjO1lBQWU7WUFBR2Y7UUFBTztRQUN6RixNQUFNLElBQUlkLHFCQUFxQmMsUUFBUVYsT0FBT0MsUUFBUUM7SUFDeEQ7QUFDRjtBQUVBOztDQUVDLEdBQ00sU0FBU3dCLGtCQUNkTixLQUFRLEVBQ1JKLFNBQWlCO0lBRWpCLE9BQU87UUFDTCxHQUFHSSxLQUFLO1FBQ1JKO0lBQ0Y7QUFDRjtBQUVBOztDQUVDLEdBQ00sU0FBU1csZ0JBQ2RMLElBQU8sRUFDUE4sU0FBaUI7SUFFakIsT0FBTztRQUNMLEdBQUdNLElBQUk7UUFDUE47SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2Fhcy1jb3JlLy4vc3JjL2xpYi90ZW5hbnQtaXNvbGF0aW9uLnRzP2YyNTMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUZW5hbnQgSXNvbGF0aW9uIEVuZm9yY2VtZW50XG4gKiBcbiAqIFRoaXMgbW9kdWxlIHByb3ZpZGVzIHN0cmljdCB0ZW5hbnQgZGF0YSBpc29sYXRpb24gYXQgdGhlIGRhdGFiYXNlIGxldmVsLlxuICogSW5zdGVhZCBvZiBQcmlzbWEgbWlkZGxld2FyZSAod2hpY2ggaGFzIGFzeW5jIGNvbnRleHQgaXNzdWVzKSwgdGhpcyB1c2VzXG4gKiBhcHBsaWNhdGlvbi1sZXZlbCB2YWxpZGF0aW9uIGJlZm9yZSBxdWVyaWVzIGFyZSBleGVjdXRlZC5cbiAqIFxuICogRmVhdHVyZXM6XG4gKiAtIFByZS1xdWVyeSB2YWxpZGF0aW9uIGZ1bmN0aW9uc1xuICogLSBTVVBFUl9BRE1JTiBieXBhc3Mgd2l0aCBleHBsaWNpdCBmbGFnXG4gKiAtIFZpb2xhdGlvbiBsb2dnaW5nIGFuZCBoYXJkIGZhaWx1cmVcbiAqIC0gU2FmZSBxdWVyeSBidWlsZGVycyB0aGF0IGVuZm9yY2UgdGVuYW50IHNjb3BpbmdcbiAqL1xuXG4vLyBNb2RlbHMgdGhhdCByZXF1aXJlIHRlbmFudCBpc29sYXRpb24gKHRlbmFudC1zY29wZWQpXG5leHBvcnQgY29uc3QgVEVOQU5UX1NDT1BFRF9NT0RFTFMgPSBbXG4gICdUZW5hbnRNZW1iZXJzaGlwJyxcbiAgJ1RlbmFudERvbWFpbicsIFxuICAnQXVkaXRMb2cnLFxuICAvLyBBZGQgZnV0dXJlIHRlbmFudC1zY29wZWQgbW9kZWxzIGhlcmVcbl0gYXMgY29uc3RcblxuLy8gTW9kZWxzIHRoYXQgcmVxdWlyZSBwYXJ0bmVyIGlzb2xhdGlvbiAocGFydG5lci1zY29wZWQpXG4vLyBUaGVzZSBhcmUgc2VwYXJhdGUgZnJvbSB0ZW5hbnQgaXNvbGF0aW9uIC0gcGFydG5lcnMgYXJlIHBsYXRmb3JtLWxldmVsXG5leHBvcnQgY29uc3QgUEFSVE5FUl9TQ09QRURfTU9ERUxTID0gW1xuICAnUGFydG5lclVzZXInLFxuICAnUGFydG5lckFncmVlbWVudCcsXG4gICdQYXJ0bmVyUmVmZXJyYWxDb2RlJyxcbiAgJ1BhcnRuZXJSZWZlcnJhbCcsXG4gICdQYXJ0bmVyRWFybmluZycsXG5dIGFzIGNvbnN0XG5cbi8vIFBsYXRmb3JtLWxldmVsIG1vZGVscyAobm8gaXNvbGF0aW9uLCBTdXBlciBBZG1pbiBvbmx5KVxuZXhwb3J0IGNvbnN0IFBMQVRGT1JNX01PREVMUyA9IFtcbiAgJ1BhcnRuZXInLFxuICAnVXNlcicsXG4gICdUZW5hbnQnLFxuICAnU2Vzc2lvbicsXG4gICdNYWdpY0xpbmsnLFxuXSBhcyBjb25zdFxuXG5leHBvcnQgdHlwZSBUZW5hbnRTY29wZWRNb2RlbCA9IHR5cGVvZiBURU5BTlRfU0NPUEVEX01PREVMU1tudW1iZXJdXG5leHBvcnQgdHlwZSBQYXJ0bmVyU2NvcGVkTW9kZWwgPSB0eXBlb2YgUEFSVE5FUl9TQ09QRURfTU9ERUxTW251bWJlcl1cbmV4cG9ydCB0eXBlIFBsYXRmb3JtTW9kZWwgPSB0eXBlb2YgUExBVEZPUk1fTU9ERUxTW251bWJlcl1cblxuZXhwb3J0IGludGVyZmFjZSBUZW5hbnRDb250ZXh0IHtcbiAgdGVuYW50SWQ6IHN0cmluZyB8IG51bGxcbiAgdXNlcklkOiBzdHJpbmcgfCBudWxsXG4gIGlzU3VwZXJBZG1pbjogYm9vbGVhblxuICBieXBhc3NJc29sYXRpb24/OiBib29sZWFuXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGFydG5lckNvbnRleHQge1xuICBwYXJ0bmVySWQ6IHN0cmluZyB8IG51bGxcbiAgdXNlcklkOiBzdHJpbmcgfCBudWxsXG4gIGlzU3VwZXJBZG1pbjogYm9vbGVhblxuICBpc1BhcnRuZXJPd25lcj86IGJvb2xlYW5cbiAgaXNQYXJ0bmVyQWRtaW4/OiBib29sZWFuXG4gIGJ5cGFzc0lzb2xhdGlvbj86IGJvb2xlYW5cbn1cblxuLyoqXG4gKiBWaW9sYXRpb24gbG9nZ2VyXG4gKi9cbmludGVyZmFjZSBWaW9sYXRpb25Mb2cge1xuICB0aW1lc3RhbXA6IERhdGVcbiAgbW9kZWw6IHN0cmluZ1xuICBhY3Rpb246IHN0cmluZ1xuICBjb250ZXh0OiBUZW5hbnRDb250ZXh0IHwgbnVsbFxuICBxdWVyeTogYW55XG4gIHJlYXNvbjogc3RyaW5nXG59XG5cbmNvbnN0IHZpb2xhdGlvbnM6IFZpb2xhdGlvbkxvZ1tdID0gW11cbmNvbnN0IE1BWF9WSU9MQVRJT05fTE9HUyA9IDEwMDBcblxuZXhwb3J0IGZ1bmN0aW9uIGxvZ1Zpb2xhdGlvbih2aW9sYXRpb246IE9taXQ8VmlvbGF0aW9uTG9nLCAndGltZXN0YW1wJz4pOiB2b2lkIHtcbiAgY29uc3QgbG9nOiBWaW9sYXRpb25Mb2cgPSB7XG4gICAgLi4udmlvbGF0aW9uLFxuICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKVxuICB9XG4gIFxuICB2aW9sYXRpb25zLnB1c2gobG9nKVxuICBcbiAgaWYgKHZpb2xhdGlvbnMubGVuZ3RoID4gTUFYX1ZJT0xBVElPTl9MT0dTKSB7XG4gICAgdmlvbGF0aW9ucy5zaGlmdCgpXG4gIH1cbiAgXG4gIGNvbnNvbGUuZXJyb3IoJ1tURU5BTlQgSVNPTEFUSU9OIFZJT0xBVElPTl0nLCBKU09OLnN0cmluZ2lmeShsb2csIG51bGwsIDIpKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0VmlvbGF0aW9uTG9ncygpOiBWaW9sYXRpb25Mb2dbXSB7XG4gIHJldHVybiBbLi4udmlvbGF0aW9uc11cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNsZWFyVmlvbGF0aW9uTG9ncygpOiB2b2lkIHtcbiAgdmlvbGF0aW9ucy5sZW5ndGggPSAwXG59XG5cbi8qKlxuICogVGVuYW50IElzb2xhdGlvbiBFcnJvclxuICovXG5leHBvcnQgY2xhc3MgVGVuYW50SXNvbGF0aW9uRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIG1lc3NhZ2U6IHN0cmluZyxcbiAgICBwdWJsaWMgbW9kZWw6IHN0cmluZyxcbiAgICBwdWJsaWMgYWN0aW9uOiBzdHJpbmcsXG4gICAgcHVibGljIGNvbnRleHQ6IFRlbmFudENvbnRleHQgfCBudWxsXG4gICkge1xuICAgIHN1cGVyKG1lc3NhZ2UpXG4gICAgdGhpcy5uYW1lID0gJ1RlbmFudElzb2xhdGlvbkVycm9yJ1xuICB9XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgYSBtb2RlbCBpcyB0ZW5hbnQtc2NvcGVkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1RlbmFudFNjb3BlZE1vZGVsKG1vZGVsOiBzdHJpbmcpOiBtb2RlbCBpcyBUZW5hbnRTY29wZWRNb2RlbCB7XG4gIHJldHVybiBURU5BTlRfU0NPUEVEX01PREVMUy5pbmNsdWRlcyhtb2RlbCBhcyBhbnkpXG59XG5cbi8qKlxuICogVmFsaWRhdGUgdGVuYW50IGNvbnRleHQgYmVmb3JlIGV4ZWN1dGluZyBhIHF1ZXJ5XG4gKiBUaGlzIHNob3VsZCBiZSBjYWxsZWQgYmVmb3JlIGFueSB0ZW5hbnQtc2NvcGVkIGRhdGFiYXNlIG9wZXJhdGlvblxuICovXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVUZW5hbnRBY2Nlc3MoXG4gIG1vZGVsOiBzdHJpbmcsXG4gIGFjdGlvbjogc3RyaW5nLFxuICBjb250ZXh0OiBUZW5hbnRDb250ZXh0IHwgbnVsbCxcbiAgcXVlcnlUZW5hbnRJZD86IHN0cmluZyB8IG51bGxcbik6IHZvaWQge1xuICAvLyBTa2lwIHZhbGlkYXRpb24gZm9yIGdsb2JhbCBtb2RlbHNcbiAgaWYgKCFpc1RlbmFudFNjb3BlZE1vZGVsKG1vZGVsKSkge1xuICAgIHJldHVyblxuICB9XG4gIFxuICAvLyBBbGxvdyBleHBsaWNpdCBieXBhc3MgKGZvciBtaWdyYXRpb25zLCBhZG1pbiB0b29scywgZXRjLilcbiAgaWYgKGNvbnRleHQ/LmJ5cGFzc0lzb2xhdGlvbiA9PT0gdHJ1ZSkge1xuICAgIGlmICghY29udGV4dC5pc1N1cGVyQWRtaW4pIHtcbiAgICAgIGNvbnN0IHJlYXNvbiA9ICdCeXBhc3MgaXNvbGF0aW9uIGF0dGVtcHRlZCB3aXRob3V0IFNVUEVSX0FETUlOIHJvbGUnXG4gICAgICBsb2dWaW9sYXRpb24oeyBtb2RlbCwgYWN0aW9uLCBjb250ZXh0LCBxdWVyeTogeyBxdWVyeVRlbmFudElkIH0sIHJlYXNvbiB9KVxuICAgICAgdGhyb3cgbmV3IFRlbmFudElzb2xhdGlvbkVycm9yKHJlYXNvbiwgbW9kZWwsIGFjdGlvbiwgY29udGV4dClcbiAgICB9XG4gICAgcmV0dXJuXG4gIH1cbiAgXG4gIC8vIFNVUEVSX0FETUlOIGNhbiBhY2Nlc3MgYWxsIGRhdGFcbiAgaWYgKGNvbnRleHQ/LmlzU3VwZXJBZG1pbikge1xuICAgIHJldHVyblxuICB9XG4gIFxuICAvLyBObyBjb250ZXh0ID0gdmlvbGF0aW9uXG4gIGlmICghY29udGV4dCkge1xuICAgIGNvbnN0IHJlYXNvbiA9ICdObyB0ZW5hbnQgY29udGV4dCBwcm92aWRlZCBmb3IgdGVuYW50LXNjb3BlZCBxdWVyeSdcbiAgICBsb2dWaW9sYXRpb24oeyBtb2RlbCwgYWN0aW9uLCBjb250ZXh0LCBxdWVyeTogeyBxdWVyeVRlbmFudElkIH0sIHJlYXNvbiB9KVxuICAgIHRocm93IG5ldyBUZW5hbnRJc29sYXRpb25FcnJvcihyZWFzb24sIG1vZGVsLCBhY3Rpb24sIGNvbnRleHQpXG4gIH1cbiAgXG4gIC8vIE5vIHRlbmFudElkIGluIGNvbnRleHQgPSB2aW9sYXRpb25cbiAgaWYgKCFjb250ZXh0LnRlbmFudElkKSB7XG4gICAgY29uc3QgcmVhc29uID0gJ05vIHRlbmFudElkIGluIGNvbnRleHQgZm9yIHRlbmFudC1zY29wZWQgcXVlcnknXG4gICAgbG9nVmlvbGF0aW9uKHsgbW9kZWwsIGFjdGlvbiwgY29udGV4dCwgcXVlcnk6IHsgcXVlcnlUZW5hbnRJZCB9LCByZWFzb24gfSlcbiAgICB0aHJvdyBuZXcgVGVuYW50SXNvbGF0aW9uRXJyb3IocmVhc29uLCBtb2RlbCwgYWN0aW9uLCBjb250ZXh0KVxuICB9XG4gIFxuICAvLyBJZiBxdWVyeSBzcGVjaWZpZXMgYSB0ZW5hbnRJZCwgaXQgbXVzdCBtYXRjaCBjb250ZXh0XG4gIGlmIChxdWVyeVRlbmFudElkICYmIHF1ZXJ5VGVuYW50SWQgIT09IGNvbnRleHQudGVuYW50SWQpIHtcbiAgICBjb25zdCByZWFzb24gPSBgQ3Jvc3MtdGVuYW50IGFjY2VzcyBhdHRlbXB0OiBxdWVyeSB0ZW5hbnRJZCAoJHtxdWVyeVRlbmFudElkfSkgIT0gY29udGV4dCB0ZW5hbnRJZCAoJHtjb250ZXh0LnRlbmFudElkfSlgXG4gICAgbG9nVmlvbGF0aW9uKHsgbW9kZWwsIGFjdGlvbiwgY29udGV4dCwgcXVlcnk6IHsgcXVlcnlUZW5hbnRJZCB9LCByZWFzb24gfSlcbiAgICB0aHJvdyBuZXcgVGVuYW50SXNvbGF0aW9uRXJyb3IocmVhc29uLCBtb2RlbCwgYWN0aW9uLCBjb250ZXh0KVxuICB9XG59XG5cbi8qKlxuICogQ3JlYXRlIGEgdGVuYW50IGNvbnRleHQgZnJvbSB1c2VyIHNlc3Npb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVRlbmFudENvbnRleHQoXG4gIHRlbmFudElkOiBzdHJpbmcgfCBudWxsLFxuICB1c2VySWQ6IHN0cmluZyB8IG51bGwsXG4gIGlzU3VwZXJBZG1pbjogYm9vbGVhbixcbiAgYnlwYXNzSXNvbGF0aW9uOiBib29sZWFuID0gZmFsc2Vcbik6IFRlbmFudENvbnRleHQge1xuICByZXR1cm4ge1xuICAgIHRlbmFudElkLFxuICAgIHVzZXJJZCxcbiAgICBpc1N1cGVyQWRtaW4sXG4gICAgYnlwYXNzSXNvbGF0aW9uXG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgYSBwYXJ0bmVyIGNvbnRleHQgZnJvbSB1c2VyIHNlc3Npb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVBhcnRuZXJDb250ZXh0KFxuICBwYXJ0bmVySWQ6IHN0cmluZyB8IG51bGwsXG4gIHVzZXJJZDogc3RyaW5nIHwgbnVsbCxcbiAgaXNTdXBlckFkbWluOiBib29sZWFuLFxuICBpc1BhcnRuZXJPd25lcjogYm9vbGVhbiA9IGZhbHNlLFxuICBpc1BhcnRuZXJBZG1pbjogYm9vbGVhbiA9IGZhbHNlLFxuICBieXBhc3NJc29sYXRpb246IGJvb2xlYW4gPSBmYWxzZVxuKTogUGFydG5lckNvbnRleHQge1xuICByZXR1cm4ge1xuICAgIHBhcnRuZXJJZCxcbiAgICB1c2VySWQsXG4gICAgaXNTdXBlckFkbWluLFxuICAgIGlzUGFydG5lck93bmVyLFxuICAgIGlzUGFydG5lckFkbWluLFxuICAgIGJ5cGFzc0lzb2xhdGlvblxuICB9XG59XG5cbi8qKlxuICogRW5zdXJlIGEgV0hFUkUgY2xhdXNlIGluY2x1ZGVzIHRoZSBjb3JyZWN0IHRlbmFudElkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB3aXRoVGVuYW50RmlsdGVyPFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBhbnk+PihcbiAgd2hlcmU6IFQsXG4gIHRlbmFudElkOiBzdHJpbmdcbik6IFQgJiB7IHRlbmFudElkOiBzdHJpbmcgfSB7XG4gIHJldHVybiB7XG4gICAgLi4ud2hlcmUsXG4gICAgdGVuYW50SWRcbiAgfVxufVxuXG4vKipcbiAqIEVuc3VyZSBkYXRhIGJlaW5nIGNyZWF0ZWQgaW5jbHVkZXMgdGhlIGNvcnJlY3QgdGVuYW50SWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHdpdGhUZW5hbnREYXRhPFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBhbnk+PihcbiAgZGF0YTogVCxcbiAgdGVuYW50SWQ6IHN0cmluZ1xuKTogVCAmIHsgdGVuYW50SWQ6IHN0cmluZyB9IHtcbiAgcmV0dXJuIHtcbiAgICAuLi5kYXRhLFxuICAgIHRlbmFudElkXG4gIH1cbn1cblxuLyoqXG4gKiBDaGVjayBpZiBhIG1vZGVsIGlzIHBhcnRuZXItc2NvcGVkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1BhcnRuZXJTY29wZWRNb2RlbChtb2RlbDogc3RyaW5nKTogbW9kZWwgaXMgUGFydG5lclNjb3BlZE1vZGVsIHtcbiAgcmV0dXJuIFBBUlRORVJfU0NPUEVEX01PREVMUy5pbmNsdWRlcyhtb2RlbCBhcyBhbnkpXG59XG5cbi8qKlxuICogVmFsaWRhdGUgcGFydG5lciBjb250ZXh0IGJlZm9yZSBleGVjdXRpbmcgYSBxdWVyeVxuICogVGhpcyBzaG91bGQgYmUgY2FsbGVkIGJlZm9yZSBhbnkgcGFydG5lci1zY29wZWQgZGF0YWJhc2Ugb3BlcmF0aW9uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVBhcnRuZXJBY2Nlc3MoXG4gIG1vZGVsOiBzdHJpbmcsXG4gIGFjdGlvbjogc3RyaW5nLFxuICBjb250ZXh0OiBQYXJ0bmVyQ29udGV4dCB8IG51bGwsXG4gIHF1ZXJ5UGFydG5lcklkPzogc3RyaW5nIHwgbnVsbFxuKTogdm9pZCB7XG4gIC8vIFNraXAgdmFsaWRhdGlvbiBmb3Igbm9uLXBhcnRuZXIgbW9kZWxzXG4gIGlmICghaXNQYXJ0bmVyU2NvcGVkTW9kZWwobW9kZWwpKSB7XG4gICAgcmV0dXJuXG4gIH1cbiAgXG4gIC8vIEFsbG93IGV4cGxpY2l0IGJ5cGFzcyAoZm9yIG1pZ3JhdGlvbnMsIGFkbWluIHRvb2xzLCBldGMuKVxuICBpZiAoY29udGV4dD8uYnlwYXNzSXNvbGF0aW9uID09PSB0cnVlKSB7XG4gICAgaWYgKCFjb250ZXh0LmlzU3VwZXJBZG1pbikge1xuICAgICAgY29uc3QgcmVhc29uID0gJ1BhcnRuZXIgYnlwYXNzIGlzb2xhdGlvbiBhdHRlbXB0ZWQgd2l0aG91dCBTVVBFUl9BRE1JTiByb2xlJ1xuICAgICAgbG9nVmlvbGF0aW9uKHsgbW9kZWwsIGFjdGlvbiwgY29udGV4dDogY29udGV4dCBhcyBhbnksIHF1ZXJ5OiB7IHF1ZXJ5UGFydG5lcklkIH0sIHJlYXNvbiB9KVxuICAgICAgdGhyb3cgbmV3IFRlbmFudElzb2xhdGlvbkVycm9yKHJlYXNvbiwgbW9kZWwsIGFjdGlvbiwgY29udGV4dCBhcyBhbnkpXG4gICAgfVxuICAgIHJldHVyblxuICB9XG4gIFxuICAvLyBTVVBFUl9BRE1JTiBjYW4gYWNjZXNzIGFsbCBwYXJ0bmVyIGRhdGFcbiAgaWYgKGNvbnRleHQ/LmlzU3VwZXJBZG1pbikge1xuICAgIHJldHVyblxuICB9XG4gIFxuICAvLyBObyBjb250ZXh0ID0gdmlvbGF0aW9uXG4gIGlmICghY29udGV4dCkge1xuICAgIGNvbnN0IHJlYXNvbiA9ICdObyBwYXJ0bmVyIGNvbnRleHQgcHJvdmlkZWQgZm9yIHBhcnRuZXItc2NvcGVkIHF1ZXJ5J1xuICAgIGxvZ1Zpb2xhdGlvbih7IG1vZGVsLCBhY3Rpb24sIGNvbnRleHQ6IG51bGwsIHF1ZXJ5OiB7IHF1ZXJ5UGFydG5lcklkIH0sIHJlYXNvbiB9KVxuICAgIHRocm93IG5ldyBUZW5hbnRJc29sYXRpb25FcnJvcihyZWFzb24sIG1vZGVsLCBhY3Rpb24sIG51bGwpXG4gIH1cbiAgXG4gIC8vIE5vIHBhcnRuZXJJZCBpbiBjb250ZXh0ID0gdmlvbGF0aW9uXG4gIGlmICghY29udGV4dC5wYXJ0bmVySWQpIHtcbiAgICBjb25zdCByZWFzb24gPSAnTm8gcGFydG5lcklkIGluIGNvbnRleHQgZm9yIHBhcnRuZXItc2NvcGVkIHF1ZXJ5J1xuICAgIGxvZ1Zpb2xhdGlvbih7IG1vZGVsLCBhY3Rpb24sIGNvbnRleHQ6IGNvbnRleHQgYXMgYW55LCBxdWVyeTogeyBxdWVyeVBhcnRuZXJJZCB9LCByZWFzb24gfSlcbiAgICB0aHJvdyBuZXcgVGVuYW50SXNvbGF0aW9uRXJyb3IocmVhc29uLCBtb2RlbCwgYWN0aW9uLCBjb250ZXh0IGFzIGFueSlcbiAgfVxuICBcbiAgLy8gSWYgcXVlcnkgc3BlY2lmaWVzIGEgcGFydG5lcklkLCBpdCBtdXN0IG1hdGNoIGNvbnRleHRcbiAgaWYgKHF1ZXJ5UGFydG5lcklkICYmIHF1ZXJ5UGFydG5lcklkICE9PSBjb250ZXh0LnBhcnRuZXJJZCkge1xuICAgIGNvbnN0IHJlYXNvbiA9IGBDcm9zcy1wYXJ0bmVyIGFjY2VzcyBhdHRlbXB0OiBxdWVyeSBwYXJ0bmVySWQgKCR7cXVlcnlQYXJ0bmVySWR9KSAhPSBjb250ZXh0IHBhcnRuZXJJZCAoJHtjb250ZXh0LnBhcnRuZXJJZH0pYFxuICAgIGxvZ1Zpb2xhdGlvbih7IG1vZGVsLCBhY3Rpb24sIGNvbnRleHQ6IGNvbnRleHQgYXMgYW55LCBxdWVyeTogeyBxdWVyeVBhcnRuZXJJZCB9LCByZWFzb24gfSlcbiAgICB0aHJvdyBuZXcgVGVuYW50SXNvbGF0aW9uRXJyb3IocmVhc29uLCBtb2RlbCwgYWN0aW9uLCBjb250ZXh0IGFzIGFueSlcbiAgfVxufVxuXG4vKipcbiAqIEVuc3VyZSBhIFdIRVJFIGNsYXVzZSBpbmNsdWRlcyB0aGUgY29ycmVjdCBwYXJ0bmVySWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHdpdGhQYXJ0bmVyRmlsdGVyPFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBhbnk+PihcbiAgd2hlcmU6IFQsXG4gIHBhcnRuZXJJZDogc3RyaW5nXG4pOiBUICYgeyBwYXJ0bmVySWQ6IHN0cmluZyB9IHtcbiAgcmV0dXJuIHtcbiAgICAuLi53aGVyZSxcbiAgICBwYXJ0bmVySWRcbiAgfVxufVxuXG4vKipcbiAqIEVuc3VyZSBkYXRhIGJlaW5nIGNyZWF0ZWQgaW5jbHVkZXMgdGhlIGNvcnJlY3QgcGFydG5lcklkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB3aXRoUGFydG5lckRhdGE8VCBleHRlbmRzIFJlY29yZDxzdHJpbmcsIGFueT4+KFxuICBkYXRhOiBULFxuICBwYXJ0bmVySWQ6IHN0cmluZ1xuKTogVCAmIHsgcGFydG5lcklkOiBzdHJpbmcgfSB7XG4gIHJldHVybiB7XG4gICAgLi4uZGF0YSxcbiAgICBwYXJ0bmVySWRcbiAgfVxufVxuIl0sIm5hbWVzIjpbIlRFTkFOVF9TQ09QRURfTU9ERUxTIiwiUEFSVE5FUl9TQ09QRURfTU9ERUxTIiwiUExBVEZPUk1fTU9ERUxTIiwidmlvbGF0aW9ucyIsIk1BWF9WSU9MQVRJT05fTE9HUyIsImxvZ1Zpb2xhdGlvbiIsInZpb2xhdGlvbiIsImxvZyIsInRpbWVzdGFtcCIsIkRhdGUiLCJwdXNoIiwibGVuZ3RoIiwic2hpZnQiLCJjb25zb2xlIiwiZXJyb3IiLCJKU09OIiwic3RyaW5naWZ5IiwiZ2V0VmlvbGF0aW9uTG9ncyIsImNsZWFyVmlvbGF0aW9uTG9ncyIsIlRlbmFudElzb2xhdGlvbkVycm9yIiwiRXJyb3IiLCJjb25zdHJ1Y3RvciIsIm1lc3NhZ2UiLCJtb2RlbCIsImFjdGlvbiIsImNvbnRleHQiLCJuYW1lIiwiaXNUZW5hbnRTY29wZWRNb2RlbCIsImluY2x1ZGVzIiwidmFsaWRhdGVUZW5hbnRBY2Nlc3MiLCJxdWVyeVRlbmFudElkIiwiYnlwYXNzSXNvbGF0aW9uIiwiaXNTdXBlckFkbWluIiwicmVhc29uIiwicXVlcnkiLCJ0ZW5hbnRJZCIsImNyZWF0ZVRlbmFudENvbnRleHQiLCJ1c2VySWQiLCJjcmVhdGVQYXJ0bmVyQ29udGV4dCIsInBhcnRuZXJJZCIsImlzUGFydG5lck93bmVyIiwiaXNQYXJ0bmVyQWRtaW4iLCJ3aXRoVGVuYW50RmlsdGVyIiwid2hlcmUiLCJ3aXRoVGVuYW50RGF0YSIsImRhdGEiLCJpc1BhcnRuZXJTY29wZWRNb2RlbCIsInZhbGlkYXRlUGFydG5lckFjY2VzcyIsInF1ZXJ5UGFydG5lcklkIiwid2l0aFBhcnRuZXJGaWx0ZXIiLCJ3aXRoUGFydG5lckRhdGEiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/tenant-isolation.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fwallets%2Froute&page=%2Fapi%2Fwallets%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fwallets%2Froute.ts&appDir=%2Fapp%2Fsaas-core%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp%2Fsaas-core&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();