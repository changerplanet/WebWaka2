"use strict";(()=>{var e={};e.id=513,e.ids=[513],e.modules={3524:e=>{e.exports=require("@prisma/client")},2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4932:e=>{e.exports=require("dns/promises")},6005:e=>{e.exports=require("node:crypto")},3434:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>N,patchFetch:()=>w,requestAsyncStorage:()=>I,routeModule:()=>y,serverHooks:()=>j,staticGenerationAsyncStorage:()=>g});var a={};s.r(a),s.d(a,{DELETE:()=>f,GET:()=>l,POST:()=>x});var n=s(9303),r=s(8716),o=s(670),i=s(7070),u=s(6238),d=s(340),c=s(7662),p=s(4245),m=s(8547);async function l(e,{params:t}){try{let{slug:e}=await t,s=await (0,d.nc)(e);if(!s.authorized)return i.NextResponse.json({success:!1,error:s.error},{status:s.status});let a=(await u._B.tenantDomain.findMany({where:{tenantId:s.tenantId},orderBy:[{isPrimary:"desc"},{createdAt:"desc"}]})).map(e=>"CUSTOM"===e.type&&"PENDING"===e.status&&e.verificationToken?{...e,verificationInfo:(0,p.qq)(e.domain,e.verificationToken)}:e);return i.NextResponse.json({success:!0,domains:a})}catch(e){return console.error("Failed to fetch domains:",e),i.NextResponse.json({success:!1,error:"Failed to fetch domains"},{status:500})}}async function x(e,{params:t}){try{let{slug:s}=await t,a=await (0,d.nc)(s);if(!a.authorized)return i.NextResponse.json({success:!1,error:a.error},{status:a.status});let{domain:n}=await e.json();if(!n)return i.NextResponse.json({success:!1,error:"Domain is required"},{status:400});let r=n.toLowerCase().trim();if(!/^(?!-)[A-Za-z0-9-]+([\-\.]{1}[a-z0-9]+)*\.[A-Za-z]{2,}$/.test(r))return i.NextResponse.json({success:!1,error:"Invalid domain format"},{status:400});if(!await (0,p.bz)(r))return i.NextResponse.json({success:!1,error:"Domain is already in use"},{status:409});let o=(0,m.Z)(),l=await u._B.tenantDomain.create({data:{id:(0,m.Z)(),tenantId:a.tenantId,domain:r,type:"CUSTOM",status:"PENDING",isPrimary:!1,verificationToken:o}});return await (0,c.U)({action:"DOMAIN_ADDED",actorId:a.user.id,actorEmail:a.user.email,tenantId:a.tenantId,targetType:"TenantDomain",targetId:l.id,metadata:{domain:r,type:"CUSTOM"}}),i.NextResponse.json({success:!0,domain:{...l,verificationInfo:(0,p.qq)(r,o)}},{status:201})}catch(e){return console.error("Failed to add domain:",e),i.NextResponse.json({success:!1,error:"Failed to add domain"},{status:500})}}async function f(e,{params:t}){try{let{slug:s}=await t,a=await (0,d.nc)(s);if(!a.authorized)return i.NextResponse.json({success:!1,error:a.error},{status:a.status});let{searchParams:n}=new URL(e.url),r=n.get("domainId");if(!r)return i.NextResponse.json({success:!1,error:"domainId is required"},{status:400});let o=await u._B.tenantDomain.findFirst({where:{id:r,tenantId:a.tenantId}});if(!o)return i.NextResponse.json({success:!1,error:"Domain not found"},{status:404});if("SUBDOMAIN"===o.type)return i.NextResponse.json({success:!1,error:"Cannot delete the default subdomain"},{status:400});return await u._B.tenantDomain.delete({where:{id:r}}),await (0,c.U)({action:"DOMAIN_REMOVED",actorId:a.user.id,actorEmail:a.user.email,tenantId:a.tenantId,targetType:"TenantDomain",targetId:r,metadata:{domain:o.domain,type:o.type}}),i.NextResponse.json({success:!0,message:"Domain removed successfully"})}catch(e){return console.error("Failed to remove domain:",e),i.NextResponse.json({success:!1,error:"Failed to remove domain"},{status:500})}}let y=new n.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/tenants/[slug]/domains/route",pathname:"/api/tenants/[slug]/domains",filename:"route",bundlePath:"app/api/tenants/[slug]/domains/route"},resolvedPagePath:"/app/saas-core/src/app/api/tenants/[slug]/domains/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:I,staticGenerationAsyncStorage:g,serverHooks:j}=y,N="/api/tenants/[slug]/domains/route";function w(){return(0,o.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:g})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[380,972,970,949],()=>s(3434));module.exports=a})();