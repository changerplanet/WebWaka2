"use strict";(()=>{var e={};e.id=167,e.ids=[167],e.modules={3524:e=>{e.exports=require("@prisma/client")},2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4932:e=>{e.exports=require("dns/promises")},6005:e=>{e.exports=require("node:crypto")},850:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>y,patchFetch:()=>j,requestAsyncStorage:()=>f,routeModule:()=>x,serverHooks:()=>g,staticGenerationAsyncStorage:()=>I});var n={};s.r(n),s.d(n,{PATCH:()=>l,POST:()=>m});var a=s(9303),r=s(8716),o=s(670),i=s(7070),u=s(6238),d=s(340),c=s(7662),p=s(4245);async function m(e,{params:t}){try{let{slug:e,domainId:s}=await t,n=await (0,d.nc)(e);if(!n.authorized)return i.NextResponse.json({success:!1,error:n.error},{status:n.status});let a=await u._B.tenantDomain.findFirst({where:{id:s,tenantId:n.tenantId}});if(!a)return i.NextResponse.json({success:!1,error:"Domain not found"},{status:404});let r=await (0,p.F2)(s);if(r.success)return await (0,c.U)({action:"DOMAIN_VERIFIED",actorId:n.user.id,actorEmail:n.user.email,tenantId:n.tenantId,targetType:"TenantDomain",targetId:s,metadata:{domain:a.domain}}),i.NextResponse.json({success:!0,domain:r.domain,message:"Domain verified successfully!"});return i.NextResponse.json({success:!1,error:r.error},{status:400})}catch(e){return console.error("Failed to verify domain:",e),i.NextResponse.json({success:!1,error:"Failed to verify domain"},{status:500})}}async function l(e,{params:t}){try{let{slug:s,domainId:n}=await t,a=await (0,d.nc)(s);if(!a.authorized)return i.NextResponse.json({success:!1,error:a.error},{status:a.status});let{isPrimary:r}=await e.json(),o=await u._B.tenantDomain.findFirst({where:{id:n,tenantId:a.tenantId}});if(!o)return i.NextResponse.json({success:!1,error:"Domain not found"},{status:404});if(r&&"VERIFIED"!==o.status)return i.NextResponse.json({success:!1,error:"Only verified domains can be set as primary"},{status:400});r&&await u._B.tenantDomain.updateMany({where:{tenantId:a.tenantId,isPrimary:!0},data:{isPrimary:!1}});let c=await u._B.tenantDomain.update({where:{id:n},data:{isPrimary:r}});return i.NextResponse.json({success:!0,domain:c})}catch(e){return console.error("Failed to update domain:",e),i.NextResponse.json({success:!1,error:"Failed to update domain"},{status:500})}}let x=new a.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/tenants/[slug]/domains/[domainId]/route",pathname:"/api/tenants/[slug]/domains/[domainId]",filename:"route",bundlePath:"app/api/tenants/[slug]/domains/[domainId]/route"},resolvedPagePath:"/app/saas-core/src/app/api/tenants/[slug]/domains/[domainId]/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:I,serverHooks:g}=x,y="/api/tenants/[slug]/domains/[domainId]/route";function j(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:I})}}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),n=t.X(0,[380,972,970,949],()=>s(850));module.exports=n})();