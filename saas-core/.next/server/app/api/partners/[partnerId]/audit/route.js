"use strict";(()=>{var t={};t.id=252,t.ids=[252],t.modules={53524:t=>{t.exports=require("@prisma/client")},72934:t=>{t.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:t=>{t.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:t=>{t.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6005:t=>{t.exports=require("node:crypto")},33174:(t,e,r)=>{r.r(e),r.d(e,{originalPathname:()=>I,patchFetch:()=>P,requestAsyncStorage:()=>p,routeModule:()=>N,serverHooks:()=>u,staticGenerationAsyncStorage:()=>c});var a={};r.r(a),r.d(a,{GET:()=>D});var n=r(49303),E=r(88716),i=r(60670),s=r(87070),A=r(93270),o=r(56238);let R=["PARTNER_CREATED","PARTNER_UPDATED","PARTNER_APPROVED","PARTNER_SUSPENDED","PARTNER_TERMINATED","PARTNER_USER_ADDED","PARTNER_USER_REMOVED","PARTNER_AGREEMENT_CREATED","PARTNER_AGREEMENT_SIGNED","PARTNER_AGREEMENT_APPROVED","ATTRIBUTION_CREATED","ATTRIBUTION_LOCKED","ATTRIBUTION_LOCK_ATTEMPTED","ATTRIBUTION_REASSIGN_BLOCKED","PARTNER_REFERRAL_CREATED","PARTNER_REFERRAL_LOCKED","PARTNER_TENANT_CREATED","PARTNER_TENANT_ACTIVATED","COMMISSION_CALCULATED","EARNING_CREATED","EARNING_CLEARED","EARNING_APPROVED","EARNING_PAID","EARNING_DISPUTED","EARNING_REVERSED","EARNING_VOIDED","PARTNER_EARNING_CREATED","PARTNER_EARNING_APPROVED","PARTNER_EARNING_PAID","PAYOUT_BATCH_CREATED","PAYOUT_BATCH_APPROVED","PAYOUT_BATCH_PROCESSED","PAYOUT_BATCH_FAILED","PAYOUT_BATCH_CANCELLED","PAYOUT_READINESS_CHECKED","PAYOUT_HOLD_APPLIED","PAYOUT_HOLD_RELEASED","PAYOUT_SETTINGS_UPDATED","TAX_DOCUMENT_SUBMITTED","TAX_DOCUMENT_VERIFIED"];async function T(t){let e={};t.actions&&t.actions.length>0&&(e.action={in:t.actions}),t.actorId&&(e.actorId=t.actorId),t.targetType&&(e.targetType=t.targetType),t.targetId&&(e.targetId=t.targetId),t.tenantId&&(e.tenantId=t.tenantId),(t.startDate||t.endDate)&&(e.createdAt={},t.startDate&&(e.createdAt.gte=t.startDate),t.endDate&&(e.createdAt.lte=t.endDate));let[r,a]=await Promise.all([o._B.auditLog.findMany({where:e,orderBy:{createdAt:"desc"},take:t.limit||100,skip:t.offset||0}),o._B.auditLog.count({where:e})]);return{entries:r,total:a}}async function _(t,e){return T({actions:R,targetId:t,...e})}async function d(t,e,r){let a=await o._B.partner.findUnique({where:{id:t},select:{id:!0,name:!0}}),{entries:n}=await T({actions:R,startDate:e,endDate:r}),E=n.filter(e=>{let r=e.metadata;return e.targetId===t||r?.partnerId===t});return{partner:a,period:{start:e,end:r},summary:{totalActions:E.length,earningsCreated:E.filter(t=>"EARNING_CREATED"===t.action).length,earningsPaid:E.filter(t=>"EARNING_PAID"===t.action).length,payoutBatches:E.filter(t=>"PAYOUT_BATCH_CREATED"===t.action).length,referralsAdded:E.filter(t=>"ATTRIBUTION_CREATED"===t.action||"PARTNER_REFERRAL_CREATED"===t.action).length},timeline:E}}async function D(t,{params:e}){try{let{partnerId:r}=await e,a=await (0,A.rO)(r);if(!a.authorized)return s.NextResponse.json({error:a.error},{status:a.status});let{searchParams:n}=new URL(t.url),E=n.get("start"),i=n.get("end"),o=n.get("report"),R=parseInt(n.get("limit")||"50"),T=parseInt(n.get("offset")||"0");if("activity"===o){let t=new Date(E||Date.now()-2592e6),e=i?new Date(i):new Date,a=await d(r,t,e);return s.NextResponse.json(a)}let D=await _(r,{startDate:E?new Date(E):void 0,endDate:i?new Date(i):void 0,limit:R,offset:T});return s.NextResponse.json({entries:D.entries,total:D.total,limit:R,offset:T})}catch(t){return console.error("Error fetching audit logs:",t),s.NextResponse.json({error:"Internal server error"},{status:500})}}let N=new n.AppRouteRouteModule({definition:{kind:E.x.APP_ROUTE,page:"/api/partners/[partnerId]/audit/route",pathname:"/api/partners/[partnerId]/audit",filename:"route",bundlePath:"app/api/partners/[partnerId]/audit/route"},resolvedPagePath:"/app/saas-core/src/app/api/partners/[partnerId]/audit/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:c,serverHooks:u}=N,I="/api/partners/[partnerId]/audit/route";function P(){return(0,i.patchFetch)({serverHooks:u,staticGenerationAsyncStorage:c})}}};var e=require("../../../../../webpack-runtime.js");e.C(t);var r=t=>e(e.s=t),a=e.X(0,[9380,5972,6970,3270],()=>r(33174));module.exports=a})();