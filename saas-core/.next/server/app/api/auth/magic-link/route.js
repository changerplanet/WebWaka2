"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/auth/magic-link/route";
exports.ids = ["app/api/auth/magic-link/route"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "./action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "./request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "./static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:crypto");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2Fmagic-link%2Froute&page=%2Fapi%2Fauth%2Fmagic-link%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fmagic-link%2Froute.ts&appDir=%2Fapp%2Fsaas-core%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp%2Fsaas-core&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2Fmagic-link%2Froute&page=%2Fapi%2Fauth%2Fmagic-link%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fmagic-link%2Froute.ts&appDir=%2Fapp%2Fsaas-core%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp%2Fsaas-core&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _app_saas_core_src_app_api_auth_magic_link_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/auth/magic-link/route.ts */ \"(rsc)/./src/app/api/auth/magic-link/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/auth/magic-link/route\",\n        pathname: \"/api/auth/magic-link\",\n        filename: \"route\",\n        bundlePath: \"app/api/auth/magic-link/route\"\n    },\n    resolvedPagePath: \"/app/saas-core/src/app/api/auth/magic-link/route.ts\",\n    nextConfigOutput,\n    userland: _app_saas_core_src_app_api_auth_magic_link_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/auth/magic-link/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZhdXRoJTJGbWFnaWMtbGluayUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGYXV0aCUyRm1hZ2ljLWxpbmslMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZhdXRoJTJGbWFnaWMtbGluayUyRnJvdXRlLnRzJmFwcERpcj0lMkZhcHAlMkZzYWFzLWNvcmUlMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRmFwcCUyRnNhYXMtY29yZSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDRztBQUNoRjtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL3NhYXMtY29yZS8/ODQ1OCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvYXBwL3NhYXMtY29yZS9zcmMvYXBwL2FwaS9hdXRoL21hZ2ljLWxpbmsvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2F1dGgvbWFnaWMtbGluay9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2F1dGgvbWFnaWMtbGlua1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvYXV0aC9tYWdpYy1saW5rL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL2FwcC9zYWFzLWNvcmUvc3JjL2FwcC9hcGkvYXV0aC9tYWdpYy1saW5rL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9hdXRoL21hZ2ljLWxpbmsvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2Fmagic-link%2Froute&page=%2Fapi%2Fauth%2Fmagic-link%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fmagic-link%2Froute.ts&appDir=%2Fapp%2Fsaas-core%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp%2Fsaas-core&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/auth/magic-link/route.ts":
/*!**********************************************!*\
  !*** ./src/app/api/auth/magic-link/route.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/auth */ \"(rsc)/./src/lib/auth.ts\");\n/* harmony import */ var _lib_resend__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/resend */ \"(rsc)/./src/lib/resend.ts\");\n/* harmony import */ var _lib_tenant_resolver__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/tenant-resolver */ \"(rsc)/./src/lib/tenant-resolver.ts\");\n\n\n\n\n// In development/testing, we can show the magic link in the response\nconst DEV_MODE =  true || 0;\nasync function POST(request) {\n    try {\n        const body = await request.json();\n        const { email, tenantSlug } = body;\n        if (!email) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Email is required\"\n            }, {\n                status: 400\n            });\n        }\n        // Validate email format\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n        if (!emailRegex.test(email)) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Invalid email format\"\n            }, {\n                status: 400\n            });\n        }\n        // Resolve tenant if slug provided\n        let tenantId;\n        let tenantName = \"SaaS Core\";\n        if (tenantSlug) {\n            const tenant = await (0,_lib_tenant_resolver__WEBPACK_IMPORTED_MODULE_3__.resolveTenantBySlug)(tenantSlug);\n            if (tenant) {\n                tenantId = tenant.id;\n                tenantName = tenant.appName || tenant.name;\n            }\n        }\n        // Create magic link\n        const { token, user } = await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_1__.createMagicLink)(email, tenantId);\n        // Build verification URL\n        const appUrl = \"https://tenanthub-3.preview.emergentagent.com\" || 0;\n        const verifyUrl = `${appUrl}/api/auth/verify?token=${token}`;\n        // Try to send email via Resend\n        let emailSent = false;\n        let emailError = null;\n        if (_lib_resend__WEBPACK_IMPORTED_MODULE_2__.resend) {\n            try {\n                const { error } = await _lib_resend__WEBPACK_IMPORTED_MODULE_2__.resend.emails.send({\n                    from: _lib_resend__WEBPACK_IMPORTED_MODULE_2__.EMAIL_FROM,\n                    to: email,\n                    subject: `Sign in to ${tenantName}`,\n                    html: `\n            <!DOCTYPE html>\n            <html>\n            <head>\n              <meta charset=\"utf-8\">\n              <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n            </head>\n            <body style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;\">\n              <div style=\"background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); padding: 30px; border-radius: 12px 12px 0 0; text-align: center;\">\n                <h1 style=\"color: white; margin: 0; font-size: 24px;\">${tenantName}</h1>\n              </div>\n              <div style=\"background: #ffffff; padding: 30px; border: 1px solid #e5e7eb; border-top: none; border-radius: 0 0 12px 12px;\">\n                <h2 style=\"color: #1f2937; margin-top: 0;\">Sign in to your account</h2>\n                <p style=\"color: #6b7280;\">Click the button below to securely sign in. This link will expire in 15 minutes.</p>\n                <div style=\"text-align: center; margin: 30px 0;\">\n                  <a href=\"${verifyUrl}\" style=\"display: inline-block; background: #6366f1; color: white; padding: 14px 32px; border-radius: 8px; text-decoration: none; font-weight: 600;\">Sign In</a>\n                </div>\n                <p style=\"color: #9ca3af; font-size: 14px;\">If you didn't request this email, you can safely ignore it.</p>\n                <hr style=\"border: none; border-top: 1px solid #e5e7eb; margin: 20px 0;\">\n                <p style=\"color: #9ca3af; font-size: 12px; margin: 0;\">Or copy and paste this URL into your browser:</p>\n                <p style=\"color: #6366f1; font-size: 12px; word-break: break-all;\">${verifyUrl}</p>\n              </div>\n            </body>\n            </html>\n          `\n                });\n                if (error) {\n                    console.error(\"Resend error:\", error);\n                    emailError = error.message || \"Failed to send email\";\n                } else {\n                    emailSent = true;\n                }\n            } catch (e) {\n                console.error(\"Email send error:\", e);\n                emailError = e.message || \"Failed to send email\";\n            }\n        }\n        // Log the magic link for development\n        console.log(\"\\n=========================================\");\n        console.log(\"MAGIC LINK for\", email, \":\");\n        console.log(verifyUrl);\n        console.log(\"=========================================\\n\");\n        // Response depends on whether email was sent\n        const response = {\n            success: true,\n            message: emailSent ? \"Magic link sent! Check your email.\" : \"Magic link created! Check the console or use the link below.\",\n            emailSent\n        };\n        // In dev mode or if email failed, include the magic link in response\n        // This makes testing much easier\n        if (!emailSent || DEV_MODE) {\n            response.magicLink = verifyUrl;\n            response.note = emailError ? `Email failed: ${emailError}. Use the magic link directly.` : \"For testing, you can use this link directly.\";\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(response);\n    } catch (error) {\n        console.error(\"Magic link error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: \"Failed to create magic link\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9hdXRoL21hZ2ljLWxpbmsvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBdUQ7QUFDWDtBQUNLO0FBQ1U7QUFFM0QscUVBQXFFO0FBQ3JFLE1BQU1LLFdBQVdDLEtBQXlCLElBQWlCQSxDQUErQjtBQUVuRixlQUFlRyxLQUFLQyxPQUFvQjtJQUM3QyxJQUFJO1FBQ0YsTUFBTUMsT0FBTyxNQUFNRCxRQUFRRSxJQUFJO1FBQy9CLE1BQU0sRUFBRUMsS0FBSyxFQUFFQyxVQUFVLEVBQUUsR0FBR0g7UUFFOUIsSUFBSSxDQUFDRSxPQUFPO1lBQ1YsT0FBT2IscURBQVlBLENBQUNZLElBQUksQ0FDdEI7Z0JBQUVHLFNBQVM7Z0JBQU9DLE9BQU87WUFBb0IsR0FDN0M7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBLHdCQUF3QjtRQUN4QixNQUFNQyxhQUFhO1FBQ25CLElBQUksQ0FBQ0EsV0FBV0MsSUFBSSxDQUFDTixRQUFRO1lBQzNCLE9BQU9iLHFEQUFZQSxDQUFDWSxJQUFJLENBQ3RCO2dCQUFFRyxTQUFTO2dCQUFPQyxPQUFPO1lBQXVCLEdBQ2hEO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQSxrQ0FBa0M7UUFDbEMsSUFBSUc7UUFDSixJQUFJQyxhQUFhO1FBRWpCLElBQUlQLFlBQVk7WUFDZCxNQUFNUSxTQUFTLE1BQU1sQix5RUFBbUJBLENBQUNVO1lBQ3pDLElBQUlRLFFBQVE7Z0JBQ1ZGLFdBQVdFLE9BQU9DLEVBQUU7Z0JBQ3BCRixhQUFhQyxPQUFPRSxPQUFPLElBQUlGLE9BQU9HLElBQUk7WUFDNUM7UUFDRjtRQUVBLG9CQUFvQjtRQUNwQixNQUFNLEVBQUVDLEtBQUssRUFBRUMsSUFBSSxFQUFFLEdBQUcsTUFBTTFCLDBEQUFlQSxDQUFDWSxPQUFPTztRQUVyRCx5QkFBeUI7UUFDekIsTUFBTVEsU0FBU3RCLCtDQUErQixJQUFJO1FBQ2xELE1BQU13QixZQUFZLENBQUMsRUFBRUYsT0FBTyx1QkFBdUIsRUFBRUYsTUFBTSxDQUFDO1FBRTVELCtCQUErQjtRQUMvQixJQUFJSyxZQUFZO1FBQ2hCLElBQUlDLGFBQTRCO1FBRWhDLElBQUk5QiwrQ0FBTUEsRUFBRTtZQUNWLElBQUk7Z0JBQ0YsTUFBTSxFQUFFYyxLQUFLLEVBQUUsR0FBRyxNQUFNZCwrQ0FBTUEsQ0FBQytCLE1BQU0sQ0FBQ0MsSUFBSSxDQUFDO29CQUN6Q0MsTUFBTWhDLG1EQUFVQTtvQkFDaEJpQyxJQUFJdkI7b0JBQ0p3QixTQUFTLENBQUMsV0FBVyxFQUFFaEIsV0FBVyxDQUFDO29CQUNuQ2lCLE1BQU0sQ0FBQzs7Ozs7Ozs7O3NFQVNxRCxFQUFFakIsV0FBVzs7Ozs7OzJCQU14RCxFQUFFUyxVQUFVOzs7OzttRkFLNEMsRUFBRUEsVUFBVTs7OztVQUlyRixDQUFDO2dCQUNIO2dCQUVBLElBQUlkLE9BQU87b0JBQ1R1QixRQUFRdkIsS0FBSyxDQUFDLGlCQUFpQkE7b0JBQy9CZ0IsYUFBYWhCLE1BQU13QixPQUFPLElBQUk7Z0JBQ2hDLE9BQU87b0JBQ0xULFlBQVk7Z0JBQ2Q7WUFDRixFQUFFLE9BQU9VLEdBQVE7Z0JBQ2ZGLFFBQVF2QixLQUFLLENBQUMscUJBQXFCeUI7Z0JBQ25DVCxhQUFhUyxFQUFFRCxPQUFPLElBQUk7WUFDNUI7UUFDRjtRQUVBLHFDQUFxQztRQUNyQ0QsUUFBUUcsR0FBRyxDQUFDO1FBQ1pILFFBQVFHLEdBQUcsQ0FBQyxrQkFBa0I3QixPQUFPO1FBQ3JDMEIsUUFBUUcsR0FBRyxDQUFDWjtRQUNaUyxRQUFRRyxHQUFHLENBQUM7UUFFWiw2Q0FBNkM7UUFDN0MsTUFBTUMsV0FBZ0I7WUFDcEI1QixTQUFTO1lBQ1R5QixTQUFTVCxZQUNMLHVDQUNBO1lBQ0pBO1FBQ0Y7UUFFQSxxRUFBcUU7UUFDckUsaUNBQWlDO1FBQ2pDLElBQUksQ0FBQ0EsYUFBYTFCLFVBQVU7WUFDMUJzQyxTQUFTQyxTQUFTLEdBQUdkO1lBQ3JCYSxTQUFTRSxJQUFJLEdBQUdiLGFBQ1osQ0FBQyxjQUFjLEVBQUVBLFdBQVcsOEJBQThCLENBQUMsR0FDM0Q7UUFDTjtRQUVBLE9BQU9oQyxxREFBWUEsQ0FBQ1ksSUFBSSxDQUFDK0I7SUFFM0IsRUFBRSxPQUFPM0IsT0FBTztRQUNkdUIsUUFBUXZCLEtBQUssQ0FBQyxxQkFBcUJBO1FBQ25DLE9BQU9oQixxREFBWUEsQ0FBQ1ksSUFBSSxDQUN0QjtZQUFFRyxTQUFTO1lBQU9DLE9BQU87UUFBOEIsR0FDdkQ7WUFBRUMsUUFBUTtRQUFJO0lBRWxCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zYWFzLWNvcmUvLi9zcmMvYXBwL2FwaS9hdXRoL21hZ2ljLWxpbmsvcm91dGUudHM/MWQ1NSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgeyBjcmVhdGVNYWdpY0xpbmsgfSBmcm9tICdAL2xpYi9hdXRoJ1xuaW1wb3J0IHsgcmVzZW5kLCBFTUFJTF9GUk9NIH0gZnJvbSAnQC9saWIvcmVzZW5kJ1xuaW1wb3J0IHsgcmVzb2x2ZVRlbmFudEJ5U2x1ZyB9IGZyb20gJ0AvbGliL3RlbmFudC1yZXNvbHZlcidcblxuLy8gSW4gZGV2ZWxvcG1lbnQvdGVzdGluZywgd2UgY2FuIHNob3cgdGhlIG1hZ2ljIGxpbmsgaW4gdGhlIHJlc3BvbnNlXG5jb25zdCBERVZfTU9ERSA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnIHx8IHByb2Nlc3MuZW52LkRFVl9NQUdJQ19MSU5LID09PSAndHJ1ZSdcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKClcbiAgICBjb25zdCB7IGVtYWlsLCB0ZW5hbnRTbHVnIH0gPSBib2R5XG4gICAgXG4gICAgaWYgKCFlbWFpbCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0VtYWlsIGlzIHJlcXVpcmVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgIClcbiAgICB9XG4gICAgXG4gICAgLy8gVmFsaWRhdGUgZW1haWwgZm9ybWF0XG4gICAgY29uc3QgZW1haWxSZWdleCA9IC9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvXG4gICAgaWYgKCFlbWFpbFJlZ2V4LnRlc3QoZW1haWwpKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBlbWFpbCBmb3JtYXQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cbiAgICBcbiAgICAvLyBSZXNvbHZlIHRlbmFudCBpZiBzbHVnIHByb3ZpZGVkXG4gICAgbGV0IHRlbmFudElkOiBzdHJpbmcgfCB1bmRlZmluZWRcbiAgICBsZXQgdGVuYW50TmFtZSA9ICdTYWFTIENvcmUnXG4gICAgXG4gICAgaWYgKHRlbmFudFNsdWcpIHtcbiAgICAgIGNvbnN0IHRlbmFudCA9IGF3YWl0IHJlc29sdmVUZW5hbnRCeVNsdWcodGVuYW50U2x1ZylcbiAgICAgIGlmICh0ZW5hbnQpIHtcbiAgICAgICAgdGVuYW50SWQgPSB0ZW5hbnQuaWRcbiAgICAgICAgdGVuYW50TmFtZSA9IHRlbmFudC5hcHBOYW1lIHx8IHRlbmFudC5uYW1lXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIENyZWF0ZSBtYWdpYyBsaW5rXG4gICAgY29uc3QgeyB0b2tlbiwgdXNlciB9ID0gYXdhaXQgY3JlYXRlTWFnaWNMaW5rKGVtYWlsLCB0ZW5hbnRJZClcbiAgICBcbiAgICAvLyBCdWlsZCB2ZXJpZmljYXRpb24gVVJMXG4gICAgY29uc3QgYXBwVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQVBQX1VSTCB8fCAnaHR0cDovL2xvY2FsaG9zdDozMDAwJ1xuICAgIGNvbnN0IHZlcmlmeVVybCA9IGAke2FwcFVybH0vYXBpL2F1dGgvdmVyaWZ5P3Rva2VuPSR7dG9rZW59YFxuICAgIFxuICAgIC8vIFRyeSB0byBzZW5kIGVtYWlsIHZpYSBSZXNlbmRcbiAgICBsZXQgZW1haWxTZW50ID0gZmFsc2VcbiAgICBsZXQgZW1haWxFcnJvcjogc3RyaW5nIHwgbnVsbCA9IG51bGxcbiAgICBcbiAgICBpZiAocmVzZW5kKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCByZXNlbmQuZW1haWxzLnNlbmQoe1xuICAgICAgICAgIGZyb206IEVNQUlMX0ZST00sXG4gICAgICAgICAgdG86IGVtYWlsLFxuICAgICAgICAgIHN1YmplY3Q6IGBTaWduIGluIHRvICR7dGVuYW50TmFtZX1gLFxuICAgICAgICAgIGh0bWw6IGBcbiAgICAgICAgICAgIDwhRE9DVFlQRSBodG1sPlxuICAgICAgICAgICAgPGh0bWw+XG4gICAgICAgICAgICA8aGVhZD5cbiAgICAgICAgICAgICAgPG1ldGEgY2hhcnNldD1cInV0Zi04XCI+XG4gICAgICAgICAgICAgIDxtZXRhIG5hbWU9XCJ2aWV3cG9ydFwiIGNvbnRlbnQ9XCJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wXCI+XG4gICAgICAgICAgICA8L2hlYWQ+XG4gICAgICAgICAgICA8Ym9keSBzdHlsZT1cImZvbnQtZmFtaWx5OiAtYXBwbGUtc3lzdGVtLCBCbGlua01hY1N5c3RlbUZvbnQsICdTZWdvZSBVSScsIFJvYm90bywgJ0hlbHZldGljYSBOZXVlJywgQXJpYWwsIHNhbnMtc2VyaWY7IGxpbmUtaGVpZ2h0OiAxLjY7IGNvbG9yOiAjMzMzOyBtYXgtd2lkdGg6IDYwMHB4OyBtYXJnaW46IDAgYXV0bzsgcGFkZGluZzogMjBweDtcIj5cbiAgICAgICAgICAgICAgPGRpdiBzdHlsZT1cImJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICM2MzY2ZjEgMCUsICM4YjVjZjYgMTAwJSk7IHBhZGRpbmc6IDMwcHg7IGJvcmRlci1yYWRpdXM6IDEycHggMTJweCAwIDA7IHRleHQtYWxpZ246IGNlbnRlcjtcIj5cbiAgICAgICAgICAgICAgICA8aDEgc3R5bGU9XCJjb2xvcjogd2hpdGU7IG1hcmdpbjogMDsgZm9udC1zaXplOiAyNHB4O1wiPiR7dGVuYW50TmFtZX08L2gxPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPGRpdiBzdHlsZT1cImJhY2tncm91bmQ6ICNmZmZmZmY7IHBhZGRpbmc6IDMwcHg7IGJvcmRlcjogMXB4IHNvbGlkICNlNWU3ZWI7IGJvcmRlci10b3A6IG5vbmU7IGJvcmRlci1yYWRpdXM6IDAgMCAxMnB4IDEycHg7XCI+XG4gICAgICAgICAgICAgICAgPGgyIHN0eWxlPVwiY29sb3I6ICMxZjI5Mzc7IG1hcmdpbi10b3A6IDA7XCI+U2lnbiBpbiB0byB5b3VyIGFjY291bnQ8L2gyPlxuICAgICAgICAgICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICM2YjcyODA7XCI+Q2xpY2sgdGhlIGJ1dHRvbiBiZWxvdyB0byBzZWN1cmVseSBzaWduIGluLiBUaGlzIGxpbmsgd2lsbCBleHBpcmUgaW4gMTUgbWludXRlcy48L3A+XG4gICAgICAgICAgICAgICAgPGRpdiBzdHlsZT1cInRleHQtYWxpZ246IGNlbnRlcjsgbWFyZ2luOiAzMHB4IDA7XCI+XG4gICAgICAgICAgICAgICAgICA8YSBocmVmPVwiJHt2ZXJpZnlVcmx9XCIgc3R5bGU9XCJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGJhY2tncm91bmQ6ICM2MzY2ZjE7IGNvbG9yOiB3aGl0ZTsgcGFkZGluZzogMTRweCAzMnB4OyBib3JkZXItcmFkaXVzOiA4cHg7IHRleHQtZGVjb3JhdGlvbjogbm9uZTsgZm9udC13ZWlnaHQ6IDYwMDtcIj5TaWduIEluPC9hPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICM5Y2EzYWY7IGZvbnQtc2l6ZTogMTRweDtcIj5JZiB5b3UgZGlkbid0IHJlcXVlc3QgdGhpcyBlbWFpbCwgeW91IGNhbiBzYWZlbHkgaWdub3JlIGl0LjwvcD5cbiAgICAgICAgICAgICAgICA8aHIgc3R5bGU9XCJib3JkZXI6IG5vbmU7IGJvcmRlci10b3A6IDFweCBzb2xpZCAjZTVlN2ViOyBtYXJnaW46IDIwcHggMDtcIj5cbiAgICAgICAgICAgICAgICA8cCBzdHlsZT1cImNvbG9yOiAjOWNhM2FmOyBmb250LXNpemU6IDEycHg7IG1hcmdpbjogMDtcIj5PciBjb3B5IGFuZCBwYXN0ZSB0aGlzIFVSTCBpbnRvIHlvdXIgYnJvd3Nlcjo8L3A+XG4gICAgICAgICAgICAgICAgPHAgc3R5bGU9XCJjb2xvcjogIzYzNjZmMTsgZm9udC1zaXplOiAxMnB4OyB3b3JkLWJyZWFrOiBicmVhay1hbGw7XCI+JHt2ZXJpZnlVcmx9PC9wPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvYm9keT5cbiAgICAgICAgICAgIDwvaHRtbD5cbiAgICAgICAgICBgXG4gICAgICAgIH0pXG4gICAgICAgIFxuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZXNlbmQgZXJyb3I6JywgZXJyb3IpXG4gICAgICAgICAgZW1haWxFcnJvciA9IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBzZW5kIGVtYWlsJ1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGVtYWlsU2VudCA9IHRydWVcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0VtYWlsIHNlbmQgZXJyb3I6JywgZSlcbiAgICAgICAgZW1haWxFcnJvciA9IGUubWVzc2FnZSB8fCAnRmFpbGVkIHRvIHNlbmQgZW1haWwnXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIExvZyB0aGUgbWFnaWMgbGluayBmb3IgZGV2ZWxvcG1lbnRcbiAgICBjb25zb2xlLmxvZygnXFxuPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nKVxuICAgIGNvbnNvbGUubG9nKCdNQUdJQyBMSU5LIGZvcicsIGVtYWlsLCAnOicpXG4gICAgY29uc29sZS5sb2codmVyaWZ5VXJsKVxuICAgIGNvbnNvbGUubG9nKCc9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxcbicpXG4gICAgXG4gICAgLy8gUmVzcG9uc2UgZGVwZW5kcyBvbiB3aGV0aGVyIGVtYWlsIHdhcyBzZW50XG4gICAgY29uc3QgcmVzcG9uc2U6IGFueSA9IHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiBlbWFpbFNlbnQgXG4gICAgICAgID8gJ01hZ2ljIGxpbmsgc2VudCEgQ2hlY2sgeW91ciBlbWFpbC4nIFxuICAgICAgICA6ICdNYWdpYyBsaW5rIGNyZWF0ZWQhIENoZWNrIHRoZSBjb25zb2xlIG9yIHVzZSB0aGUgbGluayBiZWxvdy4nLFxuICAgICAgZW1haWxTZW50XG4gICAgfVxuICAgIFxuICAgIC8vIEluIGRldiBtb2RlIG9yIGlmIGVtYWlsIGZhaWxlZCwgaW5jbHVkZSB0aGUgbWFnaWMgbGluayBpbiByZXNwb25zZVxuICAgIC8vIFRoaXMgbWFrZXMgdGVzdGluZyBtdWNoIGVhc2llclxuICAgIGlmICghZW1haWxTZW50IHx8IERFVl9NT0RFKSB7XG4gICAgICByZXNwb25zZS5tYWdpY0xpbmsgPSB2ZXJpZnlVcmxcbiAgICAgIHJlc3BvbnNlLm5vdGUgPSBlbWFpbEVycm9yIFxuICAgICAgICA/IGBFbWFpbCBmYWlsZWQ6ICR7ZW1haWxFcnJvcn0uIFVzZSB0aGUgbWFnaWMgbGluayBkaXJlY3RseS5gXG4gICAgICAgIDogJ0ZvciB0ZXN0aW5nLCB5b3UgY2FuIHVzZSB0aGlzIGxpbmsgZGlyZWN0bHkuJ1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24ocmVzcG9uc2UpXG4gICAgXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignTWFnaWMgbGluayBlcnJvcjonLCBlcnJvcilcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZhaWxlZCB0byBjcmVhdGUgbWFnaWMgbGluaycgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgIClcbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImNyZWF0ZU1hZ2ljTGluayIsInJlc2VuZCIsIkVNQUlMX0ZST00iLCJyZXNvbHZlVGVuYW50QnlTbHVnIiwiREVWX01PREUiLCJwcm9jZXNzIiwiZW52IiwiREVWX01BR0lDX0xJTksiLCJQT1NUIiwicmVxdWVzdCIsImJvZHkiLCJqc29uIiwiZW1haWwiLCJ0ZW5hbnRTbHVnIiwic3VjY2VzcyIsImVycm9yIiwic3RhdHVzIiwiZW1haWxSZWdleCIsInRlc3QiLCJ0ZW5hbnRJZCIsInRlbmFudE5hbWUiLCJ0ZW5hbnQiLCJpZCIsImFwcE5hbWUiLCJuYW1lIiwidG9rZW4iLCJ1c2VyIiwiYXBwVXJsIiwiTkVYVF9QVUJMSUNfQVBQX1VSTCIsInZlcmlmeVVybCIsImVtYWlsU2VudCIsImVtYWlsRXJyb3IiLCJlbWFpbHMiLCJzZW5kIiwiZnJvbSIsInRvIiwic3ViamVjdCIsImh0bWwiLCJjb25zb2xlIiwibWVzc2FnZSIsImUiLCJsb2ciLCJyZXNwb25zZSIsIm1hZ2ljTGluayIsIm5vdGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/auth/magic-link/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createMagicLink: () => (/* binding */ createMagicLink),\n/* harmony export */   generateToken: () => (/* binding */ generateToken),\n/* harmony export */   getCurrentSession: () => (/* binding */ getCurrentSession),\n/* harmony export */   getSessionByToken: () => (/* binding */ getSessionByToken),\n/* harmony export */   isSuperAdmin: () => (/* binding */ isSuperAdmin),\n/* harmony export */   isTenantAdmin: () => (/* binding */ isTenantAdmin),\n/* harmony export */   logout: () => (/* binding */ logout),\n/* harmony export */   setSessionCookie: () => (/* binding */ setSessionCookie),\n/* harmony export */   switchTenant: () => (/* binding */ switchTenant),\n/* harmony export */   verifyMagicLink: () => (/* binding */ verifyMagicLink)\n/* harmony export */ });\n/* harmony import */ var _prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./prisma */ \"(rsc)/./src/lib/prisma.ts\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! uuid */ \"(rsc)/./node_modules/uuid/dist-node/v4.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n\n\n\n// Token expiration times\nconst MAGIC_LINK_EXPIRY_MINUTES = 15;\nconst SESSION_EXPIRY_DAYS = 7;\n/**\n * Generate a secure random token\n */ function generateToken() {\n    return (0,uuid__WEBPACK_IMPORTED_MODULE_2__[\"default\"])() + \"-\" + (0,uuid__WEBPACK_IMPORTED_MODULE_2__[\"default\"])();\n}\n/**\n * Create a magic link for a user\n * If user doesn't exist, creates them\n */ async function createMagicLink(email, tenantId) {\n    const normalizedEmail = email.toLowerCase().trim();\n    // Find or create user\n    let user = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.user.findUnique({\n        where: {\n            email: normalizedEmail\n        }\n    });\n    if (!user) {\n        user = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.user.create({\n            data: {\n                id: (0,uuid__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(),\n                email: normalizedEmail,\n                globalRole: \"USER\"\n            }\n        });\n    }\n    // Generate token\n    const token = generateToken();\n    const expiresAt = new Date();\n    expiresAt.setMinutes(expiresAt.getMinutes() + MAGIC_LINK_EXPIRY_MINUTES);\n    // Create magic link record\n    await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.magicLink.create({\n        data: {\n            id: (0,uuid__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(),\n            token,\n            userId: user.id,\n            tenantId: tenantId || null,\n            expiresAt\n        }\n    });\n    return {\n        token,\n        user\n    };\n}\n/**\n * Verify and consume a magic link\n * Returns user and creates session if valid\n */ async function verifyMagicLink(token) {\n    // Find the magic link\n    const magicLink = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.magicLink.findUnique({\n        where: {\n            token\n        },\n        include: {\n            user: true\n        }\n    });\n    if (!magicLink) {\n        return null;\n    }\n    // Check if expired\n    if (magicLink.expiresAt < new Date()) {\n        // Delete expired token\n        await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.magicLink.delete({\n            where: {\n                id: magicLink.id\n            }\n        });\n        return null;\n    }\n    // Check if already used\n    if (magicLink.usedAt) {\n        return null;\n    }\n    // Mark as used\n    await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.magicLink.update({\n        where: {\n            id: magicLink.id\n        },\n        data: {\n            usedAt: new Date()\n        }\n    });\n    // Update user's last login\n    await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.user.update({\n        where: {\n            id: magicLink.userId\n        },\n        data: {\n            lastLoginAt: new Date()\n        }\n    });\n    // Create session\n    const sessionToken = generateToken();\n    const sessionExpiresAt = new Date();\n    sessionExpiresAt.setDate(sessionExpiresAt.getDate() + SESSION_EXPIRY_DAYS);\n    const session = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.session.create({\n        data: {\n            id: (0,uuid__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(),\n            userId: magicLink.userId,\n            token: sessionToken,\n            activeTenant: magicLink.tenantId,\n            expiresAt: sessionExpiresAt\n        }\n    });\n    // Get user with memberships\n    const user = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.user.findUnique({\n        where: {\n            id: magicLink.userId\n        },\n        include: {\n            memberships: {\n                where: {\n                    isActive: true\n                },\n                include: {\n                    tenant: true\n                }\n            }\n        }\n    });\n    return {\n        user: user,\n        session: {\n            id: session.id,\n            token: sessionToken\n        },\n        tenantId: magicLink.tenantId\n    };\n}\n/**\n * Get session from token\n */ async function getSessionByToken(token) {\n    const session = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.session.findUnique({\n        where: {\n            token\n        },\n        include: {\n            user: {\n                include: {\n                    memberships: {\n                        where: {\n                            isActive: true\n                        },\n                        include: {\n                            tenant: true\n                        }\n                    }\n                }\n            }\n        }\n    });\n    if (!session) {\n        return null;\n    }\n    // Check if expired\n    if (session.expiresAt < new Date()) {\n        await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.session.delete({\n            where: {\n                id: session.id\n            }\n        });\n        return null;\n    }\n    // Update last active\n    await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.session.update({\n        where: {\n            id: session.id\n        },\n        data: {\n            lastActiveAt: new Date()\n        }\n    });\n    return {\n        user: session.user,\n        sessionId: session.id,\n        activeTenantId: session.activeTenant\n    };\n}\n/**\n * Get current session from cookies\n */ async function getCurrentSession() {\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n    const sessionToken = cookieStore.get(\"session_token\")?.value;\n    if (!sessionToken) {\n        return null;\n    }\n    return getSessionByToken(sessionToken);\n}\n/**\n * Set session cookie\n */ async function setSessionCookie(token) {\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n    cookieStore.set(\"session_token\", token, {\n        httpOnly: true,\n        secure: \"development\" === \"production\",\n        sameSite: \"lax\",\n        maxAge: SESSION_EXPIRY_DAYS * 24 * 60 * 60,\n        path: \"/\"\n    });\n}\n/**\n * Clear session cookie and delete session\n */ async function logout() {\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n    const sessionToken = cookieStore.get(\"session_token\")?.value;\n    if (sessionToken) {\n        // Delete session from database\n        await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.session.deleteMany({\n            where: {\n                token: sessionToken\n            }\n        });\n    }\n    // Clear cookie\n    cookieStore.delete(\"session_token\");\n}\n/**\n * Switch active tenant for a session\n */ async function switchTenant(sessionToken, tenantId) {\n    const session = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.session.findUnique({\n        where: {\n            token: sessionToken\n        },\n        include: {\n            user: {\n                include: {\n                    memberships: true\n                }\n            }\n        }\n    });\n    if (!session) return false;\n    // Check if user has access to this tenant\n    const hasMembership = session.user.memberships.some((m)=>m.tenantId === tenantId && m.isActive);\n    // Super admins can access any tenant\n    const isSuperAdmin = session.user.globalRole === \"SUPER_ADMIN\";\n    if (!hasMembership && !isSuperAdmin) {\n        return false;\n    }\n    await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.session.update({\n        where: {\n            id: session.id\n        },\n        data: {\n            activeTenant: tenantId\n        }\n    });\n    return true;\n}\n/**\n * Check if user is Super Admin\n */ function isSuperAdmin(user) {\n    return user.globalRole === \"SUPER_ADMIN\";\n}\n/**\n * Check if user is Tenant Admin for a specific tenant\n */ async function isTenantAdmin(userId, tenantId) {\n    const membership = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.tenantMembership.findUnique({\n        where: {\n            userId_tenantId: {\n                userId,\n                tenantId\n            }\n        }\n    });\n    return membership?.role === \"TENANT_ADMIN\" && membership.isActive;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YTtRQUFhO1FBQzdCTCxTQUFTO1lBQUVmLE1BQU07Z0JBQUVlLFNBQVM7b0JBQUVXLGFBQWE7Z0JBQUs7WUFBRTtRQUFFO0lBQ3REO0lBRUEsSUFBSSxDQUFDRixTQUFTLE9BQU87SUFFckIsMENBQTBDO0lBQzFDLE1BQU13QixnQkFBZ0J4QixRQUFReEIsSUFBSSxDQUFDMEIsV0FBVyxDQUFDdUIsSUFBSSxDQUNqREMsQ0FBQUEsSUFBS0EsRUFBRXRELFFBQVEsS0FBS0EsWUFBWXNELEVBQUV2QixRQUFRO0lBRzVDLHFDQUFxQztJQUNyQyxNQUFNd0IsZUFBZTNCLFFBQVF4QixJQUFJLENBQUNNLFVBQVUsS0FBSztJQUVqRCxJQUFJLENBQUMwQyxpQkFBaUIsQ0FBQ0csY0FBYztRQUNuQyxPQUFPO0lBQ1Q7SUFFQSxNQUFNaEUsMkNBQU1BLENBQUNxQyxPQUFPLENBQUNOLE1BQU0sQ0FBQztRQUMxQmhCLE9BQU87WUFBRUcsSUFBSW1CLFFBQVFuQixFQUFFO1FBQUM7UUFDeEJELE1BQU07WUFBRXFCLGNBQWM3QjtRQUFTO0lBQ2pDO0lBRUEsT0FBTztBQUNUO0FBRUE7O0NBRUMsR0FDTSxTQUFTdUQsYUFBYW5ELElBQVU7SUFDckMsT0FBT0EsS0FBS00sVUFBVSxLQUFLO0FBQzdCO0FBRUE7O0NBRUMsR0FDTSxlQUFlOEMsY0FBY3ZDLE1BQWMsRUFBRWpCLFFBQWdCO0lBQ2xFLE1BQU15RCxhQUFhLE1BQU1sRSwyQ0FBTUEsQ0FBQ21FLGdCQUFnQixDQUFDckQsVUFBVSxDQUFDO1FBQzFEQyxPQUFPO1lBQ0xxRCxpQkFBaUI7Z0JBQUUxQztnQkFBUWpCO1lBQVM7UUFDdEM7SUFDRjtJQUVBLE9BQU95RCxZQUFZRyxTQUFTLGtCQUFrQkgsV0FBVzFCLFFBQVE7QUFDbkUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zYWFzLWNvcmUvLi9zcmMvbGliL2F1dGgudHM/NjY5MiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuL3ByaXNtYSdcbmltcG9ydCB7IHY0IGFzIHV1aWR2NCB9IGZyb20gJ3V1aWQnXG5pbXBvcnQgeyBjb29raWVzIH0gZnJvbSAnbmV4dC9oZWFkZXJzJ1xuaW1wb3J0IHsgVXNlciwgR2xvYmFsUm9sZSwgVGVuYW50Um9sZSwgVGVuYW50LCBUZW5hbnRNZW1iZXJzaGlwIH0gZnJvbSAnQHByaXNtYS9jbGllbnQnXG5cbi8vIFRva2VuIGV4cGlyYXRpb24gdGltZXNcbmNvbnN0IE1BR0lDX0xJTktfRVhQSVJZX01JTlVURVMgPSAxNVxuY29uc3QgU0VTU0lPTl9FWFBJUllfREFZUyA9IDdcblxuLy8gVHlwZXNcbmV4cG9ydCB0eXBlIFNlc3Npb25Vc2VyID0gVXNlciAmIHtcbiAgbWVtYmVyc2hpcHM6IChUZW5hbnRNZW1iZXJzaGlwICYge1xuICAgIHRlbmFudDogVGVuYW50XG4gIH0pW11cbn1cblxuZXhwb3J0IHR5cGUgQXV0aFNlc3Npb24gPSB7XG4gIHVzZXI6IFNlc3Npb25Vc2VyXG4gIHNlc3Npb25JZDogc3RyaW5nXG4gIGFjdGl2ZVRlbmFudElkOiBzdHJpbmcgfCBudWxsXG59XG5cbi8qKlxuICogR2VuZXJhdGUgYSBzZWN1cmUgcmFuZG9tIHRva2VuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVRva2VuKCk6IHN0cmluZyB7XG4gIHJldHVybiB1dWlkdjQoKSArICctJyArIHV1aWR2NCgpXG59XG5cbi8qKlxuICogQ3JlYXRlIGEgbWFnaWMgbGluayBmb3IgYSB1c2VyXG4gKiBJZiB1c2VyIGRvZXNuJ3QgZXhpc3QsIGNyZWF0ZXMgdGhlbVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlTWFnaWNMaW5rKGVtYWlsOiBzdHJpbmcsIHRlbmFudElkPzogc3RyaW5nKTogUHJvbWlzZTx7IHRva2VuOiBzdHJpbmc7IHVzZXI6IFVzZXIgfT4ge1xuICBjb25zdCBub3JtYWxpemVkRW1haWwgPSBlbWFpbC50b0xvd2VyQ2FzZSgpLnRyaW0oKVxuICBcbiAgLy8gRmluZCBvciBjcmVhdGUgdXNlclxuICBsZXQgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7IGVtYWlsOiBub3JtYWxpemVkRW1haWwgfVxuICB9KVxuICBcbiAgaWYgKCF1c2VyKSB7XG4gICAgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIGlkOiB1dWlkdjQoKSxcbiAgICAgICAgZW1haWw6IG5vcm1hbGl6ZWRFbWFpbCxcbiAgICAgICAgZ2xvYmFsUm9sZTogJ1VTRVInXG4gICAgICB9XG4gICAgfSlcbiAgfVxuICBcbiAgLy8gR2VuZXJhdGUgdG9rZW5cbiAgY29uc3QgdG9rZW4gPSBnZW5lcmF0ZVRva2VuKClcbiAgY29uc3QgZXhwaXJlc0F0ID0gbmV3IERhdGUoKVxuICBleHBpcmVzQXQuc2V0TWludXRlcyhleHBpcmVzQXQuZ2V0TWludXRlcygpICsgTUFHSUNfTElOS19FWFBJUllfTUlOVVRFUylcbiAgXG4gIC8vIENyZWF0ZSBtYWdpYyBsaW5rIHJlY29yZFxuICBhd2FpdCBwcmlzbWEubWFnaWNMaW5rLmNyZWF0ZSh7XG4gICAgZGF0YToge1xuICAgICAgaWQ6IHV1aWR2NCgpLFxuICAgICAgdG9rZW4sXG4gICAgICB1c2VySWQ6IHVzZXIuaWQsXG4gICAgICB0ZW5hbnRJZDogdGVuYW50SWQgfHwgbnVsbCxcbiAgICAgIGV4cGlyZXNBdFxuICAgIH1cbiAgfSlcbiAgXG4gIHJldHVybiB7IHRva2VuLCB1c2VyIH1cbn1cblxuLyoqXG4gKiBWZXJpZnkgYW5kIGNvbnN1bWUgYSBtYWdpYyBsaW5rXG4gKiBSZXR1cm5zIHVzZXIgYW5kIGNyZWF0ZXMgc2Vzc2lvbiBpZiB2YWxpZFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdmVyaWZ5TWFnaWNMaW5rKHRva2VuOiBzdHJpbmcpOiBQcm9taXNlPHsgdXNlcjogU2Vzc2lvblVzZXI7IHNlc3Npb246IHsgaWQ6IHN0cmluZzsgdG9rZW46IHN0cmluZyB9OyB0ZW5hbnRJZDogc3RyaW5nIHwgbnVsbCB9IHwgbnVsbD4ge1xuICAvLyBGaW5kIHRoZSBtYWdpYyBsaW5rXG4gIGNvbnN0IG1hZ2ljTGluayA9IGF3YWl0IHByaXNtYS5tYWdpY0xpbmsuZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHsgdG9rZW4gfSxcbiAgICBpbmNsdWRlOiB7IHVzZXI6IHRydWUgfVxuICB9KVxuICBcbiAgaWYgKCFtYWdpY0xpbmspIHtcbiAgICByZXR1cm4gbnVsbFxuICB9XG4gIFxuICAvLyBDaGVjayBpZiBleHBpcmVkXG4gIGlmIChtYWdpY0xpbmsuZXhwaXJlc0F0IDwgbmV3IERhdGUoKSkge1xuICAgIC8vIERlbGV0ZSBleHBpcmVkIHRva2VuXG4gICAgYXdhaXQgcHJpc21hLm1hZ2ljTGluay5kZWxldGUoeyB3aGVyZTogeyBpZDogbWFnaWNMaW5rLmlkIH0gfSlcbiAgICByZXR1cm4gbnVsbFxuICB9XG4gIFxuICAvLyBDaGVjayBpZiBhbHJlYWR5IHVzZWRcbiAgaWYgKG1hZ2ljTGluay51c2VkQXQpIHtcbiAgICByZXR1cm4gbnVsbFxuICB9XG4gIFxuICAvLyBNYXJrIGFzIHVzZWRcbiAgYXdhaXQgcHJpc21hLm1hZ2ljTGluay51cGRhdGUoe1xuICAgIHdoZXJlOiB7IGlkOiBtYWdpY0xpbmsuaWQgfSxcbiAgICBkYXRhOiB7IHVzZWRBdDogbmV3IERhdGUoKSB9XG4gIH0pXG4gIFxuICAvLyBVcGRhdGUgdXNlcidzIGxhc3QgbG9naW5cbiAgYXdhaXQgcHJpc21hLnVzZXIudXBkYXRlKHtcbiAgICB3aGVyZTogeyBpZDogbWFnaWNMaW5rLnVzZXJJZCB9LFxuICAgIGRhdGE6IHsgbGFzdExvZ2luQXQ6IG5ldyBEYXRlKCkgfVxuICB9KVxuICBcbiAgLy8gQ3JlYXRlIHNlc3Npb25cbiAgY29uc3Qgc2Vzc2lvblRva2VuID0gZ2VuZXJhdGVUb2tlbigpXG4gIGNvbnN0IHNlc3Npb25FeHBpcmVzQXQgPSBuZXcgRGF0ZSgpXG4gIHNlc3Npb25FeHBpcmVzQXQuc2V0RGF0ZShzZXNzaW9uRXhwaXJlc0F0LmdldERhdGUoKSArIFNFU1NJT05fRVhQSVJZX0RBWVMpXG4gIFxuICBjb25zdCBzZXNzaW9uID0gYXdhaXQgcHJpc21hLnNlc3Npb24uY3JlYXRlKHtcbiAgICBkYXRhOiB7XG4gICAgICBpZDogdXVpZHY0KCksXG4gICAgICB1c2VySWQ6IG1hZ2ljTGluay51c2VySWQsXG4gICAgICB0b2tlbjogc2Vzc2lvblRva2VuLFxuICAgICAgYWN0aXZlVGVuYW50OiBtYWdpY0xpbmsudGVuYW50SWQsXG4gICAgICBleHBpcmVzQXQ6IHNlc3Npb25FeHBpcmVzQXRcbiAgICB9XG4gIH0pXG4gIFxuICAvLyBHZXQgdXNlciB3aXRoIG1lbWJlcnNoaXBzXG4gIGNvbnN0IHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kVW5pcXVlKHtcbiAgICB3aGVyZTogeyBpZDogbWFnaWNMaW5rLnVzZXJJZCB9LFxuICAgIGluY2x1ZGU6IHtcbiAgICAgIG1lbWJlcnNoaXBzOiB7XG4gICAgICAgIHdoZXJlOiB7IGlzQWN0aXZlOiB0cnVlIH0sXG4gICAgICAgIGluY2x1ZGU6IHsgdGVuYW50OiB0cnVlIH1cbiAgICAgIH1cbiAgICB9XG4gIH0pXG4gIFxuICByZXR1cm4ge1xuICAgIHVzZXI6IHVzZXIgYXMgU2Vzc2lvblVzZXIsXG4gICAgc2Vzc2lvbjogeyBpZDogc2Vzc2lvbi5pZCwgdG9rZW46IHNlc3Npb25Ub2tlbiB9LFxuICAgIHRlbmFudElkOiBtYWdpY0xpbmsudGVuYW50SWRcbiAgfVxufVxuXG4vKipcbiAqIEdldCBzZXNzaW9uIGZyb20gdG9rZW5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFNlc3Npb25CeVRva2VuKHRva2VuOiBzdHJpbmcpOiBQcm9taXNlPEF1dGhTZXNzaW9uIHwgbnVsbD4ge1xuICBjb25zdCBzZXNzaW9uID0gYXdhaXQgcHJpc21hLnNlc3Npb24uZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHsgdG9rZW4gfSxcbiAgICBpbmNsdWRlOiB7XG4gICAgICB1c2VyOiB7XG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBtZW1iZXJzaGlwczoge1xuICAgICAgICAgICAgd2hlcmU6IHsgaXNBY3RpdmU6IHRydWUgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHsgdGVuYW50OiB0cnVlIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0pXG4gIFxuICBpZiAoIXNlc3Npb24pIHtcbiAgICByZXR1cm4gbnVsbFxuICB9XG4gIFxuICAvLyBDaGVjayBpZiBleHBpcmVkXG4gIGlmIChzZXNzaW9uLmV4cGlyZXNBdCA8IG5ldyBEYXRlKCkpIHtcbiAgICBhd2FpdCBwcmlzbWEuc2Vzc2lvbi5kZWxldGUoeyB3aGVyZTogeyBpZDogc2Vzc2lvbi5pZCB9IH0pXG4gICAgcmV0dXJuIG51bGxcbiAgfVxuICBcbiAgLy8gVXBkYXRlIGxhc3QgYWN0aXZlXG4gIGF3YWl0IHByaXNtYS5zZXNzaW9uLnVwZGF0ZSh7XG4gICAgd2hlcmU6IHsgaWQ6IHNlc3Npb24uaWQgfSxcbiAgICBkYXRhOiB7IGxhc3RBY3RpdmVBdDogbmV3IERhdGUoKSB9XG4gIH0pXG4gIFxuICByZXR1cm4ge1xuICAgIHVzZXI6IHNlc3Npb24udXNlciBhcyBTZXNzaW9uVXNlcixcbiAgICBzZXNzaW9uSWQ6IHNlc3Npb24uaWQsXG4gICAgYWN0aXZlVGVuYW50SWQ6IHNlc3Npb24uYWN0aXZlVGVuYW50XG4gIH1cbn1cblxuLyoqXG4gKiBHZXQgY3VycmVudCBzZXNzaW9uIGZyb20gY29va2llc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q3VycmVudFNlc3Npb24oKTogUHJvbWlzZTxBdXRoU2Vzc2lvbiB8IG51bGw+IHtcbiAgY29uc3QgY29va2llU3RvcmUgPSBhd2FpdCBjb29raWVzKClcbiAgY29uc3Qgc2Vzc2lvblRva2VuID0gY29va2llU3RvcmUuZ2V0KCdzZXNzaW9uX3Rva2VuJyk/LnZhbHVlXG4gIFxuICBpZiAoIXNlc3Npb25Ub2tlbikge1xuICAgIHJldHVybiBudWxsXG4gIH1cbiAgXG4gIHJldHVybiBnZXRTZXNzaW9uQnlUb2tlbihzZXNzaW9uVG9rZW4pXG59XG5cbi8qKlxuICogU2V0IHNlc3Npb24gY29va2llXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRTZXNzaW9uQ29va2llKHRva2VuOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3QgY29va2llU3RvcmUgPSBhd2FpdCBjb29raWVzKClcbiAgY29va2llU3RvcmUuc2V0KCdzZXNzaW9uX3Rva2VuJywgdG9rZW4sIHtcbiAgICBodHRwT25seTogdHJ1ZSxcbiAgICBzZWN1cmU6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicsXG4gICAgc2FtZVNpdGU6ICdsYXgnLFxuICAgIG1heEFnZTogU0VTU0lPTl9FWFBJUllfREFZUyAqIDI0ICogNjAgKiA2MCwgLy8gZGF5cyB0byBzZWNvbmRzXG4gICAgcGF0aDogJy8nXG4gIH0pXG59XG5cbi8qKlxuICogQ2xlYXIgc2Vzc2lvbiBjb29raWUgYW5kIGRlbGV0ZSBzZXNzaW9uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dvdXQoKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IGNvb2tpZVN0b3JlID0gYXdhaXQgY29va2llcygpXG4gIGNvbnN0IHNlc3Npb25Ub2tlbiA9IGNvb2tpZVN0b3JlLmdldCgnc2Vzc2lvbl90b2tlbicpPy52YWx1ZVxuICBcbiAgaWYgKHNlc3Npb25Ub2tlbikge1xuICAgIC8vIERlbGV0ZSBzZXNzaW9uIGZyb20gZGF0YWJhc2VcbiAgICBhd2FpdCBwcmlzbWEuc2Vzc2lvbi5kZWxldGVNYW55KHtcbiAgICAgIHdoZXJlOiB7IHRva2VuOiBzZXNzaW9uVG9rZW4gfVxuICAgIH0pXG4gIH1cbiAgXG4gIC8vIENsZWFyIGNvb2tpZVxuICBjb29raWVTdG9yZS5kZWxldGUoJ3Nlc3Npb25fdG9rZW4nKVxufVxuXG4vKipcbiAqIFN3aXRjaCBhY3RpdmUgdGVuYW50IGZvciBhIHNlc3Npb25cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN3aXRjaFRlbmFudChzZXNzaW9uVG9rZW46IHN0cmluZywgdGVuYW50SWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICBjb25zdCBzZXNzaW9uID0gYXdhaXQgcHJpc21hLnNlc3Npb24uZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHsgdG9rZW46IHNlc3Npb25Ub2tlbiB9LFxuICAgIGluY2x1ZGU6IHsgdXNlcjogeyBpbmNsdWRlOiB7IG1lbWJlcnNoaXBzOiB0cnVlIH0gfSB9XG4gIH0pXG4gIFxuICBpZiAoIXNlc3Npb24pIHJldHVybiBmYWxzZVxuICBcbiAgLy8gQ2hlY2sgaWYgdXNlciBoYXMgYWNjZXNzIHRvIHRoaXMgdGVuYW50XG4gIGNvbnN0IGhhc01lbWJlcnNoaXAgPSBzZXNzaW9uLnVzZXIubWVtYmVyc2hpcHMuc29tZShcbiAgICBtID0+IG0udGVuYW50SWQgPT09IHRlbmFudElkICYmIG0uaXNBY3RpdmVcbiAgKVxuICBcbiAgLy8gU3VwZXIgYWRtaW5zIGNhbiBhY2Nlc3MgYW55IHRlbmFudFxuICBjb25zdCBpc1N1cGVyQWRtaW4gPSBzZXNzaW9uLnVzZXIuZ2xvYmFsUm9sZSA9PT0gJ1NVUEVSX0FETUlOJ1xuICBcbiAgaWYgKCFoYXNNZW1iZXJzaGlwICYmICFpc1N1cGVyQWRtaW4pIHtcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuICBcbiAgYXdhaXQgcHJpc21hLnNlc3Npb24udXBkYXRlKHtcbiAgICB3aGVyZTogeyBpZDogc2Vzc2lvbi5pZCB9LFxuICAgIGRhdGE6IHsgYWN0aXZlVGVuYW50OiB0ZW5hbnRJZCB9XG4gIH0pXG4gIFxuICByZXR1cm4gdHJ1ZVxufVxuXG4vKipcbiAqIENoZWNrIGlmIHVzZXIgaXMgU3VwZXIgQWRtaW5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzU3VwZXJBZG1pbih1c2VyOiBVc2VyKTogYm9vbGVhbiB7XG4gIHJldHVybiB1c2VyLmdsb2JhbFJvbGUgPT09ICdTVVBFUl9BRE1JTidcbn1cblxuLyoqXG4gKiBDaGVjayBpZiB1c2VyIGlzIFRlbmFudCBBZG1pbiBmb3IgYSBzcGVjaWZpYyB0ZW5hbnRcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGlzVGVuYW50QWRtaW4odXNlcklkOiBzdHJpbmcsIHRlbmFudElkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgY29uc3QgbWVtYmVyc2hpcCA9IGF3YWl0IHByaXNtYS50ZW5hbnRNZW1iZXJzaGlwLmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7XG4gICAgICB1c2VySWRfdGVuYW50SWQ6IHsgdXNlcklkLCB0ZW5hbnRJZCB9XG4gICAgfVxuICB9KVxuICBcbiAgcmV0dXJuIG1lbWJlcnNoaXA/LnJvbGUgPT09ICdURU5BTlRfQURNSU4nICYmIG1lbWJlcnNoaXAuaXNBY3RpdmVcbn1cbiJdLCJuYW1lcyI6WyJwcmlzbWEiLCJ2NCIsInV1aWR2NCIsImNvb2tpZXMiLCJNQUdJQ19MSU5LX0VYUElSWV9NSU5VVEVTIiwiU0VTU0lPTl9FWFBJUllfREFZUyIsImdlbmVyYXRlVG9rZW4iLCJjcmVhdGVNYWdpY0xpbmsiLCJlbWFpbCIsInRlbmFudElkIiwibm9ybWFsaXplZEVtYWlsIiwidG9Mb3dlckNhc2UiLCJ0cmltIiwidXNlciIsImZpbmRVbmlxdWUiLCJ3aGVyZSIsImNyZWF0ZSIsImRhdGEiLCJpZCIsImdsb2JhbFJvbGUiLCJ0b2tlbiIsImV4cGlyZXNBdCIsIkRhdGUiLCJzZXRNaW51dGVzIiwiZ2V0TWludXRlcyIsIm1hZ2ljTGluayIsInVzZXJJZCIsInZlcmlmeU1hZ2ljTGluayIsImluY2x1ZGUiLCJkZWxldGUiLCJ1c2VkQXQiLCJ1cGRhdGUiLCJsYXN0TG9naW5BdCIsInNlc3Npb25Ub2tlbiIsInNlc3Npb25FeHBpcmVzQXQiLCJzZXREYXRlIiwiZ2V0RGF0ZSIsInNlc3Npb24iLCJhY3RpdmVUZW5hbnQiLCJtZW1iZXJzaGlwcyIsImlzQWN0aXZlIiwidGVuYW50IiwiZ2V0U2Vzc2lvbkJ5VG9rZW4iLCJsYXN0QWN0aXZlQXQiLCJzZXNzaW9uSWQiLCJhY3RpdmVUZW5hbnRJZCIsImdldEN1cnJlbnRTZXNzaW9uIiwiY29va2llU3RvcmUiLCJnZXQiLCJ2YWx1ZSIsInNldFNlc3Npb25Db29raWUiLCJzZXQiLCJodHRwT25seSIsInNlY3VyZSIsInByb2Nlc3MiLCJzYW1lU2l0ZSIsIm1heEFnZSIsInBhdGgiLCJsb2dvdXQiLCJkZWxldGVNYW55Iiwic3dpdGNoVGVuYW50IiwiaGFzTWVtYmVyc2hpcCIsInNvbWUiLCJtIiwiaXNTdXBlckFkbWluIiwiaXNUZW5hbnRBZG1pbiIsIm1lbWJlcnNoaXAiLCJ0ZW5hbnRNZW1iZXJzaGlwIiwidXNlcklkX3RlbmFudElkIiwicm9sZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/prisma.ts":
/*!***************************!*\
  !*** ./src/lib/prisma.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TenantIsolationError: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.TenantIsolationError),\n/* harmony export */   clearViolationLogs: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.clearViolationLogs),\n/* harmony export */   createTenantScopedClient: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.createTenantScopedClient),\n/* harmony export */   getCurrentTenantContext: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.getCurrentTenantContext),\n/* harmony export */   getViolationLogs: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.getViolationLogs),\n/* harmony export */   isTenantScopedModel: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.isTenantScopedModel),\n/* harmony export */   prisma: () => (/* binding */ prisma),\n/* harmony export */   withTenantContext: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.withTenantContext),\n/* harmony export */   withTenantContextAsync: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.withTenantContextAsync)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./tenant-isolation */ \"(rsc)/./src/lib/tenant-isolation.ts\");\n\n\nconst globalForPrisma = globalThis;\nfunction createPrismaClient() {\n    const client = new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient({\n        log:  true ? [\n            \"query\",\n            \"error\",\n            \"warn\"\n        ] : 0\n    });\n    // Add tenant isolation middleware\n    client.$use((0,_tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.createTenantIsolationMiddleware)());\n    return client;\n}\nconst prisma = globalForPrisma.prisma ?? createPrismaClient();\nif (true) globalForPrisma.prisma = prisma;\n// Re-export tenant isolation utilities\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3ByaXNtYS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBNkM7QUFDdUI7QUFFcEUsTUFBTUUsa0JBQWtCQztBQUl4QixTQUFTQztJQUNQLE1BQU1DLFNBQVMsSUFBSUwsd0RBQVlBLENBQUM7UUFDOUJNLEtBQUtDLEtBQXlCLEdBQWdCO1lBQUM7WUFBUztZQUFTO1NBQU8sR0FBRyxDQUFTO0lBQ3RGO0lBRUEsa0NBQWtDO0lBQ2xDRixPQUFPRyxJQUFJLENBQUNQLGtGQUErQkE7SUFFM0MsT0FBT0k7QUFDVDtBQUVPLE1BQU1JLFNBQVNQLGdCQUFnQk8sTUFBTSxJQUFJTCxxQkFBb0I7QUFFcEUsSUFBSUcsSUFBeUIsRUFBY0wsZ0JBQWdCTyxNQUFNLEdBQUdBO0FBRXBFLHVDQUF1QztBQVdaIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2Fhcy1jb3JlLy4vc3JjL2xpYi9wcmlzbWEudHM/MDFkNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tICdAcHJpc21hL2NsaWVudCdcbmltcG9ydCB7IGNyZWF0ZVRlbmFudElzb2xhdGlvbk1pZGRsZXdhcmUgfSBmcm9tICcuL3RlbmFudC1pc29sYXRpb24nXG5cbmNvbnN0IGdsb2JhbEZvclByaXNtYSA9IGdsb2JhbFRoaXMgYXMgdW5rbm93biBhcyB7XG4gIHByaXNtYTogUHJpc21hQ2xpZW50IHwgdW5kZWZpbmVkXG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVByaXNtYUNsaWVudCgpOiBQcmlzbWFDbGllbnQge1xuICBjb25zdCBjbGllbnQgPSBuZXcgUHJpc21hQ2xpZW50KHtcbiAgICBsb2c6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnID8gWydxdWVyeScsICdlcnJvcicsICd3YXJuJ10gOiBbJ2Vycm9yJ10sXG4gIH0pXG4gIFxuICAvLyBBZGQgdGVuYW50IGlzb2xhdGlvbiBtaWRkbGV3YXJlXG4gIGNsaWVudC4kdXNlKGNyZWF0ZVRlbmFudElzb2xhdGlvbk1pZGRsZXdhcmUoKSlcbiAgXG4gIHJldHVybiBjbGllbnRcbn1cblxuZXhwb3J0IGNvbnN0IHByaXNtYSA9IGdsb2JhbEZvclByaXNtYS5wcmlzbWEgPz8gY3JlYXRlUHJpc21hQ2xpZW50KClcblxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIGdsb2JhbEZvclByaXNtYS5wcmlzbWEgPSBwcmlzbWFcblxuLy8gUmUtZXhwb3J0IHRlbmFudCBpc29sYXRpb24gdXRpbGl0aWVzXG5leHBvcnQge1xuICB3aXRoVGVuYW50Q29udGV4dCxcbiAgd2l0aFRlbmFudENvbnRleHRBc3luYyxcbiAgZ2V0Q3VycmVudFRlbmFudENvbnRleHQsXG4gIFRlbmFudElzb2xhdGlvbkVycm9yLFxuICBpc1RlbmFudFNjb3BlZE1vZGVsLFxuICBnZXRWaW9sYXRpb25Mb2dzLFxuICBjbGVhclZpb2xhdGlvbkxvZ3MsXG4gIGNyZWF0ZVRlbmFudFNjb3BlZENsaWVudCxcbiAgdHlwZSBUZW5hbnRDb250ZXh0XG59IGZyb20gJy4vdGVuYW50LWlzb2xhdGlvbidcbiJdLCJuYW1lcyI6WyJQcmlzbWFDbGllbnQiLCJjcmVhdGVUZW5hbnRJc29sYXRpb25NaWRkbGV3YXJlIiwiZ2xvYmFsRm9yUHJpc21hIiwiZ2xvYmFsVGhpcyIsImNyZWF0ZVByaXNtYUNsaWVudCIsImNsaWVudCIsImxvZyIsInByb2Nlc3MiLCIkdXNlIiwicHJpc21hIiwid2l0aFRlbmFudENvbnRleHQiLCJ3aXRoVGVuYW50Q29udGV4dEFzeW5jIiwiZ2V0Q3VycmVudFRlbmFudENvbnRleHQiLCJUZW5hbnRJc29sYXRpb25FcnJvciIsImlzVGVuYW50U2NvcGVkTW9kZWwiLCJnZXRWaW9sYXRpb25Mb2dzIiwiY2xlYXJWaW9sYXRpb25Mb2dzIiwiY3JlYXRlVGVuYW50U2NvcGVkQ2xpZW50Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/prisma.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/resend.ts":
/*!***************************!*\
  !*** ./src/lib/resend.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EMAIL_FROM: () => (/* binding */ EMAIL_FROM),\n/* harmony export */   resend: () => (/* binding */ resend)\n/* harmony export */ });\n/* harmony import */ var resend__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! resend */ \"(rsc)/./node_modules/resend/dist/index.mjs\");\n\nconst resendApiKey = process.env.RESEND_API_KEY;\nif (!resendApiKey) {\n    console.warn(\"RESEND_API_KEY is not defined - emails will not be sent\");\n}\nconst resend = resendApiKey ? new resend__WEBPACK_IMPORTED_MODULE_0__.Resend(resendApiKey) : null;\nconst EMAIL_FROM = process.env.EMAIL_FROM || \"onboarding@resend.dev\";\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3Jlc2VuZC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBK0I7QUFFL0IsTUFBTUMsZUFBZUMsUUFBUUMsR0FBRyxDQUFDQyxjQUFjO0FBRS9DLElBQUksQ0FBQ0gsY0FBYztJQUNqQkksUUFBUUMsSUFBSSxDQUFDO0FBQ2Y7QUFFTyxNQUFNQyxTQUFTTixlQUFlLElBQUlELDBDQUFNQSxDQUFDQyxnQkFBZ0IsS0FBSTtBQUU3RCxNQUFNTyxhQUFhTixRQUFRQyxHQUFHLENBQUNLLFVBQVUsSUFBSSx3QkFBdUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zYWFzLWNvcmUvLi9zcmMvbGliL3Jlc2VuZC50cz9mYzkxIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlc2VuZCB9IGZyb20gJ3Jlc2VuZCdcblxuY29uc3QgcmVzZW5kQXBpS2V5ID0gcHJvY2Vzcy5lbnYuUkVTRU5EX0FQSV9LRVlcblxuaWYgKCFyZXNlbmRBcGlLZXkpIHtcbiAgY29uc29sZS53YXJuKCdSRVNFTkRfQVBJX0tFWSBpcyBub3QgZGVmaW5lZCAtIGVtYWlscyB3aWxsIG5vdCBiZSBzZW50Jylcbn1cblxuZXhwb3J0IGNvbnN0IHJlc2VuZCA9IHJlc2VuZEFwaUtleSA/IG5ldyBSZXNlbmQocmVzZW5kQXBpS2V5KSA6IG51bGxcblxuZXhwb3J0IGNvbnN0IEVNQUlMX0ZST00gPSBwcm9jZXNzLmVudi5FTUFJTF9GUk9NIHx8ICdvbmJvYXJkaW5nQHJlc2VuZC5kZXYnXG4iXSwibmFtZXMiOlsiUmVzZW5kIiwicmVzZW5kQXBpS2V5IiwicHJvY2VzcyIsImVudiIsIlJFU0VORF9BUElfS0VZIiwiY29uc29sZSIsIndhcm4iLCJyZXNlbmQiLCJFTUFJTF9GUk9NIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/resend.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/tenant-isolation.ts":
/*!*************************************!*\
  !*** ./src/lib/tenant-isolation.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TenantIsolationError: () => (/* binding */ TenantIsolationError),\n/* harmony export */   clearRequestContext: () => (/* binding */ clearRequestContext),\n/* harmony export */   clearViolationLogs: () => (/* binding */ clearViolationLogs),\n/* harmony export */   createTenantIsolationMiddleware: () => (/* binding */ createTenantIsolationMiddleware),\n/* harmony export */   createTenantScopedClient: () => (/* binding */ createTenantScopedClient),\n/* harmony export */   getCurrentRequestId: () => (/* binding */ getCurrentRequestId),\n/* harmony export */   getRequestContext: () => (/* binding */ getRequestContext),\n/* harmony export */   getViolationLogs: () => (/* binding */ getViolationLogs),\n/* harmony export */   isTenantScopedModel: () => (/* binding */ isTenantScopedModel),\n/* harmony export */   logViolation: () => (/* binding */ logViolation),\n/* harmony export */   setCurrentRequestId: () => (/* binding */ setCurrentRequestId),\n/* harmony export */   setRequestContext: () => (/* binding */ setRequestContext),\n/* harmony export */   withIsolatedContext: () => (/* binding */ withIsolatedContext)\n/* harmony export */ });\n/**\n * Tenant Isolation Enforcement v2\n * \n * This module provides strict tenant data isolation at the database level.\n * Uses request-scoped context via headers for Next.js compatibility.\n * \n * Features:\n * - Prisma middleware to intercept and validate queries\n * - Automatic tenantId validation for scoped queries\n * - SUPER_ADMIN bypass with explicit flag\n * - Violation logging and hard failure\n */ // Models that require tenant isolation\nconst TENANT_SCOPED_MODELS = [\n    \"TenantMembership\",\n    \"TenantDomain\",\n    \"AuditLog\"\n];\n// Models that are global (no tenant scope)\nconst GLOBAL_MODELS = [\n    \"User\",\n    \"Tenant\",\n    \"Session\",\n    \"MagicLink\"\n];\n// Actions that read data\nconst READ_ACTIONS = [\n    \"findUnique\",\n    \"findFirst\",\n    \"findMany\",\n    \"count\",\n    \"aggregate\",\n    \"groupBy\"\n];\n// Actions that write data  \nconst WRITE_ACTIONS = [\n    \"create\",\n    \"createMany\",\n    \"update\",\n    \"updateMany\",\n    \"upsert\",\n    \"delete\",\n    \"deleteMany\"\n];\n/**\n * Request-scoped context storage\n * Uses a Map keyed by request ID from headers\n */ const requestContextMap = new Map();\n/**\n * Set context for a request\n */ function setRequestContext(requestId, context) {\n    requestContextMap.set(requestId, context);\n    // Auto-cleanup after 30 seconds\n    setTimeout(()=>requestContextMap.delete(requestId), 30000);\n}\n/**\n * Get context for current request\n */ function getRequestContext(requestId) {\n    return requestContextMap.get(requestId);\n}\n/**\n * Clear context for a request  \n */ function clearRequestContext(requestId) {\n    requestContextMap.delete(requestId);\n}\n// Current request ID for middleware (set per-request)\nlet currentRequestId = null;\nfunction setCurrentRequestId(id) {\n    currentRequestId = id;\n}\nfunction getCurrentRequestId() {\n    return currentRequestId;\n}\nconst violations = [];\nconst MAX_VIOLATION_LOGS = 1000;\nfunction logViolation(violation) {\n    const log = {\n        ...violation,\n        timestamp: new Date()\n    };\n    violations.push(log);\n    if (violations.length > MAX_VIOLATION_LOGS) {\n        violations.shift();\n    }\n    console.error(\"[TENANT ISOLATION VIOLATION]\", JSON.stringify(log, null, 2));\n}\nfunction getViolationLogs() {\n    return [\n        ...violations\n    ];\n}\nfunction clearViolationLogs() {\n    violations.length = 0;\n}\n/**\n * Tenant Isolation Error\n */ class TenantIsolationError extends Error {\n    constructor(message, model, action, context){\n        super(message);\n        this.model = model;\n        this.action = action;\n        this.context = context;\n        this.name = \"TenantIsolationError\";\n    }\n}\n/**\n * Check if a model is tenant-scoped\n */ function isTenantScopedModel(model) {\n    return TENANT_SCOPED_MODELS.includes(model);\n}\n/**\n * Check if WHERE clause has tenantId filter matching expected value\n */ function hasTenantIdFilter(where, expectedTenantId) {\n    if (!where) return false;\n    if (where.tenantId === expectedTenantId) return true;\n    if (Array.isArray(where.AND)) {\n        return where.AND.some((clause)=>hasTenantIdFilter(clause, expectedTenantId));\n    }\n    if (where.tenantId?.equals === expectedTenantId) return true;\n    return false;\n}\n/**\n * Validate that a query has proper tenant isolation\n */ function validateTenantIsolation(model, action, args, context, requestId) {\n    // Skip validation for global models\n    if (!isTenantScopedModel(model)) {\n        return;\n    }\n    // Allow explicit bypass (for migrations, admin tools, etc.)\n    if (context?.bypassIsolation === true) {\n        if (!context.isSuperAdmin) {\n            const reason = \"Bypass isolation attempted without SUPER_ADMIN role\";\n            logViolation({\n                model,\n                action,\n                requestId,\n                context,\n                query: args,\n                reason\n            });\n            throw new TenantIsolationError(reason, model, action, context);\n        }\n        console.warn(`[TENANT ISOLATION] Bypass allowed for SUPER_ADMIN on ${model}.${action}`);\n        return;\n    }\n    // SUPER_ADMIN can access all data\n    if (context?.isSuperAdmin) {\n        return;\n    }\n    // No context = violation\n    if (!context) {\n        const reason = \"No tenant context provided for tenant-scoped query\";\n        logViolation({\n            model,\n            action,\n            requestId,\n            context,\n            query: args,\n            reason\n        });\n        throw new TenantIsolationError(reason, model, action, context);\n    }\n    // No tenantId in context = violation\n    if (!context.tenantId) {\n        const reason = \"No tenantId in context for tenant-scoped query\";\n        logViolation({\n            model,\n            action,\n            requestId,\n            context,\n            query: args,\n            reason\n        });\n        throw new TenantIsolationError(reason, model, action, context);\n    }\n    // For read operations, ensure WHERE clause has tenantId\n    if (READ_ACTIONS.includes(action)) {\n        const where = args?.where;\n        if (!where || !hasTenantIdFilter(where, context.tenantId)) {\n            const reason = `Read query on ${model} missing tenantId filter`;\n            logViolation({\n                model,\n                action,\n                requestId,\n                context,\n                query: args,\n                reason\n            });\n            throw new TenantIsolationError(reason, model, action, context);\n        }\n    }\n    // For write operations, ensure data has correct tenantId\n    if (WRITE_ACTIONS.includes(action)) {\n        if (action === \"create\" || action === \"createMany\") {\n            const data = action === \"createMany\" ? args?.data : [\n                args?.data\n            ];\n            for (const item of data || []){\n                if (item && item.tenantId !== context.tenantId) {\n                    const reason = `Create on ${model} has mismatched tenantId`;\n                    logViolation({\n                        model,\n                        action,\n                        requestId,\n                        context,\n                        query: args,\n                        reason\n                    });\n                    throw new TenantIsolationError(reason, model, action, context);\n                }\n            }\n        }\n        if ([\n            \"update\",\n            \"updateMany\",\n            \"delete\",\n            \"deleteMany\"\n        ].includes(action)) {\n            const where = args?.where;\n            if (!where || !hasTenantIdFilter(where, context.tenantId)) {\n                const reason = `${action} on ${model} missing tenantId filter`;\n                logViolation({\n                    model,\n                    action,\n                    requestId,\n                    context,\n                    query: args,\n                    reason\n                });\n                throw new TenantIsolationError(reason, model, action, context);\n            }\n        }\n        if (action === \"upsert\") {\n            const where = args?.where;\n            const create = args?.create;\n            if (!where || !hasTenantIdFilter(where, context.tenantId)) {\n                const reason = `Upsert on ${model} missing tenantId filter in WHERE`;\n                logViolation({\n                    model,\n                    action,\n                    requestId,\n                    context,\n                    query: args,\n                    reason\n                });\n                throw new TenantIsolationError(reason, model, action, context);\n            }\n            if (create && create.tenantId !== context.tenantId) {\n                const reason = `Upsert on ${model} has mismatched tenantId in CREATE`;\n                logViolation({\n                    model,\n                    action,\n                    requestId,\n                    context,\n                    query: args,\n                    reason\n                });\n                throw new TenantIsolationError(reason, model, action, context);\n            }\n        }\n    }\n}\n/**\n * Create Prisma middleware for tenant isolation\n */ function createTenantIsolationMiddleware() {\n    return async (params, next)=>{\n        const { model, action, args } = params;\n        if (!model) {\n            return next(params);\n        }\n        const requestId = getCurrentRequestId();\n        const context = requestId ? getRequestContext(requestId) : undefined;\n        // Validate tenant isolation\n        validateTenantIsolation(model, action, args, context, requestId);\n        return next(params);\n    };\n}\n/**\n * Execute a function with tenant context\n */ async function withIsolatedContext(context, fn) {\n    const requestId = `isolated-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n    try {\n        setRequestContext(requestId, context);\n        setCurrentRequestId(requestId);\n        return await fn();\n    } finally{\n        clearRequestContext(requestId);\n        setCurrentRequestId(null);\n    }\n}\n/**\n * Create a tenant-scoped Prisma client that automatically injects tenantId\n */ function createTenantScopedClient(prisma, tenantId) {\n    return prisma.$extends({\n        query: {\n            $allOperations ({ model, operation, args, query }) {\n                if (model && isTenantScopedModel(model)) {\n                    if (READ_ACTIONS.includes(operation)) {\n                        args.where = {\n                            ...args.where,\n                            tenantId\n                        };\n                    }\n                    if (operation === \"create\") {\n                        args.data = {\n                            ...args.data,\n                            tenantId\n                        };\n                    }\n                    if (operation === \"createMany\") {\n                        args.data = args.data.map((item)=>({\n                                ...item,\n                                tenantId\n                            }));\n                    }\n                    if ([\n                        \"update\",\n                        \"updateMany\",\n                        \"delete\",\n                        \"deleteMany\"\n                    ].includes(operation)) {\n                        args.where = {\n                            ...args.where,\n                            tenantId\n                        };\n                    }\n                }\n                return query(args);\n            }\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YXMtY29yZS8uL3NyYy9saWIvdGVuYW50LWlzb2xhdGlvbi50cz9mMjUzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGVuYW50IElzb2xhdGlvbiBFbmZvcmNlbWVudCB2MlxuICogXG4gKiBUaGlzIG1vZHVsZSBwcm92aWRlcyBzdHJpY3QgdGVuYW50IGRhdGEgaXNvbGF0aW9uIGF0IHRoZSBkYXRhYmFzZSBsZXZlbC5cbiAqIFVzZXMgcmVxdWVzdC1zY29wZWQgY29udGV4dCB2aWEgaGVhZGVycyBmb3IgTmV4dC5qcyBjb21wYXRpYmlsaXR5LlxuICogXG4gKiBGZWF0dXJlczpcbiAqIC0gUHJpc21hIG1pZGRsZXdhcmUgdG8gaW50ZXJjZXB0IGFuZCB2YWxpZGF0ZSBxdWVyaWVzXG4gKiAtIEF1dG9tYXRpYyB0ZW5hbnRJZCB2YWxpZGF0aW9uIGZvciBzY29wZWQgcXVlcmllc1xuICogLSBTVVBFUl9BRE1JTiBieXBhc3Mgd2l0aCBleHBsaWNpdCBmbGFnXG4gKiAtIFZpb2xhdGlvbiBsb2dnaW5nIGFuZCBoYXJkIGZhaWx1cmVcbiAqL1xuXG5pbXBvcnQgeyBQcmlzbWEsIFByaXNtYUNsaWVudCB9IGZyb20gJ0BwcmlzbWEvY2xpZW50J1xuaW1wb3J0IHsgaGVhZGVycyB9IGZyb20gJ25leHQvaGVhZGVycydcblxuLy8gTW9kZWxzIHRoYXQgcmVxdWlyZSB0ZW5hbnQgaXNvbGF0aW9uXG5jb25zdCBURU5BTlRfU0NPUEVEX01PREVMUyA9IFtcbiAgJ1RlbmFudE1lbWJlcnNoaXAnLFxuICAnVGVuYW50RG9tYWluJywgXG4gICdBdWRpdExvZycsXG4gIC8vIEFkZCBmdXR1cmUgdGVuYW50LXNjb3BlZCBtb2RlbHMgaGVyZTpcbiAgLy8gJ1Byb2plY3QnLCAnVGFzaycsICdEb2N1bWVudCcsICdJbnZvaWNlJywgZXRjLlxuXSBhcyBjb25zdFxuXG4vLyBNb2RlbHMgdGhhdCBhcmUgZ2xvYmFsIChubyB0ZW5hbnQgc2NvcGUpXG5jb25zdCBHTE9CQUxfTU9ERUxTID0gW1xuICAnVXNlcicsXG4gICdUZW5hbnQnLFxuICAnU2Vzc2lvbicsXG4gICdNYWdpY0xpbmsnLFxuXSBhcyBjb25zdFxuXG4vLyBBY3Rpb25zIHRoYXQgcmVhZCBkYXRhXG5jb25zdCBSRUFEX0FDVElPTlMgPSBbJ2ZpbmRVbmlxdWUnLCAnZmluZEZpcnN0JywgJ2ZpbmRNYW55JywgJ2NvdW50JywgJ2FnZ3JlZ2F0ZScsICdncm91cEJ5J11cblxuLy8gQWN0aW9ucyB0aGF0IHdyaXRlIGRhdGEgIFxuY29uc3QgV1JJVEVfQUNUSU9OUyA9IFsnY3JlYXRlJywgJ2NyZWF0ZU1hbnknLCAndXBkYXRlJywgJ3VwZGF0ZU1hbnknLCAndXBzZXJ0JywgJ2RlbGV0ZScsICdkZWxldGVNYW55J11cblxuZXhwb3J0IGludGVyZmFjZSBUZW5hbnRDb250ZXh0IHtcbiAgdGVuYW50SWQ6IHN0cmluZyB8IG51bGxcbiAgdXNlcklkOiBzdHJpbmcgfCBudWxsXG4gIGlzU3VwZXJBZG1pbjogYm9vbGVhblxuICBieXBhc3NJc29sYXRpb24/OiBib29sZWFuXG59XG5cbi8qKlxuICogUmVxdWVzdC1zY29wZWQgY29udGV4dCBzdG9yYWdlXG4gKiBVc2VzIGEgTWFwIGtleWVkIGJ5IHJlcXVlc3QgSUQgZnJvbSBoZWFkZXJzXG4gKi9cbmNvbnN0IHJlcXVlc3RDb250ZXh0TWFwID0gbmV3IE1hcDxzdHJpbmcsIFRlbmFudENvbnRleHQ+KClcblxuLyoqXG4gKiBTZXQgY29udGV4dCBmb3IgYSByZXF1ZXN0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXRSZXF1ZXN0Q29udGV4dChyZXF1ZXN0SWQ6IHN0cmluZywgY29udGV4dDogVGVuYW50Q29udGV4dCk6IHZvaWQge1xuICByZXF1ZXN0Q29udGV4dE1hcC5zZXQocmVxdWVzdElkLCBjb250ZXh0KVxuICAvLyBBdXRvLWNsZWFudXAgYWZ0ZXIgMzAgc2Vjb25kc1xuICBzZXRUaW1lb3V0KCgpID0+IHJlcXVlc3RDb250ZXh0TWFwLmRlbGV0ZShyZXF1ZXN0SWQpLCAzMDAwMClcbn1cblxuLyoqXG4gKiBHZXQgY29udGV4dCBmb3IgY3VycmVudCByZXF1ZXN0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRSZXF1ZXN0Q29udGV4dChyZXF1ZXN0SWQ6IHN0cmluZyk6IFRlbmFudENvbnRleHQgfCB1bmRlZmluZWQge1xuICByZXR1cm4gcmVxdWVzdENvbnRleHRNYXAuZ2V0KHJlcXVlc3RJZClcbn1cblxuLyoqXG4gKiBDbGVhciBjb250ZXh0IGZvciBhIHJlcXVlc3QgIFxuICovXG5leHBvcnQgZnVuY3Rpb24gY2xlYXJSZXF1ZXN0Q29udGV4dChyZXF1ZXN0SWQ6IHN0cmluZyk6IHZvaWQge1xuICByZXF1ZXN0Q29udGV4dE1hcC5kZWxldGUocmVxdWVzdElkKVxufVxuXG4vLyBDdXJyZW50IHJlcXVlc3QgSUQgZm9yIG1pZGRsZXdhcmUgKHNldCBwZXItcmVxdWVzdClcbmxldCBjdXJyZW50UmVxdWVzdElkOiBzdHJpbmcgfCBudWxsID0gbnVsbFxuXG5leHBvcnQgZnVuY3Rpb24gc2V0Q3VycmVudFJlcXVlc3RJZChpZDogc3RyaW5nIHwgbnVsbCk6IHZvaWQge1xuICBjdXJyZW50UmVxdWVzdElkID0gaWRcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEN1cnJlbnRSZXF1ZXN0SWQoKTogc3RyaW5nIHwgbnVsbCB7XG4gIHJldHVybiBjdXJyZW50UmVxdWVzdElkXG59XG5cbi8qKlxuICogVmlvbGF0aW9uIGxvZ2dlclxuICovXG5pbnRlcmZhY2UgVmlvbGF0aW9uTG9nIHtcbiAgdGltZXN0YW1wOiBEYXRlXG4gIG1vZGVsOiBzdHJpbmdcbiAgYWN0aW9uOiBzdHJpbmdcbiAgcmVxdWVzdElkOiBzdHJpbmcgfCBudWxsXG4gIGNvbnRleHQ6IFRlbmFudENvbnRleHQgfCB1bmRlZmluZWRcbiAgcXVlcnk6IGFueVxuICByZWFzb246IHN0cmluZ1xufVxuXG5jb25zdCB2aW9sYXRpb25zOiBWaW9sYXRpb25Mb2dbXSA9IFtdXG5jb25zdCBNQVhfVklPTEFUSU9OX0xPR1MgPSAxMDAwXG5cbmV4cG9ydCBmdW5jdGlvbiBsb2dWaW9sYXRpb24odmlvbGF0aW9uOiBPbWl0PFZpb2xhdGlvbkxvZywgJ3RpbWVzdGFtcCc+KSB7XG4gIGNvbnN0IGxvZzogVmlvbGF0aW9uTG9nID0ge1xuICAgIC4uLnZpb2xhdGlvbixcbiAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcbiAgfVxuICBcbiAgdmlvbGF0aW9ucy5wdXNoKGxvZylcbiAgXG4gIGlmICh2aW9sYXRpb25zLmxlbmd0aCA+IE1BWF9WSU9MQVRJT05fTE9HUykge1xuICAgIHZpb2xhdGlvbnMuc2hpZnQoKVxuICB9XG4gIFxuICBjb25zb2xlLmVycm9yKCdbVEVOQU5UIElTT0xBVElPTiBWSU9MQVRJT05dJywgSlNPTi5zdHJpbmdpZnkobG9nLCBudWxsLCAyKSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFZpb2xhdGlvbkxvZ3MoKTogVmlvbGF0aW9uTG9nW10ge1xuICByZXR1cm4gWy4uLnZpb2xhdGlvbnNdXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjbGVhclZpb2xhdGlvbkxvZ3MoKTogdm9pZCB7XG4gIHZpb2xhdGlvbnMubGVuZ3RoID0gMFxufVxuXG4vKipcbiAqIFRlbmFudCBJc29sYXRpb24gRXJyb3JcbiAqL1xuZXhwb3J0IGNsYXNzIFRlbmFudElzb2xhdGlvbkVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihcbiAgICBtZXNzYWdlOiBzdHJpbmcsXG4gICAgcHVibGljIG1vZGVsOiBzdHJpbmcsXG4gICAgcHVibGljIGFjdGlvbjogc3RyaW5nLFxuICAgIHB1YmxpYyBjb250ZXh0OiBUZW5hbnRDb250ZXh0IHwgdW5kZWZpbmVkXG4gICkge1xuICAgIHN1cGVyKG1lc3NhZ2UpXG4gICAgdGhpcy5uYW1lID0gJ1RlbmFudElzb2xhdGlvbkVycm9yJ1xuICB9XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgYSBtb2RlbCBpcyB0ZW5hbnQtc2NvcGVkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1RlbmFudFNjb3BlZE1vZGVsKG1vZGVsOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgcmV0dXJuIFRFTkFOVF9TQ09QRURfTU9ERUxTLmluY2x1ZGVzKG1vZGVsIGFzIGFueSlcbn1cblxuLyoqXG4gKiBDaGVjayBpZiBXSEVSRSBjbGF1c2UgaGFzIHRlbmFudElkIGZpbHRlciBtYXRjaGluZyBleHBlY3RlZCB2YWx1ZVxuICovXG5mdW5jdGlvbiBoYXNUZW5hbnRJZEZpbHRlcih3aGVyZTogYW55LCBleHBlY3RlZFRlbmFudElkOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgaWYgKCF3aGVyZSkgcmV0dXJuIGZhbHNlXG4gIFxuICBpZiAod2hlcmUudGVuYW50SWQgPT09IGV4cGVjdGVkVGVuYW50SWQpIHJldHVybiB0cnVlXG4gIFxuICBpZiAoQXJyYXkuaXNBcnJheSh3aGVyZS5BTkQpKSB7XG4gICAgcmV0dXJuIHdoZXJlLkFORC5zb21lKChjbGF1c2U6IGFueSkgPT4gaGFzVGVuYW50SWRGaWx0ZXIoY2xhdXNlLCBleHBlY3RlZFRlbmFudElkKSlcbiAgfVxuICBcbiAgaWYgKHdoZXJlLnRlbmFudElkPy5lcXVhbHMgPT09IGV4cGVjdGVkVGVuYW50SWQpIHJldHVybiB0cnVlXG4gIFxuICByZXR1cm4gZmFsc2Vcbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSB0aGF0IGEgcXVlcnkgaGFzIHByb3BlciB0ZW5hbnQgaXNvbGF0aW9uXG4gKi9cbmZ1bmN0aW9uIHZhbGlkYXRlVGVuYW50SXNvbGF0aW9uKFxuICBtb2RlbDogc3RyaW5nLFxuICBhY3Rpb246IHN0cmluZyxcbiAgYXJnczogYW55LFxuICBjb250ZXh0OiBUZW5hbnRDb250ZXh0IHwgdW5kZWZpbmVkLFxuICByZXF1ZXN0SWQ6IHN0cmluZyB8IG51bGxcbik6IHZvaWQge1xuICAvLyBTa2lwIHZhbGlkYXRpb24gZm9yIGdsb2JhbCBtb2RlbHNcbiAgaWYgKCFpc1RlbmFudFNjb3BlZE1vZGVsKG1vZGVsKSkge1xuICAgIHJldHVyblxuICB9XG4gIFxuICAvLyBBbGxvdyBleHBsaWNpdCBieXBhc3MgKGZvciBtaWdyYXRpb25zLCBhZG1pbiB0b29scywgZXRjLilcbiAgaWYgKGNvbnRleHQ/LmJ5cGFzc0lzb2xhdGlvbiA9PT0gdHJ1ZSkge1xuICAgIGlmICghY29udGV4dC5pc1N1cGVyQWRtaW4pIHtcbiAgICAgIGNvbnN0IHJlYXNvbiA9ICdCeXBhc3MgaXNvbGF0aW9uIGF0dGVtcHRlZCB3aXRob3V0IFNVUEVSX0FETUlOIHJvbGUnXG4gICAgICBsb2dWaW9sYXRpb24oeyBtb2RlbCwgYWN0aW9uLCByZXF1ZXN0SWQsIGNvbnRleHQsIHF1ZXJ5OiBhcmdzLCByZWFzb24gfSlcbiAgICAgIHRocm93IG5ldyBUZW5hbnRJc29sYXRpb25FcnJvcihyZWFzb24sIG1vZGVsLCBhY3Rpb24sIGNvbnRleHQpXG4gICAgfVxuICAgIGNvbnNvbGUud2FybihgW1RFTkFOVCBJU09MQVRJT05dIEJ5cGFzcyBhbGxvd2VkIGZvciBTVVBFUl9BRE1JTiBvbiAke21vZGVsfS4ke2FjdGlvbn1gKVxuICAgIHJldHVyblxuICB9XG4gIFxuICAvLyBTVVBFUl9BRE1JTiBjYW4gYWNjZXNzIGFsbCBkYXRhXG4gIGlmIChjb250ZXh0Py5pc1N1cGVyQWRtaW4pIHtcbiAgICByZXR1cm5cbiAgfVxuICBcbiAgLy8gTm8gY29udGV4dCA9IHZpb2xhdGlvblxuICBpZiAoIWNvbnRleHQpIHtcbiAgICBjb25zdCByZWFzb24gPSAnTm8gdGVuYW50IGNvbnRleHQgcHJvdmlkZWQgZm9yIHRlbmFudC1zY29wZWQgcXVlcnknXG4gICAgbG9nVmlvbGF0aW9uKHsgbW9kZWwsIGFjdGlvbiwgcmVxdWVzdElkLCBjb250ZXh0LCBxdWVyeTogYXJncywgcmVhc29uIH0pXG4gICAgdGhyb3cgbmV3IFRlbmFudElzb2xhdGlvbkVycm9yKHJlYXNvbiwgbW9kZWwsIGFjdGlvbiwgY29udGV4dClcbiAgfVxuICBcbiAgLy8gTm8gdGVuYW50SWQgaW4gY29udGV4dCA9IHZpb2xhdGlvblxuICBpZiAoIWNvbnRleHQudGVuYW50SWQpIHtcbiAgICBjb25zdCByZWFzb24gPSAnTm8gdGVuYW50SWQgaW4gY29udGV4dCBmb3IgdGVuYW50LXNjb3BlZCBxdWVyeSdcbiAgICBsb2dWaW9sYXRpb24oeyBtb2RlbCwgYWN0aW9uLCByZXF1ZXN0SWQsIGNvbnRleHQsIHF1ZXJ5OiBhcmdzLCByZWFzb24gfSlcbiAgICB0aHJvdyBuZXcgVGVuYW50SXNvbGF0aW9uRXJyb3IocmVhc29uLCBtb2RlbCwgYWN0aW9uLCBjb250ZXh0KVxuICB9XG4gIFxuICAvLyBGb3IgcmVhZCBvcGVyYXRpb25zLCBlbnN1cmUgV0hFUkUgY2xhdXNlIGhhcyB0ZW5hbnRJZFxuICBpZiAoUkVBRF9BQ1RJT05TLmluY2x1ZGVzKGFjdGlvbikpIHtcbiAgICBjb25zdCB3aGVyZSA9IGFyZ3M/LndoZXJlXG4gICAgaWYgKCF3aGVyZSB8fCAhaGFzVGVuYW50SWRGaWx0ZXIod2hlcmUsIGNvbnRleHQudGVuYW50SWQpKSB7XG4gICAgICBjb25zdCByZWFzb24gPSBgUmVhZCBxdWVyeSBvbiAke21vZGVsfSBtaXNzaW5nIHRlbmFudElkIGZpbHRlcmBcbiAgICAgIGxvZ1Zpb2xhdGlvbih7IG1vZGVsLCBhY3Rpb24sIHJlcXVlc3RJZCwgY29udGV4dCwgcXVlcnk6IGFyZ3MsIHJlYXNvbiB9KVxuICAgICAgdGhyb3cgbmV3IFRlbmFudElzb2xhdGlvbkVycm9yKHJlYXNvbiwgbW9kZWwsIGFjdGlvbiwgY29udGV4dClcbiAgICB9XG4gIH1cbiAgXG4gIC8vIEZvciB3cml0ZSBvcGVyYXRpb25zLCBlbnN1cmUgZGF0YSBoYXMgY29ycmVjdCB0ZW5hbnRJZFxuICBpZiAoV1JJVEVfQUNUSU9OUy5pbmNsdWRlcyhhY3Rpb24pKSB7XG4gICAgaWYgKGFjdGlvbiA9PT0gJ2NyZWF0ZScgfHwgYWN0aW9uID09PSAnY3JlYXRlTWFueScpIHtcbiAgICAgIGNvbnN0IGRhdGEgPSBhY3Rpb24gPT09ICdjcmVhdGVNYW55JyA/IGFyZ3M/LmRhdGEgOiBbYXJncz8uZGF0YV1cbiAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBkYXRhIHx8IFtdKSB7XG4gICAgICAgIGlmIChpdGVtICYmIGl0ZW0udGVuYW50SWQgIT09IGNvbnRleHQudGVuYW50SWQpIHtcbiAgICAgICAgICBjb25zdCByZWFzb24gPSBgQ3JlYXRlIG9uICR7bW9kZWx9IGhhcyBtaXNtYXRjaGVkIHRlbmFudElkYFxuICAgICAgICAgIGxvZ1Zpb2xhdGlvbih7IG1vZGVsLCBhY3Rpb24sIHJlcXVlc3RJZCwgY29udGV4dCwgcXVlcnk6IGFyZ3MsIHJlYXNvbiB9KVxuICAgICAgICAgIHRocm93IG5ldyBUZW5hbnRJc29sYXRpb25FcnJvcihyZWFzb24sIG1vZGVsLCBhY3Rpb24sIGNvbnRleHQpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgaWYgKFsndXBkYXRlJywgJ3VwZGF0ZU1hbnknLCAnZGVsZXRlJywgJ2RlbGV0ZU1hbnknXS5pbmNsdWRlcyhhY3Rpb24pKSB7XG4gICAgICBjb25zdCB3aGVyZSA9IGFyZ3M/LndoZXJlXG4gICAgICBpZiAoIXdoZXJlIHx8ICFoYXNUZW5hbnRJZEZpbHRlcih3aGVyZSwgY29udGV4dC50ZW5hbnRJZCkpIHtcbiAgICAgICAgY29uc3QgcmVhc29uID0gYCR7YWN0aW9ufSBvbiAke21vZGVsfSBtaXNzaW5nIHRlbmFudElkIGZpbHRlcmBcbiAgICAgICAgbG9nVmlvbGF0aW9uKHsgbW9kZWwsIGFjdGlvbiwgcmVxdWVzdElkLCBjb250ZXh0LCBxdWVyeTogYXJncywgcmVhc29uIH0pXG4gICAgICAgIHRocm93IG5ldyBUZW5hbnRJc29sYXRpb25FcnJvcihyZWFzb24sIG1vZGVsLCBhY3Rpb24sIGNvbnRleHQpXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIGlmIChhY3Rpb24gPT09ICd1cHNlcnQnKSB7XG4gICAgICBjb25zdCB3aGVyZSA9IGFyZ3M/LndoZXJlXG4gICAgICBjb25zdCBjcmVhdGUgPSBhcmdzPy5jcmVhdGVcbiAgICAgIFxuICAgICAgaWYgKCF3aGVyZSB8fCAhaGFzVGVuYW50SWRGaWx0ZXIod2hlcmUsIGNvbnRleHQudGVuYW50SWQpKSB7XG4gICAgICAgIGNvbnN0IHJlYXNvbiA9IGBVcHNlcnQgb24gJHttb2RlbH0gbWlzc2luZyB0ZW5hbnRJZCBmaWx0ZXIgaW4gV0hFUkVgXG4gICAgICAgIGxvZ1Zpb2xhdGlvbih7IG1vZGVsLCBhY3Rpb24sIHJlcXVlc3RJZCwgY29udGV4dCwgcXVlcnk6IGFyZ3MsIHJlYXNvbiB9KVxuICAgICAgICB0aHJvdyBuZXcgVGVuYW50SXNvbGF0aW9uRXJyb3IocmVhc29uLCBtb2RlbCwgYWN0aW9uLCBjb250ZXh0KVxuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAoY3JlYXRlICYmIGNyZWF0ZS50ZW5hbnRJZCAhPT0gY29udGV4dC50ZW5hbnRJZCkge1xuICAgICAgICBjb25zdCByZWFzb24gPSBgVXBzZXJ0IG9uICR7bW9kZWx9IGhhcyBtaXNtYXRjaGVkIHRlbmFudElkIGluIENSRUFURWBcbiAgICAgICAgbG9nVmlvbGF0aW9uKHsgbW9kZWwsIGFjdGlvbiwgcmVxdWVzdElkLCBjb250ZXh0LCBxdWVyeTogYXJncywgcmVhc29uIH0pXG4gICAgICAgIHRocm93IG5ldyBUZW5hbnRJc29sYXRpb25FcnJvcihyZWFzb24sIG1vZGVsLCBhY3Rpb24sIGNvbnRleHQpXG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogQ3JlYXRlIFByaXNtYSBtaWRkbGV3YXJlIGZvciB0ZW5hbnQgaXNvbGF0aW9uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVUZW5hbnRJc29sYXRpb25NaWRkbGV3YXJlKCk6IFByaXNtYS5NaWRkbGV3YXJlIHtcbiAgcmV0dXJuIGFzeW5jIChwYXJhbXMsIG5leHQpID0+IHtcbiAgICBjb25zdCB7IG1vZGVsLCBhY3Rpb24sIGFyZ3MgfSA9IHBhcmFtc1xuICAgIFxuICAgIGlmICghbW9kZWwpIHtcbiAgICAgIHJldHVybiBuZXh0KHBhcmFtcylcbiAgICB9XG4gICAgXG4gICAgY29uc3QgcmVxdWVzdElkID0gZ2V0Q3VycmVudFJlcXVlc3RJZCgpXG4gICAgY29uc3QgY29udGV4dCA9IHJlcXVlc3RJZCA/IGdldFJlcXVlc3RDb250ZXh0KHJlcXVlc3RJZCkgOiB1bmRlZmluZWRcbiAgICBcbiAgICAvLyBWYWxpZGF0ZSB0ZW5hbnQgaXNvbGF0aW9uXG4gICAgdmFsaWRhdGVUZW5hbnRJc29sYXRpb24obW9kZWwsIGFjdGlvbiwgYXJncywgY29udGV4dCwgcmVxdWVzdElkKVxuICAgIFxuICAgIHJldHVybiBuZXh0KHBhcmFtcylcbiAgfVxufVxuXG4vKipcbiAqIEV4ZWN1dGUgYSBmdW5jdGlvbiB3aXRoIHRlbmFudCBjb250ZXh0XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB3aXRoSXNvbGF0ZWRDb250ZXh0PFQ+KFxuICBjb250ZXh0OiBUZW5hbnRDb250ZXh0LFxuICBmbjogKCkgPT4gUHJvbWlzZTxUPlxuKTogUHJvbWlzZTxUPiB7XG4gIGNvbnN0IHJlcXVlc3RJZCA9IGBpc29sYXRlZC0ke0RhdGUubm93KCl9LSR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWBcbiAgXG4gIHRyeSB7XG4gICAgc2V0UmVxdWVzdENvbnRleHQocmVxdWVzdElkLCBjb250ZXh0KVxuICAgIHNldEN1cnJlbnRSZXF1ZXN0SWQocmVxdWVzdElkKVxuICAgIHJldHVybiBhd2FpdCBmbigpXG4gIH0gZmluYWxseSB7XG4gICAgY2xlYXJSZXF1ZXN0Q29udGV4dChyZXF1ZXN0SWQpXG4gICAgc2V0Q3VycmVudFJlcXVlc3RJZChudWxsKVxuICB9XG59XG5cbi8qKlxuICogQ3JlYXRlIGEgdGVuYW50LXNjb3BlZCBQcmlzbWEgY2xpZW50IHRoYXQgYXV0b21hdGljYWxseSBpbmplY3RzIHRlbmFudElkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVUZW5hbnRTY29wZWRDbGllbnQoXG4gIHByaXNtYTogUHJpc21hQ2xpZW50LFxuICB0ZW5hbnRJZDogc3RyaW5nXG4pOiBQcmlzbWFDbGllbnQge1xuICByZXR1cm4gcHJpc21hLiRleHRlbmRzKHtcbiAgICBxdWVyeToge1xuICAgICAgJGFsbE9wZXJhdGlvbnMoeyBtb2RlbCwgb3BlcmF0aW9uLCBhcmdzLCBxdWVyeSB9KSB7XG4gICAgICAgIGlmIChtb2RlbCAmJiBpc1RlbmFudFNjb3BlZE1vZGVsKG1vZGVsKSkge1xuICAgICAgICAgIGlmIChSRUFEX0FDVElPTlMuaW5jbHVkZXMob3BlcmF0aW9uKSkge1xuICAgICAgICAgICAgYXJncy53aGVyZSA9IHtcbiAgICAgICAgICAgICAgLi4uYXJncy53aGVyZSxcbiAgICAgICAgICAgICAgdGVuYW50SWRcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKG9wZXJhdGlvbiA9PT0gJ2NyZWF0ZScpIHtcbiAgICAgICAgICAgIGFyZ3MuZGF0YSA9IHtcbiAgICAgICAgICAgICAgLi4uYXJncy5kYXRhLFxuICAgICAgICAgICAgICB0ZW5hbnRJZFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICBpZiAob3BlcmF0aW9uID09PSAnY3JlYXRlTWFueScpIHtcbiAgICAgICAgICAgIGFyZ3MuZGF0YSA9IGFyZ3MuZGF0YS5tYXAoKGl0ZW06IGFueSkgPT4gKHtcbiAgICAgICAgICAgICAgLi4uaXRlbSxcbiAgICAgICAgICAgICAgdGVuYW50SWRcbiAgICAgICAgICAgIH0pKVxuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoWyd1cGRhdGUnLCAndXBkYXRlTWFueScsICdkZWxldGUnLCAnZGVsZXRlTWFueSddLmluY2x1ZGVzKG9wZXJhdGlvbikpIHtcbiAgICAgICAgICAgIGFyZ3Mud2hlcmUgPSB7XG4gICAgICAgICAgICAgIC4uLmFyZ3Mud2hlcmUsXG4gICAgICAgICAgICAgIHRlbmFudElkXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gcXVlcnkoYXJncylcbiAgICAgIH1cbiAgICB9XG4gIH0pIGFzIFByaXNtYUNsaWVudFxufVxuIl0sIm5hbWVzIjpbIlRFTkFOVF9TQ09QRURfTU9ERUxTIiwiR0xPQkFMX01PREVMUyIsIlJFQURfQUNUSU9OUyIsIldSSVRFX0FDVElPTlMiLCJyZXF1ZXN0Q29udGV4dE1hcCIsIk1hcCIsInNldFJlcXVlc3RDb250ZXh0IiwicmVxdWVzdElkIiwiY29udGV4dCIsInNldCIsInNldFRpbWVvdXQiLCJkZWxldGUiLCJnZXRSZXF1ZXN0Q29udGV4dCIsImdldCIsImNsZWFyUmVxdWVzdENvbnRleHQiLCJjdXJyZW50UmVxdWVzdElkIiwic2V0Q3VycmVudFJlcXVlc3RJZCIsImlkIiwiZ2V0Q3VycmVudFJlcXVlc3RJZCIsInZpb2xhdGlvbnMiLCJNQVhfVklPTEFUSU9OX0xPR1MiLCJsb2dWaW9sYXRpb24iLCJ2aW9sYXRpb24iLCJsb2ciLCJ0aW1lc3RhbXAiLCJEYXRlIiwicHVzaCIsImxlbmd0aCIsInNoaWZ0IiwiY29uc29sZSIsImVycm9yIiwiSlNPTiIsInN0cmluZ2lmeSIsImdldFZpb2xhdGlvbkxvZ3MiLCJjbGVhclZpb2xhdGlvbkxvZ3MiLCJUZW5hbnRJc29sYXRpb25FcnJvciIsIkVycm9yIiwiY29uc3RydWN0b3IiLCJtZXNzYWdlIiwibW9kZWwiLCJhY3Rpb24iLCJuYW1lIiwiaXNUZW5hbnRTY29wZWRNb2RlbCIsImluY2x1ZGVzIiwiaGFzVGVuYW50SWRGaWx0ZXIiLCJ3aGVyZSIsImV4cGVjdGVkVGVuYW50SWQiLCJ0ZW5hbnRJZCIsIkFycmF5IiwiaXNBcnJheSIsIkFORCIsInNvbWUiLCJjbGF1c2UiLCJlcXVhbHMiLCJ2YWxpZGF0ZVRlbmFudElzb2xhdGlvbiIsImFyZ3MiLCJieXBhc3NJc29sYXRpb24iLCJpc1N1cGVyQWRtaW4iLCJyZWFzb24iLCJxdWVyeSIsIndhcm4iLCJkYXRhIiwiaXRlbSIsImNyZWF0ZSIsImNyZWF0ZVRlbmFudElzb2xhdGlvbk1pZGRsZXdhcmUiLCJwYXJhbXMiLCJuZXh0IiwidW5kZWZpbmVkIiwid2l0aElzb2xhdGVkQ29udGV4dCIsImZuIiwibm93IiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyIiwiY3JlYXRlVGVuYW50U2NvcGVkQ2xpZW50IiwicHJpc21hIiwiJGV4dGVuZHMiLCIkYWxsT3BlcmF0aW9ucyIsIm9wZXJhdGlvbiIsIm1hcCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/tenant-isolation.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/tenant-resolver.ts":
/*!************************************!*\
  !*** ./src/lib/tenant-resolver.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PUBLIC_ROUTES: () => (/* binding */ PUBLIC_ROUTES),\n/* harmony export */   SUPER_ADMIN_ROUTES: () => (/* binding */ SUPER_ADMIN_ROUTES),\n/* harmony export */   getTenantById: () => (/* binding */ getTenantById),\n/* harmony export */   getTenantBySlug: () => (/* binding */ getTenantBySlug),\n/* harmony export */   isPublicRoute: () => (/* binding */ isPublicRoute),\n/* harmony export */   isSuperAdminRoute: () => (/* binding */ isSuperAdminRoute),\n/* harmony export */   isTenantAccessible: () => (/* binding */ isTenantAccessible),\n/* harmony export */   resolveTenant: () => (/* binding */ resolveTenant),\n/* harmony export */   resolveTenantFromHeader: () => (/* binding */ resolveTenantFromHeader),\n/* harmony export */   resolveTenantFromHost: () => (/* binding */ resolveTenantFromHost),\n/* harmony export */   resolveTenantFromQuery: () => (/* binding */ resolveTenantFromQuery)\n/* harmony export */ });\n/* harmony import */ var _prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./prisma */ \"(rsc)/./src/lib/prisma.ts\");\n\n// Routes that don't require tenant resolution\nconst PUBLIC_ROUTES = [\n    \"/login\",\n    \"/register\",\n    \"/api/auth\",\n    \"/api/health\",\n    \"/_next\",\n    \"/favicon.ico\",\n    \"/manifest.json\",\n    \"/sw.js\",\n    \"/icons\"\n];\n// Super Admin routes (require SUPER_ADMIN, no tenant needed)\nconst SUPER_ADMIN_ROUTES = [\n    \"/admin\",\n    \"/api/admin\"\n];\n/**\n * Check if a path is public (no tenant resolution needed)\n */ function isPublicRoute(pathname) {\n    return PUBLIC_ROUTES.some((route)=>pathname.startsWith(route));\n}\n/**\n * Check if a path is a Super Admin route\n */ function isSuperAdminRoute(pathname) {\n    return SUPER_ADMIN_ROUTES.some((route)=>pathname.startsWith(route));\n}\n/**\n * Resolves tenant from hostname using proper resolution order:\n * 1. Custom domain (exact match in TenantDomain)\n * 2. Subdomain (extracted from hostname)\n * 3. Returns null if no match\n */ async function resolveTenantFromHost(hostname) {\n    const host = hostname.split(\":\")[0].toLowerCase();\n    // 1. Check for custom domain match (highest priority)\n    const customDomain = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.tenantDomain.findFirst({\n        where: {\n            domain: host,\n            type: \"CUSTOM\",\n            status: \"VERIFIED\"\n        },\n        include: {\n            tenant: {\n                include: {\n                    domains: true\n                }\n            }\n        }\n    });\n    if (customDomain && customDomain.tenant.status === \"ACTIVE\") {\n        return {\n            tenant: customDomain.tenant,\n            resolvedVia: \"custom_domain\",\n            domain: host\n        };\n    }\n    // 2. Extract and check subdomain\n    const parts = host.split(\".\");\n    if (parts.length >= 3) {\n        const subdomain = parts[0];\n        // Skip common non-tenant subdomains\n        if (![\n            \"www\",\n            \"api\",\n            \"app\",\n            \"admin\",\n            \"preview\",\n            \"localhost\"\n        ].includes(subdomain)) {\n            // Check TenantDomain for subdomain\n            const subdomainEntry = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.tenantDomain.findFirst({\n                where: {\n                    domain: subdomain,\n                    type: \"SUBDOMAIN\",\n                    status: \"VERIFIED\"\n                },\n                include: {\n                    tenant: {\n                        include: {\n                            domains: true\n                        }\n                    }\n                }\n            });\n            if (subdomainEntry && subdomainEntry.tenant.status === \"ACTIVE\") {\n                return {\n                    tenant: subdomainEntry.tenant,\n                    resolvedVia: \"subdomain\",\n                    domain: subdomain\n                };\n            }\n            // Fallback: Check Tenant.slug directly\n            const tenant = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.tenant.findFirst({\n                where: {\n                    slug: subdomain,\n                    status: \"ACTIVE\"\n                },\n                include: {\n                    domains: true\n                }\n            });\n            if (tenant) {\n                return {\n                    tenant,\n                    resolvedVia: \"subdomain\",\n                    domain: subdomain\n                };\n            }\n        }\n    }\n    return null;\n}\n/**\n * Resolves tenant from X-Tenant-ID header (for internal tools)\n */ async function resolveTenantFromHeader(tenantId) {\n    const tenant = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.tenant.findFirst({\n        where: {\n            id: tenantId,\n            status: \"ACTIVE\"\n        },\n        include: {\n            domains: true\n        }\n    });\n    if (tenant) {\n        return {\n            tenant,\n            resolvedVia: \"header\"\n        };\n    }\n    return null;\n}\n/**\n * Resolves tenant from query parameter (for testing/preview)\n */ async function resolveTenantFromQuery(slug) {\n    // First try TenantDomain\n    const domainEntry = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.tenantDomain.findFirst({\n        where: {\n            domain: slug.toLowerCase(),\n            type: \"SUBDOMAIN\"\n        },\n        include: {\n            tenant: {\n                include: {\n                    domains: true\n                }\n            }\n        }\n    });\n    if (domainEntry && domainEntry.tenant.status === \"ACTIVE\") {\n        return {\n            tenant: domainEntry.tenant,\n            resolvedVia: \"query\",\n            domain: slug\n        };\n    }\n    // Fallback to slug\n    const tenant = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.tenant.findFirst({\n        where: {\n            slug: slug.toLowerCase(),\n            status: \"ACTIVE\"\n        },\n        include: {\n            domains: true\n        }\n    });\n    if (tenant) {\n        return {\n            tenant,\n            resolvedVia: \"query\",\n            domain: slug\n        };\n    }\n    return null;\n}\n/**\n * Full tenant resolution with all fallbacks\n * Resolution order:\n * 1. Custom domain\n * 2. Subdomain\n * 3. X-Tenant-ID header\n * 4. ?tenant= query param\n */ async function resolveTenant(hostname, headers, query) {\n    // 1 & 2. Try hostname resolution (custom domain, then subdomain)\n    let context = await resolveTenantFromHost(hostname);\n    if (context) return context;\n    // 3. Try X-Tenant-ID header\n    if (headers.tenantId) {\n        context = await resolveTenantFromHeader(headers.tenantId);\n        if (context) return context;\n    }\n    // 4. Try query parameter\n    if (query.tenant) {\n        context = await resolveTenantFromQuery(query.tenant);\n        if (context) return context;\n    }\n    return null;\n}\n/**\n * Check if tenant is accessible (not suspended/deactivated)\n */ function isTenantAccessible(tenant) {\n    return tenant.status === \"ACTIVE\";\n}\n/**\n * Get tenant by ID (for internal use)\n */ async function getTenantById(id) {\n    return _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.tenant.findUnique({\n        where: {\n            id\n        },\n        include: {\n            domains: true\n        }\n    });\n}\n/**\n * Get tenant by slug\n */ async function getTenantBySlug(slug) {\n    return _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.tenant.findUnique({\n        where: {\n            slug\n        },\n        include: {\n            domains: true\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNoQmlCLFVBQVUsTUFBTUwsdUJBQXVCSSxNQUFNaEIsTUFBTTtRQUNuRCxJQUFJaUIsU0FBUyxPQUFPQTtJQUN0QjtJQUVBLE9BQU87QUFDVDtBQUVBOztDQUVDLEdBQ00sU0FBU0MsbUJBQW1CbEIsTUFBYztJQUMvQyxPQUFPQSxPQUFPRixNQUFNLEtBQUs7QUFDM0I7QUFFQTs7Q0FFQyxHQUNNLGVBQWVxQixjQUFjUixFQUFVO0lBQzVDLE9BQU9qQywyQ0FBTUEsQ0FBQ3NCLE1BQU0sQ0FBQ29CLFVBQVUsQ0FBQztRQUM5QnpCLE9BQU87WUFBRWdCO1FBQUc7UUFDWlosU0FBUztZQUFFRSxTQUFTO1FBQUs7SUFDM0I7QUFDRjtBQUVBOztDQUVDLEdBQ00sZUFBZW9CLGdCQUFnQmIsSUFBWTtJQUNoRCxPQUFPOUIsMkNBQU1BLENBQUNzQixNQUFNLENBQUNvQixVQUFVLENBQUM7UUFDOUJ6QixPQUFPO1lBQUVhO1FBQUs7UUFDZFQsU0FBUztZQUFFRSxTQUFTO1FBQUs7SUFDM0I7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3NhYXMtY29yZS8uL3NyYy9saWIvdGVuYW50LXJlc29sdmVyLnRzPzgyNjYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi9wcmlzbWEnXG5pbXBvcnQgeyBUZW5hbnQsIFRlbmFudERvbWFpbiwgRG9tYWluVHlwZSwgRG9tYWluU3RhdHVzLCBUZW5hbnRTdGF0dXMgfSBmcm9tICdAcHJpc21hL2NsaWVudCdcblxuZXhwb3J0IHR5cGUgVGVuYW50V2l0aERvbWFpbnMgPSBUZW5hbnQgJiB7XG4gIGRvbWFpbnM6IFRlbmFudERvbWFpbltdXG59XG5cbmV4cG9ydCB0eXBlIFRlbmFudENvbnRleHQgPSB7XG4gIHRlbmFudDogVGVuYW50V2l0aERvbWFpbnNcbiAgcmVzb2x2ZWRWaWE6ICdjdXN0b21fZG9tYWluJyB8ICdzdWJkb21haW4nIHwgJ2hlYWRlcicgfCAncXVlcnknXG4gIGRvbWFpbj86IHN0cmluZ1xufVxuXG4vLyBSb3V0ZXMgdGhhdCBkb24ndCByZXF1aXJlIHRlbmFudCByZXNvbHV0aW9uXG5leHBvcnQgY29uc3QgUFVCTElDX1JPVVRFUyA9IFtcbiAgJy9sb2dpbicsXG4gICcvcmVnaXN0ZXInLCBcbiAgJy9hcGkvYXV0aCcsXG4gICcvYXBpL2hlYWx0aCcsXG4gICcvX25leHQnLFxuICAnL2Zhdmljb24uaWNvJyxcbiAgJy9tYW5pZmVzdC5qc29uJyxcbiAgJy9zdy5qcycsXG4gICcvaWNvbnMnXG5dXG5cbi8vIFN1cGVyIEFkbWluIHJvdXRlcyAocmVxdWlyZSBTVVBFUl9BRE1JTiwgbm8gdGVuYW50IG5lZWRlZClcbmV4cG9ydCBjb25zdCBTVVBFUl9BRE1JTl9ST1VURVMgPSBbXG4gICcvYWRtaW4nLFxuICAnL2FwaS9hZG1pbidcbl1cblxuLyoqXG4gKiBDaGVjayBpZiBhIHBhdGggaXMgcHVibGljIChubyB0ZW5hbnQgcmVzb2x1dGlvbiBuZWVkZWQpXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1B1YmxpY1JvdXRlKHBhdGhuYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgcmV0dXJuIFBVQkxJQ19ST1VURVMuc29tZShyb3V0ZSA9PiBwYXRobmFtZS5zdGFydHNXaXRoKHJvdXRlKSlcbn1cblxuLyoqXG4gKiBDaGVjayBpZiBhIHBhdGggaXMgYSBTdXBlciBBZG1pbiByb3V0ZVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNTdXBlckFkbWluUm91dGUocGF0aG5hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICByZXR1cm4gU1VQRVJfQURNSU5fUk9VVEVTLnNvbWUocm91dGUgPT4gcGF0aG5hbWUuc3RhcnRzV2l0aChyb3V0ZSkpXG59XG5cbi8qKlxuICogUmVzb2x2ZXMgdGVuYW50IGZyb20gaG9zdG5hbWUgdXNpbmcgcHJvcGVyIHJlc29sdXRpb24gb3JkZXI6XG4gKiAxLiBDdXN0b20gZG9tYWluIChleGFjdCBtYXRjaCBpbiBUZW5hbnREb21haW4pXG4gKiAyLiBTdWJkb21haW4gKGV4dHJhY3RlZCBmcm9tIGhvc3RuYW1lKVxuICogMy4gUmV0dXJucyBudWxsIGlmIG5vIG1hdGNoXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZXNvbHZlVGVuYW50RnJvbUhvc3QoaG9zdG5hbWU6IHN0cmluZyk6IFByb21pc2U8VGVuYW50Q29udGV4dCB8IG51bGw+IHtcbiAgY29uc3QgaG9zdCA9IGhvc3RuYW1lLnNwbGl0KCc6JylbMF0udG9Mb3dlckNhc2UoKVxuICBcbiAgLy8gMS4gQ2hlY2sgZm9yIGN1c3RvbSBkb21haW4gbWF0Y2ggKGhpZ2hlc3QgcHJpb3JpdHkpXG4gIGNvbnN0IGN1c3RvbURvbWFpbiA9IGF3YWl0IHByaXNtYS50ZW5hbnREb21haW4uZmluZEZpcnN0KHtcbiAgICB3aGVyZTogeyBcbiAgICAgIGRvbWFpbjogaG9zdCxcbiAgICAgIHR5cGU6ICdDVVNUT00nLFxuICAgICAgc3RhdHVzOiAnVkVSSUZJRUQnXG4gICAgfSxcbiAgICBpbmNsdWRlOiB7XG4gICAgICB0ZW5hbnQ6IHtcbiAgICAgICAgaW5jbHVkZTogeyBkb21haW5zOiB0cnVlIH1cbiAgICAgIH1cbiAgICB9XG4gIH0pXG4gIFxuICBpZiAoY3VzdG9tRG9tYWluICYmIGN1c3RvbURvbWFpbi50ZW5hbnQuc3RhdHVzID09PSAnQUNUSVZFJykge1xuICAgIHJldHVybiB7XG4gICAgICB0ZW5hbnQ6IGN1c3RvbURvbWFpbi50ZW5hbnQsXG4gICAgICByZXNvbHZlZFZpYTogJ2N1c3RvbV9kb21haW4nLFxuICAgICAgZG9tYWluOiBob3N0XG4gICAgfVxuICB9XG4gIFxuICAvLyAyLiBFeHRyYWN0IGFuZCBjaGVjayBzdWJkb21haW5cbiAgY29uc3QgcGFydHMgPSBob3N0LnNwbGl0KCcuJylcbiAgaWYgKHBhcnRzLmxlbmd0aCA+PSAzKSB7XG4gICAgY29uc3Qgc3ViZG9tYWluID0gcGFydHNbMF1cbiAgICBcbiAgICAvLyBTa2lwIGNvbW1vbiBub24tdGVuYW50IHN1YmRvbWFpbnNcbiAgICBpZiAoIVsnd3d3JywgJ2FwaScsICdhcHAnLCAnYWRtaW4nLCAncHJldmlldycsICdsb2NhbGhvc3QnXS5pbmNsdWRlcyhzdWJkb21haW4pKSB7XG4gICAgICAvLyBDaGVjayBUZW5hbnREb21haW4gZm9yIHN1YmRvbWFpblxuICAgICAgY29uc3Qgc3ViZG9tYWluRW50cnkgPSBhd2FpdCBwcmlzbWEudGVuYW50RG9tYWluLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgZG9tYWluOiBzdWJkb21haW4sXG4gICAgICAgICAgdHlwZTogJ1NVQkRPTUFJTicsXG4gICAgICAgICAgc3RhdHVzOiAnVkVSSUZJRUQnXG4gICAgICAgIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICB0ZW5hbnQ6IHtcbiAgICAgICAgICAgIGluY2x1ZGU6IHsgZG9tYWluczogdHJ1ZSB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgXG4gICAgICBpZiAoc3ViZG9tYWluRW50cnkgJiYgc3ViZG9tYWluRW50cnkudGVuYW50LnN0YXR1cyA9PT0gJ0FDVElWRScpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0ZW5hbnQ6IHN1YmRvbWFpbkVudHJ5LnRlbmFudCxcbiAgICAgICAgICByZXNvbHZlZFZpYTogJ3N1YmRvbWFpbicsXG4gICAgICAgICAgZG9tYWluOiBzdWJkb21haW5cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBGYWxsYmFjazogQ2hlY2sgVGVuYW50LnNsdWcgZGlyZWN0bHlcbiAgICAgIGNvbnN0IHRlbmFudCA9IGF3YWl0IHByaXNtYS50ZW5hbnQuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IHsgXG4gICAgICAgICAgc2x1Zzogc3ViZG9tYWluLFxuICAgICAgICAgIHN0YXR1czogJ0FDVElWRSdcbiAgICAgICAgfSxcbiAgICAgICAgaW5jbHVkZTogeyBkb21haW5zOiB0cnVlIH1cbiAgICAgIH0pXG4gICAgICBcbiAgICAgIGlmICh0ZW5hbnQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0ZW5hbnQsXG4gICAgICAgICAgcmVzb2x2ZWRWaWE6ICdzdWJkb21haW4nLFxuICAgICAgICAgIGRvbWFpbjogc3ViZG9tYWluXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgXG4gIHJldHVybiBudWxsXG59XG5cbi8qKlxuICogUmVzb2x2ZXMgdGVuYW50IGZyb20gWC1UZW5hbnQtSUQgaGVhZGVyIChmb3IgaW50ZXJuYWwgdG9vbHMpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZXNvbHZlVGVuYW50RnJvbUhlYWRlcih0ZW5hbnRJZDogc3RyaW5nKTogUHJvbWlzZTxUZW5hbnRDb250ZXh0IHwgbnVsbD4ge1xuICBjb25zdCB0ZW5hbnQgPSBhd2FpdCBwcmlzbWEudGVuYW50LmZpbmRGaXJzdCh7XG4gICAgd2hlcmU6IHsgXG4gICAgICBpZDogdGVuYW50SWQsXG4gICAgICBzdGF0dXM6ICdBQ1RJVkUnXG4gICAgfSxcbiAgICBpbmNsdWRlOiB7IGRvbWFpbnM6IHRydWUgfVxuICB9KVxuICBcbiAgaWYgKHRlbmFudCkge1xuICAgIHJldHVybiB7XG4gICAgICB0ZW5hbnQsXG4gICAgICByZXNvbHZlZFZpYTogJ2hlYWRlcidcbiAgICB9XG4gIH1cbiAgXG4gIHJldHVybiBudWxsXG59XG5cbi8qKlxuICogUmVzb2x2ZXMgdGVuYW50IGZyb20gcXVlcnkgcGFyYW1ldGVyIChmb3IgdGVzdGluZy9wcmV2aWV3KVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVzb2x2ZVRlbmFudEZyb21RdWVyeShzbHVnOiBzdHJpbmcpOiBQcm9taXNlPFRlbmFudENvbnRleHQgfCBudWxsPiB7XG4gIC8vIEZpcnN0IHRyeSBUZW5hbnREb21haW5cbiAgY29uc3QgZG9tYWluRW50cnkgPSBhd2FpdCBwcmlzbWEudGVuYW50RG9tYWluLmZpbmRGaXJzdCh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGRvbWFpbjogc2x1Zy50b0xvd2VyQ2FzZSgpLFxuICAgICAgdHlwZTogJ1NVQkRPTUFJTidcbiAgICB9LFxuICAgIGluY2x1ZGU6IHtcbiAgICAgIHRlbmFudDoge1xuICAgICAgICBpbmNsdWRlOiB7IGRvbWFpbnM6IHRydWUgfVxuICAgICAgfVxuICAgIH1cbiAgfSlcbiAgXG4gIGlmIChkb21haW5FbnRyeSAmJiBkb21haW5FbnRyeS50ZW5hbnQuc3RhdHVzID09PSAnQUNUSVZFJykge1xuICAgIHJldHVybiB7XG4gICAgICB0ZW5hbnQ6IGRvbWFpbkVudHJ5LnRlbmFudCxcbiAgICAgIHJlc29sdmVkVmlhOiAncXVlcnknLFxuICAgICAgZG9tYWluOiBzbHVnXG4gICAgfVxuICB9XG4gIFxuICAvLyBGYWxsYmFjayB0byBzbHVnXG4gIGNvbnN0IHRlbmFudCA9IGF3YWl0IHByaXNtYS50ZW5hbnQuZmluZEZpcnN0KHtcbiAgICB3aGVyZTogeyBcbiAgICAgIHNsdWc6IHNsdWcudG9Mb3dlckNhc2UoKSxcbiAgICAgIHN0YXR1czogJ0FDVElWRSdcbiAgICB9LFxuICAgIGluY2x1ZGU6IHsgZG9tYWluczogdHJ1ZSB9XG4gIH0pXG4gIFxuICBpZiAodGVuYW50KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRlbmFudCxcbiAgICAgIHJlc29sdmVkVmlhOiAncXVlcnknLFxuICAgICAgZG9tYWluOiBzbHVnXG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4gbnVsbFxufVxuXG4vKipcbiAqIEZ1bGwgdGVuYW50IHJlc29sdXRpb24gd2l0aCBhbGwgZmFsbGJhY2tzXG4gKiBSZXNvbHV0aW9uIG9yZGVyOlxuICogMS4gQ3VzdG9tIGRvbWFpblxuICogMi4gU3ViZG9tYWluXG4gKiAzLiBYLVRlbmFudC1JRCBoZWFkZXJcbiAqIDQuID90ZW5hbnQ9IHF1ZXJ5IHBhcmFtXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZXNvbHZlVGVuYW50KFxuICBob3N0bmFtZTogc3RyaW5nLFxuICBoZWFkZXJzOiB7IHRlbmFudElkPzogc3RyaW5nIH0sXG4gIHF1ZXJ5OiB7IHRlbmFudD86IHN0cmluZyB9XG4pOiBQcm9taXNlPFRlbmFudENvbnRleHQgfCBudWxsPiB7XG4gIC8vIDEgJiAyLiBUcnkgaG9zdG5hbWUgcmVzb2x1dGlvbiAoY3VzdG9tIGRvbWFpbiwgdGhlbiBzdWJkb21haW4pXG4gIGxldCBjb250ZXh0ID0gYXdhaXQgcmVzb2x2ZVRlbmFudEZyb21Ib3N0KGhvc3RuYW1lKVxuICBpZiAoY29udGV4dCkgcmV0dXJuIGNvbnRleHRcbiAgXG4gIC8vIDMuIFRyeSBYLVRlbmFudC1JRCBoZWFkZXJcbiAgaWYgKGhlYWRlcnMudGVuYW50SWQpIHtcbiAgICBjb250ZXh0ID0gYXdhaXQgcmVzb2x2ZVRlbmFudEZyb21IZWFkZXIoaGVhZGVycy50ZW5hbnRJZClcbiAgICBpZiAoY29udGV4dCkgcmV0dXJuIGNvbnRleHRcbiAgfVxuICBcbiAgLy8gNC4gVHJ5IHF1ZXJ5IHBhcmFtZXRlclxuICBpZiAocXVlcnkudGVuYW50KSB7XG4gICAgY29udGV4dCA9IGF3YWl0IHJlc29sdmVUZW5hbnRGcm9tUXVlcnkocXVlcnkudGVuYW50KVxuICAgIGlmIChjb250ZXh0KSByZXR1cm4gY29udGV4dFxuICB9XG4gIFxuICByZXR1cm4gbnVsbFxufVxuXG4vKipcbiAqIENoZWNrIGlmIHRlbmFudCBpcyBhY2Nlc3NpYmxlIChub3Qgc3VzcGVuZGVkL2RlYWN0aXZhdGVkKVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNUZW5hbnRBY2Nlc3NpYmxlKHRlbmFudDogVGVuYW50KTogYm9vbGVhbiB7XG4gIHJldHVybiB0ZW5hbnQuc3RhdHVzID09PSAnQUNUSVZFJ1xufVxuXG4vKipcbiAqIEdldCB0ZW5hbnQgYnkgSUQgKGZvciBpbnRlcm5hbCB1c2UpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRUZW5hbnRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFRlbmFudFdpdGhEb21haW5zIHwgbnVsbD4ge1xuICByZXR1cm4gcHJpc21hLnRlbmFudC5maW5kVW5pcXVlKHtcbiAgICB3aGVyZTogeyBpZCB9LFxuICAgIGluY2x1ZGU6IHsgZG9tYWluczogdHJ1ZSB9XG4gIH0pXG59XG5cbi8qKlxuICogR2V0IHRlbmFudCBieSBzbHVnXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRUZW5hbnRCeVNsdWcoc2x1Zzogc3RyaW5nKTogUHJvbWlzZTxUZW5hbnRXaXRoRG9tYWlucyB8IG51bGw+IHtcbiAgcmV0dXJuIHByaXNtYS50ZW5hbnQuZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHsgc2x1ZyB9LFxuICAgIGluY2x1ZGU6IHsgZG9tYWluczogdHJ1ZSB9XG4gIH0pXG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwiUFVCTElDX1JPVVRFUyIsIlNVUEVSX0FETUlOX1JPVVRFUyIsImlzUHVibGljUm91dGUiLCJwYXRobmFtZSIsInNvbWUiLCJyb3V0ZSIsInN0YXJ0c1dpdGgiLCJpc1N1cGVyQWRtaW5Sb3V0ZSIsInJlc29sdmVUZW5hbnRGcm9tSG9zdCIsImhvc3RuYW1lIiwiaG9zdCIsInNwbGl0IiwidG9Mb3dlckNhc2UiLCJjdXN0b21Eb21haW4iLCJ0ZW5hbnREb21haW4iLCJmaW5kRmlyc3QiLCJ3aGVyZSIsImRvbWFpbiIsInR5cGUiLCJzdGF0dXMiLCJpbmNsdWRlIiwidGVuYW50IiwiZG9tYWlucyIsInJlc29sdmVkVmlhIiwicGFydHMiLCJsZW5ndGgiLCJzdWJkb21haW4iLCJpbmNsdWRlcyIsInN1YmRvbWFpbkVudHJ5Iiwic2x1ZyIsInJlc29sdmVUZW5hbnRGcm9tSGVhZGVyIiwidGVuYW50SWQiLCJpZCIsInJlc29sdmVUZW5hbnRGcm9tUXVlcnkiLCJkb21haW5FbnRyeSIsInJlc29sdmVUZW5hbnQiLCJoZWFkZXJzIiwicXVlcnkiLCJjb250ZXh0IiwiaXNUZW5hbnRBY2Nlc3NpYmxlIiwiZ2V0VGVuYW50QnlJZCIsImZpbmRVbmlxdWUiLCJnZXRUZW5hbnRCeVNsdWciXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/tenant-resolver.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/uuid","vendor-chunks/svix","vendor-chunks/resend","vendor-chunks/fast-sha256","vendor-chunks/@stablelib"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2Fmagic-link%2Froute&page=%2Fapi%2Fauth%2Fmagic-link%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fmagic-link%2Froute.ts&appDir=%2Fapp%2Fsaas-core%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp%2Fsaas-core&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();