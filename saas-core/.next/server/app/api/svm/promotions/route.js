"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/svm/promotions/route";
exports.ids = ["app/api/svm/promotions/route"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsvm%2Fpromotions%2Froute&page=%2Fapi%2Fsvm%2Fpromotions%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsvm%2Fpromotions%2Froute.ts&appDir=%2Fapp%2Fsaas-core%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp%2Fsaas-core&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsvm%2Fpromotions%2Froute&page=%2Fapi%2Fsvm%2Fpromotions%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsvm%2Fpromotions%2Froute.ts&appDir=%2Fapp%2Fsaas-core%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp%2Fsaas-core&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _app_saas_core_src_app_api_svm_promotions_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/svm/promotions/route.ts */ \"(rsc)/./src/app/api/svm/promotions/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/svm/promotions/route\",\n        pathname: \"/api/svm/promotions\",\n        filename: \"route\",\n        bundlePath: \"app/api/svm/promotions/route\"\n    },\n    resolvedPagePath: \"/app/saas-core/src/app/api/svm/promotions/route.ts\",\n    nextConfigOutput,\n    userland: _app_saas_core_src_app_api_svm_promotions_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/svm/promotions/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZzdm0lMkZwcm9tb3Rpb25zJTJGcm91dGUmcGFnZT0lMkZhcGklMkZzdm0lMkZwcm9tb3Rpb25zJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGc3ZtJTJGcHJvbW90aW9ucyUyRnJvdXRlLnRzJmFwcERpcj0lMkZhcHAlMkZzYWFzLWNvcmUlMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRmFwcCUyRnNhYXMtY29yZSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDRTtBQUMvRTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL3NhYXMtY29yZS8/NDU0NCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvYXBwL3NhYXMtY29yZS9zcmMvYXBwL2FwaS9zdm0vcHJvbW90aW9ucy9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvc3ZtL3Byb21vdGlvbnMvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9zdm0vcHJvbW90aW9uc1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvc3ZtL3Byb21vdGlvbnMvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvYXBwL3NhYXMtY29yZS9zcmMvYXBwL2FwaS9zdm0vcHJvbW90aW9ucy9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvc3ZtL3Byb21vdGlvbnMvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsvm%2Fpromotions%2Froute&page=%2Fapi%2Fsvm%2Fpromotions%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsvm%2Fpromotions%2Froute.ts&appDir=%2Fapp%2Fsaas-core%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp%2Fsaas-core&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/svm/promotions/route.ts":
/*!*********************************************!*\
  !*** ./src/app/api/svm/promotions/route.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/promotions-storage */ \"(rsc)/./src/lib/promotions-storage.ts\");\n/* harmony import */ var decimal_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! decimal.js */ \"(rsc)/./node_modules/decimal.js/decimal.mjs\");\n/**\n * SVM Promotions API\n * \n * POST /api/svm/promotions/validate - Validate coupon code\n * POST /api/svm/promotions/calculate - Calculate discounts for cart\n * GET /api/svm/promotions - List promotions\n * POST /api/svm/promotions - Create promotion\n * \n * IMPORTANT:\n * - Promotions apply ONLY to this module (SVM)\n * - Final payable amount sent to Core\n * - No global pricing mutation\n */ \n\n\n/**\n * POST /api/svm/promotions - Create a new promotion OR validate/calculate\n * \n * For action: 'CREATE' - Create new promotion\n * For action: 'VALIDATE' - Validate coupon code\n * For action: 'CALCULATE' - Calculate discounts for cart\n */ async function POST(request) {\n    try {\n        const body = await request.json();\n        const { tenantId, action } = body;\n        if (!tenantId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"tenantId is required\"\n            }, {\n                status: 400\n            });\n        }\n        switch(action){\n            case \"VALIDATE\":\n                {\n                    // Validate a coupon code\n                    const { code, subtotal, items, customerId, isFirstOrder } = body;\n                    if (!code) {\n                        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                            success: false,\n                            error: \"Coupon code is required\"\n                        }, {\n                            status: 400\n                        });\n                    }\n                    const promotion = await (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.findByCode)(tenantId, code);\n                    if (!promotion) {\n                        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                            success: false,\n                            valid: false,\n                            error: \"Invalid coupon code\",\n                            errorCode: \"NOT_FOUND\"\n                        });\n                    }\n                    const totalQuantity = (items || []).reduce((sum, item)=>sum + item.quantity, 0);\n                    const validation = await (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.validatePromotion)(promotion, subtotal || 0, totalQuantity, customerId, isFirstOrder, []);\n                    if (!validation.valid) {\n                        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                            success: true,\n                            valid: false,\n                            error: validation.error,\n                            errorCode: validation.errorCode\n                        });\n                    }\n                    // Calculate potential discount\n                    const discount = (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.calculateDiscount)(promotion, items || [], subtotal || 0, body.shippingTotal);\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        success: true,\n                        valid: true,\n                        promotion: {\n                            id: promotion.id,\n                            name: promotion.name,\n                            description: promotion.description,\n                            code: promotion.code,\n                            discountType: promotion.discountType,\n                            discountValue: promotion.discountValue\n                        },\n                        potentialDiscount: discount\n                    });\n                }\n            case \"CALCULATE\":\n                {\n                    // Calculate all applicable discounts\n                    const { items, subtotal, shippingTotal, couponCodes, customerId, isFirstOrder } = body;\n                    if (subtotal === undefined) {\n                        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                            success: false,\n                            error: \"subtotal is required\"\n                        }, {\n                            status: 400\n                        });\n                    }\n                    const cartItems = items || [];\n                    const totalQuantity = cartItems.reduce((sum, item)=>sum + item.quantity, 0);\n                    // Get automatic promotions\n                    const autoPromotions = await (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.getAutomaticPromotions)(tenantId);\n                    // Get coupon promotions\n                    const couponPromotionPromises = (couponCodes || []).map((code)=>(0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.findByCode)(tenantId, code));\n                    const couponPromotionsResults = await Promise.all(couponPromotionPromises);\n                    const couponPromotions = couponPromotionsResults.filter((p)=>p !== null);\n                    // Combine and sort by priority\n                    const allPromotions = [\n                        ...autoPromotions,\n                        ...couponPromotions\n                    ].sort((a, b)=>{\n                        if (b.priority !== a.priority) return b.priority - a.priority;\n                        return b.discountValue - a.discountValue;\n                    });\n                    const appliedPromotions = [];\n                    const errors = [];\n                    let discountTotal = new decimal_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"](0);\n                    let shippingDiscount = new decimal_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"](0);\n                    for (const promotion of allPromotions){\n                        const validation = await (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.validatePromotion)(promotion, subtotal, totalQuantity, customerId, isFirstOrder, appliedPromotions);\n                        if (!validation.valid) {\n                            if (promotion.type === \"COUPON\") {\n                                errors.push(`${promotion.code}: ${validation.error}`);\n                            }\n                            continue;\n                        }\n                        // Check product eligibility\n                        const eligibleItems = (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.getEligibleItems)(promotion, cartItems);\n                        if (eligibleItems.length === 0 && promotion.discountType !== \"FREE_SHIPPING\") {\n                            if (promotion.type === \"COUPON\") {\n                                errors.push(`${promotion.code}: No eligible items in your cart`);\n                            }\n                            continue;\n                        }\n                        const applied = (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.calculateDiscount)(promotion, cartItems, subtotal, shippingTotal);\n                        if (applied) {\n                            appliedPromotions.push(applied);\n                            if (applied.freeShipping && shippingTotal) {\n                                shippingDiscount = new decimal_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"](shippingTotal);\n                            } else {\n                                discountTotal = discountTotal.plus(applied.discountAmount);\n                            }\n                            if (!promotion.stackable) {\n                                break;\n                            }\n                        }\n                    }\n                    // Don't exceed subtotal\n                    if (discountTotal.greaterThan(subtotal)) {\n                        discountTotal = new decimal_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"](subtotal);\n                    }\n                    const finalSubtotal = new decimal_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"](subtotal).minus(discountTotal).toDecimalPlaces(2).toNumber();\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        success: true,\n                        appliedPromotions,\n                        subtotal,\n                        discountTotal: discountTotal.toDecimalPlaces(2).toNumber(),\n                        shippingDiscount: shippingDiscount.toDecimalPlaces(2).toNumber(),\n                        finalSubtotal,\n                        shippingTotal: shippingTotal ? new decimal_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"](shippingTotal).minus(shippingDiscount).toNumber() : undefined,\n                        errors: errors.length > 0 ? errors : undefined\n                    });\n                }\n            case \"CREATE\":\n            default:\n                {\n                    // Create a new promotion\n                    const { name, description, code, type, discountType, discountValue, maxDiscount, minOrderTotal, minQuantity, productIds, categoryIds, excludeProductIds, customerIds, firstOrderOnly, usageLimit, perCustomerLimit, startsAt, endsAt, stackable, priority, buyQuantity, getQuantity, getDiscountPercent } = body;\n                    if (!name || !discountType) {\n                        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                            success: false,\n                            error: \"name and discountType are required\"\n                        }, {\n                            status: 400\n                        });\n                    }\n                    // Check for duplicate code\n                    if (code) {\n                        const existing = await (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.findByCode)(tenantId, code);\n                        if (existing) {\n                            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                                success: false,\n                                error: \"A promotion with this code already exists\"\n                            }, {\n                                status: 400\n                            });\n                        }\n                    }\n                    const newPromotion = {\n                        id: (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.generateId)(\"promo\"),\n                        tenantId,\n                        name,\n                        description,\n                        code: code?.toUpperCase(),\n                        type: type || (code ? \"COUPON\" : \"AUTOMATIC\"),\n                        discountType,\n                        discountValue: discountValue || 0,\n                        maxDiscount,\n                        minOrderTotal,\n                        minQuantity,\n                        productIds: productIds || [],\n                        categoryIds: categoryIds || [],\n                        excludeProductIds: excludeProductIds || [],\n                        customerIds: customerIds || [],\n                        firstOrderOnly: firstOrderOnly || false,\n                        usageLimit,\n                        usageCount: 0,\n                        perCustomerLimit,\n                        startsAt: startsAt ? new Date(startsAt) : new Date(),\n                        endsAt: endsAt ? new Date(endsAt) : undefined,\n                        isActive: true,\n                        stackable: stackable || false,\n                        priority: priority || 0,\n                        buyQuantity,\n                        getQuantity,\n                        getDiscountPercent,\n                        createdAt: new Date().toISOString(),\n                        updatedAt: new Date().toISOString()\n                    };\n                    await (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.addPromotion)(newPromotion);\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        success: true,\n                        promotion: newPromotion\n                    }, {\n                        status: 201\n                    });\n                }\n        }\n    } catch (error) {\n        console.error(\"[SVM] Error processing promotions request:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: error instanceof Error ? error.message : \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\n/**\n * GET /api/svm/promotions - List promotions\n */ async function GET(request) {\n    try {\n        const { searchParams } = new URL(request.url);\n        const tenantId = searchParams.get(\"tenantId\");\n        const activeOnly = searchParams.get(\"activeOnly\") === \"true\";\n        const type = searchParams.get(\"type\");\n        if (!tenantId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"tenantId is required\"\n            }, {\n                status: 400\n            });\n        }\n        let promotions = activeOnly ? await (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.getActivePromotions)(tenantId) : await (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.getPromotions)(tenantId);\n        if (type) {\n            promotions = promotions.filter((p)=>p.type === type);\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            promotions: promotions.map((p)=>({\n                    id: p.id,\n                    name: p.name,\n                    description: p.description,\n                    code: p.code,\n                    type: p.type,\n                    discountType: p.discountType,\n                    discountValue: p.discountValue,\n                    maxDiscount: p.maxDiscount,\n                    minOrderTotal: p.minOrderTotal,\n                    minQuantity: p.minQuantity,\n                    firstOrderOnly: p.firstOrderOnly,\n                    usageLimit: p.usageLimit,\n                    usageCount: p.usageCount,\n                    perCustomerLimit: p.perCustomerLimit,\n                    startsAt: p.startsAt,\n                    endsAt: p.endsAt,\n                    isActive: p.isActive,\n                    stackable: p.stackable,\n                    priority: p.priority,\n                    // BUY_X_GET_Y specific\n                    buyQuantity: p.buyQuantity,\n                    getQuantity: p.getQuantity,\n                    getDiscountPercent: p.getDiscountPercent,\n                    // Formatted display\n                    displayValue: formatDiscountDisplay(p)\n                })),\n            total: promotions.length,\n            activeCount: promotions.filter((p)=>p.isActive).length\n        });\n    } catch (error) {\n        console.error(\"[SVM] Error listing promotions:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\nfunction formatDiscountDisplay(p) {\n    switch(p.discountType){\n        case \"PERCENTAGE\":\n            return `${p.discountValue}% off${p.maxDiscount ? ` (max $${p.maxDiscount})` : \"\"}`;\n        case \"FIXED_AMOUNT\":\n            return `$${p.discountValue.toFixed(2)} off`;\n        case \"FIXED_PER_ITEM\":\n            return `$${p.discountValue.toFixed(2)} off per item`;\n        case \"FREE_SHIPPING\":\n            return \"Free shipping\";\n        case \"BUY_X_GET_Y\":\n            const getDesc = p.getDiscountPercent === 100 ? \"free\" : `${p.getDiscountPercent}% off`;\n            return `Buy ${p.buyQuantity} get ${p.getQuantity} ${getDesc}`;\n        default:\n            return \"\";\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9zdm0vcHJvbW90aW9ucy9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOzs7Ozs7Ozs7Ozs7Q0FZQyxHQUVzRDtBQWN0QjtBQUNEO0FBRWhDOzs7Ozs7Q0FNQyxHQUNNLGVBQWVXLEtBQUtDLE9BQW9CO0lBQzdDLElBQUk7UUFDRixNQUFNQyxPQUFPLE1BQU1ELFFBQVFFLElBQUk7UUFDL0IsTUFBTSxFQUFFQyxRQUFRLEVBQUVDLE1BQU0sRUFBRSxHQUFHSDtRQUU3QixJQUFJLENBQUNFLFVBQVU7WUFDYixPQUFPZixxREFBWUEsQ0FBQ2MsSUFBSSxDQUN0QjtnQkFBRUcsU0FBUztnQkFBT0MsT0FBTztZQUF1QixHQUNoRDtnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsT0FBUUg7WUFDTixLQUFLO2dCQUFZO29CQUNmLHlCQUF5QjtvQkFDekIsTUFBTSxFQUFFSSxJQUFJLEVBQUVDLFFBQVEsRUFBRUMsS0FBSyxFQUFFQyxVQUFVLEVBQUVDLFlBQVksRUFBRSxHQUFHWDtvQkFFNUQsSUFBSSxDQUFDTyxNQUFNO3dCQUNULE9BQU9wQixxREFBWUEsQ0FBQ2MsSUFBSSxDQUN0Qjs0QkFBRUcsU0FBUzs0QkFBT0MsT0FBTzt3QkFBMEIsR0FDbkQ7NEJBQUVDLFFBQVE7d0JBQUk7b0JBRWxCO29CQUVBLE1BQU1NLFlBQVksTUFBTXJCLG1FQUFVQSxDQUFDVyxVQUFVSztvQkFFN0MsSUFBSSxDQUFDSyxXQUFXO3dCQUNkLE9BQU96QixxREFBWUEsQ0FBQ2MsSUFBSSxDQUFDOzRCQUN2QkcsU0FBUzs0QkFDVFMsT0FBTzs0QkFDUFIsT0FBTzs0QkFDUFMsV0FBVzt3QkFDYjtvQkFDRjtvQkFFQSxNQUFNQyxnQkFBZ0IsQ0FBQ04sU0FBUyxFQUFFLEVBQUVPLE1BQU0sQ0FDeEMsQ0FBQ0MsS0FBYUMsT0FBNEJELE1BQU1DLEtBQUtDLFFBQVEsRUFBRTtvQkFHakUsTUFBTUMsYUFBYSxNQUFNM0IsMEVBQWlCQSxDQUN4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b0MsV0FBVyxDQUFDLEtBQUssRUFBRXBDLEVBQUVxQyxXQUFXLENBQUMsQ0FBQyxFQUFFMEIsUUFBUSxDQUFDO1FBQy9EO1lBQ0UsT0FBTztJQUNYO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zYWFzLWNvcmUvLi9zcmMvYXBwL2FwaS9zdm0vcHJvbW90aW9ucy9yb3V0ZS50cz81YTZmIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU1ZNIFByb21vdGlvbnMgQVBJXG4gKiBcbiAqIFBPU1QgL2FwaS9zdm0vcHJvbW90aW9ucy92YWxpZGF0ZSAtIFZhbGlkYXRlIGNvdXBvbiBjb2RlXG4gKiBQT1NUIC9hcGkvc3ZtL3Byb21vdGlvbnMvY2FsY3VsYXRlIC0gQ2FsY3VsYXRlIGRpc2NvdW50cyBmb3IgY2FydFxuICogR0VUIC9hcGkvc3ZtL3Byb21vdGlvbnMgLSBMaXN0IHByb21vdGlvbnNcbiAqIFBPU1QgL2FwaS9zdm0vcHJvbW90aW9ucyAtIENyZWF0ZSBwcm9tb3Rpb25cbiAqIFxuICogSU1QT1JUQU5UOlxuICogLSBQcm9tb3Rpb25zIGFwcGx5IE9OTFkgdG8gdGhpcyBtb2R1bGUgKFNWTSlcbiAqIC0gRmluYWwgcGF5YWJsZSBhbW91bnQgc2VudCB0byBDb3JlXG4gKiAtIE5vIGdsb2JhbCBwcmljaW5nIG11dGF0aW9uXG4gKi9cblxuaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xuaW1wb3J0IHtcbiAgZ2V0UHJvbW90aW9ucyxcbiAgZ2V0QWN0aXZlUHJvbW90aW9ucyxcbiAgZ2V0QXV0b21hdGljUHJvbW90aW9ucyxcbiAgZmluZEJ5Q29kZSxcbiAgYWRkUHJvbW90aW9uLFxuICB2YWxpZGF0ZVByb21vdGlvbixcbiAgZ2V0RWxpZ2libGVJdGVtcyxcbiAgY2FsY3VsYXRlRGlzY291bnQsXG4gIGdlbmVyYXRlSWQsXG4gIHR5cGUgUHJvbW90aW9uLFxuICB0eXBlIFByb21vdGlvbkNhcnRJdGVtLFxuICB0eXBlIEFwcGxpZWRQcm9tb3Rpb25cbn0gZnJvbSAnQC9saWIvcHJvbW90aW9ucy1zdG9yYWdlJ1xuaW1wb3J0IERlY2ltYWwgZnJvbSAnZGVjaW1hbC5qcydcblxuLyoqXG4gKiBQT1NUIC9hcGkvc3ZtL3Byb21vdGlvbnMgLSBDcmVhdGUgYSBuZXcgcHJvbW90aW9uIE9SIHZhbGlkYXRlL2NhbGN1bGF0ZVxuICogXG4gKiBGb3IgYWN0aW9uOiAnQ1JFQVRFJyAtIENyZWF0ZSBuZXcgcHJvbW90aW9uXG4gKiBGb3IgYWN0aW9uOiAnVkFMSURBVEUnIC0gVmFsaWRhdGUgY291cG9uIGNvZGVcbiAqIEZvciBhY3Rpb246ICdDQUxDVUxBVEUnIC0gQ2FsY3VsYXRlIGRpc2NvdW50cyBmb3IgY2FydFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKVxuICAgIGNvbnN0IHsgdGVuYW50SWQsIGFjdGlvbiB9ID0gYm9keVxuICAgIFxuICAgIGlmICghdGVuYW50SWQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICd0ZW5hbnRJZCBpcyByZXF1aXJlZCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuICAgIFxuICAgIHN3aXRjaCAoYWN0aW9uKSB7XG4gICAgICBjYXNlICdWQUxJREFURSc6IHtcbiAgICAgICAgLy8gVmFsaWRhdGUgYSBjb3Vwb24gY29kZVxuICAgICAgICBjb25zdCB7IGNvZGUsIHN1YnRvdGFsLCBpdGVtcywgY3VzdG9tZXJJZCwgaXNGaXJzdE9yZGVyIH0gPSBib2R5XG4gICAgICAgIFxuICAgICAgICBpZiAoIWNvZGUpIHtcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0NvdXBvbiBjb2RlIGlzIHJlcXVpcmVkJyB9LFxuICAgICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICAgKVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCBwcm9tb3Rpb24gPSBhd2FpdCBmaW5kQnlDb2RlKHRlbmFudElkLCBjb2RlKVxuICAgICAgICBcbiAgICAgICAgaWYgKCFwcm9tb3Rpb24pIHtcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgICBlcnJvcjogJ0ludmFsaWQgY291cG9uIGNvZGUnLFxuICAgICAgICAgICAgZXJyb3JDb2RlOiAnTk9UX0ZPVU5EJ1xuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHRvdGFsUXVhbnRpdHkgPSAoaXRlbXMgfHwgW10pLnJlZHVjZShcbiAgICAgICAgICAoc3VtOiBudW1iZXIsIGl0ZW06IFByb21vdGlvbkNhcnRJdGVtKSA9PiBzdW0gKyBpdGVtLnF1YW50aXR5LCAwXG4gICAgICAgIClcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSBhd2FpdCB2YWxpZGF0ZVByb21vdGlvbihcbiAgICAgICAgICBwcm9tb3Rpb24sXG4gICAgICAgICAgc3VidG90YWwgfHwgMCxcbiAgICAgICAgICB0b3RhbFF1YW50aXR5LFxuICAgICAgICAgIGN1c3RvbWVySWQsXG4gICAgICAgICAgaXNGaXJzdE9yZGVyLFxuICAgICAgICAgIFtdXG4gICAgICAgIClcbiAgICAgICAgXG4gICAgICAgIGlmICghdmFsaWRhdGlvbi52YWxpZCkge1xuICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgZXJyb3I6IHZhbGlkYXRpb24uZXJyb3IsXG4gICAgICAgICAgICBlcnJvckNvZGU6IHZhbGlkYXRpb24uZXJyb3JDb2RlXG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gQ2FsY3VsYXRlIHBvdGVudGlhbCBkaXNjb3VudFxuICAgICAgICBjb25zdCBkaXNjb3VudCA9IGNhbGN1bGF0ZURpc2NvdW50KFxuICAgICAgICAgIHByb21vdGlvbixcbiAgICAgICAgICBpdGVtcyB8fCBbXSxcbiAgICAgICAgICBzdWJ0b3RhbCB8fCAwLFxuICAgICAgICAgIGJvZHkuc2hpcHBpbmdUb3RhbFxuICAgICAgICApXG4gICAgICAgIFxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgdmFsaWQ6IHRydWUsXG4gICAgICAgICAgcHJvbW90aW9uOiB7XG4gICAgICAgICAgICBpZDogcHJvbW90aW9uLmlkLFxuICAgICAgICAgICAgbmFtZTogcHJvbW90aW9uLm5hbWUsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogcHJvbW90aW9uLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgY29kZTogcHJvbW90aW9uLmNvZGUsXG4gICAgICAgICAgICBkaXNjb3VudFR5cGU6IHByb21vdGlvbi5kaXNjb3VudFR5cGUsXG4gICAgICAgICAgICBkaXNjb3VudFZhbHVlOiBwcm9tb3Rpb24uZGlzY291bnRWYWx1ZVxuICAgICAgICAgIH0sXG4gICAgICAgICAgcG90ZW50aWFsRGlzY291bnQ6IGRpc2NvdW50XG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgICBcbiAgICAgIGNhc2UgJ0NBTENVTEFURSc6IHtcbiAgICAgICAgLy8gQ2FsY3VsYXRlIGFsbCBhcHBsaWNhYmxlIGRpc2NvdW50c1xuICAgICAgICBjb25zdCB7IGl0ZW1zLCBzdWJ0b3RhbCwgc2hpcHBpbmdUb3RhbCwgY291cG9uQ29kZXMsIGN1c3RvbWVySWQsIGlzRmlyc3RPcmRlciB9ID0gYm9keVxuICAgICAgICBcbiAgICAgICAgaWYgKHN1YnRvdGFsID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ3N1YnRvdGFsIGlzIHJlcXVpcmVkJyB9LFxuICAgICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICAgKVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCBjYXJ0SXRlbXM6IFByb21vdGlvbkNhcnRJdGVtW10gPSBpdGVtcyB8fCBbXVxuICAgICAgICBjb25zdCB0b3RhbFF1YW50aXR5ID0gY2FydEl0ZW1zLnJlZHVjZSgoc3VtLCBpdGVtKSA9PiBzdW0gKyBpdGVtLnF1YW50aXR5LCAwKVxuICAgICAgICBcbiAgICAgICAgLy8gR2V0IGF1dG9tYXRpYyBwcm9tb3Rpb25zXG4gICAgICAgIGNvbnN0IGF1dG9Qcm9tb3Rpb25zID0gYXdhaXQgZ2V0QXV0b21hdGljUHJvbW90aW9ucyh0ZW5hbnRJZClcbiAgICAgICAgXG4gICAgICAgIC8vIEdldCBjb3Vwb24gcHJvbW90aW9uc1xuICAgICAgICBjb25zdCBjb3Vwb25Qcm9tb3Rpb25Qcm9taXNlcyA9IChjb3Vwb25Db2RlcyB8fCBbXSkubWFwKChjb2RlOiBzdHJpbmcpID0+IGZpbmRCeUNvZGUodGVuYW50SWQsIGNvZGUpKVxuICAgICAgICBjb25zdCBjb3Vwb25Qcm9tb3Rpb25zUmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKGNvdXBvblByb21vdGlvblByb21pc2VzKVxuICAgICAgICBjb25zdCBjb3Vwb25Qcm9tb3Rpb25zOiBQcm9tb3Rpb25bXSA9IGNvdXBvblByb21vdGlvbnNSZXN1bHRzLmZpbHRlcigocCk6IHAgaXMgUHJvbW90aW9uID0+IHAgIT09IG51bGwpXG4gICAgICAgIFxuICAgICAgICAvLyBDb21iaW5lIGFuZCBzb3J0IGJ5IHByaW9yaXR5XG4gICAgICAgIGNvbnN0IGFsbFByb21vdGlvbnMgPSBbLi4uYXV0b1Byb21vdGlvbnMsIC4uLmNvdXBvblByb21vdGlvbnNdXG4gICAgICAgICAgLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgIGlmIChiLnByaW9yaXR5ICE9PSBhLnByaW9yaXR5KSByZXR1cm4gYi5wcmlvcml0eSAtIGEucHJpb3JpdHlcbiAgICAgICAgICAgIHJldHVybiBiLmRpc2NvdW50VmFsdWUgLSBhLmRpc2NvdW50VmFsdWVcbiAgICAgICAgICB9KVxuICAgICAgICBcbiAgICAgICAgY29uc3QgYXBwbGllZFByb21vdGlvbnM6IEFwcGxpZWRQcm9tb3Rpb25bXSA9IFtdXG4gICAgICAgIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXVxuICAgICAgICBsZXQgZGlzY291bnRUb3RhbCA9IG5ldyBEZWNpbWFsKDApXG4gICAgICAgIGxldCBzaGlwcGluZ0Rpc2NvdW50ID0gbmV3IERlY2ltYWwoMClcbiAgICAgICAgXG4gICAgICAgIGZvciAoY29uc3QgcHJvbW90aW9uIG9mIGFsbFByb21vdGlvbnMpIHtcbiAgICAgICAgICBjb25zdCB2YWxpZGF0aW9uID0gYXdhaXQgdmFsaWRhdGVQcm9tb3Rpb24oXG4gICAgICAgICAgICBwcm9tb3Rpb24sXG4gICAgICAgICAgICBzdWJ0b3RhbCxcbiAgICAgICAgICAgIHRvdGFsUXVhbnRpdHksXG4gICAgICAgICAgICBjdXN0b21lcklkLFxuICAgICAgICAgICAgaXNGaXJzdE9yZGVyLFxuICAgICAgICAgICAgYXBwbGllZFByb21vdGlvbnNcbiAgICAgICAgICApXG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKCF2YWxpZGF0aW9uLnZhbGlkKSB7XG4gICAgICAgICAgICBpZiAocHJvbW90aW9uLnR5cGUgPT09ICdDT1VQT04nKSB7XG4gICAgICAgICAgICAgIGVycm9ycy5wdXNoKGAke3Byb21vdGlvbi5jb2RlfTogJHt2YWxpZGF0aW9uLmVycm9yfWApXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb250aW51ZVxuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBDaGVjayBwcm9kdWN0IGVsaWdpYmlsaXR5XG4gICAgICAgICAgY29uc3QgZWxpZ2libGVJdGVtcyA9IGdldEVsaWdpYmxlSXRlbXMocHJvbW90aW9uLCBjYXJ0SXRlbXMpXG4gICAgICAgICAgaWYgKGVsaWdpYmxlSXRlbXMubGVuZ3RoID09PSAwICYmIHByb21vdGlvbi5kaXNjb3VudFR5cGUgIT09ICdGUkVFX1NISVBQSU5HJykge1xuICAgICAgICAgICAgaWYgKHByb21vdGlvbi50eXBlID09PSAnQ09VUE9OJykge1xuICAgICAgICAgICAgICBlcnJvcnMucHVzaChgJHtwcm9tb3Rpb24uY29kZX06IE5vIGVsaWdpYmxlIGl0ZW1zIGluIHlvdXIgY2FydGApXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb250aW51ZVxuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICBjb25zdCBhcHBsaWVkID0gY2FsY3VsYXRlRGlzY291bnQocHJvbW90aW9uLCBjYXJ0SXRlbXMsIHN1YnRvdGFsLCBzaGlwcGluZ1RvdGFsKVxuICAgICAgICAgIFxuICAgICAgICAgIGlmIChhcHBsaWVkKSB7XG4gICAgICAgICAgICBhcHBsaWVkUHJvbW90aW9ucy5wdXNoKGFwcGxpZWQpXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChhcHBsaWVkLmZyZWVTaGlwcGluZyAmJiBzaGlwcGluZ1RvdGFsKSB7XG4gICAgICAgICAgICAgIHNoaXBwaW5nRGlzY291bnQgPSBuZXcgRGVjaW1hbChzaGlwcGluZ1RvdGFsKVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZGlzY291bnRUb3RhbCA9IGRpc2NvdW50VG90YWwucGx1cyhhcHBsaWVkLmRpc2NvdW50QW1vdW50KVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoIXByb21vdGlvbi5zdGFja2FibGUpIHtcbiAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIERvbid0IGV4Y2VlZCBzdWJ0b3RhbFxuICAgICAgICBpZiAoZGlzY291bnRUb3RhbC5ncmVhdGVyVGhhbihzdWJ0b3RhbCkpIHtcbiAgICAgICAgICBkaXNjb3VudFRvdGFsID0gbmV3IERlY2ltYWwoc3VidG90YWwpXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGZpbmFsU3VidG90YWwgPSBuZXcgRGVjaW1hbChzdWJ0b3RhbClcbiAgICAgICAgICAubWludXMoZGlzY291bnRUb3RhbClcbiAgICAgICAgICAudG9EZWNpbWFsUGxhY2VzKDIpXG4gICAgICAgICAgLnRvTnVtYmVyKClcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICBhcHBsaWVkUHJvbW90aW9ucyxcbiAgICAgICAgICBzdWJ0b3RhbCxcbiAgICAgICAgICBkaXNjb3VudFRvdGFsOiBkaXNjb3VudFRvdGFsLnRvRGVjaW1hbFBsYWNlcygyKS50b051bWJlcigpLFxuICAgICAgICAgIHNoaXBwaW5nRGlzY291bnQ6IHNoaXBwaW5nRGlzY291bnQudG9EZWNpbWFsUGxhY2VzKDIpLnRvTnVtYmVyKCksXG4gICAgICAgICAgZmluYWxTdWJ0b3RhbCxcbiAgICAgICAgICBzaGlwcGluZ1RvdGFsOiBzaGlwcGluZ1RvdGFsID8gXG4gICAgICAgICAgICBuZXcgRGVjaW1hbChzaGlwcGluZ1RvdGFsKS5taW51cyhzaGlwcGluZ0Rpc2NvdW50KS50b051bWJlcigpIDogXG4gICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgZXJyb3JzOiBlcnJvcnMubGVuZ3RoID4gMCA/IGVycm9ycyA6IHVuZGVmaW5lZFxuICAgICAgICB9KVxuICAgICAgfVxuICAgICAgXG4gICAgICBjYXNlICdDUkVBVEUnOlxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICAvLyBDcmVhdGUgYSBuZXcgcHJvbW90aW9uXG4gICAgICAgIGNvbnN0IHsgbmFtZSwgZGVzY3JpcHRpb24sIGNvZGUsIHR5cGUsIGRpc2NvdW50VHlwZSwgZGlzY291bnRWYWx1ZSwgbWF4RGlzY291bnQsXG4gICAgICAgICAgbWluT3JkZXJUb3RhbCwgbWluUXVhbnRpdHksIHByb2R1Y3RJZHMsIGNhdGVnb3J5SWRzLCBleGNsdWRlUHJvZHVjdElkcyxcbiAgICAgICAgICBjdXN0b21lcklkcywgZmlyc3RPcmRlck9ubHksIHVzYWdlTGltaXQsIHBlckN1c3RvbWVyTGltaXQsIHN0YXJ0c0F0LCBlbmRzQXQsXG4gICAgICAgICAgc3RhY2thYmxlLCBwcmlvcml0eSwgYnV5UXVhbnRpdHksIGdldFF1YW50aXR5LCBnZXREaXNjb3VudFBlcmNlbnQgfSA9IGJvZHlcbiAgICAgICAgXG4gICAgICAgIGlmICghbmFtZSB8fCAhZGlzY291bnRUeXBlKSB7XG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICduYW1lIGFuZCBkaXNjb3VudFR5cGUgYXJlIHJlcXVpcmVkJyB9LFxuICAgICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICAgKVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBDaGVjayBmb3IgZHVwbGljYXRlIGNvZGVcbiAgICAgICAgaWYgKGNvZGUpIHtcbiAgICAgICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IGZpbmRCeUNvZGUodGVuYW50SWQsIGNvZGUpXG4gICAgICAgICAgaWYgKGV4aXN0aW5nKSB7XG4gICAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQSBwcm9tb3Rpb24gd2l0aCB0aGlzIGNvZGUgYWxyZWFkeSBleGlzdHMnIH0sXG4gICAgICAgICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgICAgICAgKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgbmV3UHJvbW90aW9uOiBQcm9tb3Rpb24gPSB7XG4gICAgICAgICAgaWQ6IGdlbmVyYXRlSWQoJ3Byb21vJyksXG4gICAgICAgICAgdGVuYW50SWQsXG4gICAgICAgICAgbmFtZSxcbiAgICAgICAgICBkZXNjcmlwdGlvbixcbiAgICAgICAgICBjb2RlOiBjb2RlPy50b1VwcGVyQ2FzZSgpLFxuICAgICAgICAgIHR5cGU6IHR5cGUgfHwgKGNvZGUgPyAnQ09VUE9OJyA6ICdBVVRPTUFUSUMnKSxcbiAgICAgICAgICBkaXNjb3VudFR5cGUsXG4gICAgICAgICAgZGlzY291bnRWYWx1ZTogZGlzY291bnRWYWx1ZSB8fCAwLFxuICAgICAgICAgIG1heERpc2NvdW50LFxuICAgICAgICAgIG1pbk9yZGVyVG90YWwsXG4gICAgICAgICAgbWluUXVhbnRpdHksXG4gICAgICAgICAgcHJvZHVjdElkczogcHJvZHVjdElkcyB8fCBbXSxcbiAgICAgICAgICBjYXRlZ29yeUlkczogY2F0ZWdvcnlJZHMgfHwgW10sXG4gICAgICAgICAgZXhjbHVkZVByb2R1Y3RJZHM6IGV4Y2x1ZGVQcm9kdWN0SWRzIHx8IFtdLFxuICAgICAgICAgIGN1c3RvbWVySWRzOiBjdXN0b21lcklkcyB8fCBbXSxcbiAgICAgICAgICBmaXJzdE9yZGVyT25seTogZmlyc3RPcmRlck9ubHkgfHwgZmFsc2UsXG4gICAgICAgICAgdXNhZ2VMaW1pdCxcbiAgICAgICAgICB1c2FnZUNvdW50OiAwLFxuICAgICAgICAgIHBlckN1c3RvbWVyTGltaXQsXG4gICAgICAgICAgc3RhcnRzQXQ6IHN0YXJ0c0F0ID8gbmV3IERhdGUoc3RhcnRzQXQpIDogbmV3IERhdGUoKSxcbiAgICAgICAgICBlbmRzQXQ6IGVuZHNBdCA/IG5ldyBEYXRlKGVuZHNBdCkgOiB1bmRlZmluZWQsXG4gICAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgICAgc3RhY2thYmxlOiBzdGFja2FibGUgfHwgZmFsc2UsXG4gICAgICAgICAgcHJpb3JpdHk6IHByaW9yaXR5IHx8IDAsXG4gICAgICAgICAgYnV5UXVhbnRpdHksXG4gICAgICAgICAgZ2V0UXVhbnRpdHksXG4gICAgICAgICAgZ2V0RGlzY291bnRQZXJjZW50LFxuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGF3YWl0IGFkZFByb21vdGlvbihuZXdQcm9tb3Rpb24pXG4gICAgICAgIFxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgcHJvbW90aW9uOiBuZXdQcm9tb3Rpb25cbiAgICAgICAgfSwgeyBzdGF0dXM6IDIwMSB9KVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbU1ZNXSBFcnJvciBwcm9jZXNzaW5nIHByb21vdGlvbnMgcmVxdWVzdDonLCBlcnJvcilcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKVxuICB9XG59XG5cbi8qKlxuICogR0VUIC9hcGkvc3ZtL3Byb21vdGlvbnMgLSBMaXN0IHByb21vdGlvbnNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKVxuICAgIGNvbnN0IHRlbmFudElkID0gc2VhcmNoUGFyYW1zLmdldCgndGVuYW50SWQnKVxuICAgIGNvbnN0IGFjdGl2ZU9ubHkgPSBzZWFyY2hQYXJhbXMuZ2V0KCdhY3RpdmVPbmx5JykgPT09ICd0cnVlJ1xuICAgIGNvbnN0IHR5cGUgPSBzZWFyY2hQYXJhbXMuZ2V0KCd0eXBlJykgYXMgJ0NPVVBPTicgfCAnQVVUT01BVElDJyB8ICdGTEFTSF9TQUxFJyB8IG51bGxcbiAgICBcbiAgICBpZiAoIXRlbmFudElkKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAndGVuYW50SWQgaXMgcmVxdWlyZWQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cbiAgICBcbiAgICBsZXQgcHJvbW90aW9ucyA9IGFjdGl2ZU9ubHkgPyBhd2FpdCBnZXRBY3RpdmVQcm9tb3Rpb25zKHRlbmFudElkKSA6IGF3YWl0IGdldFByb21vdGlvbnModGVuYW50SWQpXG4gICAgXG4gICAgaWYgKHR5cGUpIHtcbiAgICAgIHByb21vdGlvbnMgPSBwcm9tb3Rpb25zLmZpbHRlcihwID0+IHAudHlwZSA9PT0gdHlwZSlcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBwcm9tb3Rpb25zOiBwcm9tb3Rpb25zLm1hcChwID0+ICh7XG4gICAgICAgIGlkOiBwLmlkLFxuICAgICAgICBuYW1lOiBwLm5hbWUsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBwLmRlc2NyaXB0aW9uLFxuICAgICAgICBjb2RlOiBwLmNvZGUsXG4gICAgICAgIHR5cGU6IHAudHlwZSxcbiAgICAgICAgZGlzY291bnRUeXBlOiBwLmRpc2NvdW50VHlwZSxcbiAgICAgICAgZGlzY291bnRWYWx1ZTogcC5kaXNjb3VudFZhbHVlLFxuICAgICAgICBtYXhEaXNjb3VudDogcC5tYXhEaXNjb3VudCxcbiAgICAgICAgbWluT3JkZXJUb3RhbDogcC5taW5PcmRlclRvdGFsLFxuICAgICAgICBtaW5RdWFudGl0eTogcC5taW5RdWFudGl0eSxcbiAgICAgICAgZmlyc3RPcmRlck9ubHk6IHAuZmlyc3RPcmRlck9ubHksXG4gICAgICAgIHVzYWdlTGltaXQ6IHAudXNhZ2VMaW1pdCxcbiAgICAgICAgdXNhZ2VDb3VudDogcC51c2FnZUNvdW50LFxuICAgICAgICBwZXJDdXN0b21lckxpbWl0OiBwLnBlckN1c3RvbWVyTGltaXQsXG4gICAgICAgIHN0YXJ0c0F0OiBwLnN0YXJ0c0F0LFxuICAgICAgICBlbmRzQXQ6IHAuZW5kc0F0LFxuICAgICAgICBpc0FjdGl2ZTogcC5pc0FjdGl2ZSxcbiAgICAgICAgc3RhY2thYmxlOiBwLnN0YWNrYWJsZSxcbiAgICAgICAgcHJpb3JpdHk6IHAucHJpb3JpdHksXG4gICAgICAgIC8vIEJVWV9YX0dFVF9ZIHNwZWNpZmljXG4gICAgICAgIGJ1eVF1YW50aXR5OiBwLmJ1eVF1YW50aXR5LFxuICAgICAgICBnZXRRdWFudGl0eTogcC5nZXRRdWFudGl0eSxcbiAgICAgICAgZ2V0RGlzY291bnRQZXJjZW50OiBwLmdldERpc2NvdW50UGVyY2VudCxcbiAgICAgICAgLy8gRm9ybWF0dGVkIGRpc3BsYXlcbiAgICAgICAgZGlzcGxheVZhbHVlOiBmb3JtYXREaXNjb3VudERpc3BsYXkocClcbiAgICAgIH0pKSxcbiAgICAgIHRvdGFsOiBwcm9tb3Rpb25zLmxlbmd0aCxcbiAgICAgIGFjdGl2ZUNvdW50OiBwcm9tb3Rpb25zLmZpbHRlcihwID0+IHAuaXNBY3RpdmUpLmxlbmd0aFxuICAgIH0pXG4gICAgXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1NWTV0gRXJyb3IgbGlzdGluZyBwcm9tb3Rpb25zOicsIGVycm9yKVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKVxuICB9XG59XG5cbmZ1bmN0aW9uIGZvcm1hdERpc2NvdW50RGlzcGxheShwOiBQcm9tb3Rpb24pOiBzdHJpbmcge1xuICBzd2l0Y2ggKHAuZGlzY291bnRUeXBlKSB7XG4gICAgY2FzZSAnUEVSQ0VOVEFHRSc6XG4gICAgICByZXR1cm4gYCR7cC5kaXNjb3VudFZhbHVlfSUgb2ZmJHtwLm1heERpc2NvdW50ID8gYCAobWF4ICQke3AubWF4RGlzY291bnR9KWAgOiAnJ31gXG4gICAgY2FzZSAnRklYRURfQU1PVU5UJzpcbiAgICAgIHJldHVybiBgJCR7cC5kaXNjb3VudFZhbHVlLnRvRml4ZWQoMil9IG9mZmBcbiAgICBjYXNlICdGSVhFRF9QRVJfSVRFTSc6XG4gICAgICByZXR1cm4gYCQke3AuZGlzY291bnRWYWx1ZS50b0ZpeGVkKDIpfSBvZmYgcGVyIGl0ZW1gXG4gICAgY2FzZSAnRlJFRV9TSElQUElORyc6XG4gICAgICByZXR1cm4gJ0ZyZWUgc2hpcHBpbmcnXG4gICAgY2FzZSAnQlVZX1hfR0VUX1knOlxuICAgICAgY29uc3QgZ2V0RGVzYyA9IHAuZ2V0RGlzY291bnRQZXJjZW50ID09PSAxMDAgPyAnZnJlZScgOiBgJHtwLmdldERpc2NvdW50UGVyY2VudH0lIG9mZmBcbiAgICAgIHJldHVybiBgQnV5ICR7cC5idXlRdWFudGl0eX0gZ2V0ICR7cC5nZXRRdWFudGl0eX0gJHtnZXREZXNjfWBcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuICcnXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJnZXRQcm9tb3Rpb25zIiwiZ2V0QWN0aXZlUHJvbW90aW9ucyIsImdldEF1dG9tYXRpY1Byb21vdGlvbnMiLCJmaW5kQnlDb2RlIiwiYWRkUHJvbW90aW9uIiwidmFsaWRhdGVQcm9tb3Rpb24iLCJnZXRFbGlnaWJsZUl0ZW1zIiwiY2FsY3VsYXRlRGlzY291bnQiLCJnZW5lcmF0ZUlkIiwiRGVjaW1hbCIsIlBPU1QiLCJyZXF1ZXN0IiwiYm9keSIsImpzb24iLCJ0ZW5hbnRJZCIsImFjdGlvbiIsInN1Y2Nlc3MiLCJlcnJvciIsInN0YXR1cyIsImNvZGUiLCJzdWJ0b3RhbCIsIml0ZW1zIiwiY3VzdG9tZXJJZCIsImlzRmlyc3RPcmRlciIsInByb21vdGlvbiIsInZhbGlkIiwiZXJyb3JDb2RlIiwidG90YWxRdWFudGl0eSIsInJlZHVjZSIsInN1bSIsIml0ZW0iLCJxdWFudGl0eSIsInZhbGlkYXRpb24iLCJkaXNjb3VudCIsInNoaXBwaW5nVG90YWwiLCJpZCIsIm5hbWUiLCJkZXNjcmlwdGlvbiIsImRpc2NvdW50VHlwZSIsImRpc2NvdW50VmFsdWUiLCJwb3RlbnRpYWxEaXNjb3VudCIsImNvdXBvbkNvZGVzIiwidW5kZWZpbmVkIiwiY2FydEl0ZW1zIiwiYXV0b1Byb21vdGlvbnMiLCJjb3Vwb25Qcm9tb3Rpb25Qcm9taXNlcyIsIm1hcCIsImNvdXBvblByb21vdGlvbnNSZXN1bHRzIiwiUHJvbWlzZSIsImFsbCIsImNvdXBvblByb21vdGlvbnMiLCJmaWx0ZXIiLCJwIiwiYWxsUHJvbW90aW9ucyIsInNvcnQiLCJhIiwiYiIsInByaW9yaXR5IiwiYXBwbGllZFByb21vdGlvbnMiLCJlcnJvcnMiLCJkaXNjb3VudFRvdGFsIiwic2hpcHBpbmdEaXNjb3VudCIsInR5cGUiLCJwdXNoIiwiZWxpZ2libGVJdGVtcyIsImxlbmd0aCIsImFwcGxpZWQiLCJmcmVlU2hpcHBpbmciLCJwbHVzIiwiZGlzY291bnRBbW91bnQiLCJzdGFja2FibGUiLCJncmVhdGVyVGhhbiIsImZpbmFsU3VidG90YWwiLCJtaW51cyIsInRvRGVjaW1hbFBsYWNlcyIsInRvTnVtYmVyIiwibWF4RGlzY291bnQiLCJtaW5PcmRlclRvdGFsIiwibWluUXVhbnRpdHkiLCJwcm9kdWN0SWRzIiwiY2F0ZWdvcnlJZHMiLCJleGNsdWRlUHJvZHVjdElkcyIsImN1c3RvbWVySWRzIiwiZmlyc3RPcmRlck9ubHkiLCJ1c2FnZUxpbWl0IiwicGVyQ3VzdG9tZXJMaW1pdCIsInN0YXJ0c0F0IiwiZW5kc0F0IiwiYnV5UXVhbnRpdHkiLCJnZXRRdWFudGl0eSIsImdldERpc2NvdW50UGVyY2VudCIsImV4aXN0aW5nIiwibmV3UHJvbW90aW9uIiwidG9VcHBlckNhc2UiLCJ1c2FnZUNvdW50IiwiRGF0ZSIsImlzQWN0aXZlIiwiY3JlYXRlZEF0IiwidG9JU09TdHJpbmciLCJ1cGRhdGVkQXQiLCJjb25zb2xlIiwiRXJyb3IiLCJtZXNzYWdlIiwiR0VUIiwic2VhcmNoUGFyYW1zIiwiVVJMIiwidXJsIiwiZ2V0IiwiYWN0aXZlT25seSIsInByb21vdGlvbnMiLCJkaXNwbGF5VmFsdWUiLCJmb3JtYXREaXNjb3VudERpc3BsYXkiLCJ0b3RhbCIsImFjdGl2ZUNvdW50IiwidG9GaXhlZCIsImdldERlc2MiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/svm/promotions/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/prisma.ts":
/*!***************************!*\
  !*** ./src/lib/prisma.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PARTNER_SCOPED_MODELS: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.PARTNER_SCOPED_MODELS),\n/* harmony export */   PLATFORM_MODELS: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.PLATFORM_MODELS),\n/* harmony export */   TENANT_SCOPED_MODELS: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.TENANT_SCOPED_MODELS),\n/* harmony export */   TenantIsolationError: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.TenantIsolationError),\n/* harmony export */   clearViolationLogs: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.clearViolationLogs),\n/* harmony export */   createPartnerContext: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.createPartnerContext),\n/* harmony export */   createTenantContext: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.createTenantContext),\n/* harmony export */   getViolationLogs: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.getViolationLogs),\n/* harmony export */   isPartnerScopedModel: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.isPartnerScopedModel),\n/* harmony export */   isTenantScopedModel: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.isTenantScopedModel),\n/* harmony export */   logViolation: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.logViolation),\n/* harmony export */   prisma: () => (/* binding */ prisma),\n/* harmony export */   validatePartnerAccess: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.validatePartnerAccess),\n/* harmony export */   validateTenantAccess: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.validateTenantAccess),\n/* harmony export */   withPartnerData: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.withPartnerData),\n/* harmony export */   withPartnerFilter: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.withPartnerFilter),\n/* harmony export */   withTenantData: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.withTenantData),\n/* harmony export */   withTenantFilter: () => (/* reexport safe */ _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__.withTenantFilter)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _tenant_isolation__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./tenant-isolation */ \"(rsc)/./src/lib/tenant-isolation.ts\");\n\nconst globalForPrisma = globalThis;\nconst prisma = globalForPrisma.prisma ?? new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient({\n    log:  true ? [\n        \"error\",\n        \"warn\"\n    ] : 0\n});\nif (true) globalForPrisma.prisma = prisma;\n// Re-export tenant isolation utilities\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3ByaXNtYS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBNkM7QUFFN0MsTUFBTUMsa0JBQWtCQztBQUlqQixNQUFNQyxTQUFTRixnQkFBZ0JFLE1BQU0sSUFBSSxJQUFJSCx3REFBWUEsQ0FBQztJQUMvREksS0FBS0MsS0FBeUIsR0FBZ0I7UUFBQztRQUFTO0tBQU8sR0FBRyxDQUFTO0FBQzdFLEdBQUU7QUFFRixJQUFJQSxJQUF5QixFQUFjSixnQkFBZ0JFLE1BQU0sR0FBR0E7QUFFcEUsdUNBQXVDO0FBd0JaIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2Fhcy1jb3JlLy4vc3JjL2xpYi9wcmlzbWEudHM/MDFkNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tICdAcHJpc21hL2NsaWVudCdcblxuY29uc3QgZ2xvYmFsRm9yUHJpc21hID0gZ2xvYmFsVGhpcyBhcyB1bmtub3duIGFzIHtcbiAgcHJpc21hOiBQcmlzbWFDbGllbnQgfCB1bmRlZmluZWRcbn1cblxuZXhwb3J0IGNvbnN0IHByaXNtYSA9IGdsb2JhbEZvclByaXNtYS5wcmlzbWEgPz8gbmV3IFByaXNtYUNsaWVudCh7XG4gIGxvZzogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBbJ2Vycm9yJywgJ3dhcm4nXSA6IFsnZXJyb3InXSxcbn0pXG5cbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSBnbG9iYWxGb3JQcmlzbWEucHJpc21hID0gcHJpc21hXG5cbi8vIFJlLWV4cG9ydCB0ZW5hbnQgaXNvbGF0aW9uIHV0aWxpdGllc1xuZXhwb3J0IHtcbiAgdmFsaWRhdGVUZW5hbnRBY2Nlc3MsXG4gIHZhbGlkYXRlUGFydG5lckFjY2VzcyxcbiAgY3JlYXRlVGVuYW50Q29udGV4dCxcbiAgY3JlYXRlUGFydG5lckNvbnRleHQsXG4gIHdpdGhUZW5hbnRGaWx0ZXIsXG4gIHdpdGhUZW5hbnREYXRhLFxuICB3aXRoUGFydG5lckZpbHRlcixcbiAgd2l0aFBhcnRuZXJEYXRhLFxuICBUZW5hbnRJc29sYXRpb25FcnJvcixcbiAgaXNUZW5hbnRTY29wZWRNb2RlbCxcbiAgaXNQYXJ0bmVyU2NvcGVkTW9kZWwsXG4gIGdldFZpb2xhdGlvbkxvZ3MsXG4gIGNsZWFyVmlvbGF0aW9uTG9ncyxcbiAgbG9nVmlvbGF0aW9uLFxuICBURU5BTlRfU0NPUEVEX01PREVMUyxcbiAgUEFSVE5FUl9TQ09QRURfTU9ERUxTLFxuICBQTEFURk9STV9NT0RFTFMsXG4gIHR5cGUgVGVuYW50Q29udGV4dCxcbiAgdHlwZSBQYXJ0bmVyQ29udGV4dCxcbiAgdHlwZSBUZW5hbnRTY29wZWRNb2RlbCxcbiAgdHlwZSBQYXJ0bmVyU2NvcGVkTW9kZWwsXG4gIHR5cGUgUGxhdGZvcm1Nb2RlbFxufSBmcm9tICcuL3RlbmFudC1pc29sYXRpb24nXG4iXSwibmFtZXMiOlsiUHJpc21hQ2xpZW50IiwiZ2xvYmFsRm9yUHJpc21hIiwiZ2xvYmFsVGhpcyIsInByaXNtYSIsImxvZyIsInByb2Nlc3MiLCJ2YWxpZGF0ZVRlbmFudEFjY2VzcyIsInZhbGlkYXRlUGFydG5lckFjY2VzcyIsImNyZWF0ZVRlbmFudENvbnRleHQiLCJjcmVhdGVQYXJ0bmVyQ29udGV4dCIsIndpdGhUZW5hbnRGaWx0ZXIiLCJ3aXRoVGVuYW50RGF0YSIsIndpdGhQYXJ0bmVyRmlsdGVyIiwid2l0aFBhcnRuZXJEYXRhIiwiVGVuYW50SXNvbGF0aW9uRXJyb3IiLCJpc1RlbmFudFNjb3BlZE1vZGVsIiwiaXNQYXJ0bmVyU2NvcGVkTW9kZWwiLCJnZXRWaW9sYXRpb25Mb2dzIiwiY2xlYXJWaW9sYXRpb25Mb2dzIiwibG9nVmlvbGF0aW9uIiwiVEVOQU5UX1NDT1BFRF9NT0RFTFMiLCJQQVJUTkVSX1NDT1BFRF9NT0RFTFMiLCJQTEFURk9STV9NT0RFTFMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/prisma.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/promotions-storage.ts":
/*!***************************************!*\
  !*** ./src/lib/promotions-storage.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addPromotion: () => (/* binding */ addPromotion),\n/* harmony export */   calculateDiscount: () => (/* binding */ calculateDiscount),\n/* harmony export */   deletePromotion: () => (/* binding */ deletePromotion),\n/* harmony export */   findByCode: () => (/* binding */ findByCode),\n/* harmony export */   generateId: () => (/* binding */ generateId),\n/* harmony export */   getActivePromotions: () => (/* binding */ getActivePromotions),\n/* harmony export */   getAutomaticPromotions: () => (/* binding */ getAutomaticPromotions),\n/* harmony export */   getCustomerUsageCount: () => (/* binding */ getCustomerUsageCount),\n/* harmony export */   getEligibleItems: () => (/* binding */ getEligibleItems),\n/* harmony export */   getOrCreatePromotions: () => (/* binding */ getOrCreatePromotions),\n/* harmony export */   getPromotion: () => (/* binding */ getPromotion),\n/* harmony export */   getPromotions: () => (/* binding */ getPromotions),\n/* harmony export */   recordUsage: () => (/* binding */ recordUsage),\n/* harmony export */   updatePromotion: () => (/* binding */ updatePromotion),\n/* harmony export */   validatePromotion: () => (/* binding */ validatePromotion)\n/* harmony export */ });\n/* harmony import */ var _prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./prisma */ \"(rsc)/./src/lib/prisma.ts\");\n/* harmony import */ var decimal_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! decimal.js */ \"(rsc)/./node_modules/decimal.js/decimal.mjs\");\n/**\n * SVM Promotions Storage\n * \n * Database-backed storage for promotions using Prisma.\n * All data is tenant-isolated and persists across restarts.\n */ \n\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction generateId(prefix = \"promo\") {\n    return `${prefix}_${Date.now().toString(36)}${Math.random().toString(36).substring(2, 9)}`;\n}\nfunction decimalToNumber(val) {\n    if (val === null || val === undefined) return null;\n    return Number(val);\n}\nfunction mapDbPromotionToInterface(dbPromo) {\n    return {\n        id: dbPromo.id,\n        tenantId: dbPromo.tenantId,\n        name: dbPromo.name,\n        description: dbPromo.description,\n        code: dbPromo.code,\n        type: dbPromo.type,\n        discountType: dbPromo.discountType,\n        discountValue: Number(dbPromo.discountValue),\n        maxDiscount: decimalToNumber(dbPromo.maxDiscount),\n        minOrderTotal: decimalToNumber(dbPromo.minOrderTotal),\n        minQuantity: dbPromo.minQuantity,\n        productIds: dbPromo.productIds || [],\n        categoryIds: dbPromo.categoryIds || [],\n        excludeProductIds: dbPromo.excludeProductIds || [],\n        customerIds: dbPromo.customerIds || [],\n        firstOrderOnly: dbPromo.firstOrderOnly,\n        usageLimit: dbPromo.usageLimit,\n        usageCount: dbPromo.usageCount,\n        perCustomerLimit: dbPromo.perCustomerLimit,\n        startsAt: dbPromo.startsAt,\n        endsAt: dbPromo.endsAt,\n        isActive: dbPromo.isActive,\n        stackable: dbPromo.stackable,\n        priority: dbPromo.priority,\n        buyQuantity: dbPromo.buyQuantity,\n        getQuantity: dbPromo.getQuantity,\n        getDiscountPercent: dbPromo.getDiscountPercent,\n        createdAt: dbPromo.createdAt?.toISOString(),\n        updatedAt: dbPromo.updatedAt?.toISOString()\n    };\n}\n// ============================================================================\n// DEFAULT PROMOTIONS SEEDING\n// ============================================================================\nasync function seedDefaultPromotions(tenantId) {\n    const now = new Date();\n    const promotions = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction([\n        _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.svmPromotion.create({\n            data: {\n                tenantId,\n                name: \"Welcome Discount\",\n                description: \"10% off your first order\",\n                code: \"WELCOME10\",\n                type: \"COUPON\",\n                discountType: \"PERCENTAGE\",\n                discountValue: 10,\n                productIds: [],\n                categoryIds: [],\n                excludeProductIds: [],\n                customerIds: [],\n                firstOrderOnly: true,\n                usageCount: 0,\n                startsAt: now,\n                isActive: true,\n                stackable: false,\n                priority: 0\n            }\n        }),\n        _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.svmPromotion.create({\n            data: {\n                tenantId,\n                name: \"Summer Sale\",\n                description: \"15% off orders over $100 (max $50 discount)\",\n                code: null,\n                type: \"AUTOMATIC\",\n                discountType: \"PERCENTAGE\",\n                discountValue: 15,\n                maxDiscount: 50,\n                minOrderTotal: 100,\n                productIds: [],\n                categoryIds: [],\n                excludeProductIds: [],\n                customerIds: [],\n                firstOrderOnly: false,\n                usageCount: 0,\n                startsAt: now,\n                isActive: true,\n                stackable: true,\n                priority: 10\n            }\n        }),\n        _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.svmPromotion.create({\n            data: {\n                tenantId,\n                name: \"Free Shipping\",\n                description: \"Free shipping on orders over $50\",\n                code: \"FREESHIP\",\n                type: \"COUPON\",\n                discountType: \"FREE_SHIPPING\",\n                discountValue: 0,\n                minOrderTotal: 50,\n                productIds: [],\n                categoryIds: [],\n                excludeProductIds: [],\n                customerIds: [],\n                firstOrderOnly: false,\n                usageCount: 0,\n                startsAt: now,\n                isActive: true,\n                stackable: true,\n                priority: 5\n            }\n        }),\n        _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.svmPromotion.create({\n            data: {\n                tenantId,\n                name: \"Buy 2 Get 1 Free\",\n                description: \"Buy any 2 items, get 1 free\",\n                code: \"BOGO\",\n                type: \"COUPON\",\n                discountType: \"BUY_X_GET_Y\",\n                discountValue: 100,\n                buyQuantity: 2,\n                getQuantity: 1,\n                getDiscountPercent: 100,\n                productIds: [],\n                categoryIds: [],\n                excludeProductIds: [],\n                customerIds: [],\n                firstOrderOnly: false,\n                usageCount: 0,\n                startsAt: now,\n                isActive: true,\n                stackable: false,\n                priority: 0\n            }\n        }),\n        _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.svmPromotion.create({\n            data: {\n                tenantId,\n                name: \"$20 Off\",\n                description: \"$20 off orders over $75 (limit 100 uses)\",\n                code: \"SAVE20\",\n                type: \"COUPON\",\n                discountType: \"FIXED_AMOUNT\",\n                discountValue: 20,\n                minOrderTotal: 75,\n                usageLimit: 100,\n                perCustomerLimit: 1,\n                productIds: [],\n                categoryIds: [],\n                excludeProductIds: [],\n                customerIds: [],\n                firstOrderOnly: false,\n                usageCount: 0,\n                startsAt: now,\n                isActive: true,\n                stackable: false,\n                priority: 0\n            }\n        })\n    ]);\n    return promotions.map(mapDbPromotionToInterface);\n}\n// ============================================================================\n// PROMOTION CRUD\n// ============================================================================\n/**\n * Get or create sample promotions for a tenant\n */ async function getOrCreatePromotions(tenantId) {\n    const existing = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.svmPromotion.findMany({\n        where: {\n            tenantId\n        }\n    });\n    if (existing.length > 0) {\n        return existing.map(mapDbPromotionToInterface);\n    }\n    return seedDefaultPromotions(tenantId);\n}\nasync function getPromotions(tenantId) {\n    return getOrCreatePromotions(tenantId);\n}\nasync function getActivePromotions(tenantId) {\n    const now = new Date();\n    const promotions = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.svmPromotion.findMany({\n        where: {\n            tenantId,\n            isActive: true,\n            startsAt: {\n                lte: now\n            },\n            OR: [\n                {\n                    endsAt: null\n                },\n                {\n                    endsAt: {\n                        gt: now\n                    }\n                }\n            ]\n        }\n    });\n    // Filter by usage limit in application layer\n    return promotions.map(mapDbPromotionToInterface).filter((p)=>!p.usageLimit || p.usageCount < p.usageLimit);\n}\nasync function getAutomaticPromotions(tenantId) {\n    const active = await getActivePromotions(tenantId);\n    return active.filter((p)=>p.type === \"AUTOMATIC\" || p.type === \"FLASH_SALE\");\n}\nasync function findByCode(tenantId, code) {\n    const promotion = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.svmPromotion.findFirst({\n        where: {\n            tenantId,\n            code: {\n                equals: code,\n                mode: \"insensitive\"\n            },\n            isActive: true,\n            startsAt: {\n                lte: new Date()\n            },\n            OR: [\n                {\n                    endsAt: null\n                },\n                {\n                    endsAt: {\n                        gt: new Date()\n                    }\n                }\n            ]\n        }\n    });\n    if (!promotion) return null;\n    const mapped = mapDbPromotionToInterface(promotion);\n    // Check usage limit\n    if (mapped.usageLimit && mapped.usageCount >= mapped.usageLimit) {\n        return null;\n    }\n    return mapped;\n}\nasync function getPromotion(tenantId, promotionId) {\n    const promotion = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.svmPromotion.findFirst({\n        where: {\n            id: promotionId,\n            tenantId\n        }\n    });\n    return promotion ? mapDbPromotionToInterface(promotion) : null;\n}\nasync function addPromotion(promotion) {\n    await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.svmPromotion.create({\n        data: {\n            id: promotion.id,\n            tenantId: promotion.tenantId,\n            name: promotion.name,\n            description: promotion.description,\n            code: promotion.code,\n            type: promotion.type,\n            discountType: promotion.discountType,\n            discountValue: promotion.discountValue,\n            maxDiscount: promotion.maxDiscount,\n            minOrderTotal: promotion.minOrderTotal,\n            minQuantity: promotion.minQuantity,\n            productIds: promotion.productIds,\n            categoryIds: promotion.categoryIds,\n            excludeProductIds: promotion.excludeProductIds,\n            customerIds: promotion.customerIds,\n            firstOrderOnly: promotion.firstOrderOnly,\n            usageLimit: promotion.usageLimit,\n            usageCount: promotion.usageCount,\n            perCustomerLimit: promotion.perCustomerLimit,\n            buyQuantity: promotion.buyQuantity,\n            getQuantity: promotion.getQuantity,\n            getDiscountPercent: promotion.getDiscountPercent,\n            startsAt: promotion.startsAt,\n            endsAt: promotion.endsAt,\n            isActive: promotion.isActive,\n            stackable: promotion.stackable,\n            priority: promotion.priority\n        }\n    });\n}\nasync function updatePromotion(tenantId, promotionId, updates) {\n    const existing = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.svmPromotion.findFirst({\n        where: {\n            id: promotionId,\n            tenantId\n        }\n    });\n    if (!existing) return null;\n    const updated = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.svmPromotion.update({\n        where: {\n            id: promotionId\n        },\n        data: {\n            name: updates.name,\n            description: updates.description,\n            discountValue: updates.discountValue,\n            maxDiscount: updates.maxDiscount,\n            minOrderTotal: updates.minOrderTotal,\n            minQuantity: updates.minQuantity,\n            productIds: updates.productIds,\n            categoryIds: updates.categoryIds,\n            excludeProductIds: updates.excludeProductIds,\n            customerIds: updates.customerIds,\n            firstOrderOnly: updates.firstOrderOnly,\n            usageLimit: updates.usageLimit,\n            perCustomerLimit: updates.perCustomerLimit,\n            buyQuantity: updates.buyQuantity,\n            getQuantity: updates.getQuantity,\n            getDiscountPercent: updates.getDiscountPercent,\n            startsAt: updates.startsAt,\n            endsAt: updates.endsAt,\n            isActive: updates.isActive,\n            stackable: updates.stackable,\n            priority: updates.priority\n        }\n    });\n    return mapDbPromotionToInterface(updated);\n}\nasync function deletePromotion(tenantId, promotionId) {\n    const existing = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.svmPromotion.findFirst({\n        where: {\n            id: promotionId,\n            tenantId\n        }\n    });\n    if (!existing) return null;\n    await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.svmPromotion.delete({\n        where: {\n            id: promotionId\n        }\n    });\n    return mapDbPromotionToInterface(existing);\n}\n// ============================================================================\n// USAGE TRACKING\n// ============================================================================\nasync function recordUsage(promotionId, orderId, customerId, discountApplied) {\n    const usage = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.svmPromotionUsage.create({\n        data: {\n            promotionId,\n            orderId,\n            customerId,\n            discountApplied\n        }\n    });\n    // Increment usage count on promotion\n    await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.svmPromotion.update({\n        where: {\n            id: promotionId\n        },\n        data: {\n            usageCount: {\n                increment: 1\n            }\n        }\n    });\n    return {\n        id: usage.id,\n        promotionId: usage.promotionId,\n        orderId: usage.orderId,\n        customerId: usage.customerId || undefined,\n        discountApplied: Number(usage.discountApplied),\n        createdAt: usage.createdAt\n    };\n}\nasync function getCustomerUsageCount(promotionId, customerId) {\n    if (!customerId) return 0;\n    const count = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.svmPromotionUsage.count({\n        where: {\n            promotionId,\n            customerId\n        }\n    });\n    return count;\n}\nasync function validatePromotion(promotion, subtotal, totalQuantity, customerId, isFirstOrder, currentDiscounts = []) {\n    const now = new Date();\n    if (!promotion.isActive) {\n        return {\n            valid: false,\n            error: \"This promotion is no longer active\",\n            errorCode: \"INACTIVE\"\n        };\n    }\n    if (promotion.startsAt > now) {\n        return {\n            valid: false,\n            error: \"This promotion has not started yet\",\n            errorCode: \"NOT_STARTED\"\n        };\n    }\n    if (promotion.endsAt && promotion.endsAt < now) {\n        return {\n            valid: false,\n            error: \"This promotion has expired\",\n            errorCode: \"EXPIRED\"\n        };\n    }\n    if (promotion.usageLimit && promotion.usageCount >= promotion.usageLimit) {\n        return {\n            valid: false,\n            error: \"This promotion has reached its usage limit\",\n            errorCode: \"USAGE_LIMIT_REACHED\"\n        };\n    }\n    const customerUsageCount = await getCustomerUsageCount(promotion.id, customerId);\n    if (promotion.perCustomerLimit && customerUsageCount >= promotion.perCustomerLimit) {\n        return {\n            valid: false,\n            error: \"You have already used this promotion the maximum number of times\",\n            errorCode: \"CUSTOMER_LIMIT_REACHED\"\n        };\n    }\n    if (promotion.customerIds.length > 0 && customerId) {\n        if (!promotion.customerIds.includes(customerId)) {\n            return {\n                valid: false,\n                error: \"This promotion is not available for your account\",\n                errorCode: \"CUSTOMER_NOT_ELIGIBLE\"\n            };\n        }\n    }\n    if (promotion.firstOrderOnly && !isFirstOrder) {\n        return {\n            valid: false,\n            error: \"This promotion is only valid for first-time orders\",\n            errorCode: \"FIRST_ORDER_ONLY\"\n        };\n    }\n    if (promotion.minOrderTotal && subtotal < promotion.minOrderTotal) {\n        return {\n            valid: false,\n            error: `Minimum order total of $${promotion.minOrderTotal.toFixed(2)} required`,\n            errorCode: \"MIN_ORDER_NOT_MET\"\n        };\n    }\n    if (promotion.minQuantity && totalQuantity < promotion.minQuantity) {\n        return {\n            valid: false,\n            error: `Minimum of ${promotion.minQuantity} items required`,\n            errorCode: \"MIN_QUANTITY_NOT_MET\"\n        };\n    }\n    if (!promotion.stackable && currentDiscounts.length > 0) {\n        return {\n            valid: false,\n            error: \"This promotion cannot be combined with other discounts\",\n            errorCode: \"NOT_STACKABLE\"\n        };\n    }\n    if (currentDiscounts.some((d)=>d.promotionId === promotion.id)) {\n        return {\n            valid: false,\n            error: \"This promotion is already applied\",\n            errorCode: \"ALREADY_APPLIED\"\n        };\n    }\n    return {\n        valid: true\n    };\n}\nfunction getEligibleItems(promotion, items) {\n    return items.filter((item)=>{\n        if (promotion.excludeProductIds.includes(item.productId)) {\n            return false;\n        }\n        if (promotion.productIds.length === 0 && promotion.categoryIds.length === 0) {\n            return true;\n        }\n        if (promotion.productIds.length > 0 && promotion.productIds.includes(item.productId)) {\n            return true;\n        }\n        if (promotion.categoryIds.length > 0 && item.categoryId && promotion.categoryIds.includes(item.categoryId)) {\n            return true;\n        }\n        return false;\n    });\n}\nfunction calculateDiscount(promotion, items, subtotal, shippingTotal) {\n    const eligibleItems = getEligibleItems(promotion, items);\n    let discountAmount = new decimal_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](0);\n    let originalAmount;\n    let freeShipping = false;\n    let affectedItems = [];\n    let message = \"\";\n    switch(promotion.discountType){\n        case \"PERCENTAGE\":\n            {\n                const eligibleSubtotal = eligibleItems.reduce((sum, item)=>sum + item.unitPrice * item.quantity, 0);\n                const percentDiscount = new decimal_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](eligibleSubtotal).times(promotion.discountValue).dividedBy(100);\n                originalAmount = percentDiscount.toDecimalPlaces(2).toNumber();\n                if (promotion.maxDiscount && percentDiscount.greaterThan(promotion.maxDiscount)) {\n                    discountAmount = new decimal_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](promotion.maxDiscount);\n                } else {\n                    discountAmount = percentDiscount;\n                }\n                affectedItems = eligibleItems.map((i)=>i.productId);\n                message = `${promotion.discountValue}% off${affectedItems.length < items.length ? \" eligible items\" : \"\"}`;\n                break;\n            }\n        case \"FIXED_AMOUNT\":\n            {\n                discountAmount = new decimal_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](promotion.discountValue);\n                if (discountAmount.greaterThan(subtotal)) {\n                    discountAmount = new decimal_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](subtotal);\n                }\n                message = `$${promotion.discountValue.toFixed(2)} off your order`;\n                break;\n            }\n        case \"FIXED_PER_ITEM\":\n            {\n                const totalEligibleQty = eligibleItems.reduce((sum, item)=>sum + item.quantity, 0);\n                discountAmount = new decimal_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](promotion.discountValue).times(totalEligibleQty);\n                const eligibleSubtotal = eligibleItems.reduce((sum, item)=>sum + item.unitPrice * item.quantity, 0);\n                if (discountAmount.greaterThan(eligibleSubtotal)) {\n                    discountAmount = new decimal_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](eligibleSubtotal);\n                }\n                affectedItems = eligibleItems.map((i)=>i.productId);\n                message = `$${promotion.discountValue.toFixed(2)} off each eligible item`;\n                break;\n            }\n        case \"FREE_SHIPPING\":\n            {\n                freeShipping = true;\n                message = \"Free shipping\";\n                break;\n            }\n        case \"BUY_X_GET_Y\":\n            {\n                if (!promotion.buyQuantity || !promotion.getQuantity) {\n                    return null;\n                }\n                const sortedItems = [\n                    ...eligibleItems\n                ].sort((a, b)=>b.unitPrice - a.unitPrice);\n                const totalQty = sortedItems.reduce((sum, item)=>sum + item.quantity, 0);\n                const dealSize = promotion.buyQuantity + promotion.getQuantity;\n                const numDeals = Math.floor(totalQty / dealSize);\n                if (numDeals === 0) {\n                    return null;\n                }\n                const discountPercent = promotion.getDiscountPercent || 100;\n                let discountedItems = 0;\n                let totalDiscount = new decimal_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](0);\n                const reversedItems = [\n                    ...sortedItems\n                ].reverse();\n                for (const item of reversedItems){\n                    const itemsToDiscount = Math.min(item.quantity, numDeals * promotion.getQuantity - discountedItems);\n                    if (itemsToDiscount > 0) {\n                        const itemDiscount = new decimal_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](item.unitPrice).times(itemsToDiscount).times(discountPercent).dividedBy(100);\n                        totalDiscount = totalDiscount.plus(itemDiscount);\n                        discountedItems += itemsToDiscount;\n                    }\n                    if (discountedItems >= numDeals * promotion.getQuantity) {\n                        break;\n                    }\n                }\n                discountAmount = totalDiscount;\n                affectedItems = eligibleItems.map((i)=>i.productId);\n                const getDesc = discountPercent === 100 ? \"free\" : `${discountPercent}% off`;\n                message = `Buy ${promotion.buyQuantity} get ${promotion.getQuantity} ${getDesc}`;\n                break;\n            }\n    }\n    const finalDiscount = discountAmount.toDecimalPlaces(2).toNumber();\n    if (finalDiscount === 0 && !freeShipping) {\n        return null;\n    }\n    return {\n        promotionId: promotion.id,\n        promotionName: promotion.name,\n        code: promotion.code,\n        discountType: promotion.discountType,\n        discountAmount: finalDiscount,\n        originalAmount,\n        cappedAmount: originalAmount && originalAmount > finalDiscount ? finalDiscount : undefined,\n        affectedItems: affectedItems.length > 0 ? affectedItems : undefined,\n        freeShipping,\n        message\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUssQ0FBQ29CLGlCQUNOcEIsS0FBSyxDQUFDZSxpQkFDTmQsU0FBUyxDQUFDO3dCQUViZ0IsZ0JBQWdCQSxjQUFjTSxJQUFJLENBQUNEO3dCQUNuQ04sbUJBQW1CSTtvQkFDckI7b0JBRUEsSUFBSUosbUJBQW1CSCxXQUFXcEUsVUFBVTNCLFdBQVcsRUFBRTt3QkFDdkQ7b0JBQ0Y7Z0JBQ0Y7Z0JBRUF1RSxpQkFBaUI0QjtnQkFDakJ6QixnQkFBZ0JKLGNBQWMzRCxHQUFHLENBQUM0RSxDQUFBQSxJQUFLQSxFQUFFckIsU0FBUztnQkFFbEQsTUFBTXdDLFVBQVVULG9CQUFvQixNQUFNLFNBQVMsQ0FBQyxFQUFFQSxnQkFBZ0IsS0FBSyxDQUFDO2dCQUM1RXRCLFVBQVUsQ0FBQyxJQUFJLEVBQUVoRCxVQUFVNUIsV0FBVyxDQUFDLEtBQUssRUFBRTRCLFVBQVUzQixXQUFXLENBQUMsQ0FBQyxFQUFFMEcsUUFBUSxDQUFDO2dCQUNoRjtZQUNGO0lBQ0Y7SUFFQSxNQUFNQyxnQkFBZ0JwQyxlQUFlYSxlQUFlLENBQUMsR0FBR0MsUUFBUTtJQUVoRSxJQUFJc0Isa0JBQWtCLEtBQUssQ0FBQ2xDLGNBQWM7UUFDeEMsT0FBTztJQUNUO0lBRUEsT0FBTztRQUNMeEMsYUFBYU4sVUFBVXBELEVBQUU7UUFDekJxSSxlQUFlakYsVUFBVWxELElBQUk7UUFDN0JFLE1BQU1nRCxVQUFVaEQsSUFBSTtRQUNwQkUsY0FBYzhDLFVBQVU5QyxZQUFZO1FBQ3BDMEYsZ0JBQWdCb0M7UUFDaEJuQztRQUNBcUMsY0FBY3JDLGtCQUFrQkEsaUJBQWlCbUMsZ0JBQWdCQSxnQkFBZ0J4STtRQUNqRnVHLGVBQWVBLGNBQWMxRCxNQUFNLEdBQUcsSUFBSTBELGdCQUFnQnZHO1FBQzFEc0c7UUFDQUU7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2Fhcy1jb3JlLy4vc3JjL2xpYi9wcm9tb3Rpb25zLXN0b3JhZ2UudHM/OWY0NCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFNWTSBQcm9tb3Rpb25zIFN0b3JhZ2VcbiAqIFxuICogRGF0YWJhc2UtYmFja2VkIHN0b3JhZ2UgZm9yIHByb21vdGlvbnMgdXNpbmcgUHJpc21hLlxuICogQWxsIGRhdGEgaXMgdGVuYW50LWlzb2xhdGVkIGFuZCBwZXJzaXN0cyBhY3Jvc3MgcmVzdGFydHMuXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi9wcmlzbWEnXG5pbXBvcnQgeyBQcmlzbWEgfSBmcm9tICdAcHJpc21hL2NsaWVudCdcbmltcG9ydCBEZWNpbWFsIGZyb20gJ2RlY2ltYWwuanMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRZUEVTIChtYWludGFpbmVkIGZvciBBUEkgY29tcGF0aWJpbGl0eSlcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IHR5cGUgUHJvbW90aW9uVHlwZSA9ICdDT1VQT04nIHwgJ0FVVE9NQVRJQycgfCAnRkxBU0hfU0FMRSdcbmV4cG9ydCB0eXBlIERpc2NvdW50VHlwZSA9ICdQRVJDRU5UQUdFJyB8ICdGSVhFRF9BTU9VTlQnIHwgJ0ZJWEVEX1BFUl9JVEVNJyB8ICdGUkVFX1NISVBQSU5HJyB8ICdCVVlfWF9HRVRfWSdcblxuZXhwb3J0IGludGVyZmFjZSBQcm9tb3Rpb24ge1xuICBpZDogc3RyaW5nXG4gIHRlbmFudElkOiBzdHJpbmdcbiAgbmFtZTogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2RlPzogc3RyaW5nIHwgbnVsbFxuICB0eXBlOiBQcm9tb3Rpb25UeXBlXG4gIGRpc2NvdW50VHlwZTogRGlzY291bnRUeXBlXG4gIGRpc2NvdW50VmFsdWU6IG51bWJlclxuICBtYXhEaXNjb3VudD86IG51bWJlciB8IG51bGxcbiAgbWluT3JkZXJUb3RhbD86IG51bWJlciB8IG51bGxcbiAgbWluUXVhbnRpdHk/OiBudW1iZXIgfCBudWxsXG4gIHByb2R1Y3RJZHM6IHN0cmluZ1tdXG4gIGNhdGVnb3J5SWRzOiBzdHJpbmdbXVxuICBleGNsdWRlUHJvZHVjdElkczogc3RyaW5nW11cbiAgY3VzdG9tZXJJZHM6IHN0cmluZ1tdXG4gIGZpcnN0T3JkZXJPbmx5OiBib29sZWFuXG4gIHVzYWdlTGltaXQ/OiBudW1iZXIgfCBudWxsXG4gIHVzYWdlQ291bnQ6IG51bWJlclxuICBwZXJDdXN0b21lckxpbWl0PzogbnVtYmVyIHwgbnVsbFxuICBzdGFydHNBdDogRGF0ZVxuICBlbmRzQXQ/OiBEYXRlIHwgbnVsbFxuICBpc0FjdGl2ZTogYm9vbGVhblxuICBzdGFja2FibGU6IGJvb2xlYW5cbiAgcHJpb3JpdHk6IG51bWJlclxuICBidXlRdWFudGl0eT86IG51bWJlciB8IG51bGxcbiAgZ2V0UXVhbnRpdHk/OiBudW1iZXIgfCBudWxsXG4gIGdldERpc2NvdW50UGVyY2VudD86IG51bWJlciB8IG51bGxcbiAgY3JlYXRlZEF0Pzogc3RyaW5nXG4gIHVwZGF0ZWRBdD86IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFByb21vdGlvblVzYWdlIHtcbiAgaWQ6IHN0cmluZ1xuICBwcm9tb3Rpb25JZDogc3RyaW5nXG4gIG9yZGVySWQ6IHN0cmluZ1xuICBjdXN0b21lcklkPzogc3RyaW5nXG4gIGRpc2NvdW50QXBwbGllZDogbnVtYmVyXG4gIGNyZWF0ZWRBdDogRGF0ZVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFByb21vdGlvbkNhcnRJdGVtIHtcbiAgcHJvZHVjdElkOiBzdHJpbmdcbiAgdmFyaWFudElkPzogc3RyaW5nXG4gIGNhdGVnb3J5SWQ/OiBzdHJpbmdcbiAgcHJvZHVjdE5hbWU6IHN0cmluZ1xuICB1bml0UHJpY2U6IG51bWJlclxuICBxdWFudGl0eTogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXBwbGllZFByb21vdGlvbiB7XG4gIHByb21vdGlvbklkOiBzdHJpbmdcbiAgcHJvbW90aW9uTmFtZTogc3RyaW5nXG4gIGNvZGU/OiBzdHJpbmcgfCBudWxsXG4gIGRpc2NvdW50VHlwZTogRGlzY291bnRUeXBlXG4gIGRpc2NvdW50QW1vdW50OiBudW1iZXJcbiAgb3JpZ2luYWxBbW91bnQ/OiBudW1iZXJcbiAgY2FwcGVkQW1vdW50PzogbnVtYmVyXG4gIGFmZmVjdGVkSXRlbXM/OiBzdHJpbmdbXVxuICBmcmVlU2hpcHBpbmc/OiBib29sZWFuXG4gIG1lc3NhZ2U6IHN0cmluZ1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZUlkKHByZWZpeDogc3RyaW5nID0gJ3Byb21vJyk6IHN0cmluZyB7XG4gIHJldHVybiBgJHtwcmVmaXh9XyR7RGF0ZS5ub3coKS50b1N0cmluZygzNil9JHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgOSl9YFxufVxuXG5mdW5jdGlvbiBkZWNpbWFsVG9OdW1iZXIodmFsOiBQcmlzbWEuRGVjaW1hbCB8IG51bGwgfCB1bmRlZmluZWQpOiBudW1iZXIgfCBudWxsIHtcbiAgaWYgKHZhbCA9PT0gbnVsbCB8fCB2YWwgPT09IHVuZGVmaW5lZCkgcmV0dXJuIG51bGxcbiAgcmV0dXJuIE51bWJlcih2YWwpXG59XG5cbmZ1bmN0aW9uIG1hcERiUHJvbW90aW9uVG9JbnRlcmZhY2UoZGJQcm9tbzogYW55KTogUHJvbW90aW9uIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogZGJQcm9tby5pZCxcbiAgICB0ZW5hbnRJZDogZGJQcm9tby50ZW5hbnRJZCxcbiAgICBuYW1lOiBkYlByb21vLm5hbWUsXG4gICAgZGVzY3JpcHRpb246IGRiUHJvbW8uZGVzY3JpcHRpb24sXG4gICAgY29kZTogZGJQcm9tby5jb2RlLFxuICAgIHR5cGU6IGRiUHJvbW8udHlwZSBhcyBQcm9tb3Rpb25UeXBlLFxuICAgIGRpc2NvdW50VHlwZTogZGJQcm9tby5kaXNjb3VudFR5cGUgYXMgRGlzY291bnRUeXBlLFxuICAgIGRpc2NvdW50VmFsdWU6IE51bWJlcihkYlByb21vLmRpc2NvdW50VmFsdWUpLFxuICAgIG1heERpc2NvdW50OiBkZWNpbWFsVG9OdW1iZXIoZGJQcm9tby5tYXhEaXNjb3VudCksXG4gICAgbWluT3JkZXJUb3RhbDogZGVjaW1hbFRvTnVtYmVyKGRiUHJvbW8ubWluT3JkZXJUb3RhbCksXG4gICAgbWluUXVhbnRpdHk6IGRiUHJvbW8ubWluUXVhbnRpdHksXG4gICAgcHJvZHVjdElkczogZGJQcm9tby5wcm9kdWN0SWRzIHx8IFtdLFxuICAgIGNhdGVnb3J5SWRzOiBkYlByb21vLmNhdGVnb3J5SWRzIHx8IFtdLFxuICAgIGV4Y2x1ZGVQcm9kdWN0SWRzOiBkYlByb21vLmV4Y2x1ZGVQcm9kdWN0SWRzIHx8IFtdLFxuICAgIGN1c3RvbWVySWRzOiBkYlByb21vLmN1c3RvbWVySWRzIHx8IFtdLFxuICAgIGZpcnN0T3JkZXJPbmx5OiBkYlByb21vLmZpcnN0T3JkZXJPbmx5LFxuICAgIHVzYWdlTGltaXQ6IGRiUHJvbW8udXNhZ2VMaW1pdCxcbiAgICB1c2FnZUNvdW50OiBkYlByb21vLnVzYWdlQ291bnQsXG4gICAgcGVyQ3VzdG9tZXJMaW1pdDogZGJQcm9tby5wZXJDdXN0b21lckxpbWl0LFxuICAgIHN0YXJ0c0F0OiBkYlByb21vLnN0YXJ0c0F0LFxuICAgIGVuZHNBdDogZGJQcm9tby5lbmRzQXQsXG4gICAgaXNBY3RpdmU6IGRiUHJvbW8uaXNBY3RpdmUsXG4gICAgc3RhY2thYmxlOiBkYlByb21vLnN0YWNrYWJsZSxcbiAgICBwcmlvcml0eTogZGJQcm9tby5wcmlvcml0eSxcbiAgICBidXlRdWFudGl0eTogZGJQcm9tby5idXlRdWFudGl0eSxcbiAgICBnZXRRdWFudGl0eTogZGJQcm9tby5nZXRRdWFudGl0eSxcbiAgICBnZXREaXNjb3VudFBlcmNlbnQ6IGRiUHJvbW8uZ2V0RGlzY291bnRQZXJjZW50LFxuICAgIGNyZWF0ZWRBdDogZGJQcm9tby5jcmVhdGVkQXQ/LnRvSVNPU3RyaW5nKCksXG4gICAgdXBkYXRlZEF0OiBkYlByb21vLnVwZGF0ZWRBdD8udG9JU09TdHJpbmcoKVxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERFRkFVTFQgUFJPTU9USU9OUyBTRUVESU5HXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmFzeW5jIGZ1bmN0aW9uIHNlZWREZWZhdWx0UHJvbW90aW9ucyh0ZW5hbnRJZDogc3RyaW5nKTogUHJvbWlzZTxQcm9tb3Rpb25bXT4ge1xuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpXG4gIFxuICBjb25zdCBwcm9tb3Rpb25zID0gYXdhaXQgcHJpc21hLiR0cmFuc2FjdGlvbihbXG4gICAgcHJpc21hLnN2bVByb21vdGlvbi5jcmVhdGUoe1xuICAgICAgZGF0YToge1xuICAgICAgICB0ZW5hbnRJZCxcbiAgICAgICAgbmFtZTogJ1dlbGNvbWUgRGlzY291bnQnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJzEwJSBvZmYgeW91ciBmaXJzdCBvcmRlcicsXG4gICAgICAgIGNvZGU6ICdXRUxDT01FMTAnLFxuICAgICAgICB0eXBlOiAnQ09VUE9OJyxcbiAgICAgICAgZGlzY291bnRUeXBlOiAnUEVSQ0VOVEFHRScsXG4gICAgICAgIGRpc2NvdW50VmFsdWU6IDEwLFxuICAgICAgICBwcm9kdWN0SWRzOiBbXSxcbiAgICAgICAgY2F0ZWdvcnlJZHM6IFtdLFxuICAgICAgICBleGNsdWRlUHJvZHVjdElkczogW10sXG4gICAgICAgIGN1c3RvbWVySWRzOiBbXSxcbiAgICAgICAgZmlyc3RPcmRlck9ubHk6IHRydWUsXG4gICAgICAgIHVzYWdlQ291bnQ6IDAsXG4gICAgICAgIHN0YXJ0c0F0OiBub3csXG4gICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICBzdGFja2FibGU6IGZhbHNlLFxuICAgICAgICBwcmlvcml0eTogMFxuICAgICAgfVxuICAgIH0pLFxuICAgIHByaXNtYS5zdm1Qcm9tb3Rpb24uY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdGVuYW50SWQsXG4gICAgICAgIG5hbWU6ICdTdW1tZXIgU2FsZScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnMTUlIG9mZiBvcmRlcnMgb3ZlciAkMTAwIChtYXggJDUwIGRpc2NvdW50KScsXG4gICAgICAgIGNvZGU6IG51bGwsXG4gICAgICAgIHR5cGU6ICdBVVRPTUFUSUMnLFxuICAgICAgICBkaXNjb3VudFR5cGU6ICdQRVJDRU5UQUdFJyxcbiAgICAgICAgZGlzY291bnRWYWx1ZTogMTUsXG4gICAgICAgIG1heERpc2NvdW50OiA1MCxcbiAgICAgICAgbWluT3JkZXJUb3RhbDogMTAwLFxuICAgICAgICBwcm9kdWN0SWRzOiBbXSxcbiAgICAgICAgY2F0ZWdvcnlJZHM6IFtdLFxuICAgICAgICBleGNsdWRlUHJvZHVjdElkczogW10sXG4gICAgICAgIGN1c3RvbWVySWRzOiBbXSxcbiAgICAgICAgZmlyc3RPcmRlck9ubHk6IGZhbHNlLFxuICAgICAgICB1c2FnZUNvdW50OiAwLFxuICAgICAgICBzdGFydHNBdDogbm93LFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgc3RhY2thYmxlOiB0cnVlLFxuICAgICAgICBwcmlvcml0eTogMTBcbiAgICAgIH1cbiAgICB9KSxcbiAgICBwcmlzbWEuc3ZtUHJvbW90aW9uLmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIHRlbmFudElkLFxuICAgICAgICBuYW1lOiAnRnJlZSBTaGlwcGluZycsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnRnJlZSBzaGlwcGluZyBvbiBvcmRlcnMgb3ZlciAkNTAnLFxuICAgICAgICBjb2RlOiAnRlJFRVNISVAnLFxuICAgICAgICB0eXBlOiAnQ09VUE9OJyxcbiAgICAgICAgZGlzY291bnRUeXBlOiAnRlJFRV9TSElQUElORycsXG4gICAgICAgIGRpc2NvdW50VmFsdWU6IDAsXG4gICAgICAgIG1pbk9yZGVyVG90YWw6IDUwLFxuICAgICAgICBwcm9kdWN0SWRzOiBbXSxcbiAgICAgICAgY2F0ZWdvcnlJZHM6IFtdLFxuICAgICAgICBleGNsdWRlUHJvZHVjdElkczogW10sXG4gICAgICAgIGN1c3RvbWVySWRzOiBbXSxcbiAgICAgICAgZmlyc3RPcmRlck9ubHk6IGZhbHNlLFxuICAgICAgICB1c2FnZUNvdW50OiAwLFxuICAgICAgICBzdGFydHNBdDogbm93LFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgc3RhY2thYmxlOiB0cnVlLFxuICAgICAgICBwcmlvcml0eTogNVxuICAgICAgfVxuICAgIH0pLFxuICAgIHByaXNtYS5zdm1Qcm9tb3Rpb24uY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdGVuYW50SWQsXG4gICAgICAgIG5hbWU6ICdCdXkgMiBHZXQgMSBGcmVlJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdCdXkgYW55IDIgaXRlbXMsIGdldCAxIGZyZWUnLFxuICAgICAgICBjb2RlOiAnQk9HTycsXG4gICAgICAgIHR5cGU6ICdDT1VQT04nLFxuICAgICAgICBkaXNjb3VudFR5cGU6ICdCVVlfWF9HRVRfWScsXG4gICAgICAgIGRpc2NvdW50VmFsdWU6IDEwMCxcbiAgICAgICAgYnV5UXVhbnRpdHk6IDIsXG4gICAgICAgIGdldFF1YW50aXR5OiAxLFxuICAgICAgICBnZXREaXNjb3VudFBlcmNlbnQ6IDEwMCxcbiAgICAgICAgcHJvZHVjdElkczogW10sXG4gICAgICAgIGNhdGVnb3J5SWRzOiBbXSxcbiAgICAgICAgZXhjbHVkZVByb2R1Y3RJZHM6IFtdLFxuICAgICAgICBjdXN0b21lcklkczogW10sXG4gICAgICAgIGZpcnN0T3JkZXJPbmx5OiBmYWxzZSxcbiAgICAgICAgdXNhZ2VDb3VudDogMCxcbiAgICAgICAgc3RhcnRzQXQ6IG5vdyxcbiAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgIHN0YWNrYWJsZTogZmFsc2UsXG4gICAgICAgIHByaW9yaXR5OiAwXG4gICAgICB9XG4gICAgfSksXG4gICAgcHJpc21hLnN2bVByb21vdGlvbi5jcmVhdGUoe1xuICAgICAgZGF0YToge1xuICAgICAgICB0ZW5hbnRJZCxcbiAgICAgICAgbmFtZTogJyQyMCBPZmYnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJyQyMCBvZmYgb3JkZXJzIG92ZXIgJDc1IChsaW1pdCAxMDAgdXNlcyknLFxuICAgICAgICBjb2RlOiAnU0FWRTIwJyxcbiAgICAgICAgdHlwZTogJ0NPVVBPTicsXG4gICAgICAgIGRpc2NvdW50VHlwZTogJ0ZJWEVEX0FNT1VOVCcsXG4gICAgICAgIGRpc2NvdW50VmFsdWU6IDIwLFxuICAgICAgICBtaW5PcmRlclRvdGFsOiA3NSxcbiAgICAgICAgdXNhZ2VMaW1pdDogMTAwLFxuICAgICAgICBwZXJDdXN0b21lckxpbWl0OiAxLFxuICAgICAgICBwcm9kdWN0SWRzOiBbXSxcbiAgICAgICAgY2F0ZWdvcnlJZHM6IFtdLFxuICAgICAgICBleGNsdWRlUHJvZHVjdElkczogW10sXG4gICAgICAgIGN1c3RvbWVySWRzOiBbXSxcbiAgICAgICAgZmlyc3RPcmRlck9ubHk6IGZhbHNlLFxuICAgICAgICB1c2FnZUNvdW50OiAwLFxuICAgICAgICBzdGFydHNBdDogbm93LFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgc3RhY2thYmxlOiBmYWxzZSxcbiAgICAgICAgcHJpb3JpdHk6IDBcbiAgICAgIH1cbiAgICB9KVxuICBdKVxuICBcbiAgcmV0dXJuIHByb21vdGlvbnMubWFwKG1hcERiUHJvbW90aW9uVG9JbnRlcmZhY2UpXG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFBST01PVElPTiBDUlVEXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogR2V0IG9yIGNyZWF0ZSBzYW1wbGUgcHJvbW90aW9ucyBmb3IgYSB0ZW5hbnRcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE9yQ3JlYXRlUHJvbW90aW9ucyh0ZW5hbnRJZDogc3RyaW5nKTogUHJvbWlzZTxQcm9tb3Rpb25bXT4ge1xuICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHByaXNtYS5zdm1Qcm9tb3Rpb24uZmluZE1hbnkoe1xuICAgIHdoZXJlOiB7IHRlbmFudElkIH1cbiAgfSlcbiAgXG4gIGlmIChleGlzdGluZy5sZW5ndGggPiAwKSB7XG4gICAgcmV0dXJuIGV4aXN0aW5nLm1hcChtYXBEYlByb21vdGlvblRvSW50ZXJmYWNlKVxuICB9XG4gIFxuICByZXR1cm4gc2VlZERlZmF1bHRQcm9tb3Rpb25zKHRlbmFudElkKVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UHJvbW90aW9ucyh0ZW5hbnRJZDogc3RyaW5nKTogUHJvbWlzZTxQcm9tb3Rpb25bXT4ge1xuICByZXR1cm4gZ2V0T3JDcmVhdGVQcm9tb3Rpb25zKHRlbmFudElkKVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QWN0aXZlUHJvbW90aW9ucyh0ZW5hbnRJZDogc3RyaW5nKTogUHJvbWlzZTxQcm9tb3Rpb25bXT4ge1xuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpXG4gIFxuICBjb25zdCBwcm9tb3Rpb25zID0gYXdhaXQgcHJpc21hLnN2bVByb21vdGlvbi5maW5kTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHRlbmFudElkLFxuICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICBzdGFydHNBdDogeyBsdGU6IG5vdyB9LFxuICAgICAgT1I6IFtcbiAgICAgICAgeyBlbmRzQXQ6IG51bGwgfSxcbiAgICAgICAgeyBlbmRzQXQ6IHsgZ3Q6IG5vdyB9IH1cbiAgICAgIF1cbiAgICB9XG4gIH0pXG4gIFxuICAvLyBGaWx0ZXIgYnkgdXNhZ2UgbGltaXQgaW4gYXBwbGljYXRpb24gbGF5ZXJcbiAgcmV0dXJuIHByb21vdGlvbnNcbiAgICAubWFwKG1hcERiUHJvbW90aW9uVG9JbnRlcmZhY2UpXG4gICAgLmZpbHRlcihwID0+ICFwLnVzYWdlTGltaXQgfHwgcC51c2FnZUNvdW50IDwgcC51c2FnZUxpbWl0KVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QXV0b21hdGljUHJvbW90aW9ucyh0ZW5hbnRJZDogc3RyaW5nKTogUHJvbWlzZTxQcm9tb3Rpb25bXT4ge1xuICBjb25zdCBhY3RpdmUgPSBhd2FpdCBnZXRBY3RpdmVQcm9tb3Rpb25zKHRlbmFudElkKVxuICByZXR1cm4gYWN0aXZlLmZpbHRlcihwID0+IHAudHlwZSA9PT0gJ0FVVE9NQVRJQycgfHwgcC50eXBlID09PSAnRkxBU0hfU0FMRScpXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmaW5kQnlDb2RlKHRlbmFudElkOiBzdHJpbmcsIGNvZGU6IHN0cmluZyk6IFByb21pc2U8UHJvbW90aW9uIHwgbnVsbD4ge1xuICBjb25zdCBwcm9tb3Rpb24gPSBhd2FpdCBwcmlzbWEuc3ZtUHJvbW90aW9uLmZpbmRGaXJzdCh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHRlbmFudElkLFxuICAgICAgY29kZTogeyBlcXVhbHM6IGNvZGUsIG1vZGU6ICdpbnNlbnNpdGl2ZScgfSxcbiAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgc3RhcnRzQXQ6IHsgbHRlOiBuZXcgRGF0ZSgpIH0sXG4gICAgICBPUjogW1xuICAgICAgICB7IGVuZHNBdDogbnVsbCB9LFxuICAgICAgICB7IGVuZHNBdDogeyBndDogbmV3IERhdGUoKSB9IH1cbiAgICAgIF1cbiAgICB9XG4gIH0pXG4gIFxuICBpZiAoIXByb21vdGlvbikgcmV0dXJuIG51bGxcbiAgXG4gIGNvbnN0IG1hcHBlZCA9IG1hcERiUHJvbW90aW9uVG9JbnRlcmZhY2UocHJvbW90aW9uKVxuICBcbiAgLy8gQ2hlY2sgdXNhZ2UgbGltaXRcbiAgaWYgKG1hcHBlZC51c2FnZUxpbWl0ICYmIG1hcHBlZC51c2FnZUNvdW50ID49IG1hcHBlZC51c2FnZUxpbWl0KSB7XG4gICAgcmV0dXJuIG51bGxcbiAgfVxuICBcbiAgcmV0dXJuIG1hcHBlZFxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UHJvbW90aW9uKHRlbmFudElkOiBzdHJpbmcsIHByb21vdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPFByb21vdGlvbiB8IG51bGw+IHtcbiAgY29uc3QgcHJvbW90aW9uID0gYXdhaXQgcHJpc21hLnN2bVByb21vdGlvbi5maW5kRmlyc3Qoe1xuICAgIHdoZXJlOiB7IGlkOiBwcm9tb3Rpb25JZCwgdGVuYW50SWQgfVxuICB9KVxuICBcbiAgcmV0dXJuIHByb21vdGlvbiA/IG1hcERiUHJvbW90aW9uVG9JbnRlcmZhY2UocHJvbW90aW9uKSA6IG51bGxcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZFByb21vdGlvbihwcm9tb3Rpb246IFByb21vdGlvbik6IFByb21pc2U8dm9pZD4ge1xuICBhd2FpdCBwcmlzbWEuc3ZtUHJvbW90aW9uLmNyZWF0ZSh7XG4gICAgZGF0YToge1xuICAgICAgaWQ6IHByb21vdGlvbi5pZCxcbiAgICAgIHRlbmFudElkOiBwcm9tb3Rpb24udGVuYW50SWQsXG4gICAgICBuYW1lOiBwcm9tb3Rpb24ubmFtZSxcbiAgICAgIGRlc2NyaXB0aW9uOiBwcm9tb3Rpb24uZGVzY3JpcHRpb24sXG4gICAgICBjb2RlOiBwcm9tb3Rpb24uY29kZSxcbiAgICAgIHR5cGU6IHByb21vdGlvbi50eXBlLFxuICAgICAgZGlzY291bnRUeXBlOiBwcm9tb3Rpb24uZGlzY291bnRUeXBlLFxuICAgICAgZGlzY291bnRWYWx1ZTogcHJvbW90aW9uLmRpc2NvdW50VmFsdWUsXG4gICAgICBtYXhEaXNjb3VudDogcHJvbW90aW9uLm1heERpc2NvdW50LFxuICAgICAgbWluT3JkZXJUb3RhbDogcHJvbW90aW9uLm1pbk9yZGVyVG90YWwsXG4gICAgICBtaW5RdWFudGl0eTogcHJvbW90aW9uLm1pblF1YW50aXR5LFxuICAgICAgcHJvZHVjdElkczogcHJvbW90aW9uLnByb2R1Y3RJZHMsXG4gICAgICBjYXRlZ29yeUlkczogcHJvbW90aW9uLmNhdGVnb3J5SWRzLFxuICAgICAgZXhjbHVkZVByb2R1Y3RJZHM6IHByb21vdGlvbi5leGNsdWRlUHJvZHVjdElkcyxcbiAgICAgIGN1c3RvbWVySWRzOiBwcm9tb3Rpb24uY3VzdG9tZXJJZHMsXG4gICAgICBmaXJzdE9yZGVyT25seTogcHJvbW90aW9uLmZpcnN0T3JkZXJPbmx5LFxuICAgICAgdXNhZ2VMaW1pdDogcHJvbW90aW9uLnVzYWdlTGltaXQsXG4gICAgICB1c2FnZUNvdW50OiBwcm9tb3Rpb24udXNhZ2VDb3VudCxcbiAgICAgIHBlckN1c3RvbWVyTGltaXQ6IHByb21vdGlvbi5wZXJDdXN0b21lckxpbWl0LFxuICAgICAgYnV5UXVhbnRpdHk6IHByb21vdGlvbi5idXlRdWFudGl0eSxcbiAgICAgIGdldFF1YW50aXR5OiBwcm9tb3Rpb24uZ2V0UXVhbnRpdHksXG4gICAgICBnZXREaXNjb3VudFBlcmNlbnQ6IHByb21vdGlvbi5nZXREaXNjb3VudFBlcmNlbnQsXG4gICAgICBzdGFydHNBdDogcHJvbW90aW9uLnN0YXJ0c0F0LFxuICAgICAgZW5kc0F0OiBwcm9tb3Rpb24uZW5kc0F0LFxuICAgICAgaXNBY3RpdmU6IHByb21vdGlvbi5pc0FjdGl2ZSxcbiAgICAgIHN0YWNrYWJsZTogcHJvbW90aW9uLnN0YWNrYWJsZSxcbiAgICAgIHByaW9yaXR5OiBwcm9tb3Rpb24ucHJpb3JpdHlcbiAgICB9XG4gIH0pXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVQcm9tb3Rpb24odGVuYW50SWQ6IHN0cmluZywgcHJvbW90aW9uSWQ6IHN0cmluZywgdXBkYXRlczogUGFydGlhbDxQcm9tb3Rpb24+KTogUHJvbWlzZTxQcm9tb3Rpb24gfCBudWxsPiB7XG4gIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgcHJpc21hLnN2bVByb21vdGlvbi5maW5kRmlyc3Qoe1xuICAgIHdoZXJlOiB7IGlkOiBwcm9tb3Rpb25JZCwgdGVuYW50SWQgfVxuICB9KVxuICBcbiAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcbiAgXG4gIGNvbnN0IHVwZGF0ZWQgPSBhd2FpdCBwcmlzbWEuc3ZtUHJvbW90aW9uLnVwZGF0ZSh7XG4gICAgd2hlcmU6IHsgaWQ6IHByb21vdGlvbklkIH0sXG4gICAgZGF0YToge1xuICAgICAgbmFtZTogdXBkYXRlcy5uYW1lLFxuICAgICAgZGVzY3JpcHRpb246IHVwZGF0ZXMuZGVzY3JpcHRpb24sXG4gICAgICBkaXNjb3VudFZhbHVlOiB1cGRhdGVzLmRpc2NvdW50VmFsdWUsXG4gICAgICBtYXhEaXNjb3VudDogdXBkYXRlcy5tYXhEaXNjb3VudCxcbiAgICAgIG1pbk9yZGVyVG90YWw6IHVwZGF0ZXMubWluT3JkZXJUb3RhbCxcbiAgICAgIG1pblF1YW50aXR5OiB1cGRhdGVzLm1pblF1YW50aXR5LFxuICAgICAgcHJvZHVjdElkczogdXBkYXRlcy5wcm9kdWN0SWRzLFxuICAgICAgY2F0ZWdvcnlJZHM6IHVwZGF0ZXMuY2F0ZWdvcnlJZHMsXG4gICAgICBleGNsdWRlUHJvZHVjdElkczogdXBkYXRlcy5leGNsdWRlUHJvZHVjdElkcyxcbiAgICAgIGN1c3RvbWVySWRzOiB1cGRhdGVzLmN1c3RvbWVySWRzLFxuICAgICAgZmlyc3RPcmRlck9ubHk6IHVwZGF0ZXMuZmlyc3RPcmRlck9ubHksXG4gICAgICB1c2FnZUxpbWl0OiB1cGRhdGVzLnVzYWdlTGltaXQsXG4gICAgICBwZXJDdXN0b21lckxpbWl0OiB1cGRhdGVzLnBlckN1c3RvbWVyTGltaXQsXG4gICAgICBidXlRdWFudGl0eTogdXBkYXRlcy5idXlRdWFudGl0eSxcbiAgICAgIGdldFF1YW50aXR5OiB1cGRhdGVzLmdldFF1YW50aXR5LFxuICAgICAgZ2V0RGlzY291bnRQZXJjZW50OiB1cGRhdGVzLmdldERpc2NvdW50UGVyY2VudCxcbiAgICAgIHN0YXJ0c0F0OiB1cGRhdGVzLnN0YXJ0c0F0LFxuICAgICAgZW5kc0F0OiB1cGRhdGVzLmVuZHNBdCxcbiAgICAgIGlzQWN0aXZlOiB1cGRhdGVzLmlzQWN0aXZlLFxuICAgICAgc3RhY2thYmxlOiB1cGRhdGVzLnN0YWNrYWJsZSxcbiAgICAgIHByaW9yaXR5OiB1cGRhdGVzLnByaW9yaXR5XG4gICAgfVxuICB9KVxuICBcbiAgcmV0dXJuIG1hcERiUHJvbW90aW9uVG9JbnRlcmZhY2UodXBkYXRlZClcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZVByb21vdGlvbih0ZW5hbnRJZDogc3RyaW5nLCBwcm9tb3Rpb25JZDogc3RyaW5nKTogUHJvbWlzZTxQcm9tb3Rpb24gfCBudWxsPiB7XG4gIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgcHJpc21hLnN2bVByb21vdGlvbi5maW5kRmlyc3Qoe1xuICAgIHdoZXJlOiB7IGlkOiBwcm9tb3Rpb25JZCwgdGVuYW50SWQgfVxuICB9KVxuICBcbiAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcbiAgXG4gIGF3YWl0IHByaXNtYS5zdm1Qcm9tb3Rpb24uZGVsZXRlKHtcbiAgICB3aGVyZTogeyBpZDogcHJvbW90aW9uSWQgfVxuICB9KVxuICBcbiAgcmV0dXJuIG1hcERiUHJvbW90aW9uVG9JbnRlcmZhY2UoZXhpc3RpbmcpXG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFVTQUdFIFRSQUNLSU5HXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZWNvcmRVc2FnZShcbiAgcHJvbW90aW9uSWQ6IHN0cmluZyxcbiAgb3JkZXJJZDogc3RyaW5nLFxuICBjdXN0b21lcklkOiBzdHJpbmcgfCB1bmRlZmluZWQsXG4gIGRpc2NvdW50QXBwbGllZDogbnVtYmVyXG4pOiBQcm9taXNlPFByb21vdGlvblVzYWdlPiB7XG4gIGNvbnN0IHVzYWdlID0gYXdhaXQgcHJpc21hLnN2bVByb21vdGlvblVzYWdlLmNyZWF0ZSh7XG4gICAgZGF0YToge1xuICAgICAgcHJvbW90aW9uSWQsXG4gICAgICBvcmRlcklkLFxuICAgICAgY3VzdG9tZXJJZCxcbiAgICAgIGRpc2NvdW50QXBwbGllZFxuICAgIH1cbiAgfSlcbiAgXG4gIC8vIEluY3JlbWVudCB1c2FnZSBjb3VudCBvbiBwcm9tb3Rpb25cbiAgYXdhaXQgcHJpc21hLnN2bVByb21vdGlvbi51cGRhdGUoe1xuICAgIHdoZXJlOiB7IGlkOiBwcm9tb3Rpb25JZCB9LFxuICAgIGRhdGE6IHsgdXNhZ2VDb3VudDogeyBpbmNyZW1lbnQ6IDEgfSB9XG4gIH0pXG4gIFxuICByZXR1cm4ge1xuICAgIGlkOiB1c2FnZS5pZCxcbiAgICBwcm9tb3Rpb25JZDogdXNhZ2UucHJvbW90aW9uSWQsXG4gICAgb3JkZXJJZDogdXNhZ2Uub3JkZXJJZCxcbiAgICBjdXN0b21lcklkOiB1c2FnZS5jdXN0b21lcklkIHx8IHVuZGVmaW5lZCxcbiAgICBkaXNjb3VudEFwcGxpZWQ6IE51bWJlcih1c2FnZS5kaXNjb3VudEFwcGxpZWQpLFxuICAgIGNyZWF0ZWRBdDogdXNhZ2UuY3JlYXRlZEF0XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1c3RvbWVyVXNhZ2VDb3VudChwcm9tb3Rpb25JZDogc3RyaW5nLCBjdXN0b21lcklkPzogc3RyaW5nKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgaWYgKCFjdXN0b21lcklkKSByZXR1cm4gMFxuICBcbiAgY29uc3QgY291bnQgPSBhd2FpdCBwcmlzbWEuc3ZtUHJvbW90aW9uVXNhZ2UuY291bnQoe1xuICAgIHdoZXJlOiB7IHByb21vdGlvbklkLCBjdXN0b21lcklkIH1cbiAgfSlcbiAgXG4gIHJldHVybiBjb3VudFxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBWQUxJREFUSU9OICYgQ0FMQ1VMQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBWYWxpZGF0aW9uUmVzdWx0IHtcbiAgdmFsaWQ6IGJvb2xlYW5cbiAgZXJyb3I/OiBzdHJpbmdcbiAgZXJyb3JDb2RlPzogc3RyaW5nXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2YWxpZGF0ZVByb21vdGlvbihcbiAgcHJvbW90aW9uOiBQcm9tb3Rpb24sXG4gIHN1YnRvdGFsOiBudW1iZXIsXG4gIHRvdGFsUXVhbnRpdHk6IG51bWJlcixcbiAgY3VzdG9tZXJJZD86IHN0cmluZyxcbiAgaXNGaXJzdE9yZGVyPzogYm9vbGVhbixcbiAgY3VycmVudERpc2NvdW50czogQXBwbGllZFByb21vdGlvbltdID0gW11cbik6IFByb21pc2U8VmFsaWRhdGlvblJlc3VsdD4ge1xuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpXG4gIFxuICBpZiAoIXByb21vdGlvbi5pc0FjdGl2ZSkge1xuICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICdUaGlzIHByb21vdGlvbiBpcyBubyBsb25nZXIgYWN0aXZlJywgZXJyb3JDb2RlOiAnSU5BQ1RJVkUnIH1cbiAgfVxuICBcbiAgaWYgKHByb21vdGlvbi5zdGFydHNBdCA+IG5vdykge1xuICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICdUaGlzIHByb21vdGlvbiBoYXMgbm90IHN0YXJ0ZWQgeWV0JywgZXJyb3JDb2RlOiAnTk9UX1NUQVJURUQnIH1cbiAgfVxuICBcbiAgaWYgKHByb21vdGlvbi5lbmRzQXQgJiYgcHJvbW90aW9uLmVuZHNBdCA8IG5vdykge1xuICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICdUaGlzIHByb21vdGlvbiBoYXMgZXhwaXJlZCcsIGVycm9yQ29kZTogJ0VYUElSRUQnIH1cbiAgfVxuICBcbiAgaWYgKHByb21vdGlvbi51c2FnZUxpbWl0ICYmIHByb21vdGlvbi51c2FnZUNvdW50ID49IHByb21vdGlvbi51c2FnZUxpbWl0KSB7XG4gICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBlcnJvcjogJ1RoaXMgcHJvbW90aW9uIGhhcyByZWFjaGVkIGl0cyB1c2FnZSBsaW1pdCcsIGVycm9yQ29kZTogJ1VTQUdFX0xJTUlUX1JFQUNIRUQnIH1cbiAgfVxuICBcbiAgY29uc3QgY3VzdG9tZXJVc2FnZUNvdW50ID0gYXdhaXQgZ2V0Q3VzdG9tZXJVc2FnZUNvdW50KHByb21vdGlvbi5pZCwgY3VzdG9tZXJJZClcbiAgaWYgKHByb21vdGlvbi5wZXJDdXN0b21lckxpbWl0ICYmIGN1c3RvbWVyVXNhZ2VDb3VudCA+PSBwcm9tb3Rpb24ucGVyQ3VzdG9tZXJMaW1pdCkge1xuICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICdZb3UgaGF2ZSBhbHJlYWR5IHVzZWQgdGhpcyBwcm9tb3Rpb24gdGhlIG1heGltdW0gbnVtYmVyIG9mIHRpbWVzJywgZXJyb3JDb2RlOiAnQ1VTVE9NRVJfTElNSVRfUkVBQ0hFRCcgfVxuICB9XG4gIFxuICBpZiAocHJvbW90aW9uLmN1c3RvbWVySWRzLmxlbmd0aCA+IDAgJiYgY3VzdG9tZXJJZCkge1xuICAgIGlmICghcHJvbW90aW9uLmN1c3RvbWVySWRzLmluY2x1ZGVzKGN1c3RvbWVySWQpKSB7XG4gICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnVGhpcyBwcm9tb3Rpb24gaXMgbm90IGF2YWlsYWJsZSBmb3IgeW91ciBhY2NvdW50JywgZXJyb3JDb2RlOiAnQ1VTVE9NRVJfTk9UX0VMSUdJQkxFJyB9XG4gICAgfVxuICB9XG4gIFxuICBpZiAocHJvbW90aW9uLmZpcnN0T3JkZXJPbmx5ICYmICFpc0ZpcnN0T3JkZXIpIHtcbiAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnVGhpcyBwcm9tb3Rpb24gaXMgb25seSB2YWxpZCBmb3IgZmlyc3QtdGltZSBvcmRlcnMnLCBlcnJvckNvZGU6ICdGSVJTVF9PUkRFUl9PTkxZJyB9XG4gIH1cbiAgXG4gIGlmIChwcm9tb3Rpb24ubWluT3JkZXJUb3RhbCAmJiBzdWJ0b3RhbCA8IHByb21vdGlvbi5taW5PcmRlclRvdGFsKSB7XG4gICAgcmV0dXJuIHsgXG4gICAgICB2YWxpZDogZmFsc2UsIFxuICAgICAgZXJyb3I6IGBNaW5pbXVtIG9yZGVyIHRvdGFsIG9mICQke3Byb21vdGlvbi5taW5PcmRlclRvdGFsLnRvRml4ZWQoMil9IHJlcXVpcmVkYCxcbiAgICAgIGVycm9yQ29kZTogJ01JTl9PUkRFUl9OT1RfTUVUJ1xuICAgIH1cbiAgfVxuICBcbiAgaWYgKHByb21vdGlvbi5taW5RdWFudGl0eSAmJiB0b3RhbFF1YW50aXR5IDwgcHJvbW90aW9uLm1pblF1YW50aXR5KSB7XG4gICAgcmV0dXJuIHsgXG4gICAgICB2YWxpZDogZmFsc2UsIFxuICAgICAgZXJyb3I6IGBNaW5pbXVtIG9mICR7cHJvbW90aW9uLm1pblF1YW50aXR5fSBpdGVtcyByZXF1aXJlZGAsXG4gICAgICBlcnJvckNvZGU6ICdNSU5fUVVBTlRJVFlfTk9UX01FVCdcbiAgICB9XG4gIH1cbiAgXG4gIGlmICghcHJvbW90aW9uLnN0YWNrYWJsZSAmJiBjdXJyZW50RGlzY291bnRzLmxlbmd0aCA+IDApIHtcbiAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnVGhpcyBwcm9tb3Rpb24gY2Fubm90IGJlIGNvbWJpbmVkIHdpdGggb3RoZXIgZGlzY291bnRzJywgZXJyb3JDb2RlOiAnTk9UX1NUQUNLQUJMRScgfVxuICB9XG4gIFxuICBpZiAoY3VycmVudERpc2NvdW50cy5zb21lKGQgPT4gZC5wcm9tb3Rpb25JZCA9PT0gcHJvbW90aW9uLmlkKSkge1xuICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICdUaGlzIHByb21vdGlvbiBpcyBhbHJlYWR5IGFwcGxpZWQnLCBlcnJvckNvZGU6ICdBTFJFQURZX0FQUExJRUQnIH1cbiAgfVxuICBcbiAgcmV0dXJuIHsgdmFsaWQ6IHRydWUgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RWxpZ2libGVJdGVtcyhwcm9tb3Rpb246IFByb21vdGlvbiwgaXRlbXM6IFByb21vdGlvbkNhcnRJdGVtW10pOiBQcm9tb3Rpb25DYXJ0SXRlbVtdIHtcbiAgcmV0dXJuIGl0ZW1zLmZpbHRlcihpdGVtID0+IHtcbiAgICBpZiAocHJvbW90aW9uLmV4Y2x1ZGVQcm9kdWN0SWRzLmluY2x1ZGVzKGl0ZW0ucHJvZHVjdElkKSkge1xuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuICAgIFxuICAgIGlmIChwcm9tb3Rpb24ucHJvZHVjdElkcy5sZW5ndGggPT09IDAgJiYgcHJvbW90aW9uLmNhdGVnb3J5SWRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gICAgXG4gICAgaWYgKHByb21vdGlvbi5wcm9kdWN0SWRzLmxlbmd0aCA+IDAgJiYgcHJvbW90aW9uLnByb2R1Y3RJZHMuaW5jbHVkZXMoaXRlbS5wcm9kdWN0SWQpKSB7XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgICBcbiAgICBpZiAocHJvbW90aW9uLmNhdGVnb3J5SWRzLmxlbmd0aCA+IDAgJiYgaXRlbS5jYXRlZ29yeUlkICYmIHByb21vdGlvbi5jYXRlZ29yeUlkcy5pbmNsdWRlcyhpdGVtLmNhdGVnb3J5SWQpKSB7XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZmFsc2VcbiAgfSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZURpc2NvdW50KFxuICBwcm9tb3Rpb246IFByb21vdGlvbixcbiAgaXRlbXM6IFByb21vdGlvbkNhcnRJdGVtW10sXG4gIHN1YnRvdGFsOiBudW1iZXIsXG4gIHNoaXBwaW5nVG90YWw/OiBudW1iZXJcbik6IEFwcGxpZWRQcm9tb3Rpb24gfCBudWxsIHtcbiAgY29uc3QgZWxpZ2libGVJdGVtcyA9IGdldEVsaWdpYmxlSXRlbXMocHJvbW90aW9uLCBpdGVtcylcbiAgXG4gIGxldCBkaXNjb3VudEFtb3VudCA9IG5ldyBEZWNpbWFsKDApXG4gIGxldCBvcmlnaW5hbEFtb3VudDogbnVtYmVyIHwgdW5kZWZpbmVkXG4gIGxldCBmcmVlU2hpcHBpbmcgPSBmYWxzZVxuICBsZXQgYWZmZWN0ZWRJdGVtczogc3RyaW5nW10gPSBbXVxuICBsZXQgbWVzc2FnZSA9ICcnXG4gIFxuICBzd2l0Y2ggKHByb21vdGlvbi5kaXNjb3VudFR5cGUpIHtcbiAgICBjYXNlICdQRVJDRU5UQUdFJzoge1xuICAgICAgY29uc3QgZWxpZ2libGVTdWJ0b3RhbCA9IGVsaWdpYmxlSXRlbXMucmVkdWNlKFxuICAgICAgICAoc3VtLCBpdGVtKSA9PiBzdW0gKyAoaXRlbS51bml0UHJpY2UgKiBpdGVtLnF1YW50aXR5KSwgMFxuICAgICAgKVxuICAgICAgXG4gICAgICBjb25zdCBwZXJjZW50RGlzY291bnQgPSBuZXcgRGVjaW1hbChlbGlnaWJsZVN1YnRvdGFsKVxuICAgICAgICAudGltZXMocHJvbW90aW9uLmRpc2NvdW50VmFsdWUpXG4gICAgICAgIC5kaXZpZGVkQnkoMTAwKVxuICAgICAgXG4gICAgICBvcmlnaW5hbEFtb3VudCA9IHBlcmNlbnREaXNjb3VudC50b0RlY2ltYWxQbGFjZXMoMikudG9OdW1iZXIoKVxuICAgICAgXG4gICAgICBpZiAocHJvbW90aW9uLm1heERpc2NvdW50ICYmIHBlcmNlbnREaXNjb3VudC5ncmVhdGVyVGhhbihwcm9tb3Rpb24ubWF4RGlzY291bnQpKSB7XG4gICAgICAgIGRpc2NvdW50QW1vdW50ID0gbmV3IERlY2ltYWwocHJvbW90aW9uLm1heERpc2NvdW50KVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGlzY291bnRBbW91bnQgPSBwZXJjZW50RGlzY291bnRcbiAgICAgIH1cbiAgICAgIFxuICAgICAgYWZmZWN0ZWRJdGVtcyA9IGVsaWdpYmxlSXRlbXMubWFwKGkgPT4gaS5wcm9kdWN0SWQpXG4gICAgICBtZXNzYWdlID0gYCR7cHJvbW90aW9uLmRpc2NvdW50VmFsdWV9JSBvZmYke2FmZmVjdGVkSXRlbXMubGVuZ3RoIDwgaXRlbXMubGVuZ3RoID8gJyBlbGlnaWJsZSBpdGVtcycgOiAnJ31gXG4gICAgICBicmVha1xuICAgIH1cbiAgICBcbiAgICBjYXNlICdGSVhFRF9BTU9VTlQnOiB7XG4gICAgICBkaXNjb3VudEFtb3VudCA9IG5ldyBEZWNpbWFsKHByb21vdGlvbi5kaXNjb3VudFZhbHVlKVxuICAgICAgaWYgKGRpc2NvdW50QW1vdW50LmdyZWF0ZXJUaGFuKHN1YnRvdGFsKSkge1xuICAgICAgICBkaXNjb3VudEFtb3VudCA9IG5ldyBEZWNpbWFsKHN1YnRvdGFsKVxuICAgICAgfVxuICAgICAgbWVzc2FnZSA9IGAkJHtwcm9tb3Rpb24uZGlzY291bnRWYWx1ZS50b0ZpeGVkKDIpfSBvZmYgeW91ciBvcmRlcmBcbiAgICAgIGJyZWFrXG4gICAgfVxuICAgIFxuICAgIGNhc2UgJ0ZJWEVEX1BFUl9JVEVNJzoge1xuICAgICAgY29uc3QgdG90YWxFbGlnaWJsZVF0eSA9IGVsaWdpYmxlSXRlbXMucmVkdWNlKChzdW0sIGl0ZW0pID0+IHN1bSArIGl0ZW0ucXVhbnRpdHksIDApXG4gICAgICBkaXNjb3VudEFtb3VudCA9IG5ldyBEZWNpbWFsKHByb21vdGlvbi5kaXNjb3VudFZhbHVlKS50aW1lcyh0b3RhbEVsaWdpYmxlUXR5KVxuICAgICAgXG4gICAgICBjb25zdCBlbGlnaWJsZVN1YnRvdGFsID0gZWxpZ2libGVJdGVtcy5yZWR1Y2UoXG4gICAgICAgIChzdW0sIGl0ZW0pID0+IHN1bSArIChpdGVtLnVuaXRQcmljZSAqIGl0ZW0ucXVhbnRpdHkpLCAwXG4gICAgICApXG4gICAgICBpZiAoZGlzY291bnRBbW91bnQuZ3JlYXRlclRoYW4oZWxpZ2libGVTdWJ0b3RhbCkpIHtcbiAgICAgICAgZGlzY291bnRBbW91bnQgPSBuZXcgRGVjaW1hbChlbGlnaWJsZVN1YnRvdGFsKVxuICAgICAgfVxuICAgICAgXG4gICAgICBhZmZlY3RlZEl0ZW1zID0gZWxpZ2libGVJdGVtcy5tYXAoaSA9PiBpLnByb2R1Y3RJZClcbiAgICAgIG1lc3NhZ2UgPSBgJCR7cHJvbW90aW9uLmRpc2NvdW50VmFsdWUudG9GaXhlZCgyKX0gb2ZmIGVhY2ggZWxpZ2libGUgaXRlbWBcbiAgICAgIGJyZWFrXG4gICAgfVxuICAgIFxuICAgIGNhc2UgJ0ZSRUVfU0hJUFBJTkcnOiB7XG4gICAgICBmcmVlU2hpcHBpbmcgPSB0cnVlXG4gICAgICBtZXNzYWdlID0gJ0ZyZWUgc2hpcHBpbmcnXG4gICAgICBicmVha1xuICAgIH1cbiAgICBcbiAgICBjYXNlICdCVVlfWF9HRVRfWSc6IHtcbiAgICAgIGlmICghcHJvbW90aW9uLmJ1eVF1YW50aXR5IHx8ICFwcm9tb3Rpb24uZ2V0UXVhbnRpdHkpIHtcbiAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc3Qgc29ydGVkSXRlbXMgPSBbLi4uZWxpZ2libGVJdGVtc10uc29ydCgoYSwgYikgPT4gYi51bml0UHJpY2UgLSBhLnVuaXRQcmljZSlcbiAgICAgIGNvbnN0IHRvdGFsUXR5ID0gc29ydGVkSXRlbXMucmVkdWNlKChzdW0sIGl0ZW0pID0+IHN1bSArIGl0ZW0ucXVhbnRpdHksIDApXG4gICAgICBcbiAgICAgIGNvbnN0IGRlYWxTaXplID0gcHJvbW90aW9uLmJ1eVF1YW50aXR5ICsgcHJvbW90aW9uLmdldFF1YW50aXR5XG4gICAgICBjb25zdCBudW1EZWFscyA9IE1hdGguZmxvb3IodG90YWxRdHkgLyBkZWFsU2l6ZSlcbiAgICAgIFxuICAgICAgaWYgKG51bURlYWxzID09PSAwKSB7XG4gICAgICAgIHJldHVybiBudWxsXG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IGRpc2NvdW50UGVyY2VudCA9IHByb21vdGlvbi5nZXREaXNjb3VudFBlcmNlbnQgfHwgMTAwXG4gICAgICBsZXQgZGlzY291bnRlZEl0ZW1zID0gMFxuICAgICAgbGV0IHRvdGFsRGlzY291bnQgPSBuZXcgRGVjaW1hbCgwKVxuICAgICAgXG4gICAgICBjb25zdCByZXZlcnNlZEl0ZW1zID0gWy4uLnNvcnRlZEl0ZW1zXS5yZXZlcnNlKClcbiAgICAgIGZvciAoY29uc3QgaXRlbSBvZiByZXZlcnNlZEl0ZW1zKSB7XG4gICAgICAgIGNvbnN0IGl0ZW1zVG9EaXNjb3VudCA9IE1hdGgubWluKFxuICAgICAgICAgIGl0ZW0ucXVhbnRpdHksXG4gICAgICAgICAgKG51bURlYWxzICogcHJvbW90aW9uLmdldFF1YW50aXR5KSAtIGRpc2NvdW50ZWRJdGVtc1xuICAgICAgICApXG4gICAgICAgIFxuICAgICAgICBpZiAoaXRlbXNUb0Rpc2NvdW50ID4gMCkge1xuICAgICAgICAgIGNvbnN0IGl0ZW1EaXNjb3VudCA9IG5ldyBEZWNpbWFsKGl0ZW0udW5pdFByaWNlKVxuICAgICAgICAgICAgLnRpbWVzKGl0ZW1zVG9EaXNjb3VudClcbiAgICAgICAgICAgIC50aW1lcyhkaXNjb3VudFBlcmNlbnQpXG4gICAgICAgICAgICAuZGl2aWRlZEJ5KDEwMClcbiAgICAgICAgICBcbiAgICAgICAgICB0b3RhbERpc2NvdW50ID0gdG90YWxEaXNjb3VudC5wbHVzKGl0ZW1EaXNjb3VudClcbiAgICAgICAgICBkaXNjb3VudGVkSXRlbXMgKz0gaXRlbXNUb0Rpc2NvdW50XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmIChkaXNjb3VudGVkSXRlbXMgPj0gbnVtRGVhbHMgKiBwcm9tb3Rpb24uZ2V0UXVhbnRpdHkpIHtcbiAgICAgICAgICBicmVha1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIGRpc2NvdW50QW1vdW50ID0gdG90YWxEaXNjb3VudFxuICAgICAgYWZmZWN0ZWRJdGVtcyA9IGVsaWdpYmxlSXRlbXMubWFwKGkgPT4gaS5wcm9kdWN0SWQpXG4gICAgICBcbiAgICAgIGNvbnN0IGdldERlc2MgPSBkaXNjb3VudFBlcmNlbnQgPT09IDEwMCA/ICdmcmVlJyA6IGAke2Rpc2NvdW50UGVyY2VudH0lIG9mZmBcbiAgICAgIG1lc3NhZ2UgPSBgQnV5ICR7cHJvbW90aW9uLmJ1eVF1YW50aXR5fSBnZXQgJHtwcm9tb3Rpb24uZ2V0UXVhbnRpdHl9ICR7Z2V0RGVzY31gXG4gICAgICBicmVha1xuICAgIH1cbiAgfVxuICBcbiAgY29uc3QgZmluYWxEaXNjb3VudCA9IGRpc2NvdW50QW1vdW50LnRvRGVjaW1hbFBsYWNlcygyKS50b051bWJlcigpXG4gIFxuICBpZiAoZmluYWxEaXNjb3VudCA9PT0gMCAmJiAhZnJlZVNoaXBwaW5nKSB7XG4gICAgcmV0dXJuIG51bGxcbiAgfVxuICBcbiAgcmV0dXJuIHtcbiAgICBwcm9tb3Rpb25JZDogcHJvbW90aW9uLmlkLFxuICAgIHByb21vdGlvbk5hbWU6IHByb21vdGlvbi5uYW1lLFxuICAgIGNvZGU6IHByb21vdGlvbi5jb2RlLFxuICAgIGRpc2NvdW50VHlwZTogcHJvbW90aW9uLmRpc2NvdW50VHlwZSxcbiAgICBkaXNjb3VudEFtb3VudDogZmluYWxEaXNjb3VudCxcbiAgICBvcmlnaW5hbEFtb3VudCxcbiAgICBjYXBwZWRBbW91bnQ6IG9yaWdpbmFsQW1vdW50ICYmIG9yaWdpbmFsQW1vdW50ID4gZmluYWxEaXNjb3VudCA/IGZpbmFsRGlzY291bnQgOiB1bmRlZmluZWQsXG4gICAgYWZmZWN0ZWRJdGVtczogYWZmZWN0ZWRJdGVtcy5sZW5ndGggPiAwID8gYWZmZWN0ZWRJdGVtcyA6IHVuZGVmaW5lZCxcbiAgICBmcmVlU2hpcHBpbmcsXG4gICAgbWVzc2FnZVxuICB9XG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwiRGVjaW1hbCIsImdlbmVyYXRlSWQiLCJwcmVmaXgiLCJEYXRlIiwibm93IiwidG9TdHJpbmciLCJNYXRoIiwicmFuZG9tIiwic3Vic3RyaW5nIiwiZGVjaW1hbFRvTnVtYmVyIiwidmFsIiwidW5kZWZpbmVkIiwiTnVtYmVyIiwibWFwRGJQcm9tb3Rpb25Ub0ludGVyZmFjZSIsImRiUHJvbW8iLCJpZCIsInRlbmFudElkIiwibmFtZSIsImRlc2NyaXB0aW9uIiwiY29kZSIsInR5cGUiLCJkaXNjb3VudFR5cGUiLCJkaXNjb3VudFZhbHVlIiwibWF4RGlzY291bnQiLCJtaW5PcmRlclRvdGFsIiwibWluUXVhbnRpdHkiLCJwcm9kdWN0SWRzIiwiY2F0ZWdvcnlJZHMiLCJleGNsdWRlUHJvZHVjdElkcyIsImN1c3RvbWVySWRzIiwiZmlyc3RPcmRlck9ubHkiLCJ1c2FnZUxpbWl0IiwidXNhZ2VDb3VudCIsInBlckN1c3RvbWVyTGltaXQiLCJzdGFydHNBdCIsImVuZHNBdCIsImlzQWN0aXZlIiwic3RhY2thYmxlIiwicHJpb3JpdHkiLCJidXlRdWFudGl0eSIsImdldFF1YW50aXR5IiwiZ2V0RGlzY291bnRQZXJjZW50IiwiY3JlYXRlZEF0IiwidG9JU09TdHJpbmciLCJ1cGRhdGVkQXQiLCJzZWVkRGVmYXVsdFByb21vdGlvbnMiLCJwcm9tb3Rpb25zIiwiJHRyYW5zYWN0aW9uIiwic3ZtUHJvbW90aW9uIiwiY3JlYXRlIiwiZGF0YSIsIm1hcCIsImdldE9yQ3JlYXRlUHJvbW90aW9ucyIsImV4aXN0aW5nIiwiZmluZE1hbnkiLCJ3aGVyZSIsImxlbmd0aCIsImdldFByb21vdGlvbnMiLCJnZXRBY3RpdmVQcm9tb3Rpb25zIiwibHRlIiwiT1IiLCJndCIsImZpbHRlciIsInAiLCJnZXRBdXRvbWF0aWNQcm9tb3Rpb25zIiwiYWN0aXZlIiwiZmluZEJ5Q29kZSIsInByb21vdGlvbiIsImZpbmRGaXJzdCIsImVxdWFscyIsIm1vZGUiLCJtYXBwZWQiLCJnZXRQcm9tb3Rpb24iLCJwcm9tb3Rpb25JZCIsImFkZFByb21vdGlvbiIsInVwZGF0ZVByb21vdGlvbiIsInVwZGF0ZXMiLCJ1cGRhdGVkIiwidXBkYXRlIiwiZGVsZXRlUHJvbW90aW9uIiwiZGVsZXRlIiwicmVjb3JkVXNhZ2UiLCJvcmRlcklkIiwiY3VzdG9tZXJJZCIsImRpc2NvdW50QXBwbGllZCIsInVzYWdlIiwic3ZtUHJvbW90aW9uVXNhZ2UiLCJpbmNyZW1lbnQiLCJnZXRDdXN0b21lclVzYWdlQ291bnQiLCJjb3VudCIsInZhbGlkYXRlUHJvbW90aW9uIiwic3VidG90YWwiLCJ0b3RhbFF1YW50aXR5IiwiaXNGaXJzdE9yZGVyIiwiY3VycmVudERpc2NvdW50cyIsInZhbGlkIiwiZXJyb3IiLCJlcnJvckNvZGUiLCJjdXN0b21lclVzYWdlQ291bnQiLCJpbmNsdWRlcyIsInRvRml4ZWQiLCJzb21lIiwiZCIsImdldEVsaWdpYmxlSXRlbXMiLCJpdGVtcyIsIml0ZW0iLCJwcm9kdWN0SWQiLCJjYXRlZ29yeUlkIiwiY2FsY3VsYXRlRGlzY291bnQiLCJzaGlwcGluZ1RvdGFsIiwiZWxpZ2libGVJdGVtcyIsImRpc2NvdW50QW1vdW50Iiwib3JpZ2luYWxBbW91bnQiLCJmcmVlU2hpcHBpbmciLCJhZmZlY3RlZEl0ZW1zIiwibWVzc2FnZSIsImVsaWdpYmxlU3VidG90YWwiLCJyZWR1Y2UiLCJzdW0iLCJ1bml0UHJpY2UiLCJxdWFudGl0eSIsInBlcmNlbnREaXNjb3VudCIsInRpbWVzIiwiZGl2aWRlZEJ5IiwidG9EZWNpbWFsUGxhY2VzIiwidG9OdW1iZXIiLCJncmVhdGVyVGhhbiIsImkiLCJ0b3RhbEVsaWdpYmxlUXR5Iiwic29ydGVkSXRlbXMiLCJzb3J0IiwiYSIsImIiLCJ0b3RhbFF0eSIsImRlYWxTaXplIiwibnVtRGVhbHMiLCJmbG9vciIsImRpc2NvdW50UGVyY2VudCIsImRpc2NvdW50ZWRJdGVtcyIsInRvdGFsRGlzY291bnQiLCJyZXZlcnNlZEl0ZW1zIiwicmV2ZXJzZSIsIml0ZW1zVG9EaXNjb3VudCIsIm1pbiIsIml0ZW1EaXNjb3VudCIsInBsdXMiLCJnZXREZXNjIiwiZmluYWxEaXNjb3VudCIsInByb21vdGlvbk5hbWUiLCJjYXBwZWRBbW91bnQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/promotions-storage.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/tenant-isolation.ts":
/*!*************************************!*\
  !*** ./src/lib/tenant-isolation.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PARTNER_SCOPED_MODELS: () => (/* binding */ PARTNER_SCOPED_MODELS),\n/* harmony export */   PLATFORM_MODELS: () => (/* binding */ PLATFORM_MODELS),\n/* harmony export */   TENANT_SCOPED_MODELS: () => (/* binding */ TENANT_SCOPED_MODELS),\n/* harmony export */   TenantIsolationError: () => (/* binding */ TenantIsolationError),\n/* harmony export */   clearViolationLogs: () => (/* binding */ clearViolationLogs),\n/* harmony export */   createPartnerContext: () => (/* binding */ createPartnerContext),\n/* harmony export */   createTenantContext: () => (/* binding */ createTenantContext),\n/* harmony export */   getViolationLogs: () => (/* binding */ getViolationLogs),\n/* harmony export */   isPartnerScopedModel: () => (/* binding */ isPartnerScopedModel),\n/* harmony export */   isTenantScopedModel: () => (/* binding */ isTenantScopedModel),\n/* harmony export */   logViolation: () => (/* binding */ logViolation),\n/* harmony export */   validatePartnerAccess: () => (/* binding */ validatePartnerAccess),\n/* harmony export */   validateTenantAccess: () => (/* binding */ validateTenantAccess),\n/* harmony export */   withPartnerData: () => (/* binding */ withPartnerData),\n/* harmony export */   withPartnerFilter: () => (/* binding */ withPartnerFilter),\n/* harmony export */   withTenantData: () => (/* binding */ withTenantData),\n/* harmony export */   withTenantFilter: () => (/* binding */ withTenantFilter)\n/* harmony export */ });\n/**\n * Tenant Isolation Enforcement\n * \n * This module provides strict tenant data isolation at the database level.\n * Instead of Prisma middleware (which has async context issues), this uses\n * application-level validation before queries are executed.\n * \n * Features:\n * - Pre-query validation functions\n * - SUPER_ADMIN bypass with explicit flag\n * - Violation logging and hard failure\n * - Safe query builders that enforce tenant scoping\n */ // Models that require tenant isolation (tenant-scoped)\nconst TENANT_SCOPED_MODELS = [\n    \"TenantMembership\",\n    \"TenantDomain\",\n    \"AuditLog\"\n];\n// Models that require partner isolation (partner-scoped)\n// These are separate from tenant isolation - partners are platform-level\nconst PARTNER_SCOPED_MODELS = [\n    \"PartnerUser\",\n    \"PartnerAgreement\",\n    \"PartnerReferralCode\",\n    \"PartnerReferral\",\n    \"PartnerEarning\"\n];\n// Platform-level models (no isolation, Super Admin only)\nconst PLATFORM_MODELS = [\n    \"Partner\",\n    \"User\",\n    \"Tenant\",\n    \"Session\",\n    \"MagicLink\"\n];\nconst violations = [];\nconst MAX_VIOLATION_LOGS = 1000;\nfunction logViolation(violation) {\n    const log = {\n        ...violation,\n        timestamp: new Date()\n    };\n    violations.push(log);\n    if (violations.length > MAX_VIOLATION_LOGS) {\n        violations.shift();\n    }\n    console.error(\"[TENANT ISOLATION VIOLATION]\", JSON.stringify(log, null, 2));\n}\nfunction getViolationLogs() {\n    return [\n        ...violations\n    ];\n}\nfunction clearViolationLogs() {\n    violations.length = 0;\n}\n/**\n * Tenant Isolation Error\n */ class TenantIsolationError extends Error {\n    constructor(message, model, action, context){\n        super(message);\n        this.model = model;\n        this.action = action;\n        this.context = context;\n        this.name = \"TenantIsolationError\";\n    }\n}\n/**\n * Check if a model is tenant-scoped\n */ function isTenantScopedModel(model) {\n    return TENANT_SCOPED_MODELS.includes(model);\n}\n/**\n * Validate tenant context before executing a query\n * This should be called before any tenant-scoped database operation\n */ function validateTenantAccess(model, action, context, queryTenantId) {\n    // Skip validation for global models\n    if (!isTenantScopedModel(model)) {\n        return;\n    }\n    // Allow explicit bypass (for migrations, admin tools, etc.)\n    if (context?.bypassIsolation === true) {\n        if (!context.isSuperAdmin) {\n            const reason = \"Bypass isolation attempted without SUPER_ADMIN role\";\n            logViolation({\n                model,\n                action,\n                context,\n                query: {\n                    queryTenantId\n                },\n                reason\n            });\n            throw new TenantIsolationError(reason, model, action, context);\n        }\n        return;\n    }\n    // SUPER_ADMIN can access all data\n    if (context?.isSuperAdmin) {\n        return;\n    }\n    // No context = violation\n    if (!context) {\n        const reason = \"No tenant context provided for tenant-scoped query\";\n        logViolation({\n            model,\n            action,\n            context,\n            query: {\n                queryTenantId\n            },\n            reason\n        });\n        throw new TenantIsolationError(reason, model, action, context);\n    }\n    // No tenantId in context = violation\n    if (!context.tenantId) {\n        const reason = \"No tenantId in context for tenant-scoped query\";\n        logViolation({\n            model,\n            action,\n            context,\n            query: {\n                queryTenantId\n            },\n            reason\n        });\n        throw new TenantIsolationError(reason, model, action, context);\n    }\n    // If query specifies a tenantId, it must match context\n    if (queryTenantId && queryTenantId !== context.tenantId) {\n        const reason = `Cross-tenant access attempt: query tenantId (${queryTenantId}) != context tenantId (${context.tenantId})`;\n        logViolation({\n            model,\n            action,\n            context,\n            query: {\n                queryTenantId\n            },\n            reason\n        });\n        throw new TenantIsolationError(reason, model, action, context);\n    }\n}\n/**\n * Create a tenant context from user session\n */ function createTenantContext(tenantId, userId, isSuperAdmin, bypassIsolation = false) {\n    return {\n        tenantId,\n        userId,\n        isSuperAdmin,\n        bypassIsolation\n    };\n}\n/**\n * Create a partner context from user session\n */ function createPartnerContext(partnerId, userId, isSuperAdmin, isPartnerOwner = false, isPartnerAdmin = false, bypassIsolation = false) {\n    return {\n        partnerId,\n        userId,\n        isSuperAdmin,\n        isPartnerOwner,\n        isPartnerAdmin,\n        bypassIsolation\n    };\n}\n/**\n * Ensure a WHERE clause includes the correct tenantId\n */ function withTenantFilter(where, tenantId) {\n    return {\n        ...where,\n        tenantId\n    };\n}\n/**\n * Ensure data being created includes the correct tenantId\n */ function withTenantData(data, tenantId) {\n    return {\n        ...data,\n        tenantId\n    };\n}\n/**\n * Check if a model is partner-scoped\n */ function isPartnerScopedModel(model) {\n    return PARTNER_SCOPED_MODELS.includes(model);\n}\n/**\n * Validate partner context before executing a query\n * This should be called before any partner-scoped database operation\n */ function validatePartnerAccess(model, action, context, queryPartnerId) {\n    // Skip validation for non-partner models\n    if (!isPartnerScopedModel(model)) {\n        return;\n    }\n    // Allow explicit bypass (for migrations, admin tools, etc.)\n    if (context?.bypassIsolation === true) {\n        if (!context.isSuperAdmin) {\n            const reason = \"Partner bypass isolation attempted without SUPER_ADMIN role\";\n            logViolation({\n                model,\n                action,\n                context: context,\n                query: {\n                    queryPartnerId\n                },\n                reason\n            });\n            throw new TenantIsolationError(reason, model, action, context);\n        }\n        return;\n    }\n    // SUPER_ADMIN can access all partner data\n    if (context?.isSuperAdmin) {\n        return;\n    }\n    // No context = violation\n    if (!context) {\n        const reason = \"No partner context provided for partner-scoped query\";\n        logViolation({\n            model,\n            action,\n            context: null,\n            query: {\n                queryPartnerId\n            },\n            reason\n        });\n        throw new TenantIsolationError(reason, model, action, null);\n    }\n    // No partnerId in context = violation\n    if (!context.partnerId) {\n        const reason = \"No partnerId in context for partner-scoped query\";\n        logViolation({\n            model,\n            action,\n            context: context,\n            query: {\n                queryPartnerId\n            },\n            reason\n        });\n        throw new TenantIsolationError(reason, model, action, context);\n    }\n    // If query specifies a partnerId, it must match context\n    if (queryPartnerId && queryPartnerId !== context.partnerId) {\n        const reason = `Cross-partner access attempt: query partnerId (${queryPartnerId}) != context partnerId (${context.partnerId})`;\n        logViolation({\n            model,\n            action,\n            context: context,\n            query: {\n                queryPartnerId\n            },\n            reason\n        });\n        throw new TenantIsolationError(reason, model, action, context);\n    }\n}\n/**\n * Ensure a WHERE clause includes the correct partnerId\n */ function withPartnerFilter(where, partnerId) {\n    return {\n        ...where,\n        partnerId\n    };\n}\n/**\n * Ensure data being created includes the correct partnerId\n */ function withPartnerData(data, partnerId) {\n    return {\n        ...data,\n        partnerId\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UE4sU0FBaUI7SUFFakIsT0FBTztRQUNMLEdBQUdNLElBQUk7UUFDUE47SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2Fhcy1jb3JlLy4vc3JjL2xpYi90ZW5hbnQtaXNvbGF0aW9uLnRzP2YyNTMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUZW5hbnQgSXNvbGF0aW9uIEVuZm9yY2VtZW50XG4gKiBcbiAqIFRoaXMgbW9kdWxlIHByb3ZpZGVzIHN0cmljdCB0ZW5hbnQgZGF0YSBpc29sYXRpb24gYXQgdGhlIGRhdGFiYXNlIGxldmVsLlxuICogSW5zdGVhZCBvZiBQcmlzbWEgbWlkZGxld2FyZSAod2hpY2ggaGFzIGFzeW5jIGNvbnRleHQgaXNzdWVzKSwgdGhpcyB1c2VzXG4gKiBhcHBsaWNhdGlvbi1sZXZlbCB2YWxpZGF0aW9uIGJlZm9yZSBxdWVyaWVzIGFyZSBleGVjdXRlZC5cbiAqIFxuICogRmVhdHVyZXM6XG4gKiAtIFByZS1xdWVyeSB2YWxpZGF0aW9uIGZ1bmN0aW9uc1xuICogLSBTVVBFUl9BRE1JTiBieXBhc3Mgd2l0aCBleHBsaWNpdCBmbGFnXG4gKiAtIFZpb2xhdGlvbiBsb2dnaW5nIGFuZCBoYXJkIGZhaWx1cmVcbiAqIC0gU2FmZSBxdWVyeSBidWlsZGVycyB0aGF0IGVuZm9yY2UgdGVuYW50IHNjb3BpbmdcbiAqL1xuXG4vLyBNb2RlbHMgdGhhdCByZXF1aXJlIHRlbmFudCBpc29sYXRpb24gKHRlbmFudC1zY29wZWQpXG5leHBvcnQgY29uc3QgVEVOQU5UX1NDT1BFRF9NT0RFTFMgPSBbXG4gICdUZW5hbnRNZW1iZXJzaGlwJyxcbiAgJ1RlbmFudERvbWFpbicsIFxuICAnQXVkaXRMb2cnLFxuICAvLyBBZGQgZnV0dXJlIHRlbmFudC1zY29wZWQgbW9kZWxzIGhlcmVcbl0gYXMgY29uc3RcblxuLy8gTW9kZWxzIHRoYXQgcmVxdWlyZSBwYXJ0bmVyIGlzb2xhdGlvbiAocGFydG5lci1zY29wZWQpXG4vLyBUaGVzZSBhcmUgc2VwYXJhdGUgZnJvbSB0ZW5hbnQgaXNvbGF0aW9uIC0gcGFydG5lcnMgYXJlIHBsYXRmb3JtLWxldmVsXG5leHBvcnQgY29uc3QgUEFSVE5FUl9TQ09QRURfTU9ERUxTID0gW1xuICAnUGFydG5lclVzZXInLFxuICAnUGFydG5lckFncmVlbWVudCcsXG4gICdQYXJ0bmVyUmVmZXJyYWxDb2RlJyxcbiAgJ1BhcnRuZXJSZWZlcnJhbCcsXG4gICdQYXJ0bmVyRWFybmluZycsXG5dIGFzIGNvbnN0XG5cbi8vIFBsYXRmb3JtLWxldmVsIG1vZGVscyAobm8gaXNvbGF0aW9uLCBTdXBlciBBZG1pbiBvbmx5KVxuZXhwb3J0IGNvbnN0IFBMQVRGT1JNX01PREVMUyA9IFtcbiAgJ1BhcnRuZXInLFxuICAnVXNlcicsXG4gICdUZW5hbnQnLFxuICAnU2Vzc2lvbicsXG4gICdNYWdpY0xpbmsnLFxuXSBhcyBjb25zdFxuXG5leHBvcnQgdHlwZSBUZW5hbnRTY29wZWRNb2RlbCA9IHR5cGVvZiBURU5BTlRfU0NPUEVEX01PREVMU1tudW1iZXJdXG5leHBvcnQgdHlwZSBQYXJ0bmVyU2NvcGVkTW9kZWwgPSB0eXBlb2YgUEFSVE5FUl9TQ09QRURfTU9ERUxTW251bWJlcl1cbmV4cG9ydCB0eXBlIFBsYXRmb3JtTW9kZWwgPSB0eXBlb2YgUExBVEZPUk1fTU9ERUxTW251bWJlcl1cblxuZXhwb3J0IGludGVyZmFjZSBUZW5hbnRDb250ZXh0IHtcbiAgdGVuYW50SWQ6IHN0cmluZyB8IG51bGxcbiAgdXNlcklkOiBzdHJpbmcgfCBudWxsXG4gIGlzU3VwZXJBZG1pbjogYm9vbGVhblxuICBieXBhc3NJc29sYXRpb24/OiBib29sZWFuXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGFydG5lckNvbnRleHQge1xuICBwYXJ0bmVySWQ6IHN0cmluZyB8IG51bGxcbiAgdXNlcklkOiBzdHJpbmcgfCBudWxsXG4gIGlzU3VwZXJBZG1pbjogYm9vbGVhblxuICBpc1BhcnRuZXJPd25lcj86IGJvb2xlYW5cbiAgaXNQYXJ0bmVyQWRtaW4/OiBib29sZWFuXG4gIGJ5cGFzc0lzb2xhdGlvbj86IGJvb2xlYW5cbn1cblxuLyoqXG4gKiBWaW9sYXRpb24gbG9nZ2VyXG4gKi9cbmludGVyZmFjZSBWaW9sYXRpb25Mb2cge1xuICB0aW1lc3RhbXA6IERhdGVcbiAgbW9kZWw6IHN0cmluZ1xuICBhY3Rpb246IHN0cmluZ1xuICBjb250ZXh0OiBUZW5hbnRDb250ZXh0IHwgbnVsbFxuICBxdWVyeTogYW55XG4gIHJlYXNvbjogc3RyaW5nXG59XG5cbmNvbnN0IHZpb2xhdGlvbnM6IFZpb2xhdGlvbkxvZ1tdID0gW11cbmNvbnN0IE1BWF9WSU9MQVRJT05fTE9HUyA9IDEwMDBcblxuZXhwb3J0IGZ1bmN0aW9uIGxvZ1Zpb2xhdGlvbih2aW9sYXRpb246IE9taXQ8VmlvbGF0aW9uTG9nLCAndGltZXN0YW1wJz4pOiB2b2lkIHtcbiAgY29uc3QgbG9nOiBWaW9sYXRpb25Mb2cgPSB7XG4gICAgLi4udmlvbGF0aW9uLFxuICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKVxuICB9XG4gIFxuICB2aW9sYXRpb25zLnB1c2gobG9nKVxuICBcbiAgaWYgKHZpb2xhdGlvbnMubGVuZ3RoID4gTUFYX1ZJT0xBVElPTl9MT0dTKSB7XG4gICAgdmlvbGF0aW9ucy5zaGlmdCgpXG4gIH1cbiAgXG4gIGNvbnNvbGUuZXJyb3IoJ1tURU5BTlQgSVNPTEFUSU9OIFZJT0xBVElPTl0nLCBKU09OLnN0cmluZ2lmeShsb2csIG51bGwsIDIpKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0VmlvbGF0aW9uTG9ncygpOiBWaW9sYXRpb25Mb2dbXSB7XG4gIHJldHVybiBbLi4udmlvbGF0aW9uc11cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNsZWFyVmlvbGF0aW9uTG9ncygpOiB2b2lkIHtcbiAgdmlvbGF0aW9ucy5sZW5ndGggPSAwXG59XG5cbi8qKlxuICogVGVuYW50IElzb2xhdGlvbiBFcnJvclxuICovXG5leHBvcnQgY2xhc3MgVGVuYW50SXNvbGF0aW9uRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIG1lc3NhZ2U6IHN0cmluZyxcbiAgICBwdWJsaWMgbW9kZWw6IHN0cmluZyxcbiAgICBwdWJsaWMgYWN0aW9uOiBzdHJpbmcsXG4gICAgcHVibGljIGNvbnRleHQ6IFRlbmFudENvbnRleHQgfCBudWxsXG4gICkge1xuICAgIHN1cGVyKG1lc3NhZ2UpXG4gICAgdGhpcy5uYW1lID0gJ1RlbmFudElzb2xhdGlvbkVycm9yJ1xuICB9XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgYSBtb2RlbCBpcyB0ZW5hbnQtc2NvcGVkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1RlbmFudFNjb3BlZE1vZGVsKG1vZGVsOiBzdHJpbmcpOiBtb2RlbCBpcyBUZW5hbnRTY29wZWRNb2RlbCB7XG4gIHJldHVybiBURU5BTlRfU0NPUEVEX01PREVMUy5pbmNsdWRlcyhtb2RlbCBhcyBhbnkpXG59XG5cbi8qKlxuICogVmFsaWRhdGUgdGVuYW50IGNvbnRleHQgYmVmb3JlIGV4ZWN1dGluZyBhIHF1ZXJ5XG4gKiBUaGlzIHNob3VsZCBiZSBjYWxsZWQgYmVmb3JlIGFueSB0ZW5hbnQtc2NvcGVkIGRhdGFiYXNlIG9wZXJhdGlvblxuICovXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVUZW5hbnRBY2Nlc3MoXG4gIG1vZGVsOiBzdHJpbmcsXG4gIGFjdGlvbjogc3RyaW5nLFxuICBjb250ZXh0OiBUZW5hbnRDb250ZXh0IHwgbnVsbCxcbiAgcXVlcnlUZW5hbnRJZD86IHN0cmluZyB8IG51bGxcbik6IHZvaWQge1xuICAvLyBTa2lwIHZhbGlkYXRpb24gZm9yIGdsb2JhbCBtb2RlbHNcbiAgaWYgKCFpc1RlbmFudFNjb3BlZE1vZGVsKG1vZGVsKSkge1xuICAgIHJldHVyblxuICB9XG4gIFxuICAvLyBBbGxvdyBleHBsaWNpdCBieXBhc3MgKGZvciBtaWdyYXRpb25zLCBhZG1pbiB0b29scywgZXRjLilcbiAgaWYgKGNvbnRleHQ/LmJ5cGFzc0lzb2xhdGlvbiA9PT0gdHJ1ZSkge1xuICAgIGlmICghY29udGV4dC5pc1N1cGVyQWRtaW4pIHtcbiAgICAgIGNvbnN0IHJlYXNvbiA9ICdCeXBhc3MgaXNvbGF0aW9uIGF0dGVtcHRlZCB3aXRob3V0IFNVUEVSX0FETUlOIHJvbGUnXG4gICAgICBsb2dWaW9sYXRpb24oeyBtb2RlbCwgYWN0aW9uLCBjb250ZXh0LCBxdWVyeTogeyBxdWVyeVRlbmFudElkIH0sIHJlYXNvbiB9KVxuICAgICAgdGhyb3cgbmV3IFRlbmFudElzb2xhdGlvbkVycm9yKHJlYXNvbiwgbW9kZWwsIGFjdGlvbiwgY29udGV4dClcbiAgICB9XG4gICAgcmV0dXJuXG4gIH1cbiAgXG4gIC8vIFNVUEVSX0FETUlOIGNhbiBhY2Nlc3MgYWxsIGRhdGFcbiAgaWYgKGNvbnRleHQ/LmlzU3VwZXJBZG1pbikge1xuICAgIHJldHVyblxuICB9XG4gIFxuICAvLyBObyBjb250ZXh0ID0gdmlvbGF0aW9uXG4gIGlmICghY29udGV4dCkge1xuICAgIGNvbnN0IHJlYXNvbiA9ICdObyB0ZW5hbnQgY29udGV4dCBwcm92aWRlZCBmb3IgdGVuYW50LXNjb3BlZCBxdWVyeSdcbiAgICBsb2dWaW9sYXRpb24oeyBtb2RlbCwgYWN0aW9uLCBjb250ZXh0LCBxdWVyeTogeyBxdWVyeVRlbmFudElkIH0sIHJlYXNvbiB9KVxuICAgIHRocm93IG5ldyBUZW5hbnRJc29sYXRpb25FcnJvcihyZWFzb24sIG1vZGVsLCBhY3Rpb24sIGNvbnRleHQpXG4gIH1cbiAgXG4gIC8vIE5vIHRlbmFudElkIGluIGNvbnRleHQgPSB2aW9sYXRpb25cbiAgaWYgKCFjb250ZXh0LnRlbmFudElkKSB7XG4gICAgY29uc3QgcmVhc29uID0gJ05vIHRlbmFudElkIGluIGNvbnRleHQgZm9yIHRlbmFudC1zY29wZWQgcXVlcnknXG4gICAgbG9nVmlvbGF0aW9uKHsgbW9kZWwsIGFjdGlvbiwgY29udGV4dCwgcXVlcnk6IHsgcXVlcnlUZW5hbnRJZCB9LCByZWFzb24gfSlcbiAgICB0aHJvdyBuZXcgVGVuYW50SXNvbGF0aW9uRXJyb3IocmVhc29uLCBtb2RlbCwgYWN0aW9uLCBjb250ZXh0KVxuICB9XG4gIFxuICAvLyBJZiBxdWVyeSBzcGVjaWZpZXMgYSB0ZW5hbnRJZCwgaXQgbXVzdCBtYXRjaCBjb250ZXh0XG4gIGlmIChxdWVyeVRlbmFudElkICYmIHF1ZXJ5VGVuYW50SWQgIT09IGNvbnRleHQudGVuYW50SWQpIHtcbiAgICBjb25zdCByZWFzb24gPSBgQ3Jvc3MtdGVuYW50IGFjY2VzcyBhdHRlbXB0OiBxdWVyeSB0ZW5hbnRJZCAoJHtxdWVyeVRlbmFudElkfSkgIT0gY29udGV4dCB0ZW5hbnRJZCAoJHtjb250ZXh0LnRlbmFudElkfSlgXG4gICAgbG9nVmlvbGF0aW9uKHsgbW9kZWwsIGFjdGlvbiwgY29udGV4dCwgcXVlcnk6IHsgcXVlcnlUZW5hbnRJZCB9LCByZWFzb24gfSlcbiAgICB0aHJvdyBuZXcgVGVuYW50SXNvbGF0aW9uRXJyb3IocmVhc29uLCBtb2RlbCwgYWN0aW9uLCBjb250ZXh0KVxuICB9XG59XG5cbi8qKlxuICogQ3JlYXRlIGEgdGVuYW50IGNvbnRleHQgZnJvbSB1c2VyIHNlc3Npb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVRlbmFudENvbnRleHQoXG4gIHRlbmFudElkOiBzdHJpbmcgfCBudWxsLFxuICB1c2VySWQ6IHN0cmluZyB8IG51bGwsXG4gIGlzU3VwZXJBZG1pbjogYm9vbGVhbixcbiAgYnlwYXNzSXNvbGF0aW9uOiBib29sZWFuID0gZmFsc2Vcbik6IFRlbmFudENvbnRleHQge1xuICByZXR1cm4ge1xuICAgIHRlbmFudElkLFxuICAgIHVzZXJJZCxcbiAgICBpc1N1cGVyQWRtaW4sXG4gICAgYnlwYXNzSXNvbGF0aW9uXG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgYSBwYXJ0bmVyIGNvbnRleHQgZnJvbSB1c2VyIHNlc3Npb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVBhcnRuZXJDb250ZXh0KFxuICBwYXJ0bmVySWQ6IHN0cmluZyB8IG51bGwsXG4gIHVzZXJJZDogc3RyaW5nIHwgbnVsbCxcbiAgaXNTdXBlckFkbWluOiBib29sZWFuLFxuICBpc1BhcnRuZXJPd25lcjogYm9vbGVhbiA9IGZhbHNlLFxuICBpc1BhcnRuZXJBZG1pbjogYm9vbGVhbiA9IGZhbHNlLFxuICBieXBhc3NJc29sYXRpb246IGJvb2xlYW4gPSBmYWxzZVxuKTogUGFydG5lckNvbnRleHQge1xuICByZXR1cm4ge1xuICAgIHBhcnRuZXJJZCxcbiAgICB1c2VySWQsXG4gICAgaXNTdXBlckFkbWluLFxuICAgIGlzUGFydG5lck93bmVyLFxuICAgIGlzUGFydG5lckFkbWluLFxuICAgIGJ5cGFzc0lzb2xhdGlvblxuICB9XG59XG5cbi8qKlxuICogRW5zdXJlIGEgV0hFUkUgY2xhdXNlIGluY2x1ZGVzIHRoZSBjb3JyZWN0IHRlbmFudElkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB3aXRoVGVuYW50RmlsdGVyPFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBhbnk+PihcbiAgd2hlcmU6IFQsXG4gIHRlbmFudElkOiBzdHJpbmdcbik6IFQgJiB7IHRlbmFudElkOiBzdHJpbmcgfSB7XG4gIHJldHVybiB7XG4gICAgLi4ud2hlcmUsXG4gICAgdGVuYW50SWRcbiAgfVxufVxuXG4vKipcbiAqIEVuc3VyZSBkYXRhIGJlaW5nIGNyZWF0ZWQgaW5jbHVkZXMgdGhlIGNvcnJlY3QgdGVuYW50SWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHdpdGhUZW5hbnREYXRhPFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBhbnk+PihcbiAgZGF0YTogVCxcbiAgdGVuYW50SWQ6IHN0cmluZ1xuKTogVCAmIHsgdGVuYW50SWQ6IHN0cmluZyB9IHtcbiAgcmV0dXJuIHtcbiAgICAuLi5kYXRhLFxuICAgIHRlbmFudElkXG4gIH1cbn1cblxuLyoqXG4gKiBDaGVjayBpZiBhIG1vZGVsIGlzIHBhcnRuZXItc2NvcGVkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1BhcnRuZXJTY29wZWRNb2RlbChtb2RlbDogc3RyaW5nKTogbW9kZWwgaXMgUGFydG5lclNjb3BlZE1vZGVsIHtcbiAgcmV0dXJuIFBBUlRORVJfU0NPUEVEX01PREVMUy5pbmNsdWRlcyhtb2RlbCBhcyBhbnkpXG59XG5cbi8qKlxuICogVmFsaWRhdGUgcGFydG5lciBjb250ZXh0IGJlZm9yZSBleGVjdXRpbmcgYSBxdWVyeVxuICogVGhpcyBzaG91bGQgYmUgY2FsbGVkIGJlZm9yZSBhbnkgcGFydG5lci1zY29wZWQgZGF0YWJhc2Ugb3BlcmF0aW9uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVBhcnRuZXJBY2Nlc3MoXG4gIG1vZGVsOiBzdHJpbmcsXG4gIGFjdGlvbjogc3RyaW5nLFxuICBjb250ZXh0OiBQYXJ0bmVyQ29udGV4dCB8IG51bGwsXG4gIHF1ZXJ5UGFydG5lcklkPzogc3RyaW5nIHwgbnVsbFxuKTogdm9pZCB7XG4gIC8vIFNraXAgdmFsaWRhdGlvbiBmb3Igbm9uLXBhcnRuZXIgbW9kZWxzXG4gIGlmICghaXNQYXJ0bmVyU2NvcGVkTW9kZWwobW9kZWwpKSB7XG4gICAgcmV0dXJuXG4gIH1cbiAgXG4gIC8vIEFsbG93IGV4cGxpY2l0IGJ5cGFzcyAoZm9yIG1pZ3JhdGlvbnMsIGFkbWluIHRvb2xzLCBldGMuKVxuICBpZiAoY29udGV4dD8uYnlwYXNzSXNvbGF0aW9uID09PSB0cnVlKSB7XG4gICAgaWYgKCFjb250ZXh0LmlzU3VwZXJBZG1pbikge1xuICAgICAgY29uc3QgcmVhc29uID0gJ1BhcnRuZXIgYnlwYXNzIGlzb2xhdGlvbiBhdHRlbXB0ZWQgd2l0aG91dCBTVVBFUl9BRE1JTiByb2xlJ1xuICAgICAgbG9nVmlvbGF0aW9uKHsgbW9kZWwsIGFjdGlvbiwgY29udGV4dDogY29udGV4dCBhcyBhbnksIHF1ZXJ5OiB7IHF1ZXJ5UGFydG5lcklkIH0sIHJlYXNvbiB9KVxuICAgICAgdGhyb3cgbmV3IFRlbmFudElzb2xhdGlvbkVycm9yKHJlYXNvbiwgbW9kZWwsIGFjdGlvbiwgY29udGV4dCBhcyBhbnkpXG4gICAgfVxuICAgIHJldHVyblxuICB9XG4gIFxuICAvLyBTVVBFUl9BRE1JTiBjYW4gYWNjZXNzIGFsbCBwYXJ0bmVyIGRhdGFcbiAgaWYgKGNvbnRleHQ/LmlzU3VwZXJBZG1pbikge1xuICAgIHJldHVyblxuICB9XG4gIFxuICAvLyBObyBjb250ZXh0ID0gdmlvbGF0aW9uXG4gIGlmICghY29udGV4dCkge1xuICAgIGNvbnN0IHJlYXNvbiA9ICdObyBwYXJ0bmVyIGNvbnRleHQgcHJvdmlkZWQgZm9yIHBhcnRuZXItc2NvcGVkIHF1ZXJ5J1xuICAgIGxvZ1Zpb2xhdGlvbih7IG1vZGVsLCBhY3Rpb24sIGNvbnRleHQ6IG51bGwsIHF1ZXJ5OiB7IHF1ZXJ5UGFydG5lcklkIH0sIHJlYXNvbiB9KVxuICAgIHRocm93IG5ldyBUZW5hbnRJc29sYXRpb25FcnJvcihyZWFzb24sIG1vZGVsLCBhY3Rpb24sIG51bGwpXG4gIH1cbiAgXG4gIC8vIE5vIHBhcnRuZXJJZCBpbiBjb250ZXh0ID0gdmlvbGF0aW9uXG4gIGlmICghY29udGV4dC5wYXJ0bmVySWQpIHtcbiAgICBjb25zdCByZWFzb24gPSAnTm8gcGFydG5lcklkIGluIGNvbnRleHQgZm9yIHBhcnRuZXItc2NvcGVkIHF1ZXJ5J1xuICAgIGxvZ1Zpb2xhdGlvbih7IG1vZGVsLCBhY3Rpb24sIGNvbnRleHQ6IGNvbnRleHQgYXMgYW55LCBxdWVyeTogeyBxdWVyeVBhcnRuZXJJZCB9LCByZWFzb24gfSlcbiAgICB0aHJvdyBuZXcgVGVuYW50SXNvbGF0aW9uRXJyb3IocmVhc29uLCBtb2RlbCwgYWN0aW9uLCBjb250ZXh0IGFzIGFueSlcbiAgfVxuICBcbiAgLy8gSWYgcXVlcnkgc3BlY2lmaWVzIGEgcGFydG5lcklkLCBpdCBtdXN0IG1hdGNoIGNvbnRleHRcbiAgaWYgKHF1ZXJ5UGFydG5lcklkICYmIHF1ZXJ5UGFydG5lcklkICE9PSBjb250ZXh0LnBhcnRuZXJJZCkge1xuICAgIGNvbnN0IHJlYXNvbiA9IGBDcm9zcy1wYXJ0bmVyIGFjY2VzcyBhdHRlbXB0OiBxdWVyeSBwYXJ0bmVySWQgKCR7cXVlcnlQYXJ0bmVySWR9KSAhPSBjb250ZXh0IHBhcnRuZXJJZCAoJHtjb250ZXh0LnBhcnRuZXJJZH0pYFxuICAgIGxvZ1Zpb2xhdGlvbih7IG1vZGVsLCBhY3Rpb24sIGNvbnRleHQ6IGNvbnRleHQgYXMgYW55LCBxdWVyeTogeyBxdWVyeVBhcnRuZXJJZCB9LCByZWFzb24gfSlcbiAgICB0aHJvdyBuZXcgVGVuYW50SXNvbGF0aW9uRXJyb3IocmVhc29uLCBtb2RlbCwgYWN0aW9uLCBjb250ZXh0IGFzIGFueSlcbiAgfVxufVxuXG4vKipcbiAqIEVuc3VyZSBhIFdIRVJFIGNsYXVzZSBpbmNsdWRlcyB0aGUgY29ycmVjdCBwYXJ0bmVySWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHdpdGhQYXJ0bmVyRmlsdGVyPFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBhbnk+PihcbiAgd2hlcmU6IFQsXG4gIHBhcnRuZXJJZDogc3RyaW5nXG4pOiBUICYgeyBwYXJ0bmVySWQ6IHN0cmluZyB9IHtcbiAgcmV0dXJuIHtcbiAgICAuLi53aGVyZSxcbiAgICBwYXJ0bmVySWRcbiAgfVxufVxuXG4vKipcbiAqIEVuc3VyZSBkYXRhIGJlaW5nIGNyZWF0ZWQgaW5jbHVkZXMgdGhlIGNvcnJlY3QgcGFydG5lcklkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB3aXRoUGFydG5lckRhdGE8VCBleHRlbmRzIFJlY29yZDxzdHJpbmcsIGFueT4+KFxuICBkYXRhOiBULFxuICBwYXJ0bmVySWQ6IHN0cmluZ1xuKTogVCAmIHsgcGFydG5lcklkOiBzdHJpbmcgfSB7XG4gIHJldHVybiB7XG4gICAgLi4uZGF0YSxcbiAgICBwYXJ0bmVySWRcbiAgfVxufVxuIl0sIm5hbWVzIjpbIlRFTkFOVF9TQ09QRURfTU9ERUxTIiwiUEFSVE5FUl9TQ09QRURfTU9ERUxTIiwiUExBVEZPUk1fTU9ERUxTIiwidmlvbGF0aW9ucyIsIk1BWF9WSU9MQVRJT05fTE9HUyIsImxvZ1Zpb2xhdGlvbiIsInZpb2xhdGlvbiIsImxvZyIsInRpbWVzdGFtcCIsIkRhdGUiLCJwdXNoIiwibGVuZ3RoIiwic2hpZnQiLCJjb25zb2xlIiwiZXJyb3IiLCJKU09OIiwic3RyaW5naWZ5IiwiZ2V0VmlvbGF0aW9uTG9ncyIsImNsZWFyVmlvbGF0aW9uTG9ncyIsIlRlbmFudElzb2xhdGlvbkVycm9yIiwiRXJyb3IiLCJjb25zdHJ1Y3RvciIsIm1lc3NhZ2UiLCJtb2RlbCIsImFjdGlvbiIsImNvbnRleHQiLCJuYW1lIiwiaXNUZW5hbnRTY29wZWRNb2RlbCIsImluY2x1ZGVzIiwidmFsaWRhdGVUZW5hbnRBY2Nlc3MiLCJxdWVyeVRlbmFudElkIiwiYnlwYXNzSXNvbGF0aW9uIiwiaXNTdXBlckFkbWluIiwicmVhc29uIiwicXVlcnkiLCJ0ZW5hbnRJZCIsImNyZWF0ZVRlbmFudENvbnRleHQiLCJ1c2VySWQiLCJjcmVhdGVQYXJ0bmVyQ29udGV4dCIsInBhcnRuZXJJZCIsImlzUGFydG5lck93bmVyIiwiaXNQYXJ0bmVyQWRtaW4iLCJ3aXRoVGVuYW50RmlsdGVyIiwid2hlcmUiLCJ3aXRoVGVuYW50RGF0YSIsImRhdGEiLCJpc1BhcnRuZXJTY29wZWRNb2RlbCIsInZhbGlkYXRlUGFydG5lckFjY2VzcyIsInF1ZXJ5UGFydG5lcklkIiwid2l0aFBhcnRuZXJGaWx0ZXIiLCJ3aXRoUGFydG5lckRhdGEiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/tenant-isolation.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/decimal.js"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsvm%2Fpromotions%2Froute&page=%2Fapi%2Fsvm%2Fpromotions%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsvm%2Fpromotions%2Froute.ts&appDir=%2Fapp%2Fsaas-core%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp%2Fsaas-core&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();