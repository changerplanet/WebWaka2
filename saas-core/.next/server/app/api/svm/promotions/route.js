"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/svm/promotions/route";
exports.ids = ["app/api/svm/promotions/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsvm%2Fpromotions%2Froute&page=%2Fapi%2Fsvm%2Fpromotions%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsvm%2Fpromotions%2Froute.ts&appDir=%2Fapp%2Fsaas-core%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp%2Fsaas-core&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsvm%2Fpromotions%2Froute&page=%2Fapi%2Fsvm%2Fpromotions%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsvm%2Fpromotions%2Froute.ts&appDir=%2Fapp%2Fsaas-core%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp%2Fsaas-core&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _app_saas_core_src_app_api_svm_promotions_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/svm/promotions/route.ts */ \"(rsc)/./src/app/api/svm/promotions/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/svm/promotions/route\",\n        pathname: \"/api/svm/promotions\",\n        filename: \"route\",\n        bundlePath: \"app/api/svm/promotions/route\"\n    },\n    resolvedPagePath: \"/app/saas-core/src/app/api/svm/promotions/route.ts\",\n    nextConfigOutput,\n    userland: _app_saas_core_src_app_api_svm_promotions_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/svm/promotions/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZzdm0lMkZwcm9tb3Rpb25zJTJGcm91dGUmcGFnZT0lMkZhcGklMkZzdm0lMkZwcm9tb3Rpb25zJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGc3ZtJTJGcHJvbW90aW9ucyUyRnJvdXRlLnRzJmFwcERpcj0lMkZhcHAlMkZzYWFzLWNvcmUlMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRmFwcCUyRnNhYXMtY29yZSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDRTtBQUMvRTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL3NhYXMtY29yZS8/NDU0NCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvYXBwL3NhYXMtY29yZS9zcmMvYXBwL2FwaS9zdm0vcHJvbW90aW9ucy9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvc3ZtL3Byb21vdGlvbnMvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9zdm0vcHJvbW90aW9uc1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvc3ZtL3Byb21vdGlvbnMvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvYXBwL3NhYXMtY29yZS9zcmMvYXBwL2FwaS9zdm0vcHJvbW90aW9ucy9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvc3ZtL3Byb21vdGlvbnMvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsvm%2Fpromotions%2Froute&page=%2Fapi%2Fsvm%2Fpromotions%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsvm%2Fpromotions%2Froute.ts&appDir=%2Fapp%2Fsaas-core%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp%2Fsaas-core&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/svm/promotions/route.ts":
/*!*********************************************!*\
  !*** ./src/app/api/svm/promotions/route.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/promotions-storage */ \"(rsc)/./src/lib/promotions-storage.ts\");\n/* harmony import */ var decimal_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! decimal.js */ \"(rsc)/./node_modules/decimal.js/decimal.mjs\");\n/**\n * SVM Promotions API\n * \n * POST /api/svm/promotions/validate - Validate coupon code\n * POST /api/svm/promotions/calculate - Calculate discounts for cart\n * GET /api/svm/promotions - List promotions\n * POST /api/svm/promotions - Create promotion\n * \n * IMPORTANT:\n * - Promotions apply ONLY to this module (SVM)\n * - Final payable amount sent to Core\n * - No global pricing mutation\n */ \n\n\n/**\n * POST /api/svm/promotions - Create a new promotion OR validate/calculate\n * \n * For action: 'CREATE' - Create new promotion\n * For action: 'VALIDATE' - Validate coupon code\n * For action: 'CALCULATE' - Calculate discounts for cart\n */ async function POST(request) {\n    try {\n        const body = await request.json();\n        const { tenantId, action } = body;\n        if (!tenantId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"tenantId is required\"\n            }, {\n                status: 400\n            });\n        }\n        switch(action){\n            case \"VALIDATE\":\n                {\n                    // Validate a coupon code\n                    const { code, subtotal, items, customerId, isFirstOrder } = body;\n                    if (!code) {\n                        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                            success: false,\n                            error: \"Coupon code is required\"\n                        }, {\n                            status: 400\n                        });\n                    }\n                    const promotion = (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.findByCode)(tenantId, code);\n                    if (!promotion) {\n                        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                            success: false,\n                            valid: false,\n                            error: \"Invalid coupon code\",\n                            errorCode: \"NOT_FOUND\"\n                        });\n                    }\n                    const totalQuantity = (items || []).reduce((sum, item)=>sum + item.quantity, 0);\n                    const validation = (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.validatePromotion)(promotion, subtotal || 0, totalQuantity, customerId, isFirstOrder, []);\n                    if (!validation.valid) {\n                        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                            success: true,\n                            valid: false,\n                            error: validation.error,\n                            errorCode: validation.errorCode\n                        });\n                    }\n                    // Calculate potential discount\n                    const discount = (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.calculateDiscount)(promotion, items || [], subtotal || 0, body.shippingTotal);\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        success: true,\n                        valid: true,\n                        promotion: {\n                            id: promotion.id,\n                            name: promotion.name,\n                            description: promotion.description,\n                            code: promotion.code,\n                            discountType: promotion.discountType,\n                            discountValue: promotion.discountValue\n                        },\n                        potentialDiscount: discount\n                    });\n                }\n            case \"CALCULATE\":\n                {\n                    // Calculate all applicable discounts\n                    const { items, subtotal, shippingTotal, couponCodes, customerId, isFirstOrder } = body;\n                    if (subtotal === undefined) {\n                        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                            success: false,\n                            error: \"subtotal is required\"\n                        }, {\n                            status: 400\n                        });\n                    }\n                    const cartItems = items || [];\n                    const totalQuantity = cartItems.reduce((sum, item)=>sum + item.quantity, 0);\n                    // Get automatic promotions\n                    const autoPromotions = (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.getAutomaticPromotions)(tenantId);\n                    // Get coupon promotions\n                    const couponPromotions = (couponCodes || []).map((code)=>(0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.findByCode)(tenantId, code)).filter((p)=>p !== null);\n                    // Combine and sort by priority\n                    const allPromotions = [\n                        ...autoPromotions,\n                        ...couponPromotions\n                    ].sort((a, b)=>{\n                        if (b.priority !== a.priority) return b.priority - a.priority;\n                        return b.discountValue - a.discountValue;\n                    });\n                    const appliedPromotions = [];\n                    const errors = [];\n                    let discountTotal = new decimal_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"](0);\n                    let shippingDiscount = new decimal_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"](0);\n                    for (const promotion of allPromotions){\n                        const validation = (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.validatePromotion)(promotion, subtotal, totalQuantity, customerId, isFirstOrder, appliedPromotions);\n                        if (!validation.valid) {\n                            if (promotion.type === \"COUPON\") {\n                                errors.push(`${promotion.code}: ${validation.error}`);\n                            }\n                            continue;\n                        }\n                        // Check product eligibility\n                        const eligibleItems = (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.getEligibleItems)(promotion, cartItems);\n                        if (eligibleItems.length === 0 && promotion.discountType !== \"FREE_SHIPPING\") {\n                            if (promotion.type === \"COUPON\") {\n                                errors.push(`${promotion.code}: No eligible items in your cart`);\n                            }\n                            continue;\n                        }\n                        const applied = (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.calculateDiscount)(promotion, cartItems, subtotal, shippingTotal);\n                        if (applied) {\n                            appliedPromotions.push(applied);\n                            if (applied.freeShipping && shippingTotal) {\n                                shippingDiscount = new decimal_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"](shippingTotal);\n                            } else {\n                                discountTotal = discountTotal.plus(applied.discountAmount);\n                            }\n                            if (!promotion.stackable) {\n                                break;\n                            }\n                        }\n                    }\n                    // Don't exceed subtotal\n                    if (discountTotal.greaterThan(subtotal)) {\n                        discountTotal = new decimal_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"](subtotal);\n                    }\n                    const finalSubtotal = new decimal_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"](subtotal).minus(discountTotal).toDecimalPlaces(2).toNumber();\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        success: true,\n                        appliedPromotions,\n                        subtotal,\n                        discountTotal: discountTotal.toDecimalPlaces(2).toNumber(),\n                        shippingDiscount: shippingDiscount.toDecimalPlaces(2).toNumber(),\n                        finalSubtotal,\n                        shippingTotal: shippingTotal ? new decimal_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"](shippingTotal).minus(shippingDiscount).toNumber() : undefined,\n                        errors: errors.length > 0 ? errors : undefined\n                    });\n                }\n            case \"CREATE\":\n            default:\n                {\n                    // Create a new promotion\n                    const { name, description, code, type, discountType, discountValue, maxDiscount, minOrderTotal, minQuantity, productIds, categoryIds, excludeProductIds, customerIds, firstOrderOnly, usageLimit, perCustomerLimit, startsAt, endsAt, stackable, priority, buyQuantity, getQuantity, getDiscountPercent } = body;\n                    if (!name || !discountType) {\n                        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                            success: false,\n                            error: \"name and discountType are required\"\n                        }, {\n                            status: 400\n                        });\n                    }\n                    // Check for duplicate code\n                    if (code) {\n                        const existing = (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.findByCode)(tenantId, code);\n                        if (existing) {\n                            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                                success: false,\n                                error: \"A promotion with this code already exists\"\n                            }, {\n                                status: 400\n                            });\n                        }\n                    }\n                    const newPromotion = {\n                        id: (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.generateId)(\"promo\"),\n                        tenantId,\n                        name,\n                        description,\n                        code: code?.toUpperCase(),\n                        type: type || (code ? \"COUPON\" : \"AUTOMATIC\"),\n                        discountType,\n                        discountValue: discountValue || 0,\n                        maxDiscount,\n                        minOrderTotal,\n                        minQuantity,\n                        productIds: productIds || [],\n                        categoryIds: categoryIds || [],\n                        excludeProductIds: excludeProductIds || [],\n                        customerIds: customerIds || [],\n                        firstOrderOnly: firstOrderOnly || false,\n                        usageLimit,\n                        usageCount: 0,\n                        perCustomerLimit,\n                        startsAt: startsAt ? new Date(startsAt) : new Date(),\n                        endsAt: endsAt ? new Date(endsAt) : undefined,\n                        isActive: true,\n                        stackable: stackable || false,\n                        priority: priority || 0,\n                        buyQuantity,\n                        getQuantity,\n                        getDiscountPercent,\n                        createdAt: new Date().toISOString(),\n                        updatedAt: new Date().toISOString()\n                    };\n                    (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.addPromotion)(newPromotion);\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        success: true,\n                        promotion: newPromotion\n                    }, {\n                        status: 201\n                    });\n                }\n        }\n    } catch (error) {\n        console.error(\"[SVM] Error processing promotions request:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: error instanceof Error ? error.message : \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\n/**\n * GET /api/svm/promotions - List promotions\n */ async function GET(request) {\n    try {\n        const { searchParams } = new URL(request.url);\n        const tenantId = searchParams.get(\"tenantId\");\n        const activeOnly = searchParams.get(\"activeOnly\") === \"true\";\n        const type = searchParams.get(\"type\");\n        if (!tenantId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"tenantId is required\"\n            }, {\n                status: 400\n            });\n        }\n        let promotions = activeOnly ? (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.getActivePromotions)(tenantId) : (0,_lib_promotions_storage__WEBPACK_IMPORTED_MODULE_1__.getPromotions)(tenantId);\n        if (type) {\n            promotions = promotions.filter((p)=>p.type === type);\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            promotions: promotions.map((p)=>({\n                    id: p.id,\n                    name: p.name,\n                    description: p.description,\n                    code: p.code,\n                    type: p.type,\n                    discountType: p.discountType,\n                    discountValue: p.discountValue,\n                    maxDiscount: p.maxDiscount,\n                    minOrderTotal: p.minOrderTotal,\n                    minQuantity: p.minQuantity,\n                    firstOrderOnly: p.firstOrderOnly,\n                    usageLimit: p.usageLimit,\n                    usageCount: p.usageCount,\n                    perCustomerLimit: p.perCustomerLimit,\n                    startsAt: p.startsAt,\n                    endsAt: p.endsAt,\n                    isActive: p.isActive,\n                    stackable: p.stackable,\n                    priority: p.priority,\n                    // BUY_X_GET_Y specific\n                    buyQuantity: p.buyQuantity,\n                    getQuantity: p.getQuantity,\n                    getDiscountPercent: p.getDiscountPercent,\n                    // Formatted display\n                    displayValue: formatDiscountDisplay(p)\n                })),\n            total: promotions.length,\n            activeCount: promotions.filter((p)=>p.isActive).length\n        });\n    } catch (error) {\n        console.error(\"[SVM] Error listing promotions:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\nfunction formatDiscountDisplay(p) {\n    switch(p.discountType){\n        case \"PERCENTAGE\":\n            return `${p.discountValue}% off${p.maxDiscount ? ` (max $${p.maxDiscount})` : \"\"}`;\n        case \"FIXED_AMOUNT\":\n            return `$${p.discountValue.toFixed(2)} off`;\n        case \"FIXED_PER_ITEM\":\n            return `$${p.discountValue.toFixed(2)} off per item`;\n        case \"FREE_SHIPPING\":\n            return \"Free shipping\";\n        case \"BUY_X_GET_Y\":\n            const getDesc = p.getDiscountPercent === 100 ? \"free\" : `${p.getDiscountPercent}% off`;\n            return `Buy ${p.buyQuantity} get ${p.getQuantity} ${getDesc}`;\n        default:\n            return \"\";\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9zdm0vcHJvbW90aW9ucy9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOzs7Ozs7Ozs7Ozs7Q0FZQyxHQUVzRDtBQWN0QjtBQUNEO0FBRWhDOzs7Ozs7Q0FNQyxHQUNNLGVBQWVXLEtBQUtDLE9BQW9CO0lBQzdDLElBQUk7UUFDRixNQUFNQyxPQUFPLE1BQU1ELFFBQVFFLElBQUk7UUFDL0IsTUFBTSxFQUFFQyxRQUFRLEVBQUVDLE1BQU0sRUFBRSxHQUFHSDtRQUU3QixJQUFJLENBQUNFLFVBQVU7WUFDYixPQUFPZixxREFBWUEsQ0FBQ2MsSUFBSSxDQUN0QjtnQkFBRUcsU0FBUztnQkFBT0MsT0FBTztZQUF1QixHQUNoRDtnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsT0FBUUg7WUFDTixLQUFLO2dCQUFZO29CQUNmLHlCQUF5QjtvQkFDekIsTUFBTSxFQUFFSSxJQUFJLEVBQUVDLFFBQVEsRUFBRUMsS0FBSyxFQUFFQyxVQUFVLEVBQUVDLFlBQVksRUFBRSxHQUFHWDtvQkFFNUQsSUFBSSxDQUFDTyxNQUFNO3dCQUNULE9BQU9wQixxREFBWUEsQ0FBQ2MsSUFBSSxDQUN0Qjs0QkFBRUcsU0FBUzs0QkFBT0MsT0FBTzt3QkFBMEIsR0FDbkQ7NEJBQUVDLFFBQVE7d0JBQUk7b0JBRWxCO29CQUVBLE1BQU1NLFlBQVlyQixtRUFBVUEsQ0FBQ1csVUFBVUs7b0JBRXZDLElBQUksQ0FBQ0ssV0FBVzt3QkFDZCxPQUFPekIscURBQVlBLENBQUNjLElBQUksQ0FBQzs0QkFDdkJHLFNBQVM7NEJBQ1RTLE9BQU87NEJBQ1BSLE9BQU87NEJBQ1BTLFdBQVc7d0JBQ2I7b0JBQ0Y7b0JBRUEsTUFBTUMsZ0JBQWdCLENBQUNOLFNBQVMsRUFBRSxFQUFFTyxNQUFNLENBQ3hDLENBQUNDLEtBQWFDLE9BQTRCRCxNQUFNQyxLQUFLQyxRQUFRLEVBQUU7b0JBR2pFLE1BQU1DLGFBQWEzQiwwRUFBaUJBLENBQ2xDbUIsV0FDQUosWUFBWSxHQUNaTyxlQUNBTCxZQUNBQyxjQUNBLEVBQUU7b0JBR0osSUFBSSxDQUFDUyxXQUFXUCxLQUFLLEVBQUU7d0JBQ3JCLE9BQU8xQixxREFBWUEsQ0FBQ2MsSUFBSSxDQUFDOzRCQUN2QkcsU0FBUzs0QkFDVFMsT0FBTzs0QkFDUFIsT0FBT2UsV0FBV2YsS0FBSzs0QkFDdkJTLFdBQVdNLFdBQVdOLFNBQVM7d0JBQ2pDO29CQUNGO29CQUVBLCtCQUErQjtvQkFDL0IsTUFBTU8sV0FBVzFCLDBFQUFpQkEsQ0FDaENpQixXQUNBSCxTQUFTLEVBQUUsRUFDWEQsWUFBWSxHQUNaUixLQUFLc0IsYUFBYTtvQkFHcEIsT0FBT25DLHFEQUFZQSxDQUFDYyxJQUFJLENBQUM7d0JBQ3ZCRyxTQUFTO3dCQUNUUyxPQUFPO3dCQUNQRCxXQUFXOzRCQUNUVyxJQUFJWCxVQUFVVyxFQUFFOzRCQUNoQkMsTUFBTVosVUFBVVksSUFBSTs0QkFDcEJDLGFBQWFiLFVBQVVhLFdBQVc7NEJBQ2xDbEIsTUFBTUssVUFBVUwsSUFBSTs0QkFDcEJtQixjQUFjZCxVQUFVYyxZQUFZOzRCQUNwQ0MsZUFBZWYsVUFBVWUsYUFBYTt3QkFDeEM7d0JBQ0FDLG1CQUFtQlA7b0JBQ3JCO2dCQUNGO1lBRUEsS0FBSztnQkFBYTtvQkFDaEIscUNBQXFDO29CQUNyQyxNQUFNLEVBQUVaLEtBQUssRUFBRUQsUUFBUSxFQUFFYyxhQUFhLEVBQUVPLFdBQVcsRUFBRW5CLFVBQVUsRUFBRUMsWUFBWSxFQUFFLEdBQUdYO29CQUVsRixJQUFJUSxhQUFhc0IsV0FBVzt3QkFDMUIsT0FBTzNDLHFEQUFZQSxDQUFDYyxJQUFJLENBQ3RCOzRCQUFFRyxTQUFTOzRCQUFPQyxPQUFPO3dCQUF1QixHQUNoRDs0QkFBRUMsUUFBUTt3QkFBSTtvQkFFbEI7b0JBRUEsTUFBTXlCLFlBQWlDdEIsU0FBUyxFQUFFO29CQUNsRCxNQUFNTSxnQkFBZ0JnQixVQUFVZixNQUFNLENBQUMsQ0FBQ0MsS0FBS0MsT0FBU0QsTUFBTUMsS0FBS0MsUUFBUSxFQUFFO29CQUUzRSwyQkFBMkI7b0JBQzNCLE1BQU1hLGlCQUFpQjFDLCtFQUFzQkEsQ0FBQ1k7b0JBRTlDLHdCQUF3QjtvQkFDeEIsTUFBTStCLG1CQUFnQyxDQUFDSixlQUFlLEVBQUUsRUFDckRLLEdBQUcsQ0FBQyxDQUFDM0IsT0FBaUJoQixtRUFBVUEsQ0FBQ1csVUFBVUssT0FDM0M0QixNQUFNLENBQUMsQ0FBQ0MsSUFBd0NBLE1BQU07b0JBRXpELCtCQUErQjtvQkFDL0IsTUFBTUMsZ0JBQWdCOzJCQUFJTDsyQkFBbUJDO3FCQUFpQixDQUMzREssSUFBSSxDQUFDLENBQUNDLEdBQUdDO3dCQUNSLElBQUlBLEVBQUVDLFFBQVEsS0FBS0YsRUFBRUUsUUFBUSxFQUFFLE9BQU9ELEVBQUVDLFFBQVEsR0FBR0YsRUFBRUUsUUFBUTt3QkFDN0QsT0FBT0QsRUFBRWIsYUFBYSxHQUFHWSxFQUFFWixhQUFhO29CQUMxQztvQkFFRixNQUFNZSxvQkFBd0MsRUFBRTtvQkFDaEQsTUFBTUMsU0FBbUIsRUFBRTtvQkFDM0IsSUFBSUMsZ0JBQWdCLElBQUkvQyxrREFBT0EsQ0FBQztvQkFDaEMsSUFBSWdELG1CQUFtQixJQUFJaEQsa0RBQU9BLENBQUM7b0JBRW5DLEtBQUssTUFBTWUsYUFBYXlCLGNBQWU7d0JBQ3JDLE1BQU1qQixhQUFhM0IsMEVBQWlCQSxDQUNsQ21CLFdBQ0FKLFVBQ0FPLGVBQ0FMLFlBQ0FDLGNBQ0ErQjt3QkFHRixJQUFJLENBQUN0QixXQUFXUCxLQUFLLEVBQUU7NEJBQ3JCLElBQUlELFVBQVVrQyxJQUFJLEtBQUssVUFBVTtnQ0FDL0JILE9BQU9JLElBQUksQ0FBQyxDQUFDLEVBQUVuQyxVQUFVTCxJQUFJLENBQUMsRUFBRSxFQUFFYSxXQUFXZixLQUFLLENBQUMsQ0FBQzs0QkFDdEQ7NEJBQ0E7d0JBQ0Y7d0JBRUEsNEJBQTRCO3dCQUM1QixNQUFNMkMsZ0JBQWdCdEQseUVBQWdCQSxDQUFDa0IsV0FBV21CO3dCQUNsRCxJQUFJaUIsY0FBY0MsTUFBTSxLQUFLLEtBQUtyQyxVQUFVYyxZQUFZLEtBQUssaUJBQWlCOzRCQUM1RSxJQUFJZCxVQUFVa0MsSUFBSSxLQUFLLFVBQVU7Z0NBQy9CSCxPQUFPSSxJQUFJLENBQUMsQ0FBQyxFQUFFbkMsVUFBVUwsSUFBSSxDQUFDLGdDQUFnQyxDQUFDOzRCQUNqRTs0QkFDQTt3QkFDRjt3QkFFQSxNQUFNMkMsVUFBVXZELDBFQUFpQkEsQ0FBQ2lCLFdBQVdtQixXQUFXdkIsVUFBVWM7d0JBRWxFLElBQUk0QixTQUFTOzRCQUNYUixrQkFBa0JLLElBQUksQ0FBQ0c7NEJBRXZCLElBQUlBLFFBQVFDLFlBQVksSUFBSTdCLGVBQWU7Z0NBQ3pDdUIsbUJBQW1CLElBQUloRCxrREFBT0EsQ0FBQ3lCOzRCQUNqQyxPQUFPO2dDQUNMc0IsZ0JBQWdCQSxjQUFjUSxJQUFJLENBQUNGLFFBQVFHLGNBQWM7NEJBQzNEOzRCQUVBLElBQUksQ0FBQ3pDLFVBQVUwQyxTQUFTLEVBQUU7Z0NBQ3hCOzRCQUNGO3dCQUNGO29CQUNGO29CQUVBLHdCQUF3QjtvQkFDeEIsSUFBSVYsY0FBY1csV0FBVyxDQUFDL0MsV0FBVzt3QkFDdkNvQyxnQkFBZ0IsSUFBSS9DLGtEQUFPQSxDQUFDVztvQkFDOUI7b0JBRUEsTUFBTWdELGdCQUFnQixJQUFJM0Qsa0RBQU9BLENBQUNXLFVBQy9CaUQsS0FBSyxDQUFDYixlQUNOYyxlQUFlLENBQUMsR0FDaEJDLFFBQVE7b0JBRVgsT0FBT3hFLHFEQUFZQSxDQUFDYyxJQUFJLENBQUM7d0JBQ3ZCRyxTQUFTO3dCQUNUc0M7d0JBQ0FsQzt3QkFDQW9DLGVBQWVBLGNBQWNjLGVBQWUsQ0FBQyxHQUFHQyxRQUFRO3dCQUN4RGQsa0JBQWtCQSxpQkFBaUJhLGVBQWUsQ0FBQyxHQUFHQyxRQUFRO3dCQUM5REg7d0JBQ0FsQyxlQUFlQSxnQkFDYixJQUFJekIsa0RBQU9BLENBQUN5QixlQUFlbUMsS0FBSyxDQUFDWixrQkFBa0JjLFFBQVEsS0FDM0Q3Qjt3QkFDRmEsUUFBUUEsT0FBT00sTUFBTSxHQUFHLElBQUlOLFNBQVNiO29CQUN2QztnQkFDRjtZQUVBLEtBQUs7WUFDTDtnQkFBUztvQkFDUCx5QkFBeUI7b0JBQ3pCLE1BQU0sRUFBRU4sSUFBSSxFQUFFQyxXQUFXLEVBQUVsQixJQUFJLEVBQUV1QyxJQUFJLEVBQUVwQixZQUFZLEVBQUVDLGFBQWEsRUFBRWlDLFdBQVcsRUFDN0VDLGFBQWEsRUFBRUMsV0FBVyxFQUFFQyxVQUFVLEVBQUVDLFdBQVcsRUFBRUMsaUJBQWlCLEVBQ3RFQyxXQUFXLEVBQUVDLGNBQWMsRUFBRUMsVUFBVSxFQUFFQyxnQkFBZ0IsRUFBRUMsUUFBUSxFQUFFQyxNQUFNLEVBQzNFakIsU0FBUyxFQUFFYixRQUFRLEVBQUUrQixXQUFXLEVBQUVDLFdBQVcsRUFBRUMsa0JBQWtCLEVBQUUsR0FBRzFFO29CQUV4RSxJQUFJLENBQUN3QixRQUFRLENBQUNFLGNBQWM7d0JBQzFCLE9BQU92QyxxREFBWUEsQ0FBQ2MsSUFBSSxDQUN0Qjs0QkFBRUcsU0FBUzs0QkFBT0MsT0FBTzt3QkFBcUMsR0FDOUQ7NEJBQUVDLFFBQVE7d0JBQUk7b0JBRWxCO29CQUVBLDJCQUEyQjtvQkFDM0IsSUFBSUMsTUFBTTt3QkFDUixNQUFNb0UsV0FBV3BGLG1FQUFVQSxDQUFDVyxVQUFVSzt3QkFDdEMsSUFBSW9FLFVBQVU7NEJBQ1osT0FBT3hGLHFEQUFZQSxDQUFDYyxJQUFJLENBQ3RCO2dDQUFFRyxTQUFTO2dDQUFPQyxPQUFPOzRCQUE0QyxHQUNyRTtnQ0FBRUMsUUFBUTs0QkFBSTt3QkFFbEI7b0JBQ0Y7b0JBRUEsTUFBTXNFLGVBQTBCO3dCQUM5QnJELElBQUkzQixtRUFBVUEsQ0FBQzt3QkFDZk07d0JBQ0FzQjt3QkFDQUM7d0JBQ0FsQixNQUFNQSxNQUFNc0U7d0JBQ1ovQixNQUFNQSxRQUFTdkMsQ0FBQUEsT0FBTyxXQUFXLFdBQVU7d0JBQzNDbUI7d0JBQ0FDLGVBQWVBLGlCQUFpQjt3QkFDaENpQzt3QkFDQUM7d0JBQ0FDO3dCQUNBQyxZQUFZQSxjQUFjLEVBQUU7d0JBQzVCQyxhQUFhQSxlQUFlLEVBQUU7d0JBQzlCQyxtQkFBbUJBLHFCQUFxQixFQUFFO3dCQUMxQ0MsYUFBYUEsZUFBZSxFQUFFO3dCQUM5QkMsZ0JBQWdCQSxrQkFBa0I7d0JBQ2xDQzt3QkFDQVUsWUFBWTt3QkFDWlQ7d0JBQ0FDLFVBQVVBLFdBQVcsSUFBSVMsS0FBS1QsWUFBWSxJQUFJUzt3QkFDOUNSLFFBQVFBLFNBQVMsSUFBSVEsS0FBS1IsVUFBVXpDO3dCQUNwQ2tELFVBQVU7d0JBQ1YxQixXQUFXQSxhQUFhO3dCQUN4QmIsVUFBVUEsWUFBWTt3QkFDdEIrQjt3QkFDQUM7d0JBQ0FDO3dCQUNBTyxXQUFXLElBQUlGLE9BQU9HLFdBQVc7d0JBQ2pDQyxXQUFXLElBQUlKLE9BQU9HLFdBQVc7b0JBQ25DO29CQUVBMUYscUVBQVlBLENBQUNvRjtvQkFFYixPQUFPekYscURBQVlBLENBQUNjLElBQUksQ0FBQzt3QkFDdkJHLFNBQVM7d0JBQ1RRLFdBQVdnRTtvQkFDYixHQUFHO3dCQUFFdEUsUUFBUTtvQkFBSTtnQkFDbkI7UUFDRjtJQUVGLEVBQUUsT0FBT0QsT0FBTztRQUNkK0UsUUFBUS9FLEtBQUssQ0FBQyw4Q0FBOENBO1FBQzVELE9BQU9sQixxREFBWUEsQ0FBQ2MsSUFBSSxDQUN0QjtZQUFFRyxTQUFTO1lBQU9DLE9BQU9BLGlCQUFpQmdGLFFBQVFoRixNQUFNaUYsT0FBTyxHQUFHO1FBQXdCLEdBQzFGO1lBQUVoRixRQUFRO1FBQUk7SUFFbEI7QUFDRjtBQUVBOztDQUVDLEdBQ00sZUFBZWlGLElBQUl4RixPQUFvQjtJQUM1QyxJQUFJO1FBQ0YsTUFBTSxFQUFFeUYsWUFBWSxFQUFFLEdBQUcsSUFBSUMsSUFBSTFGLFFBQVEyRixHQUFHO1FBQzVDLE1BQU14RixXQUFXc0YsYUFBYUcsR0FBRyxDQUFDO1FBQ2xDLE1BQU1DLGFBQWFKLGFBQWFHLEdBQUcsQ0FBQyxrQkFBa0I7UUFDdEQsTUFBTTdDLE9BQU8wQyxhQUFhRyxHQUFHLENBQUM7UUFFOUIsSUFBSSxDQUFDekYsVUFBVTtZQUNiLE9BQU9mLHFEQUFZQSxDQUFDYyxJQUFJLENBQ3RCO2dCQUFFRyxTQUFTO2dCQUFPQyxPQUFPO1lBQXVCLEdBQ2hEO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQSxJQUFJdUYsYUFBYUQsYUFBYXZHLDRFQUFtQkEsQ0FBQ2EsWUFBWWQsc0VBQWFBLENBQUNjO1FBRTVFLElBQUk0QyxNQUFNO1lBQ1IrQyxhQUFhQSxXQUFXMUQsTUFBTSxDQUFDQyxDQUFBQSxJQUFLQSxFQUFFVSxJQUFJLEtBQUtBO1FBQ2pEO1FBRUEsT0FBTzNELHFEQUFZQSxDQUFDYyxJQUFJLENBQUM7WUFDdkJHLFNBQVM7WUFDVHlGLFlBQVlBLFdBQVczRCxHQUFHLENBQUNFLENBQUFBLElBQU07b0JBQy9CYixJQUFJYSxFQUFFYixFQUFFO29CQUNSQyxNQUFNWSxFQUFFWixJQUFJO29CQUNaQyxhQUFhVyxFQUFFWCxXQUFXO29CQUMxQmxCLE1BQU02QixFQUFFN0IsSUFBSTtvQkFDWnVDLE1BQU1WLEVBQUVVLElBQUk7b0JBQ1pwQixjQUFjVSxFQUFFVixZQUFZO29CQUM1QkMsZUFBZVMsRUFBRVQsYUFBYTtvQkFDOUJpQyxhQUFheEIsRUFBRXdCLFdBQVc7b0JBQzFCQyxlQUFlekIsRUFBRXlCLGFBQWE7b0JBQzlCQyxhQUFhMUIsRUFBRTBCLFdBQVc7b0JBQzFCSyxnQkFBZ0IvQixFQUFFK0IsY0FBYztvQkFDaENDLFlBQVloQyxFQUFFZ0MsVUFBVTtvQkFDeEJVLFlBQVkxQyxFQUFFMEMsVUFBVTtvQkFDeEJULGtCQUFrQmpDLEVBQUVpQyxnQkFBZ0I7b0JBQ3BDQyxVQUFVbEMsRUFBRWtDLFFBQVE7b0JBQ3BCQyxRQUFRbkMsRUFBRW1DLE1BQU07b0JBQ2hCUyxVQUFVNUMsRUFBRTRDLFFBQVE7b0JBQ3BCMUIsV0FBV2xCLEVBQUVrQixTQUFTO29CQUN0QmIsVUFBVUwsRUFBRUssUUFBUTtvQkFDcEIsdUJBQXVCO29CQUN2QitCLGFBQWFwQyxFQUFFb0MsV0FBVztvQkFDMUJDLGFBQWFyQyxFQUFFcUMsV0FBVztvQkFDMUJDLG9CQUFvQnRDLEVBQUVzQyxrQkFBa0I7b0JBQ3hDLG9CQUFvQjtvQkFDcEJvQixjQUFjQyxzQkFBc0IzRDtnQkFDdEM7WUFDQTRELE9BQU9ILFdBQVc1QyxNQUFNO1lBQ3hCZ0QsYUFBYUosV0FBVzFELE1BQU0sQ0FBQ0MsQ0FBQUEsSUFBS0EsRUFBRTRDLFFBQVEsRUFBRS9CLE1BQU07UUFDeEQ7SUFFRixFQUFFLE9BQU81QyxPQUFPO1FBQ2QrRSxRQUFRL0UsS0FBSyxDQUFDLG1DQUFtQ0E7UUFDakQsT0FBT2xCLHFEQUFZQSxDQUFDYyxJQUFJLENBQ3RCO1lBQUVHLFNBQVM7WUFBT0MsT0FBTztRQUF3QixHQUNqRDtZQUFFQyxRQUFRO1FBQUk7SUFFbEI7QUFDRjtBQUVBLFNBQVN5RixzQkFBc0IzRCxDQUFZO0lBQ3pDLE9BQVFBLEVBQUVWLFlBQVk7UUFDcEIsS0FBSztZQUNILE9BQU8sQ0FBQyxFQUFFVSxFQUFFVCxhQUFhLENBQUMsS0FBSyxFQUFFUyxFQUFFd0IsV0FBVyxHQUFHLENBQUMsT0FBTyxFQUFFeEIsRUFBRXdCLFdBQVcsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUM7UUFDcEYsS0FBSztZQUNILE9BQU8sQ0FBQyxDQUFDLEVBQUV4QixFQUFFVCxhQUFhLENBQUN1RSxPQUFPLENBQUMsR0FBRyxJQUFJLENBQUM7UUFDN0MsS0FBSztZQUNILE9BQU8sQ0FBQyxDQUFDLEVBQUU5RCxFQUFFVCxhQUFhLENBQUN1RSxPQUFPLENBQUMsR0FBRyxhQUFhLENBQUM7UUFDdEQsS0FBSztZQUNILE9BQU87UUFDVCxLQUFLO1lBQ0gsTUFBTUMsVUFBVS9ELEVBQUVzQyxrQkFBa0IsS0FBSyxNQUFNLFNBQVMsQ0FBQyxFQUFFdEMsRUFBRXNDLGtCQUFrQixDQUFDLEtBQUssQ0FBQztZQUN0RixPQUFPLENBQUMsSUFBSSxFQUFFdEMsRUFBRW9DLFdBQVcsQ0FBQyxLQUFLLEVBQUVwQyxFQUFFcUMsV0FBVyxDQUFDLENBQUMsRUFBRTBCLFFBQVEsQ0FBQztRQUMvRDtZQUNFLE9BQU87SUFDWDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2Fhcy1jb3JlLy4vc3JjL2FwcC9hcGkvc3ZtL3Byb21vdGlvbnMvcm91dGUudHM/NWE2ZiJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFNWTSBQcm9tb3Rpb25zIEFQSVxuICogXG4gKiBQT1NUIC9hcGkvc3ZtL3Byb21vdGlvbnMvdmFsaWRhdGUgLSBWYWxpZGF0ZSBjb3Vwb24gY29kZVxuICogUE9TVCAvYXBpL3N2bS9wcm9tb3Rpb25zL2NhbGN1bGF0ZSAtIENhbGN1bGF0ZSBkaXNjb3VudHMgZm9yIGNhcnRcbiAqIEdFVCAvYXBpL3N2bS9wcm9tb3Rpb25zIC0gTGlzdCBwcm9tb3Rpb25zXG4gKiBQT1NUIC9hcGkvc3ZtL3Byb21vdGlvbnMgLSBDcmVhdGUgcHJvbW90aW9uXG4gKiBcbiAqIElNUE9SVEFOVDpcbiAqIC0gUHJvbW90aW9ucyBhcHBseSBPTkxZIHRvIHRoaXMgbW9kdWxlIChTVk0pXG4gKiAtIEZpbmFsIHBheWFibGUgYW1vdW50IHNlbnQgdG8gQ29yZVxuICogLSBObyBnbG9iYWwgcHJpY2luZyBtdXRhdGlvblxuICovXG5cbmltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcidcbmltcG9ydCB7XG4gIGdldFByb21vdGlvbnMsXG4gIGdldEFjdGl2ZVByb21vdGlvbnMsXG4gIGdldEF1dG9tYXRpY1Byb21vdGlvbnMsXG4gIGZpbmRCeUNvZGUsXG4gIGFkZFByb21vdGlvbixcbiAgdmFsaWRhdGVQcm9tb3Rpb24sXG4gIGdldEVsaWdpYmxlSXRlbXMsXG4gIGNhbGN1bGF0ZURpc2NvdW50LFxuICBnZW5lcmF0ZUlkLFxuICB0eXBlIFByb21vdGlvbixcbiAgdHlwZSBQcm9tb3Rpb25DYXJ0SXRlbSxcbiAgdHlwZSBBcHBsaWVkUHJvbW90aW9uXG59IGZyb20gJ0AvbGliL3Byb21vdGlvbnMtc3RvcmFnZSdcbmltcG9ydCBEZWNpbWFsIGZyb20gJ2RlY2ltYWwuanMnXG5cbi8qKlxuICogUE9TVCAvYXBpL3N2bS9wcm9tb3Rpb25zIC0gQ3JlYXRlIGEgbmV3IHByb21vdGlvbiBPUiB2YWxpZGF0ZS9jYWxjdWxhdGVcbiAqIFxuICogRm9yIGFjdGlvbjogJ0NSRUFURScgLSBDcmVhdGUgbmV3IHByb21vdGlvblxuICogRm9yIGFjdGlvbjogJ1ZBTElEQVRFJyAtIFZhbGlkYXRlIGNvdXBvbiBjb2RlXG4gKiBGb3IgYWN0aW9uOiAnQ0FMQ1VMQVRFJyAtIENhbGN1bGF0ZSBkaXNjb3VudHMgZm9yIGNhcnRcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKClcbiAgICBjb25zdCB7IHRlbmFudElkLCBhY3Rpb24gfSA9IGJvZHlcbiAgICBcbiAgICBpZiAoIXRlbmFudElkKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAndGVuYW50SWQgaXMgcmVxdWlyZWQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cbiAgICBcbiAgICBzd2l0Y2ggKGFjdGlvbikge1xuICAgICAgY2FzZSAnVkFMSURBVEUnOiB7XG4gICAgICAgIC8vIFZhbGlkYXRlIGEgY291cG9uIGNvZGVcbiAgICAgICAgY29uc3QgeyBjb2RlLCBzdWJ0b3RhbCwgaXRlbXMsIGN1c3RvbWVySWQsIGlzRmlyc3RPcmRlciB9ID0gYm9keVxuICAgICAgICBcbiAgICAgICAgaWYgKCFjb2RlKSB7XG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdDb3Vwb24gY29kZSBpcyByZXF1aXJlZCcgfSxcbiAgICAgICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgICAgIClcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgcHJvbW90aW9uID0gZmluZEJ5Q29kZSh0ZW5hbnRJZCwgY29kZSlcbiAgICAgICAgXG4gICAgICAgIGlmICghcHJvbW90aW9uKSB7XG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgZXJyb3I6ICdJbnZhbGlkIGNvdXBvbiBjb2RlJyxcbiAgICAgICAgICAgIGVycm9yQ29kZTogJ05PVF9GT1VORCdcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0b3RhbFF1YW50aXR5ID0gKGl0ZW1zIHx8IFtdKS5yZWR1Y2UoXG4gICAgICAgICAgKHN1bTogbnVtYmVyLCBpdGVtOiBQcm9tb3Rpb25DYXJ0SXRlbSkgPT4gc3VtICsgaXRlbS5xdWFudGl0eSwgMFxuICAgICAgICApXG4gICAgICAgIFxuICAgICAgICBjb25zdCB2YWxpZGF0aW9uID0gdmFsaWRhdGVQcm9tb3Rpb24oXG4gICAgICAgICAgcHJvbW90aW9uLFxuICAgICAgICAgIHN1YnRvdGFsIHx8IDAsXG4gICAgICAgICAgdG90YWxRdWFudGl0eSxcbiAgICAgICAgICBjdXN0b21lcklkLFxuICAgICAgICAgIGlzRmlyc3RPcmRlcixcbiAgICAgICAgICBbXVxuICAgICAgICApXG4gICAgICAgIFxuICAgICAgICBpZiAoIXZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgIGVycm9yOiB2YWxpZGF0aW9uLmVycm9yLFxuICAgICAgICAgICAgZXJyb3JDb2RlOiB2YWxpZGF0aW9uLmVycm9yQ29kZVxuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIENhbGN1bGF0ZSBwb3RlbnRpYWwgZGlzY291bnRcbiAgICAgICAgY29uc3QgZGlzY291bnQgPSBjYWxjdWxhdGVEaXNjb3VudChcbiAgICAgICAgICBwcm9tb3Rpb24sXG4gICAgICAgICAgaXRlbXMgfHwgW10sXG4gICAgICAgICAgc3VidG90YWwgfHwgMCxcbiAgICAgICAgICBib2R5LnNoaXBwaW5nVG90YWxcbiAgICAgICAgKVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgIHZhbGlkOiB0cnVlLFxuICAgICAgICAgIHByb21vdGlvbjoge1xuICAgICAgICAgICAgaWQ6IHByb21vdGlvbi5pZCxcbiAgICAgICAgICAgIG5hbWU6IHByb21vdGlvbi5uYW1lLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IHByb21vdGlvbi5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgIGNvZGU6IHByb21vdGlvbi5jb2RlLFxuICAgICAgICAgICAgZGlzY291bnRUeXBlOiBwcm9tb3Rpb24uZGlzY291bnRUeXBlLFxuICAgICAgICAgICAgZGlzY291bnRWYWx1ZTogcHJvbW90aW9uLmRpc2NvdW50VmFsdWVcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBvdGVudGlhbERpc2NvdW50OiBkaXNjb3VudFxuICAgICAgICB9KVxuICAgICAgfVxuICAgICAgXG4gICAgICBjYXNlICdDQUxDVUxBVEUnOiB7XG4gICAgICAgIC8vIENhbGN1bGF0ZSBhbGwgYXBwbGljYWJsZSBkaXNjb3VudHNcbiAgICAgICAgY29uc3QgeyBpdGVtcywgc3VidG90YWwsIHNoaXBwaW5nVG90YWwsIGNvdXBvbkNvZGVzLCBjdXN0b21lcklkLCBpc0ZpcnN0T3JkZXIgfSA9IGJvZHlcbiAgICAgICAgXG4gICAgICAgIGlmIChzdWJ0b3RhbCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdzdWJ0b3RhbCBpcyByZXF1aXJlZCcgfSxcbiAgICAgICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgICAgIClcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgY2FydEl0ZW1zOiBQcm9tb3Rpb25DYXJ0SXRlbVtdID0gaXRlbXMgfHwgW11cbiAgICAgICAgY29uc3QgdG90YWxRdWFudGl0eSA9IGNhcnRJdGVtcy5yZWR1Y2UoKHN1bSwgaXRlbSkgPT4gc3VtICsgaXRlbS5xdWFudGl0eSwgMClcbiAgICAgICAgXG4gICAgICAgIC8vIEdldCBhdXRvbWF0aWMgcHJvbW90aW9uc1xuICAgICAgICBjb25zdCBhdXRvUHJvbW90aW9ucyA9IGdldEF1dG9tYXRpY1Byb21vdGlvbnModGVuYW50SWQpXG4gICAgICAgIFxuICAgICAgICAvLyBHZXQgY291cG9uIHByb21vdGlvbnNcbiAgICAgICAgY29uc3QgY291cG9uUHJvbW90aW9uczogUHJvbW90aW9uW10gPSAoY291cG9uQ29kZXMgfHwgW10pXG4gICAgICAgICAgLm1hcCgoY29kZTogc3RyaW5nKSA9PiBmaW5kQnlDb2RlKHRlbmFudElkLCBjb2RlKSlcbiAgICAgICAgICAuZmlsdGVyKChwOiBQcm9tb3Rpb24gfCBudWxsKTogcCBpcyBQcm9tb3Rpb24gPT4gcCAhPT0gbnVsbClcbiAgICAgICAgXG4gICAgICAgIC8vIENvbWJpbmUgYW5kIHNvcnQgYnkgcHJpb3JpdHlcbiAgICAgICAgY29uc3QgYWxsUHJvbW90aW9ucyA9IFsuLi5hdXRvUHJvbW90aW9ucywgLi4uY291cG9uUHJvbW90aW9uc11cbiAgICAgICAgICAuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgICAgaWYgKGIucHJpb3JpdHkgIT09IGEucHJpb3JpdHkpIHJldHVybiBiLnByaW9yaXR5IC0gYS5wcmlvcml0eVxuICAgICAgICAgICAgcmV0dXJuIGIuZGlzY291bnRWYWx1ZSAtIGEuZGlzY291bnRWYWx1ZVxuICAgICAgICAgIH0pXG4gICAgICAgIFxuICAgICAgICBjb25zdCBhcHBsaWVkUHJvbW90aW9uczogQXBwbGllZFByb21vdGlvbltdID0gW11cbiAgICAgICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdXG4gICAgICAgIGxldCBkaXNjb3VudFRvdGFsID0gbmV3IERlY2ltYWwoMClcbiAgICAgICAgbGV0IHNoaXBwaW5nRGlzY291bnQgPSBuZXcgRGVjaW1hbCgwKVxuICAgICAgICBcbiAgICAgICAgZm9yIChjb25zdCBwcm9tb3Rpb24gb2YgYWxsUHJvbW90aW9ucykge1xuICAgICAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2YWxpZGF0ZVByb21vdGlvbihcbiAgICAgICAgICAgIHByb21vdGlvbixcbiAgICAgICAgICAgIHN1YnRvdGFsLFxuICAgICAgICAgICAgdG90YWxRdWFudGl0eSxcbiAgICAgICAgICAgIGN1c3RvbWVySWQsXG4gICAgICAgICAgICBpc0ZpcnN0T3JkZXIsXG4gICAgICAgICAgICBhcHBsaWVkUHJvbW90aW9uc1xuICAgICAgICAgIClcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoIXZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgICAgICAgIGlmIChwcm9tb3Rpb24udHlwZSA9PT0gJ0NPVVBPTicpIHtcbiAgICAgICAgICAgICAgZXJyb3JzLnB1c2goYCR7cHJvbW90aW9uLmNvZGV9OiAke3ZhbGlkYXRpb24uZXJyb3J9YClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIENoZWNrIHByb2R1Y3QgZWxpZ2liaWxpdHlcbiAgICAgICAgICBjb25zdCBlbGlnaWJsZUl0ZW1zID0gZ2V0RWxpZ2libGVJdGVtcyhwcm9tb3Rpb24sIGNhcnRJdGVtcylcbiAgICAgICAgICBpZiAoZWxpZ2libGVJdGVtcy5sZW5ndGggPT09IDAgJiYgcHJvbW90aW9uLmRpc2NvdW50VHlwZSAhPT0gJ0ZSRUVfU0hJUFBJTkcnKSB7XG4gICAgICAgICAgICBpZiAocHJvbW90aW9uLnR5cGUgPT09ICdDT1VQT04nKSB7XG4gICAgICAgICAgICAgIGVycm9ycy5wdXNoKGAke3Byb21vdGlvbi5jb2RlfTogTm8gZWxpZ2libGUgaXRlbXMgaW4geW91ciBjYXJ0YClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIGNvbnN0IGFwcGxpZWQgPSBjYWxjdWxhdGVEaXNjb3VudChwcm9tb3Rpb24sIGNhcnRJdGVtcywgc3VidG90YWwsIHNoaXBwaW5nVG90YWwpXG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKGFwcGxpZWQpIHtcbiAgICAgICAgICAgIGFwcGxpZWRQcm9tb3Rpb25zLnB1c2goYXBwbGllZClcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKGFwcGxpZWQuZnJlZVNoaXBwaW5nICYmIHNoaXBwaW5nVG90YWwpIHtcbiAgICAgICAgICAgICAgc2hpcHBpbmdEaXNjb3VudCA9IG5ldyBEZWNpbWFsKHNoaXBwaW5nVG90YWwpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBkaXNjb3VudFRvdGFsID0gZGlzY291bnRUb3RhbC5wbHVzKGFwcGxpZWQuZGlzY291bnRBbW91bnQpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICghcHJvbW90aW9uLnN0YWNrYWJsZSkge1xuICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gRG9uJ3QgZXhjZWVkIHN1YnRvdGFsXG4gICAgICAgIGlmIChkaXNjb3VudFRvdGFsLmdyZWF0ZXJUaGFuKHN1YnRvdGFsKSkge1xuICAgICAgICAgIGRpc2NvdW50VG90YWwgPSBuZXcgRGVjaW1hbChzdWJ0b3RhbClcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgZmluYWxTdWJ0b3RhbCA9IG5ldyBEZWNpbWFsKHN1YnRvdGFsKVxuICAgICAgICAgIC5taW51cyhkaXNjb3VudFRvdGFsKVxuICAgICAgICAgIC50b0RlY2ltYWxQbGFjZXMoMilcbiAgICAgICAgICAudG9OdW1iZXIoKVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgIGFwcGxpZWRQcm9tb3Rpb25zLFxuICAgICAgICAgIHN1YnRvdGFsLFxuICAgICAgICAgIGRpc2NvdW50VG90YWw6IGRpc2NvdW50VG90YWwudG9EZWNpbWFsUGxhY2VzKDIpLnRvTnVtYmVyKCksXG4gICAgICAgICAgc2hpcHBpbmdEaXNjb3VudDogc2hpcHBpbmdEaXNjb3VudC50b0RlY2ltYWxQbGFjZXMoMikudG9OdW1iZXIoKSxcbiAgICAgICAgICBmaW5hbFN1YnRvdGFsLFxuICAgICAgICAgIHNoaXBwaW5nVG90YWw6IHNoaXBwaW5nVG90YWwgPyBcbiAgICAgICAgICAgIG5ldyBEZWNpbWFsKHNoaXBwaW5nVG90YWwpLm1pbnVzKHNoaXBwaW5nRGlzY291bnQpLnRvTnVtYmVyKCkgOiBcbiAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICBlcnJvcnM6IGVycm9ycy5sZW5ndGggPiAwID8gZXJyb3JzIDogdW5kZWZpbmVkXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgICBcbiAgICAgIGNhc2UgJ0NSRUFURSc6XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIC8vIENyZWF0ZSBhIG5ldyBwcm9tb3Rpb25cbiAgICAgICAgY29uc3QgeyBuYW1lLCBkZXNjcmlwdGlvbiwgY29kZSwgdHlwZSwgZGlzY291bnRUeXBlLCBkaXNjb3VudFZhbHVlLCBtYXhEaXNjb3VudCxcbiAgICAgICAgICBtaW5PcmRlclRvdGFsLCBtaW5RdWFudGl0eSwgcHJvZHVjdElkcywgY2F0ZWdvcnlJZHMsIGV4Y2x1ZGVQcm9kdWN0SWRzLFxuICAgICAgICAgIGN1c3RvbWVySWRzLCBmaXJzdE9yZGVyT25seSwgdXNhZ2VMaW1pdCwgcGVyQ3VzdG9tZXJMaW1pdCwgc3RhcnRzQXQsIGVuZHNBdCxcbiAgICAgICAgICBzdGFja2FibGUsIHByaW9yaXR5LCBidXlRdWFudGl0eSwgZ2V0UXVhbnRpdHksIGdldERpc2NvdW50UGVyY2VudCB9ID0gYm9keVxuICAgICAgICBcbiAgICAgICAgaWYgKCFuYW1lIHx8ICFkaXNjb3VudFR5cGUpIHtcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ25hbWUgYW5kIGRpc2NvdW50VHlwZSBhcmUgcmVxdWlyZWQnIH0sXG4gICAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgICApXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIENoZWNrIGZvciBkdXBsaWNhdGUgY29kZVxuICAgICAgICBpZiAoY29kZSkge1xuICAgICAgICAgIGNvbnN0IGV4aXN0aW5nID0gZmluZEJ5Q29kZSh0ZW5hbnRJZCwgY29kZSlcbiAgICAgICAgICBpZiAoZXhpc3RpbmcpIHtcbiAgICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdBIHByb21vdGlvbiB3aXRoIHRoaXMgY29kZSBhbHJlYWR5IGV4aXN0cycgfSxcbiAgICAgICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICAgICApXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCBuZXdQcm9tb3Rpb246IFByb21vdGlvbiA9IHtcbiAgICAgICAgICBpZDogZ2VuZXJhdGVJZCgncHJvbW8nKSxcbiAgICAgICAgICB0ZW5hbnRJZCxcbiAgICAgICAgICBuYW1lLFxuICAgICAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgICAgIGNvZGU6IGNvZGU/LnRvVXBwZXJDYXNlKCksXG4gICAgICAgICAgdHlwZTogdHlwZSB8fCAoY29kZSA/ICdDT1VQT04nIDogJ0FVVE9NQVRJQycpLFxuICAgICAgICAgIGRpc2NvdW50VHlwZSxcbiAgICAgICAgICBkaXNjb3VudFZhbHVlOiBkaXNjb3VudFZhbHVlIHx8IDAsXG4gICAgICAgICAgbWF4RGlzY291bnQsXG4gICAgICAgICAgbWluT3JkZXJUb3RhbCxcbiAgICAgICAgICBtaW5RdWFudGl0eSxcbiAgICAgICAgICBwcm9kdWN0SWRzOiBwcm9kdWN0SWRzIHx8IFtdLFxuICAgICAgICAgIGNhdGVnb3J5SWRzOiBjYXRlZ29yeUlkcyB8fCBbXSxcbiAgICAgICAgICBleGNsdWRlUHJvZHVjdElkczogZXhjbHVkZVByb2R1Y3RJZHMgfHwgW10sXG4gICAgICAgICAgY3VzdG9tZXJJZHM6IGN1c3RvbWVySWRzIHx8IFtdLFxuICAgICAgICAgIGZpcnN0T3JkZXJPbmx5OiBmaXJzdE9yZGVyT25seSB8fCBmYWxzZSxcbiAgICAgICAgICB1c2FnZUxpbWl0LFxuICAgICAgICAgIHVzYWdlQ291bnQ6IDAsXG4gICAgICAgICAgcGVyQ3VzdG9tZXJMaW1pdCxcbiAgICAgICAgICBzdGFydHNBdDogc3RhcnRzQXQgPyBuZXcgRGF0ZShzdGFydHNBdCkgOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIGVuZHNBdDogZW5kc0F0ID8gbmV3IERhdGUoZW5kc0F0KSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICBzdGFja2FibGU6IHN0YWNrYWJsZSB8fCBmYWxzZSxcbiAgICAgICAgICBwcmlvcml0eTogcHJpb3JpdHkgfHwgMCxcbiAgICAgICAgICBidXlRdWFudGl0eSxcbiAgICAgICAgICBnZXRRdWFudGl0eSxcbiAgICAgICAgICBnZXREaXNjb3VudFBlcmNlbnQsXG4gICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgYWRkUHJvbW90aW9uKG5ld1Byb21vdGlvbilcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICBwcm9tb3Rpb246IG5ld1Byb21vdGlvblxuICAgICAgICB9LCB7IHN0YXR1czogMjAxIH0pXG4gICAgICB9XG4gICAgfVxuICAgIFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tTVk1dIEVycm9yIHByb2Nlc3NpbmcgcHJvbW90aW9ucyByZXF1ZXN0OicsIGVycm9yKVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApXG4gIH1cbn1cblxuLyoqXG4gKiBHRVQgL2FwaS9zdm0vcHJvbW90aW9ucyAtIExpc3QgcHJvbW90aW9uc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBzZWFyY2hQYXJhbXMgfSA9IG5ldyBVUkwocmVxdWVzdC51cmwpXG4gICAgY29uc3QgdGVuYW50SWQgPSBzZWFyY2hQYXJhbXMuZ2V0KCd0ZW5hbnRJZCcpXG4gICAgY29uc3QgYWN0aXZlT25seSA9IHNlYXJjaFBhcmFtcy5nZXQoJ2FjdGl2ZU9ubHknKSA9PT0gJ3RydWUnXG4gICAgY29uc3QgdHlwZSA9IHNlYXJjaFBhcmFtcy5nZXQoJ3R5cGUnKSBhcyAnQ09VUE9OJyB8ICdBVVRPTUFUSUMnIHwgJ0ZMQVNIX1NBTEUnIHwgbnVsbFxuICAgIFxuICAgIGlmICghdGVuYW50SWQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICd0ZW5hbnRJZCBpcyByZXF1aXJlZCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuICAgIFxuICAgIGxldCBwcm9tb3Rpb25zID0gYWN0aXZlT25seSA/IGdldEFjdGl2ZVByb21vdGlvbnModGVuYW50SWQpIDogZ2V0UHJvbW90aW9ucyh0ZW5hbnRJZClcbiAgICBcbiAgICBpZiAodHlwZSkge1xuICAgICAgcHJvbW90aW9ucyA9IHByb21vdGlvbnMuZmlsdGVyKHAgPT4gcC50eXBlID09PSB0eXBlKVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHByb21vdGlvbnM6IHByb21vdGlvbnMubWFwKHAgPT4gKHtcbiAgICAgICAgaWQ6IHAuaWQsXG4gICAgICAgIG5hbWU6IHAubmFtZSxcbiAgICAgICAgZGVzY3JpcHRpb246IHAuZGVzY3JpcHRpb24sXG4gICAgICAgIGNvZGU6IHAuY29kZSxcbiAgICAgICAgdHlwZTogcC50eXBlLFxuICAgICAgICBkaXNjb3VudFR5cGU6IHAuZGlzY291bnRUeXBlLFxuICAgICAgICBkaXNjb3VudFZhbHVlOiBwLmRpc2NvdW50VmFsdWUsXG4gICAgICAgIG1heERpc2NvdW50OiBwLm1heERpc2NvdW50LFxuICAgICAgICBtaW5PcmRlclRvdGFsOiBwLm1pbk9yZGVyVG90YWwsXG4gICAgICAgIG1pblF1YW50aXR5OiBwLm1pblF1YW50aXR5LFxuICAgICAgICBmaXJzdE9yZGVyT25seTogcC5maXJzdE9yZGVyT25seSxcbiAgICAgICAgdXNhZ2VMaW1pdDogcC51c2FnZUxpbWl0LFxuICAgICAgICB1c2FnZUNvdW50OiBwLnVzYWdlQ291bnQsXG4gICAgICAgIHBlckN1c3RvbWVyTGltaXQ6IHAucGVyQ3VzdG9tZXJMaW1pdCxcbiAgICAgICAgc3RhcnRzQXQ6IHAuc3RhcnRzQXQsXG4gICAgICAgIGVuZHNBdDogcC5lbmRzQXQsXG4gICAgICAgIGlzQWN0aXZlOiBwLmlzQWN0aXZlLFxuICAgICAgICBzdGFja2FibGU6IHAuc3RhY2thYmxlLFxuICAgICAgICBwcmlvcml0eTogcC5wcmlvcml0eSxcbiAgICAgICAgLy8gQlVZX1hfR0VUX1kgc3BlY2lmaWNcbiAgICAgICAgYnV5UXVhbnRpdHk6IHAuYnV5UXVhbnRpdHksXG4gICAgICAgIGdldFF1YW50aXR5OiBwLmdldFF1YW50aXR5LFxuICAgICAgICBnZXREaXNjb3VudFBlcmNlbnQ6IHAuZ2V0RGlzY291bnRQZXJjZW50LFxuICAgICAgICAvLyBGb3JtYXR0ZWQgZGlzcGxheVxuICAgICAgICBkaXNwbGF5VmFsdWU6IGZvcm1hdERpc2NvdW50RGlzcGxheShwKVxuICAgICAgfSkpLFxuICAgICAgdG90YWw6IHByb21vdGlvbnMubGVuZ3RoLFxuICAgICAgYWN0aXZlQ291bnQ6IHByb21vdGlvbnMuZmlsdGVyKHAgPT4gcC5pc0FjdGl2ZSkubGVuZ3RoXG4gICAgfSlcbiAgICBcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbU1ZNXSBFcnJvciBsaXN0aW5nIHByb21vdGlvbnM6JywgZXJyb3IpXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApXG4gIH1cbn1cblxuZnVuY3Rpb24gZm9ybWF0RGlzY291bnREaXNwbGF5KHA6IFByb21vdGlvbik6IHN0cmluZyB7XG4gIHN3aXRjaCAocC5kaXNjb3VudFR5cGUpIHtcbiAgICBjYXNlICdQRVJDRU5UQUdFJzpcbiAgICAgIHJldHVybiBgJHtwLmRpc2NvdW50VmFsdWV9JSBvZmYke3AubWF4RGlzY291bnQgPyBgIChtYXggJCR7cC5tYXhEaXNjb3VudH0pYCA6ICcnfWBcbiAgICBjYXNlICdGSVhFRF9BTU9VTlQnOlxuICAgICAgcmV0dXJuIGAkJHtwLmRpc2NvdW50VmFsdWUudG9GaXhlZCgyKX0gb2ZmYFxuICAgIGNhc2UgJ0ZJWEVEX1BFUl9JVEVNJzpcbiAgICAgIHJldHVybiBgJCR7cC5kaXNjb3VudFZhbHVlLnRvRml4ZWQoMil9IG9mZiBwZXIgaXRlbWBcbiAgICBjYXNlICdGUkVFX1NISVBQSU5HJzpcbiAgICAgIHJldHVybiAnRnJlZSBzaGlwcGluZydcbiAgICBjYXNlICdCVVlfWF9HRVRfWSc6XG4gICAgICBjb25zdCBnZXREZXNjID0gcC5nZXREaXNjb3VudFBlcmNlbnQgPT09IDEwMCA/ICdmcmVlJyA6IGAke3AuZ2V0RGlzY291bnRQZXJjZW50fSUgb2ZmYFxuICAgICAgcmV0dXJuIGBCdXkgJHtwLmJ1eVF1YW50aXR5fSBnZXQgJHtwLmdldFF1YW50aXR5fSAke2dldERlc2N9YFxuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gJydcbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImdldFByb21vdGlvbnMiLCJnZXRBY3RpdmVQcm9tb3Rpb25zIiwiZ2V0QXV0b21hdGljUHJvbW90aW9ucyIsImZpbmRCeUNvZGUiLCJhZGRQcm9tb3Rpb24iLCJ2YWxpZGF0ZVByb21vdGlvbiIsImdldEVsaWdpYmxlSXRlbXMiLCJjYWxjdWxhdGVEaXNjb3VudCIsImdlbmVyYXRlSWQiLCJEZWNpbWFsIiwiUE9TVCIsInJlcXVlc3QiLCJib2R5IiwianNvbiIsInRlbmFudElkIiwiYWN0aW9uIiwic3VjY2VzcyIsImVycm9yIiwic3RhdHVzIiwiY29kZSIsInN1YnRvdGFsIiwiaXRlbXMiLCJjdXN0b21lcklkIiwiaXNGaXJzdE9yZGVyIiwicHJvbW90aW9uIiwidmFsaWQiLCJlcnJvckNvZGUiLCJ0b3RhbFF1YW50aXR5IiwicmVkdWNlIiwic3VtIiwiaXRlbSIsInF1YW50aXR5IiwidmFsaWRhdGlvbiIsImRpc2NvdW50Iiwic2hpcHBpbmdUb3RhbCIsImlkIiwibmFtZSIsImRlc2NyaXB0aW9uIiwiZGlzY291bnRUeXBlIiwiZGlzY291bnRWYWx1ZSIsInBvdGVudGlhbERpc2NvdW50IiwiY291cG9uQ29kZXMiLCJ1bmRlZmluZWQiLCJjYXJ0SXRlbXMiLCJhdXRvUHJvbW90aW9ucyIsImNvdXBvblByb21vdGlvbnMiLCJtYXAiLCJmaWx0ZXIiLCJwIiwiYWxsUHJvbW90aW9ucyIsInNvcnQiLCJhIiwiYiIsInByaW9yaXR5IiwiYXBwbGllZFByb21vdGlvbnMiLCJlcnJvcnMiLCJkaXNjb3VudFRvdGFsIiwic2hpcHBpbmdEaXNjb3VudCIsInR5cGUiLCJwdXNoIiwiZWxpZ2libGVJdGVtcyIsImxlbmd0aCIsImFwcGxpZWQiLCJmcmVlU2hpcHBpbmciLCJwbHVzIiwiZGlzY291bnRBbW91bnQiLCJzdGFja2FibGUiLCJncmVhdGVyVGhhbiIsImZpbmFsU3VidG90YWwiLCJtaW51cyIsInRvRGVjaW1hbFBsYWNlcyIsInRvTnVtYmVyIiwibWF4RGlzY291bnQiLCJtaW5PcmRlclRvdGFsIiwibWluUXVhbnRpdHkiLCJwcm9kdWN0SWRzIiwiY2F0ZWdvcnlJZHMiLCJleGNsdWRlUHJvZHVjdElkcyIsImN1c3RvbWVySWRzIiwiZmlyc3RPcmRlck9ubHkiLCJ1c2FnZUxpbWl0IiwicGVyQ3VzdG9tZXJMaW1pdCIsInN0YXJ0c0F0IiwiZW5kc0F0IiwiYnV5UXVhbnRpdHkiLCJnZXRRdWFudGl0eSIsImdldERpc2NvdW50UGVyY2VudCIsImV4aXN0aW5nIiwibmV3UHJvbW90aW9uIiwidG9VcHBlckNhc2UiLCJ1c2FnZUNvdW50IiwiRGF0ZSIsImlzQWN0aXZlIiwiY3JlYXRlZEF0IiwidG9JU09TdHJpbmciLCJ1cGRhdGVkQXQiLCJjb25zb2xlIiwiRXJyb3IiLCJtZXNzYWdlIiwiR0VUIiwic2VhcmNoUGFyYW1zIiwiVVJMIiwidXJsIiwiZ2V0IiwiYWN0aXZlT25seSIsInByb21vdGlvbnMiLCJkaXNwbGF5VmFsdWUiLCJmb3JtYXREaXNjb3VudERpc3BsYXkiLCJ0b3RhbCIsImFjdGl2ZUNvdW50IiwidG9GaXhlZCIsImdldERlc2MiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/svm/promotions/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/promotions-storage.ts":
/*!***************************************!*\
  !*** ./src/lib/promotions-storage.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addPromotion: () => (/* binding */ addPromotion),\n/* harmony export */   calculateDiscount: () => (/* binding */ calculateDiscount),\n/* harmony export */   deletePromotion: () => (/* binding */ deletePromotion),\n/* harmony export */   findByCode: () => (/* binding */ findByCode),\n/* harmony export */   generateId: () => (/* binding */ generateId),\n/* harmony export */   getActivePromotions: () => (/* binding */ getActivePromotions),\n/* harmony export */   getAutomaticPromotions: () => (/* binding */ getAutomaticPromotions),\n/* harmony export */   getCustomerUsageCount: () => (/* binding */ getCustomerUsageCount),\n/* harmony export */   getEligibleItems: () => (/* binding */ getEligibleItems),\n/* harmony export */   getOrCreatePromotions: () => (/* binding */ getOrCreatePromotions),\n/* harmony export */   getPromotion: () => (/* binding */ getPromotion),\n/* harmony export */   getPromotions: () => (/* binding */ getPromotions),\n/* harmony export */   recordUsage: () => (/* binding */ recordUsage),\n/* harmony export */   updatePromotion: () => (/* binding */ updatePromotion),\n/* harmony export */   validatePromotion: () => (/* binding */ validatePromotion)\n/* harmony export */ });\n/* harmony import */ var decimal_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! decimal.js */ \"(rsc)/./node_modules/decimal.js/decimal.mjs\");\n/**\n * SVM Promotions Storage\n * \n * Shared in-memory storage for promotions.\n * Using globalThis to ensure single instance across all Next.js API routes.\n * \n * In production, this would be replaced with database queries.\n */ \n// ============================================================================\n// SHARED STORAGE (Singleton using globalThis)\n// ============================================================================\nconst PROMOTIONS_STORAGE_KEY = \"__svm_promotions_storage__\";\nconst USAGE_STORAGE_KEY = \"__svm_promotion_usage_storage__\";\nfunction getPromotionsStorage() {\n    if (!globalThis[PROMOTIONS_STORAGE_KEY]) {\n        globalThis[PROMOTIONS_STORAGE_KEY] = new Map();\n    }\n    return globalThis[PROMOTIONS_STORAGE_KEY];\n}\nfunction getUsageStorage() {\n    if (!globalThis[USAGE_STORAGE_KEY]) {\n        globalThis[USAGE_STORAGE_KEY] = new Map();\n    }\n    return globalThis[USAGE_STORAGE_KEY];\n}\nfunction generateId(prefix = \"promo\") {\n    return `${prefix}_${Date.now().toString(36)}${Math.random().toString(36).substring(2, 9)}`;\n}\n// ============================================================================\n// PROMOTION CRUD\n// ============================================================================\n/**\n * Get or create sample promotions for a tenant\n */ function getOrCreatePromotions(tenantId) {\n    const storage = getPromotionsStorage();\n    if (storage.has(tenantId)) {\n        return storage.get(tenantId);\n    }\n    // Create sample promotions\n    const now = new Date();\n    const samplePromotions = [\n        {\n            id: generateId(\"promo\"),\n            tenantId,\n            name: \"Welcome Discount\",\n            description: \"10% off your first order\",\n            code: \"WELCOME10\",\n            type: \"COUPON\",\n            discountType: \"PERCENTAGE\",\n            discountValue: 10,\n            productIds: [],\n            categoryIds: [],\n            excludeProductIds: [],\n            customerIds: [],\n            firstOrderOnly: true,\n            usageCount: 0,\n            startsAt: now,\n            isActive: true,\n            stackable: false,\n            priority: 0,\n            createdAt: now.toISOString(),\n            updatedAt: now.toISOString()\n        },\n        {\n            id: generateId(\"promo\"),\n            tenantId,\n            name: \"Summer Sale\",\n            description: \"15% off orders over $100 (max $50 discount)\",\n            type: \"AUTOMATIC\",\n            discountType: \"PERCENTAGE\",\n            discountValue: 15,\n            maxDiscount: 50,\n            minOrderTotal: 100,\n            productIds: [],\n            categoryIds: [],\n            excludeProductIds: [],\n            customerIds: [],\n            firstOrderOnly: false,\n            usageCount: 0,\n            startsAt: now,\n            isActive: true,\n            stackable: true,\n            priority: 10,\n            createdAt: now.toISOString(),\n            updatedAt: now.toISOString()\n        },\n        {\n            id: generateId(\"promo\"),\n            tenantId,\n            name: \"Free Shipping\",\n            description: \"Free shipping on orders over $50\",\n            code: \"FREESHIP\",\n            type: \"COUPON\",\n            discountType: \"FREE_SHIPPING\",\n            discountValue: 0,\n            minOrderTotal: 50,\n            productIds: [],\n            categoryIds: [],\n            excludeProductIds: [],\n            customerIds: [],\n            firstOrderOnly: false,\n            usageCount: 0,\n            startsAt: now,\n            isActive: true,\n            stackable: true,\n            priority: 5,\n            createdAt: now.toISOString(),\n            updatedAt: now.toISOString()\n        },\n        {\n            id: generateId(\"promo\"),\n            tenantId,\n            name: \"Buy 2 Get 1 Free\",\n            description: \"Buy any 2 items, get 1 free\",\n            code: \"BOGO\",\n            type: \"COUPON\",\n            discountType: \"BUY_X_GET_Y\",\n            discountValue: 100,\n            buyQuantity: 2,\n            getQuantity: 1,\n            getDiscountPercent: 100,\n            productIds: [],\n            categoryIds: [],\n            excludeProductIds: [],\n            customerIds: [],\n            firstOrderOnly: false,\n            usageCount: 0,\n            startsAt: now,\n            isActive: true,\n            stackable: false,\n            priority: 0,\n            createdAt: now.toISOString(),\n            updatedAt: now.toISOString()\n        },\n        {\n            id: generateId(\"promo\"),\n            tenantId,\n            name: \"$20 Off\",\n            description: \"$20 off orders over $75 (limit 100 uses)\",\n            code: \"SAVE20\",\n            type: \"COUPON\",\n            discountType: \"FIXED_AMOUNT\",\n            discountValue: 20,\n            minOrderTotal: 75,\n            usageLimit: 100,\n            perCustomerLimit: 1,\n            productIds: [],\n            categoryIds: [],\n            excludeProductIds: [],\n            customerIds: [],\n            firstOrderOnly: false,\n            usageCount: 0,\n            startsAt: now,\n            isActive: true,\n            stackable: false,\n            priority: 0,\n            createdAt: now.toISOString(),\n            updatedAt: now.toISOString()\n        }\n    ];\n    storage.set(tenantId, samplePromotions);\n    return samplePromotions;\n}\nfunction getPromotions(tenantId) {\n    return getOrCreatePromotions(tenantId);\n}\nfunction getActivePromotions(tenantId) {\n    const now = new Date();\n    return getPromotions(tenantId).filter((p)=>p.isActive && p.startsAt <= now && (!p.endsAt || p.endsAt > now) && (!p.usageLimit || p.usageCount < p.usageLimit));\n}\nfunction getAutomaticPromotions(tenantId) {\n    return getActivePromotions(tenantId).filter((p)=>p.type === \"AUTOMATIC\" || p.type === \"FLASH_SALE\");\n}\nfunction findByCode(tenantId, code) {\n    const promotions = getActivePromotions(tenantId);\n    return promotions.find((p)=>p.code?.toUpperCase() === code.toUpperCase()) || null;\n}\nfunction getPromotion(tenantId, promotionId) {\n    const promotions = getPromotions(tenantId);\n    return promotions.find((p)=>p.id === promotionId) || null;\n}\nfunction addPromotion(promotion) {\n    const storage = getPromotionsStorage();\n    const promotions = getOrCreatePromotions(promotion.tenantId);\n    promotions.push(promotion);\n}\nfunction updatePromotion(tenantId, promotionId, updates) {\n    const promotions = getPromotions(tenantId);\n    const index = promotions.findIndex((p)=>p.id === promotionId);\n    if (index < 0) return null;\n    promotions[index] = {\n        ...promotions[index],\n        ...updates,\n        updatedAt: new Date().toISOString()\n    };\n    return promotions[index];\n}\nfunction deletePromotion(tenantId, promotionId) {\n    const storage = getPromotionsStorage();\n    const promotions = storage.get(tenantId) || [];\n    const index = promotions.findIndex((p)=>p.id === promotionId);\n    if (index < 0) return null;\n    const [deleted] = promotions.splice(index, 1);\n    return deleted;\n}\n// ============================================================================\n// USAGE TRACKING\n// ============================================================================\nfunction recordUsage(promotionId, orderId, customerId, discountApplied) {\n    const usageStorage = getUsageStorage();\n    const promotionsStorage = getPromotionsStorage();\n    const usage = {\n        id: generateId(\"usage\"),\n        promotionId,\n        orderId,\n        customerId,\n        discountApplied,\n        createdAt: new Date()\n    };\n    // Store usage\n    const usages = usageStorage.get(promotionId) || [];\n    usages.push(usage);\n    usageStorage.set(promotionId, usages);\n    // Increment usage count on promotion\n    for (const [tenantId, promotions] of promotionsStorage){\n        const promotion = promotions.find((p)=>p.id === promotionId);\n        if (promotion) {\n            promotion.usageCount++;\n            break;\n        }\n    }\n    return usage;\n}\nfunction getCustomerUsageCount(promotionId, customerId) {\n    if (!customerId) return 0;\n    const usageStorage = getUsageStorage();\n    const usages = usageStorage.get(promotionId) || [];\n    return usages.filter((u)=>u.customerId === customerId).length;\n}\nfunction validatePromotion(promotion, subtotal, totalQuantity, customerId, isFirstOrder, currentDiscounts = []) {\n    const now = new Date();\n    if (!promotion.isActive) {\n        return {\n            valid: false,\n            error: \"This promotion is no longer active\",\n            errorCode: \"INACTIVE\"\n        };\n    }\n    if (promotion.startsAt > now) {\n        return {\n            valid: false,\n            error: \"This promotion has not started yet\",\n            errorCode: \"NOT_STARTED\"\n        };\n    }\n    if (promotion.endsAt && promotion.endsAt < now) {\n        return {\n            valid: false,\n            error: \"This promotion has expired\",\n            errorCode: \"EXPIRED\"\n        };\n    }\n    if (promotion.usageLimit && promotion.usageCount >= promotion.usageLimit) {\n        return {\n            valid: false,\n            error: \"This promotion has reached its usage limit\",\n            errorCode: \"USAGE_LIMIT_REACHED\"\n        };\n    }\n    const customerUsageCount = getCustomerUsageCount(promotion.id, customerId);\n    if (promotion.perCustomerLimit && customerUsageCount >= promotion.perCustomerLimit) {\n        return {\n            valid: false,\n            error: \"You have already used this promotion the maximum number of times\",\n            errorCode: \"CUSTOMER_LIMIT_REACHED\"\n        };\n    }\n    if (promotion.customerIds.length > 0 && customerId) {\n        if (!promotion.customerIds.includes(customerId)) {\n            return {\n                valid: false,\n                error: \"This promotion is not available for your account\",\n                errorCode: \"CUSTOMER_NOT_ELIGIBLE\"\n            };\n        }\n    }\n    if (promotion.firstOrderOnly && !isFirstOrder) {\n        return {\n            valid: false,\n            error: \"This promotion is only valid for first-time orders\",\n            errorCode: \"FIRST_ORDER_ONLY\"\n        };\n    }\n    if (promotion.minOrderTotal && subtotal < promotion.minOrderTotal) {\n        return {\n            valid: false,\n            error: `Minimum order total of $${promotion.minOrderTotal.toFixed(2)} required`,\n            errorCode: \"MIN_ORDER_NOT_MET\"\n        };\n    }\n    if (promotion.minQuantity && totalQuantity < promotion.minQuantity) {\n        return {\n            valid: false,\n            error: `Minimum of ${promotion.minQuantity} items required`,\n            errorCode: \"MIN_QUANTITY_NOT_MET\"\n        };\n    }\n    if (!promotion.stackable && currentDiscounts.length > 0) {\n        return {\n            valid: false,\n            error: \"This promotion cannot be combined with other discounts\",\n            errorCode: \"NOT_STACKABLE\"\n        };\n    }\n    if (currentDiscounts.some((d)=>d.promotionId === promotion.id)) {\n        return {\n            valid: false,\n            error: \"This promotion is already applied\",\n            errorCode: \"ALREADY_APPLIED\"\n        };\n    }\n    return {\n        valid: true\n    };\n}\nfunction getEligibleItems(promotion, items) {\n    return items.filter((item)=>{\n        if (promotion.excludeProductIds.includes(item.productId)) {\n            return false;\n        }\n        if (promotion.productIds.length === 0 && promotion.categoryIds.length === 0) {\n            return true;\n        }\n        if (promotion.productIds.length > 0 && promotion.productIds.includes(item.productId)) {\n            return true;\n        }\n        if (promotion.categoryIds.length > 0 && item.categoryId && promotion.categoryIds.includes(item.categoryId)) {\n            return true;\n        }\n        return false;\n    });\n}\nfunction calculateDiscount(promotion, items, subtotal, shippingTotal) {\n    const eligibleItems = getEligibleItems(promotion, items);\n    let discountAmount = new decimal_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](0);\n    let originalAmount;\n    let freeShipping = false;\n    let affectedItems = [];\n    let message = \"\";\n    switch(promotion.discountType){\n        case \"PERCENTAGE\":\n            {\n                const eligibleSubtotal = eligibleItems.reduce((sum, item)=>sum + item.unitPrice * item.quantity, 0);\n                const percentDiscount = new decimal_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](eligibleSubtotal).times(promotion.discountValue).dividedBy(100);\n                originalAmount = percentDiscount.toDecimalPlaces(2).toNumber();\n                if (promotion.maxDiscount && percentDiscount.greaterThan(promotion.maxDiscount)) {\n                    discountAmount = new decimal_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](promotion.maxDiscount);\n                } else {\n                    discountAmount = percentDiscount;\n                }\n                affectedItems = eligibleItems.map((i)=>i.productId);\n                message = `${promotion.discountValue}% off${affectedItems.length < items.length ? \" eligible items\" : \"\"}`;\n                break;\n            }\n        case \"FIXED_AMOUNT\":\n            {\n                discountAmount = new decimal_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](promotion.discountValue);\n                if (discountAmount.greaterThan(subtotal)) {\n                    discountAmount = new decimal_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](subtotal);\n                }\n                message = `$${promotion.discountValue.toFixed(2)} off your order`;\n                break;\n            }\n        case \"FIXED_PER_ITEM\":\n            {\n                const totalEligibleQty = eligibleItems.reduce((sum, item)=>sum + item.quantity, 0);\n                discountAmount = new decimal_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](promotion.discountValue).times(totalEligibleQty);\n                const eligibleSubtotal = eligibleItems.reduce((sum, item)=>sum + item.unitPrice * item.quantity, 0);\n                if (discountAmount.greaterThan(eligibleSubtotal)) {\n                    discountAmount = new decimal_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](eligibleSubtotal);\n                }\n                affectedItems = eligibleItems.map((i)=>i.productId);\n                message = `$${promotion.discountValue.toFixed(2)} off each eligible item`;\n                break;\n            }\n        case \"FREE_SHIPPING\":\n            {\n                freeShipping = true;\n                message = \"Free shipping\";\n                break;\n            }\n        case \"BUY_X_GET_Y\":\n            {\n                if (!promotion.buyQuantity || !promotion.getQuantity) {\n                    return null;\n                }\n                const sortedItems = [\n                    ...eligibleItems\n                ].sort((a, b)=>b.unitPrice - a.unitPrice);\n                const totalQty = sortedItems.reduce((sum, item)=>sum + item.quantity, 0);\n                const dealSize = promotion.buyQuantity + promotion.getQuantity;\n                const numDeals = Math.floor(totalQty / dealSize);\n                if (numDeals === 0) {\n                    return null;\n                }\n                const discountPercent = promotion.getDiscountPercent || 100;\n                let discountedItems = 0;\n                let totalDiscount = new decimal_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](0);\n                const reversedItems = [\n                    ...sortedItems\n                ].reverse();\n                for (const item of reversedItems){\n                    const itemsToDiscount = Math.min(item.quantity, numDeals * promotion.getQuantity - discountedItems);\n                    if (itemsToDiscount > 0) {\n                        const itemDiscount = new decimal_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](item.unitPrice).times(itemsToDiscount).times(discountPercent).dividedBy(100);\n                        totalDiscount = totalDiscount.plus(itemDiscount);\n                        discountedItems += itemsToDiscount;\n                    }\n                    if (discountedItems >= numDeals * promotion.getQuantity) {\n                        break;\n                    }\n                }\n                discountAmount = totalDiscount;\n                affectedItems = eligibleItems.map((i)=>i.productId);\n                const getDesc = discountPercent === 100 ? \"free\" : `${discountPercent}% off`;\n                message = `Buy ${promotion.buyQuantity} get ${promotion.getQuantity} ${getDesc}`;\n                break;\n            }\n    }\n    const finalDiscount = discountAmount.toDecimalPlaces(2).toNumber();\n    if (finalDiscount === 0 && !freeShipping) {\n        return null;\n    }\n    return {\n        promotionId: promotion.id,\n        promotionName: promotion.name,\n        code: promotion.code,\n        discountType: promotion.discountType,\n        discountAmount: finalDiscount,\n        originalAmount,\n        cappedAmount: originalAmount && originalAmount > finalDiscount ? finalDiscount : undefined,\n        affectedItems: affectedItems.length > 0 ? affectedItems : undefined,\n        freeShipping,\n        message\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEtBQUtjLFNBQVMsRUFDNUNHLEtBQUssQ0FBQ3FCLGlCQUNOckIsS0FBSyxDQUFDZ0IsaUJBQ05mLFNBQVMsQ0FBQzt3QkFFYmlCLGdCQUFnQkEsY0FBY00sSUFBSSxDQUFDRDt3QkFDbkNOLG1CQUFtQkk7b0JBQ3JCO29CQUVBLElBQUlKLG1CQUFtQkgsV0FBV25FLFVBQVVsQixXQUFXLEVBQUU7d0JBQ3ZEO29CQUNGO2dCQUNGO2dCQUVBNEQsaUJBQWlCNkI7Z0JBQ2pCMUIsZ0JBQWdCSixjQUFjaUIsR0FBRyxDQUFDQyxDQUFBQSxJQUFLQSxFQUFFdEIsU0FBUztnQkFFbEQsTUFBTXlDLFVBQVVULG9CQUFvQixNQUFNLFNBQVMsQ0FBQyxFQUFFQSxnQkFBZ0IsS0FBSyxDQUFDO2dCQUM1RXZCLFVBQVUsQ0FBQyxJQUFJLEVBQUU5QyxVQUFVbkIsV0FBVyxDQUFDLEtBQUssRUFBRW1CLFVBQVVsQixXQUFXLENBQUMsQ0FBQyxFQUFFZ0csUUFBUSxDQUFDO2dCQUNoRjtZQUNGO0lBQ0Y7SUFFQSxNQUFNQyxnQkFBZ0JyQyxlQUFlYSxlQUFlLENBQUMsR0FBR0MsUUFBUTtJQUVoRSxJQUFJdUIsa0JBQWtCLEtBQUssQ0FBQ25DLGNBQWM7UUFDeEMsT0FBTztJQUNUO0lBRUEsT0FBTztRQUNMOUMsYUFBYUUsVUFBVXpDLEVBQUU7UUFDekJ5SCxlQUFlaEYsVUFBVXhDLElBQUk7UUFDN0JFLE1BQU1zQyxVQUFVdEMsSUFBSTtRQUNwQkUsY0FBY29DLFVBQVVwQyxZQUFZO1FBQ3BDOEUsZ0JBQWdCcUM7UUFDaEJwQztRQUNBc0MsY0FBY3RDLGtCQUFrQkEsaUJBQWlCb0MsZ0JBQWdCQSxnQkFBZ0JHO1FBQ2pGckMsZUFBZUEsY0FBYzFCLE1BQU0sR0FBRyxJQUFJMEIsZ0JBQWdCcUM7UUFDMUR0QztRQUNBRTtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zYWFzLWNvcmUvLi9zcmMvbGliL3Byb21vdGlvbnMtc3RvcmFnZS50cz85ZjQ0Il0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU1ZNIFByb21vdGlvbnMgU3RvcmFnZVxuICogXG4gKiBTaGFyZWQgaW4tbWVtb3J5IHN0b3JhZ2UgZm9yIHByb21vdGlvbnMuXG4gKiBVc2luZyBnbG9iYWxUaGlzIHRvIGVuc3VyZSBzaW5nbGUgaW5zdGFuY2UgYWNyb3NzIGFsbCBOZXh0LmpzIEFQSSByb3V0ZXMuXG4gKiBcbiAqIEluIHByb2R1Y3Rpb24sIHRoaXMgd291bGQgYmUgcmVwbGFjZWQgd2l0aCBkYXRhYmFzZSBxdWVyaWVzLlxuICovXG5cbmltcG9ydCBEZWNpbWFsIGZyb20gJ2RlY2ltYWwuanMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRZUEVTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCB0eXBlIFByb21vdGlvblR5cGUgPSAnQ09VUE9OJyB8ICdBVVRPTUFUSUMnIHwgJ0ZMQVNIX1NBTEUnXG5leHBvcnQgdHlwZSBEaXNjb3VudFR5cGUgPSAnUEVSQ0VOVEFHRScgfCAnRklYRURfQU1PVU5UJyB8ICdGSVhFRF9QRVJfSVRFTScgfCAnRlJFRV9TSElQUElORycgfCAnQlVZX1hfR0VUX1knXG5cbmV4cG9ydCBpbnRlcmZhY2UgUHJvbW90aW9uIHtcbiAgaWQ6IHN0cmluZ1xuICB0ZW5hbnRJZDogc3RyaW5nXG4gIG5hbWU6IHN0cmluZ1xuICBkZXNjcmlwdGlvbj86IHN0cmluZ1xuICBjb2RlPzogc3RyaW5nXG4gIHR5cGU6IFByb21vdGlvblR5cGVcbiAgZGlzY291bnRUeXBlOiBEaXNjb3VudFR5cGVcbiAgZGlzY291bnRWYWx1ZTogbnVtYmVyXG4gIG1heERpc2NvdW50PzogbnVtYmVyXG4gIG1pbk9yZGVyVG90YWw/OiBudW1iZXJcbiAgbWluUXVhbnRpdHk/OiBudW1iZXJcbiAgcHJvZHVjdElkczogc3RyaW5nW11cbiAgY2F0ZWdvcnlJZHM6IHN0cmluZ1tdXG4gIGV4Y2x1ZGVQcm9kdWN0SWRzOiBzdHJpbmdbXVxuICBjdXN0b21lcklkczogc3RyaW5nW11cbiAgZmlyc3RPcmRlck9ubHk6IGJvb2xlYW5cbiAgdXNhZ2VMaW1pdD86IG51bWJlclxuICB1c2FnZUNvdW50OiBudW1iZXJcbiAgcGVyQ3VzdG9tZXJMaW1pdD86IG51bWJlclxuICBzdGFydHNBdDogRGF0ZVxuICBlbmRzQXQ/OiBEYXRlXG4gIGlzQWN0aXZlOiBib29sZWFuXG4gIHN0YWNrYWJsZTogYm9vbGVhblxuICBwcmlvcml0eTogbnVtYmVyXG4gIGJ1eVF1YW50aXR5PzogbnVtYmVyXG4gIGdldFF1YW50aXR5PzogbnVtYmVyXG4gIGdldERpc2NvdW50UGVyY2VudD86IG51bWJlclxuICBjcmVhdGVkQXQ/OiBzdHJpbmdcbiAgdXBkYXRlZEF0Pzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUHJvbW90aW9uVXNhZ2Uge1xuICBpZDogc3RyaW5nXG4gIHByb21vdGlvbklkOiBzdHJpbmdcbiAgb3JkZXJJZDogc3RyaW5nXG4gIGN1c3RvbWVySWQ/OiBzdHJpbmdcbiAgZGlzY291bnRBcHBsaWVkOiBudW1iZXJcbiAgY3JlYXRlZEF0OiBEYXRlXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUHJvbW90aW9uQ2FydEl0ZW0ge1xuICBwcm9kdWN0SWQ6IHN0cmluZ1xuICB2YXJpYW50SWQ/OiBzdHJpbmdcbiAgY2F0ZWdvcnlJZD86IHN0cmluZ1xuICBwcm9kdWN0TmFtZTogc3RyaW5nXG4gIHVuaXRQcmljZTogbnVtYmVyXG4gIHF1YW50aXR5OiBudW1iZXJcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHBsaWVkUHJvbW90aW9uIHtcbiAgcHJvbW90aW9uSWQ6IHN0cmluZ1xuICBwcm9tb3Rpb25OYW1lOiBzdHJpbmdcbiAgY29kZT86IHN0cmluZ1xuICBkaXNjb3VudFR5cGU6IERpc2NvdW50VHlwZVxuICBkaXNjb3VudEFtb3VudDogbnVtYmVyXG4gIG9yaWdpbmFsQW1vdW50PzogbnVtYmVyXG4gIGNhcHBlZEFtb3VudD86IG51bWJlclxuICBhZmZlY3RlZEl0ZW1zPzogc3RyaW5nW11cbiAgZnJlZVNoaXBwaW5nPzogYm9vbGVhblxuICBtZXNzYWdlOiBzdHJpbmdcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gU0hBUkVEIFNUT1JBR0UgKFNpbmdsZXRvbiB1c2luZyBnbG9iYWxUaGlzKVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBQUk9NT1RJT05TX1NUT1JBR0VfS0VZID0gJ19fc3ZtX3Byb21vdGlvbnNfc3RvcmFnZV9fJ1xuY29uc3QgVVNBR0VfU1RPUkFHRV9LRVkgPSAnX19zdm1fcHJvbW90aW9uX3VzYWdlX3N0b3JhZ2VfXydcblxuZnVuY3Rpb24gZ2V0UHJvbW90aW9uc1N0b3JhZ2UoKTogTWFwPHN0cmluZywgUHJvbW90aW9uW10+IHtcbiAgaWYgKCEoZ2xvYmFsVGhpcyBhcyBhbnkpW1BST01PVElPTlNfU1RPUkFHRV9LRVldKSB7XG4gICAgKGdsb2JhbFRoaXMgYXMgYW55KVtQUk9NT1RJT05TX1NUT1JBR0VfS0VZXSA9IG5ldyBNYXA8c3RyaW5nLCBQcm9tb3Rpb25bXT4oKVxuICB9XG4gIHJldHVybiAoZ2xvYmFsVGhpcyBhcyBhbnkpW1BST01PVElPTlNfU1RPUkFHRV9LRVldXG59XG5cbmZ1bmN0aW9uIGdldFVzYWdlU3RvcmFnZSgpOiBNYXA8c3RyaW5nLCBQcm9tb3Rpb25Vc2FnZVtdPiB7XG4gIGlmICghKGdsb2JhbFRoaXMgYXMgYW55KVtVU0FHRV9TVE9SQUdFX0tFWV0pIHtcbiAgICAoZ2xvYmFsVGhpcyBhcyBhbnkpW1VTQUdFX1NUT1JBR0VfS0VZXSA9IG5ldyBNYXA8c3RyaW5nLCBQcm9tb3Rpb25Vc2FnZVtdPigpXG4gIH1cbiAgcmV0dXJuIChnbG9iYWxUaGlzIGFzIGFueSlbVVNBR0VfU1RPUkFHRV9LRVldXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZUlkKHByZWZpeDogc3RyaW5nID0gJ3Byb21vJyk6IHN0cmluZyB7XG4gIHJldHVybiBgJHtwcmVmaXh9XyR7RGF0ZS5ub3coKS50b1N0cmluZygzNil9JHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgOSl9YFxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBQUk9NT1RJT04gQ1JVRFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEdldCBvciBjcmVhdGUgc2FtcGxlIHByb21vdGlvbnMgZm9yIGEgdGVuYW50XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRPckNyZWF0ZVByb21vdGlvbnModGVuYW50SWQ6IHN0cmluZyk6IFByb21vdGlvbltdIHtcbiAgY29uc3Qgc3RvcmFnZSA9IGdldFByb21vdGlvbnNTdG9yYWdlKClcbiAgXG4gIGlmIChzdG9yYWdlLmhhcyh0ZW5hbnRJZCkpIHtcbiAgICByZXR1cm4gc3RvcmFnZS5nZXQodGVuYW50SWQpIVxuICB9XG4gIFxuICAvLyBDcmVhdGUgc2FtcGxlIHByb21vdGlvbnNcbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKVxuICBjb25zdCBzYW1wbGVQcm9tb3Rpb25zOiBQcm9tb3Rpb25bXSA9IFtcbiAgICB7XG4gICAgICBpZDogZ2VuZXJhdGVJZCgncHJvbW8nKSxcbiAgICAgIHRlbmFudElkLFxuICAgICAgbmFtZTogJ1dlbGNvbWUgRGlzY291bnQnLFxuICAgICAgZGVzY3JpcHRpb246ICcxMCUgb2ZmIHlvdXIgZmlyc3Qgb3JkZXInLFxuICAgICAgY29kZTogJ1dFTENPTUUxMCcsXG4gICAgICB0eXBlOiAnQ09VUE9OJyxcbiAgICAgIGRpc2NvdW50VHlwZTogJ1BFUkNFTlRBR0UnLFxuICAgICAgZGlzY291bnRWYWx1ZTogMTAsXG4gICAgICBwcm9kdWN0SWRzOiBbXSxcbiAgICAgIGNhdGVnb3J5SWRzOiBbXSxcbiAgICAgIGV4Y2x1ZGVQcm9kdWN0SWRzOiBbXSxcbiAgICAgIGN1c3RvbWVySWRzOiBbXSxcbiAgICAgIGZpcnN0T3JkZXJPbmx5OiB0cnVlLFxuICAgICAgdXNhZ2VDb3VudDogMCxcbiAgICAgIHN0YXJ0c0F0OiBub3csXG4gICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgIHN0YWNrYWJsZTogZmFsc2UsXG4gICAgICBwcmlvcml0eTogMCxcbiAgICAgIGNyZWF0ZWRBdDogbm93LnRvSVNPU3RyaW5nKCksXG4gICAgICB1cGRhdGVkQXQ6IG5vdy50b0lTT1N0cmluZygpXG4gICAgfSxcbiAgICB7XG4gICAgICBpZDogZ2VuZXJhdGVJZCgncHJvbW8nKSxcbiAgICAgIHRlbmFudElkLFxuICAgICAgbmFtZTogJ1N1bW1lciBTYWxlJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnMTUlIG9mZiBvcmRlcnMgb3ZlciAkMTAwIChtYXggJDUwIGRpc2NvdW50KScsXG4gICAgICB0eXBlOiAnQVVUT01BVElDJyxcbiAgICAgIGRpc2NvdW50VHlwZTogJ1BFUkNFTlRBR0UnLFxuICAgICAgZGlzY291bnRWYWx1ZTogMTUsXG4gICAgICBtYXhEaXNjb3VudDogNTAsXG4gICAgICBtaW5PcmRlclRvdGFsOiAxMDAsXG4gICAgICBwcm9kdWN0SWRzOiBbXSxcbiAgICAgIGNhdGVnb3J5SWRzOiBbXSxcbiAgICAgIGV4Y2x1ZGVQcm9kdWN0SWRzOiBbXSxcbiAgICAgIGN1c3RvbWVySWRzOiBbXSxcbiAgICAgIGZpcnN0T3JkZXJPbmx5OiBmYWxzZSxcbiAgICAgIHVzYWdlQ291bnQ6IDAsXG4gICAgICBzdGFydHNBdDogbm93LFxuICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICBzdGFja2FibGU6IHRydWUsXG4gICAgICBwcmlvcml0eTogMTAsXG4gICAgICBjcmVhdGVkQXQ6IG5vdy50b0lTT1N0cmluZygpLFxuICAgICAgdXBkYXRlZEF0OiBub3cudG9JU09TdHJpbmcoKVxuICAgIH0sXG4gICAge1xuICAgICAgaWQ6IGdlbmVyYXRlSWQoJ3Byb21vJyksXG4gICAgICB0ZW5hbnRJZCxcbiAgICAgIG5hbWU6ICdGcmVlIFNoaXBwaW5nJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnRnJlZSBzaGlwcGluZyBvbiBvcmRlcnMgb3ZlciAkNTAnLFxuICAgICAgY29kZTogJ0ZSRUVTSElQJyxcbiAgICAgIHR5cGU6ICdDT1VQT04nLFxuICAgICAgZGlzY291bnRUeXBlOiAnRlJFRV9TSElQUElORycsXG4gICAgICBkaXNjb3VudFZhbHVlOiAwLFxuICAgICAgbWluT3JkZXJUb3RhbDogNTAsXG4gICAgICBwcm9kdWN0SWRzOiBbXSxcbiAgICAgIGNhdGVnb3J5SWRzOiBbXSxcbiAgICAgIGV4Y2x1ZGVQcm9kdWN0SWRzOiBbXSxcbiAgICAgIGN1c3RvbWVySWRzOiBbXSxcbiAgICAgIGZpcnN0T3JkZXJPbmx5OiBmYWxzZSxcbiAgICAgIHVzYWdlQ291bnQ6IDAsXG4gICAgICBzdGFydHNBdDogbm93LFxuICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICBzdGFja2FibGU6IHRydWUsXG4gICAgICBwcmlvcml0eTogNSxcbiAgICAgIGNyZWF0ZWRBdDogbm93LnRvSVNPU3RyaW5nKCksXG4gICAgICB1cGRhdGVkQXQ6IG5vdy50b0lTT1N0cmluZygpXG4gICAgfSxcbiAgICB7XG4gICAgICBpZDogZ2VuZXJhdGVJZCgncHJvbW8nKSxcbiAgICAgIHRlbmFudElkLFxuICAgICAgbmFtZTogJ0J1eSAyIEdldCAxIEZyZWUnLFxuICAgICAgZGVzY3JpcHRpb246ICdCdXkgYW55IDIgaXRlbXMsIGdldCAxIGZyZWUnLFxuICAgICAgY29kZTogJ0JPR08nLFxuICAgICAgdHlwZTogJ0NPVVBPTicsXG4gICAgICBkaXNjb3VudFR5cGU6ICdCVVlfWF9HRVRfWScsXG4gICAgICBkaXNjb3VudFZhbHVlOiAxMDAsXG4gICAgICBidXlRdWFudGl0eTogMixcbiAgICAgIGdldFF1YW50aXR5OiAxLFxuICAgICAgZ2V0RGlzY291bnRQZXJjZW50OiAxMDAsXG4gICAgICBwcm9kdWN0SWRzOiBbXSxcbiAgICAgIGNhdGVnb3J5SWRzOiBbXSxcbiAgICAgIGV4Y2x1ZGVQcm9kdWN0SWRzOiBbXSxcbiAgICAgIGN1c3RvbWVySWRzOiBbXSxcbiAgICAgIGZpcnN0T3JkZXJPbmx5OiBmYWxzZSxcbiAgICAgIHVzYWdlQ291bnQ6IDAsXG4gICAgICBzdGFydHNBdDogbm93LFxuICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICBzdGFja2FibGU6IGZhbHNlLFxuICAgICAgcHJpb3JpdHk6IDAsXG4gICAgICBjcmVhdGVkQXQ6IG5vdy50b0lTT1N0cmluZygpLFxuICAgICAgdXBkYXRlZEF0OiBub3cudG9JU09TdHJpbmcoKVxuICAgIH0sXG4gICAge1xuICAgICAgaWQ6IGdlbmVyYXRlSWQoJ3Byb21vJyksXG4gICAgICB0ZW5hbnRJZCxcbiAgICAgIG5hbWU6ICckMjAgT2ZmJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnJDIwIG9mZiBvcmRlcnMgb3ZlciAkNzUgKGxpbWl0IDEwMCB1c2VzKScsXG4gICAgICBjb2RlOiAnU0FWRTIwJyxcbiAgICAgIHR5cGU6ICdDT1VQT04nLFxuICAgICAgZGlzY291bnRUeXBlOiAnRklYRURfQU1PVU5UJyxcbiAgICAgIGRpc2NvdW50VmFsdWU6IDIwLFxuICAgICAgbWluT3JkZXJUb3RhbDogNzUsXG4gICAgICB1c2FnZUxpbWl0OiAxMDAsXG4gICAgICBwZXJDdXN0b21lckxpbWl0OiAxLFxuICAgICAgcHJvZHVjdElkczogW10sXG4gICAgICBjYXRlZ29yeUlkczogW10sXG4gICAgICBleGNsdWRlUHJvZHVjdElkczogW10sXG4gICAgICBjdXN0b21lcklkczogW10sXG4gICAgICBmaXJzdE9yZGVyT25seTogZmFsc2UsXG4gICAgICB1c2FnZUNvdW50OiAwLFxuICAgICAgc3RhcnRzQXQ6IG5vdyxcbiAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgc3RhY2thYmxlOiBmYWxzZSxcbiAgICAgIHByaW9yaXR5OiAwLFxuICAgICAgY3JlYXRlZEF0OiBub3cudG9JU09TdHJpbmcoKSxcbiAgICAgIHVwZGF0ZWRBdDogbm93LnRvSVNPU3RyaW5nKClcbiAgICB9XG4gIF1cbiAgXG4gIHN0b3JhZ2Uuc2V0KHRlbmFudElkLCBzYW1wbGVQcm9tb3Rpb25zKVxuICByZXR1cm4gc2FtcGxlUHJvbW90aW9uc1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0UHJvbW90aW9ucyh0ZW5hbnRJZDogc3RyaW5nKTogUHJvbW90aW9uW10ge1xuICByZXR1cm4gZ2V0T3JDcmVhdGVQcm9tb3Rpb25zKHRlbmFudElkKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QWN0aXZlUHJvbW90aW9ucyh0ZW5hbnRJZDogc3RyaW5nKTogUHJvbW90aW9uW10ge1xuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpXG4gIHJldHVybiBnZXRQcm9tb3Rpb25zKHRlbmFudElkKS5maWx0ZXIocCA9PiBcbiAgICBwLmlzQWN0aXZlICYmIFxuICAgIHAuc3RhcnRzQXQgPD0gbm93ICYmIFxuICAgICghcC5lbmRzQXQgfHwgcC5lbmRzQXQgPiBub3cpICYmXG4gICAgKCFwLnVzYWdlTGltaXQgfHwgcC51c2FnZUNvdW50IDwgcC51c2FnZUxpbWl0KVxuICApXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBdXRvbWF0aWNQcm9tb3Rpb25zKHRlbmFudElkOiBzdHJpbmcpOiBQcm9tb3Rpb25bXSB7XG4gIHJldHVybiBnZXRBY3RpdmVQcm9tb3Rpb25zKHRlbmFudElkKS5maWx0ZXIocCA9PiBcbiAgICBwLnR5cGUgPT09ICdBVVRPTUFUSUMnIHx8IHAudHlwZSA9PT0gJ0ZMQVNIX1NBTEUnXG4gIClcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZpbmRCeUNvZGUodGVuYW50SWQ6IHN0cmluZywgY29kZTogc3RyaW5nKTogUHJvbW90aW9uIHwgbnVsbCB7XG4gIGNvbnN0IHByb21vdGlvbnMgPSBnZXRBY3RpdmVQcm9tb3Rpb25zKHRlbmFudElkKVxuICByZXR1cm4gcHJvbW90aW9ucy5maW5kKHAgPT4gcC5jb2RlPy50b1VwcGVyQ2FzZSgpID09PSBjb2RlLnRvVXBwZXJDYXNlKCkpIHx8IG51bGxcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFByb21vdGlvbih0ZW5hbnRJZDogc3RyaW5nLCBwcm9tb3Rpb25JZDogc3RyaW5nKTogUHJvbW90aW9uIHwgbnVsbCB7XG4gIGNvbnN0IHByb21vdGlvbnMgPSBnZXRQcm9tb3Rpb25zKHRlbmFudElkKVxuICByZXR1cm4gcHJvbW90aW9ucy5maW5kKHAgPT4gcC5pZCA9PT0gcHJvbW90aW9uSWQpIHx8IG51bGxcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFkZFByb21vdGlvbihwcm9tb3Rpb246IFByb21vdGlvbik6IHZvaWQge1xuICBjb25zdCBzdG9yYWdlID0gZ2V0UHJvbW90aW9uc1N0b3JhZ2UoKVxuICBjb25zdCBwcm9tb3Rpb25zID0gZ2V0T3JDcmVhdGVQcm9tb3Rpb25zKHByb21vdGlvbi50ZW5hbnRJZClcbiAgcHJvbW90aW9ucy5wdXNoKHByb21vdGlvbilcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVByb21vdGlvbih0ZW5hbnRJZDogc3RyaW5nLCBwcm9tb3Rpb25JZDogc3RyaW5nLCB1cGRhdGVzOiBQYXJ0aWFsPFByb21vdGlvbj4pOiBQcm9tb3Rpb24gfCBudWxsIHtcbiAgY29uc3QgcHJvbW90aW9ucyA9IGdldFByb21vdGlvbnModGVuYW50SWQpXG4gIGNvbnN0IGluZGV4ID0gcHJvbW90aW9ucy5maW5kSW5kZXgocCA9PiBwLmlkID09PSBwcm9tb3Rpb25JZClcbiAgaWYgKGluZGV4IDwgMCkgcmV0dXJuIG51bGxcbiAgXG4gIHByb21vdGlvbnNbaW5kZXhdID0geyAuLi5wcm9tb3Rpb25zW2luZGV4XSwgLi4udXBkYXRlcywgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkgfVxuICByZXR1cm4gcHJvbW90aW9uc1tpbmRleF1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlbGV0ZVByb21vdGlvbih0ZW5hbnRJZDogc3RyaW5nLCBwcm9tb3Rpb25JZDogc3RyaW5nKTogUHJvbW90aW9uIHwgbnVsbCB7XG4gIGNvbnN0IHN0b3JhZ2UgPSBnZXRQcm9tb3Rpb25zU3RvcmFnZSgpXG4gIGNvbnN0IHByb21vdGlvbnMgPSBzdG9yYWdlLmdldCh0ZW5hbnRJZCkgfHwgW11cbiAgY29uc3QgaW5kZXggPSBwcm9tb3Rpb25zLmZpbmRJbmRleChwID0+IHAuaWQgPT09IHByb21vdGlvbklkKVxuICBpZiAoaW5kZXggPCAwKSByZXR1cm4gbnVsbFxuICBcbiAgY29uc3QgW2RlbGV0ZWRdID0gcHJvbW90aW9ucy5zcGxpY2UoaW5kZXgsIDEpXG4gIHJldHVybiBkZWxldGVkXG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFVTQUdFIFRSQUNLSU5HXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiByZWNvcmRVc2FnZShcbiAgcHJvbW90aW9uSWQ6IHN0cmluZyxcbiAgb3JkZXJJZDogc3RyaW5nLFxuICBjdXN0b21lcklkOiBzdHJpbmcgfCB1bmRlZmluZWQsXG4gIGRpc2NvdW50QXBwbGllZDogbnVtYmVyXG4pOiBQcm9tb3Rpb25Vc2FnZSB7XG4gIGNvbnN0IHVzYWdlU3RvcmFnZSA9IGdldFVzYWdlU3RvcmFnZSgpXG4gIGNvbnN0IHByb21vdGlvbnNTdG9yYWdlID0gZ2V0UHJvbW90aW9uc1N0b3JhZ2UoKVxuICBcbiAgY29uc3QgdXNhZ2U6IFByb21vdGlvblVzYWdlID0ge1xuICAgIGlkOiBnZW5lcmF0ZUlkKCd1c2FnZScpLFxuICAgIHByb21vdGlvbklkLFxuICAgIG9yZGVySWQsXG4gICAgY3VzdG9tZXJJZCxcbiAgICBkaXNjb3VudEFwcGxpZWQsXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpXG4gIH1cbiAgXG4gIC8vIFN0b3JlIHVzYWdlXG4gIGNvbnN0IHVzYWdlcyA9IHVzYWdlU3RvcmFnZS5nZXQocHJvbW90aW9uSWQpIHx8IFtdXG4gIHVzYWdlcy5wdXNoKHVzYWdlKVxuICB1c2FnZVN0b3JhZ2Uuc2V0KHByb21vdGlvbklkLCB1c2FnZXMpXG4gIFxuICAvLyBJbmNyZW1lbnQgdXNhZ2UgY291bnQgb24gcHJvbW90aW9uXG4gIGZvciAoY29uc3QgW3RlbmFudElkLCBwcm9tb3Rpb25zXSBvZiBwcm9tb3Rpb25zU3RvcmFnZSkge1xuICAgIGNvbnN0IHByb21vdGlvbiA9IHByb21vdGlvbnMuZmluZChwID0+IHAuaWQgPT09IHByb21vdGlvbklkKVxuICAgIGlmIChwcm9tb3Rpb24pIHtcbiAgICAgIHByb21vdGlvbi51c2FnZUNvdW50KytcbiAgICAgIGJyZWFrXG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4gdXNhZ2Vcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEN1c3RvbWVyVXNhZ2VDb3VudChwcm9tb3Rpb25JZDogc3RyaW5nLCBjdXN0b21lcklkPzogc3RyaW5nKTogbnVtYmVyIHtcbiAgaWYgKCFjdXN0b21lcklkKSByZXR1cm4gMFxuICBcbiAgY29uc3QgdXNhZ2VTdG9yYWdlID0gZ2V0VXNhZ2VTdG9yYWdlKClcbiAgY29uc3QgdXNhZ2VzID0gdXNhZ2VTdG9yYWdlLmdldChwcm9tb3Rpb25JZCkgfHwgW11cbiAgcmV0dXJuIHVzYWdlcy5maWx0ZXIodSA9PiB1LmN1c3RvbWVySWQgPT09IGN1c3RvbWVySWQpLmxlbmd0aFxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBWQUxJREFUSU9OICYgQ0FMQ1VMQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBWYWxpZGF0aW9uUmVzdWx0IHtcbiAgdmFsaWQ6IGJvb2xlYW5cbiAgZXJyb3I/OiBzdHJpbmdcbiAgZXJyb3JDb2RlPzogc3RyaW5nXG59XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVByb21vdGlvbihcbiAgcHJvbW90aW9uOiBQcm9tb3Rpb24sXG4gIHN1YnRvdGFsOiBudW1iZXIsXG4gIHRvdGFsUXVhbnRpdHk6IG51bWJlcixcbiAgY3VzdG9tZXJJZD86IHN0cmluZyxcbiAgaXNGaXJzdE9yZGVyPzogYm9vbGVhbixcbiAgY3VycmVudERpc2NvdW50czogQXBwbGllZFByb21vdGlvbltdID0gW11cbik6IFZhbGlkYXRpb25SZXN1bHQge1xuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpXG4gIFxuICBpZiAoIXByb21vdGlvbi5pc0FjdGl2ZSkge1xuICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICdUaGlzIHByb21vdGlvbiBpcyBubyBsb25nZXIgYWN0aXZlJywgZXJyb3JDb2RlOiAnSU5BQ1RJVkUnIH1cbiAgfVxuICBcbiAgaWYgKHByb21vdGlvbi5zdGFydHNBdCA+IG5vdykge1xuICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICdUaGlzIHByb21vdGlvbiBoYXMgbm90IHN0YXJ0ZWQgeWV0JywgZXJyb3JDb2RlOiAnTk9UX1NUQVJURUQnIH1cbiAgfVxuICBcbiAgaWYgKHByb21vdGlvbi5lbmRzQXQgJiYgcHJvbW90aW9uLmVuZHNBdCA8IG5vdykge1xuICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICdUaGlzIHByb21vdGlvbiBoYXMgZXhwaXJlZCcsIGVycm9yQ29kZTogJ0VYUElSRUQnIH1cbiAgfVxuICBcbiAgaWYgKHByb21vdGlvbi51c2FnZUxpbWl0ICYmIHByb21vdGlvbi51c2FnZUNvdW50ID49IHByb21vdGlvbi51c2FnZUxpbWl0KSB7XG4gICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBlcnJvcjogJ1RoaXMgcHJvbW90aW9uIGhhcyByZWFjaGVkIGl0cyB1c2FnZSBsaW1pdCcsIGVycm9yQ29kZTogJ1VTQUdFX0xJTUlUX1JFQUNIRUQnIH1cbiAgfVxuICBcbiAgY29uc3QgY3VzdG9tZXJVc2FnZUNvdW50ID0gZ2V0Q3VzdG9tZXJVc2FnZUNvdW50KHByb21vdGlvbi5pZCwgY3VzdG9tZXJJZClcbiAgaWYgKHByb21vdGlvbi5wZXJDdXN0b21lckxpbWl0ICYmIGN1c3RvbWVyVXNhZ2VDb3VudCA+PSBwcm9tb3Rpb24ucGVyQ3VzdG9tZXJMaW1pdCkge1xuICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICdZb3UgaGF2ZSBhbHJlYWR5IHVzZWQgdGhpcyBwcm9tb3Rpb24gdGhlIG1heGltdW0gbnVtYmVyIG9mIHRpbWVzJywgZXJyb3JDb2RlOiAnQ1VTVE9NRVJfTElNSVRfUkVBQ0hFRCcgfVxuICB9XG4gIFxuICBpZiAocHJvbW90aW9uLmN1c3RvbWVySWRzLmxlbmd0aCA+IDAgJiYgY3VzdG9tZXJJZCkge1xuICAgIGlmICghcHJvbW90aW9uLmN1c3RvbWVySWRzLmluY2x1ZGVzKGN1c3RvbWVySWQpKSB7XG4gICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnVGhpcyBwcm9tb3Rpb24gaXMgbm90IGF2YWlsYWJsZSBmb3IgeW91ciBhY2NvdW50JywgZXJyb3JDb2RlOiAnQ1VTVE9NRVJfTk9UX0VMSUdJQkxFJyB9XG4gICAgfVxuICB9XG4gIFxuICBpZiAocHJvbW90aW9uLmZpcnN0T3JkZXJPbmx5ICYmICFpc0ZpcnN0T3JkZXIpIHtcbiAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnVGhpcyBwcm9tb3Rpb24gaXMgb25seSB2YWxpZCBmb3IgZmlyc3QtdGltZSBvcmRlcnMnLCBlcnJvckNvZGU6ICdGSVJTVF9PUkRFUl9PTkxZJyB9XG4gIH1cbiAgXG4gIGlmIChwcm9tb3Rpb24ubWluT3JkZXJUb3RhbCAmJiBzdWJ0b3RhbCA8IHByb21vdGlvbi5taW5PcmRlclRvdGFsKSB7XG4gICAgcmV0dXJuIHsgXG4gICAgICB2YWxpZDogZmFsc2UsIFxuICAgICAgZXJyb3I6IGBNaW5pbXVtIG9yZGVyIHRvdGFsIG9mICQke3Byb21vdGlvbi5taW5PcmRlclRvdGFsLnRvRml4ZWQoMil9IHJlcXVpcmVkYCxcbiAgICAgIGVycm9yQ29kZTogJ01JTl9PUkRFUl9OT1RfTUVUJ1xuICAgIH1cbiAgfVxuICBcbiAgaWYgKHByb21vdGlvbi5taW5RdWFudGl0eSAmJiB0b3RhbFF1YW50aXR5IDwgcHJvbW90aW9uLm1pblF1YW50aXR5KSB7XG4gICAgcmV0dXJuIHsgXG4gICAgICB2YWxpZDogZmFsc2UsIFxuICAgICAgZXJyb3I6IGBNaW5pbXVtIG9mICR7cHJvbW90aW9uLm1pblF1YW50aXR5fSBpdGVtcyByZXF1aXJlZGAsXG4gICAgICBlcnJvckNvZGU6ICdNSU5fUVVBTlRJVFlfTk9UX01FVCdcbiAgICB9XG4gIH1cbiAgXG4gIGlmICghcHJvbW90aW9uLnN0YWNrYWJsZSAmJiBjdXJyZW50RGlzY291bnRzLmxlbmd0aCA+IDApIHtcbiAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnVGhpcyBwcm9tb3Rpb24gY2Fubm90IGJlIGNvbWJpbmVkIHdpdGggb3RoZXIgZGlzY291bnRzJywgZXJyb3JDb2RlOiAnTk9UX1NUQUNLQUJMRScgfVxuICB9XG4gIFxuICBpZiAoY3VycmVudERpc2NvdW50cy5zb21lKGQgPT4gZC5wcm9tb3Rpb25JZCA9PT0gcHJvbW90aW9uLmlkKSkge1xuICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICdUaGlzIHByb21vdGlvbiBpcyBhbHJlYWR5IGFwcGxpZWQnLCBlcnJvckNvZGU6ICdBTFJFQURZX0FQUExJRUQnIH1cbiAgfVxuICBcbiAgcmV0dXJuIHsgdmFsaWQ6IHRydWUgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RWxpZ2libGVJdGVtcyhwcm9tb3Rpb246IFByb21vdGlvbiwgaXRlbXM6IFByb21vdGlvbkNhcnRJdGVtW10pOiBQcm9tb3Rpb25DYXJ0SXRlbVtdIHtcbiAgcmV0dXJuIGl0ZW1zLmZpbHRlcihpdGVtID0+IHtcbiAgICBpZiAocHJvbW90aW9uLmV4Y2x1ZGVQcm9kdWN0SWRzLmluY2x1ZGVzKGl0ZW0ucHJvZHVjdElkKSkge1xuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuICAgIFxuICAgIGlmIChwcm9tb3Rpb24ucHJvZHVjdElkcy5sZW5ndGggPT09IDAgJiYgcHJvbW90aW9uLmNhdGVnb3J5SWRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gICAgXG4gICAgaWYgKHByb21vdGlvbi5wcm9kdWN0SWRzLmxlbmd0aCA+IDAgJiYgcHJvbW90aW9uLnByb2R1Y3RJZHMuaW5jbHVkZXMoaXRlbS5wcm9kdWN0SWQpKSB7XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgICBcbiAgICBpZiAocHJvbW90aW9uLmNhdGVnb3J5SWRzLmxlbmd0aCA+IDAgJiYgaXRlbS5jYXRlZ29yeUlkICYmIHByb21vdGlvbi5jYXRlZ29yeUlkcy5pbmNsdWRlcyhpdGVtLmNhdGVnb3J5SWQpKSB7XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZmFsc2VcbiAgfSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZURpc2NvdW50KFxuICBwcm9tb3Rpb246IFByb21vdGlvbixcbiAgaXRlbXM6IFByb21vdGlvbkNhcnRJdGVtW10sXG4gIHN1YnRvdGFsOiBudW1iZXIsXG4gIHNoaXBwaW5nVG90YWw/OiBudW1iZXJcbik6IEFwcGxpZWRQcm9tb3Rpb24gfCBudWxsIHtcbiAgY29uc3QgZWxpZ2libGVJdGVtcyA9IGdldEVsaWdpYmxlSXRlbXMocHJvbW90aW9uLCBpdGVtcylcbiAgXG4gIGxldCBkaXNjb3VudEFtb3VudCA9IG5ldyBEZWNpbWFsKDApXG4gIGxldCBvcmlnaW5hbEFtb3VudDogbnVtYmVyIHwgdW5kZWZpbmVkXG4gIGxldCBmcmVlU2hpcHBpbmcgPSBmYWxzZVxuICBsZXQgYWZmZWN0ZWRJdGVtczogc3RyaW5nW10gPSBbXVxuICBsZXQgbWVzc2FnZSA9ICcnXG4gIFxuICBzd2l0Y2ggKHByb21vdGlvbi5kaXNjb3VudFR5cGUpIHtcbiAgICBjYXNlICdQRVJDRU5UQUdFJzoge1xuICAgICAgY29uc3QgZWxpZ2libGVTdWJ0b3RhbCA9IGVsaWdpYmxlSXRlbXMucmVkdWNlKFxuICAgICAgICAoc3VtLCBpdGVtKSA9PiBzdW0gKyAoaXRlbS51bml0UHJpY2UgKiBpdGVtLnF1YW50aXR5KSwgMFxuICAgICAgKVxuICAgICAgXG4gICAgICBjb25zdCBwZXJjZW50RGlzY291bnQgPSBuZXcgRGVjaW1hbChlbGlnaWJsZVN1YnRvdGFsKVxuICAgICAgICAudGltZXMocHJvbW90aW9uLmRpc2NvdW50VmFsdWUpXG4gICAgICAgIC5kaXZpZGVkQnkoMTAwKVxuICAgICAgXG4gICAgICBvcmlnaW5hbEFtb3VudCA9IHBlcmNlbnREaXNjb3VudC50b0RlY2ltYWxQbGFjZXMoMikudG9OdW1iZXIoKVxuICAgICAgXG4gICAgICBpZiAocHJvbW90aW9uLm1heERpc2NvdW50ICYmIHBlcmNlbnREaXNjb3VudC5ncmVhdGVyVGhhbihwcm9tb3Rpb24ubWF4RGlzY291bnQpKSB7XG4gICAgICAgIGRpc2NvdW50QW1vdW50ID0gbmV3IERlY2ltYWwocHJvbW90aW9uLm1heERpc2NvdW50KVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGlzY291bnRBbW91bnQgPSBwZXJjZW50RGlzY291bnRcbiAgICAgIH1cbiAgICAgIFxuICAgICAgYWZmZWN0ZWRJdGVtcyA9IGVsaWdpYmxlSXRlbXMubWFwKGkgPT4gaS5wcm9kdWN0SWQpXG4gICAgICBtZXNzYWdlID0gYCR7cHJvbW90aW9uLmRpc2NvdW50VmFsdWV9JSBvZmYke2FmZmVjdGVkSXRlbXMubGVuZ3RoIDwgaXRlbXMubGVuZ3RoID8gJyBlbGlnaWJsZSBpdGVtcycgOiAnJ31gXG4gICAgICBicmVha1xuICAgIH1cbiAgICBcbiAgICBjYXNlICdGSVhFRF9BTU9VTlQnOiB7XG4gICAgICBkaXNjb3VudEFtb3VudCA9IG5ldyBEZWNpbWFsKHByb21vdGlvbi5kaXNjb3VudFZhbHVlKVxuICAgICAgaWYgKGRpc2NvdW50QW1vdW50LmdyZWF0ZXJUaGFuKHN1YnRvdGFsKSkge1xuICAgICAgICBkaXNjb3VudEFtb3VudCA9IG5ldyBEZWNpbWFsKHN1YnRvdGFsKVxuICAgICAgfVxuICAgICAgbWVzc2FnZSA9IGAkJHtwcm9tb3Rpb24uZGlzY291bnRWYWx1ZS50b0ZpeGVkKDIpfSBvZmYgeW91ciBvcmRlcmBcbiAgICAgIGJyZWFrXG4gICAgfVxuICAgIFxuICAgIGNhc2UgJ0ZJWEVEX1BFUl9JVEVNJzoge1xuICAgICAgY29uc3QgdG90YWxFbGlnaWJsZVF0eSA9IGVsaWdpYmxlSXRlbXMucmVkdWNlKChzdW0sIGl0ZW0pID0+IHN1bSArIGl0ZW0ucXVhbnRpdHksIDApXG4gICAgICBkaXNjb3VudEFtb3VudCA9IG5ldyBEZWNpbWFsKHByb21vdGlvbi5kaXNjb3VudFZhbHVlKS50aW1lcyh0b3RhbEVsaWdpYmxlUXR5KVxuICAgICAgXG4gICAgICBjb25zdCBlbGlnaWJsZVN1YnRvdGFsID0gZWxpZ2libGVJdGVtcy5yZWR1Y2UoXG4gICAgICAgIChzdW0sIGl0ZW0pID0+IHN1bSArIChpdGVtLnVuaXRQcmljZSAqIGl0ZW0ucXVhbnRpdHkpLCAwXG4gICAgICApXG4gICAgICBpZiAoZGlzY291bnRBbW91bnQuZ3JlYXRlclRoYW4oZWxpZ2libGVTdWJ0b3RhbCkpIHtcbiAgICAgICAgZGlzY291bnRBbW91bnQgPSBuZXcgRGVjaW1hbChlbGlnaWJsZVN1YnRvdGFsKVxuICAgICAgfVxuICAgICAgXG4gICAgICBhZmZlY3RlZEl0ZW1zID0gZWxpZ2libGVJdGVtcy5tYXAoaSA9PiBpLnByb2R1Y3RJZClcbiAgICAgIG1lc3NhZ2UgPSBgJCR7cHJvbW90aW9uLmRpc2NvdW50VmFsdWUudG9GaXhlZCgyKX0gb2ZmIGVhY2ggZWxpZ2libGUgaXRlbWBcbiAgICAgIGJyZWFrXG4gICAgfVxuICAgIFxuICAgIGNhc2UgJ0ZSRUVfU0hJUFBJTkcnOiB7XG4gICAgICBmcmVlU2hpcHBpbmcgPSB0cnVlXG4gICAgICBtZXNzYWdlID0gJ0ZyZWUgc2hpcHBpbmcnXG4gICAgICBicmVha1xuICAgIH1cbiAgICBcbiAgICBjYXNlICdCVVlfWF9HRVRfWSc6IHtcbiAgICAgIGlmICghcHJvbW90aW9uLmJ1eVF1YW50aXR5IHx8ICFwcm9tb3Rpb24uZ2V0UXVhbnRpdHkpIHtcbiAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc3Qgc29ydGVkSXRlbXMgPSBbLi4uZWxpZ2libGVJdGVtc10uc29ydCgoYSwgYikgPT4gYi51bml0UHJpY2UgLSBhLnVuaXRQcmljZSlcbiAgICAgIGNvbnN0IHRvdGFsUXR5ID0gc29ydGVkSXRlbXMucmVkdWNlKChzdW0sIGl0ZW0pID0+IHN1bSArIGl0ZW0ucXVhbnRpdHksIDApXG4gICAgICBcbiAgICAgIGNvbnN0IGRlYWxTaXplID0gcHJvbW90aW9uLmJ1eVF1YW50aXR5ICsgcHJvbW90aW9uLmdldFF1YW50aXR5XG4gICAgICBjb25zdCBudW1EZWFscyA9IE1hdGguZmxvb3IodG90YWxRdHkgLyBkZWFsU2l6ZSlcbiAgICAgIFxuICAgICAgaWYgKG51bURlYWxzID09PSAwKSB7XG4gICAgICAgIHJldHVybiBudWxsXG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IGRpc2NvdW50UGVyY2VudCA9IHByb21vdGlvbi5nZXREaXNjb3VudFBlcmNlbnQgfHwgMTAwXG4gICAgICBsZXQgZGlzY291bnRlZEl0ZW1zID0gMFxuICAgICAgbGV0IHRvdGFsRGlzY291bnQgPSBuZXcgRGVjaW1hbCgwKVxuICAgICAgXG4gICAgICBjb25zdCByZXZlcnNlZEl0ZW1zID0gWy4uLnNvcnRlZEl0ZW1zXS5yZXZlcnNlKClcbiAgICAgIGZvciAoY29uc3QgaXRlbSBvZiByZXZlcnNlZEl0ZW1zKSB7XG4gICAgICAgIGNvbnN0IGl0ZW1zVG9EaXNjb3VudCA9IE1hdGgubWluKFxuICAgICAgICAgIGl0ZW0ucXVhbnRpdHksXG4gICAgICAgICAgKG51bURlYWxzICogcHJvbW90aW9uLmdldFF1YW50aXR5KSAtIGRpc2NvdW50ZWRJdGVtc1xuICAgICAgICApXG4gICAgICAgIFxuICAgICAgICBpZiAoaXRlbXNUb0Rpc2NvdW50ID4gMCkge1xuICAgICAgICAgIGNvbnN0IGl0ZW1EaXNjb3VudCA9IG5ldyBEZWNpbWFsKGl0ZW0udW5pdFByaWNlKVxuICAgICAgICAgICAgLnRpbWVzKGl0ZW1zVG9EaXNjb3VudClcbiAgICAgICAgICAgIC50aW1lcyhkaXNjb3VudFBlcmNlbnQpXG4gICAgICAgICAgICAuZGl2aWRlZEJ5KDEwMClcbiAgICAgICAgICBcbiAgICAgICAgICB0b3RhbERpc2NvdW50ID0gdG90YWxEaXNjb3VudC5wbHVzKGl0ZW1EaXNjb3VudClcbiAgICAgICAgICBkaXNjb3VudGVkSXRlbXMgKz0gaXRlbXNUb0Rpc2NvdW50XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmIChkaXNjb3VudGVkSXRlbXMgPj0gbnVtRGVhbHMgKiBwcm9tb3Rpb24uZ2V0UXVhbnRpdHkpIHtcbiAgICAgICAgICBicmVha1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIGRpc2NvdW50QW1vdW50ID0gdG90YWxEaXNjb3VudFxuICAgICAgYWZmZWN0ZWRJdGVtcyA9IGVsaWdpYmxlSXRlbXMubWFwKGkgPT4gaS5wcm9kdWN0SWQpXG4gICAgICBcbiAgICAgIGNvbnN0IGdldERlc2MgPSBkaXNjb3VudFBlcmNlbnQgPT09IDEwMCA/ICdmcmVlJyA6IGAke2Rpc2NvdW50UGVyY2VudH0lIG9mZmBcbiAgICAgIG1lc3NhZ2UgPSBgQnV5ICR7cHJvbW90aW9uLmJ1eVF1YW50aXR5fSBnZXQgJHtwcm9tb3Rpb24uZ2V0UXVhbnRpdHl9ICR7Z2V0RGVzY31gXG4gICAgICBicmVha1xuICAgIH1cbiAgfVxuICBcbiAgY29uc3QgZmluYWxEaXNjb3VudCA9IGRpc2NvdW50QW1vdW50LnRvRGVjaW1hbFBsYWNlcygyKS50b051bWJlcigpXG4gIFxuICBpZiAoZmluYWxEaXNjb3VudCA9PT0gMCAmJiAhZnJlZVNoaXBwaW5nKSB7XG4gICAgcmV0dXJuIG51bGxcbiAgfVxuICBcbiAgcmV0dXJuIHtcbiAgICBwcm9tb3Rpb25JZDogcHJvbW90aW9uLmlkLFxuICAgIHByb21vdGlvbk5hbWU6IHByb21vdGlvbi5uYW1lLFxuICAgIGNvZGU6IHByb21vdGlvbi5jb2RlLFxuICAgIGRpc2NvdW50VHlwZTogcHJvbW90aW9uLmRpc2NvdW50VHlwZSxcbiAgICBkaXNjb3VudEFtb3VudDogZmluYWxEaXNjb3VudCxcbiAgICBvcmlnaW5hbEFtb3VudCxcbiAgICBjYXBwZWRBbW91bnQ6IG9yaWdpbmFsQW1vdW50ICYmIG9yaWdpbmFsQW1vdW50ID4gZmluYWxEaXNjb3VudCA/IGZpbmFsRGlzY291bnQgOiB1bmRlZmluZWQsXG4gICAgYWZmZWN0ZWRJdGVtczogYWZmZWN0ZWRJdGVtcy5sZW5ndGggPiAwID8gYWZmZWN0ZWRJdGVtcyA6IHVuZGVmaW5lZCxcbiAgICBmcmVlU2hpcHBpbmcsXG4gICAgbWVzc2FnZVxuICB9XG59XG4iXSwibmFtZXMiOlsiRGVjaW1hbCIsIlBST01PVElPTlNfU1RPUkFHRV9LRVkiLCJVU0FHRV9TVE9SQUdFX0tFWSIsImdldFByb21vdGlvbnNTdG9yYWdlIiwiZ2xvYmFsVGhpcyIsIk1hcCIsImdldFVzYWdlU3RvcmFnZSIsImdlbmVyYXRlSWQiLCJwcmVmaXgiLCJEYXRlIiwibm93IiwidG9TdHJpbmciLCJNYXRoIiwicmFuZG9tIiwic3Vic3RyaW5nIiwiZ2V0T3JDcmVhdGVQcm9tb3Rpb25zIiwidGVuYW50SWQiLCJzdG9yYWdlIiwiaGFzIiwiZ2V0Iiwic2FtcGxlUHJvbW90aW9ucyIsImlkIiwibmFtZSIsImRlc2NyaXB0aW9uIiwiY29kZSIsInR5cGUiLCJkaXNjb3VudFR5cGUiLCJkaXNjb3VudFZhbHVlIiwicHJvZHVjdElkcyIsImNhdGVnb3J5SWRzIiwiZXhjbHVkZVByb2R1Y3RJZHMiLCJjdXN0b21lcklkcyIsImZpcnN0T3JkZXJPbmx5IiwidXNhZ2VDb3VudCIsInN0YXJ0c0F0IiwiaXNBY3RpdmUiLCJzdGFja2FibGUiLCJwcmlvcml0eSIsImNyZWF0ZWRBdCIsInRvSVNPU3RyaW5nIiwidXBkYXRlZEF0IiwibWF4RGlzY291bnQiLCJtaW5PcmRlclRvdGFsIiwiYnV5UXVhbnRpdHkiLCJnZXRRdWFudGl0eSIsImdldERpc2NvdW50UGVyY2VudCIsInVzYWdlTGltaXQiLCJwZXJDdXN0b21lckxpbWl0Iiwic2V0IiwiZ2V0UHJvbW90aW9ucyIsImdldEFjdGl2ZVByb21vdGlvbnMiLCJmaWx0ZXIiLCJwIiwiZW5kc0F0IiwiZ2V0QXV0b21hdGljUHJvbW90aW9ucyIsImZpbmRCeUNvZGUiLCJwcm9tb3Rpb25zIiwiZmluZCIsInRvVXBwZXJDYXNlIiwiZ2V0UHJvbW90aW9uIiwicHJvbW90aW9uSWQiLCJhZGRQcm9tb3Rpb24iLCJwcm9tb3Rpb24iLCJwdXNoIiwidXBkYXRlUHJvbW90aW9uIiwidXBkYXRlcyIsImluZGV4IiwiZmluZEluZGV4IiwiZGVsZXRlUHJvbW90aW9uIiwiZGVsZXRlZCIsInNwbGljZSIsInJlY29yZFVzYWdlIiwib3JkZXJJZCIsImN1c3RvbWVySWQiLCJkaXNjb3VudEFwcGxpZWQiLCJ1c2FnZVN0b3JhZ2UiLCJwcm9tb3Rpb25zU3RvcmFnZSIsInVzYWdlIiwidXNhZ2VzIiwiZ2V0Q3VzdG9tZXJVc2FnZUNvdW50IiwidSIsImxlbmd0aCIsInZhbGlkYXRlUHJvbW90aW9uIiwic3VidG90YWwiLCJ0b3RhbFF1YW50aXR5IiwiaXNGaXJzdE9yZGVyIiwiY3VycmVudERpc2NvdW50cyIsInZhbGlkIiwiZXJyb3IiLCJlcnJvckNvZGUiLCJjdXN0b21lclVzYWdlQ291bnQiLCJpbmNsdWRlcyIsInRvRml4ZWQiLCJtaW5RdWFudGl0eSIsInNvbWUiLCJkIiwiZ2V0RWxpZ2libGVJdGVtcyIsIml0ZW1zIiwiaXRlbSIsInByb2R1Y3RJZCIsImNhdGVnb3J5SWQiLCJjYWxjdWxhdGVEaXNjb3VudCIsInNoaXBwaW5nVG90YWwiLCJlbGlnaWJsZUl0ZW1zIiwiZGlzY291bnRBbW91bnQiLCJvcmlnaW5hbEFtb3VudCIsImZyZWVTaGlwcGluZyIsImFmZmVjdGVkSXRlbXMiLCJtZXNzYWdlIiwiZWxpZ2libGVTdWJ0b3RhbCIsInJlZHVjZSIsInN1bSIsInVuaXRQcmljZSIsInF1YW50aXR5IiwicGVyY2VudERpc2NvdW50IiwidGltZXMiLCJkaXZpZGVkQnkiLCJ0b0RlY2ltYWxQbGFjZXMiLCJ0b051bWJlciIsImdyZWF0ZXJUaGFuIiwibWFwIiwiaSIsInRvdGFsRWxpZ2libGVRdHkiLCJzb3J0ZWRJdGVtcyIsInNvcnQiLCJhIiwiYiIsInRvdGFsUXR5IiwiZGVhbFNpemUiLCJudW1EZWFscyIsImZsb29yIiwiZGlzY291bnRQZXJjZW50IiwiZGlzY291bnRlZEl0ZW1zIiwidG90YWxEaXNjb3VudCIsInJldmVyc2VkSXRlbXMiLCJyZXZlcnNlIiwiaXRlbXNUb0Rpc2NvdW50IiwibWluIiwiaXRlbURpc2NvdW50IiwicGx1cyIsImdldERlc2MiLCJmaW5hbERpc2NvdW50IiwicHJvbW90aW9uTmFtZSIsImNhcHBlZEFtb3VudCIsInVuZGVmaW5lZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/promotions-storage.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/decimal.js"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsvm%2Fpromotions%2Froute&page=%2Fapi%2Fsvm%2Fpromotions%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsvm%2Fpromotions%2Froute.ts&appDir=%2Fapp%2Fsaas-core%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp%2Fsaas-core&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();