"use strict";(()=>{var e={};e.id=8797,e.ids=[8797],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},66440:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>v,patchFetch:()=>x,requestAsyncStorage:()=>I,routeModule:()=>m,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var r={};s.r(r),s.d(r,{DELETE:()=>l,GET:()=>p,POST:()=>c});var o=s(49303),n=s(88716),a=s(60670),i=s(87070);let u=new Map;function d(e,t,s){if(t)return`${e}:customer:${t}`;if(s)return`${e}:session:${s}`;throw Error("Either customerId or sessionId is required")}async function c(e){try{let t=await e.json(),{tenantId:s,customerId:r,sessionId:o,action:n}=t;if(!s)return i.NextResponse.json({success:!1,error:"tenantId is required"},{status:400});if(!r&&!o)return i.NextResponse.json({success:!1,error:"Either customerId or sessionId is required"},{status:400});let a=d(s,r,o),c=u.get(a);switch(c||(c={id:`cart_${Date.now().toString(36)}${Math.random().toString(36).substring(2,9)}`,tenantId:s,customerId:r,sessionId:o,items:[],subtotal:0,discountTotal:0,createdAt:new Date,updatedAt:new Date}),n){case"ADD_ITEM":{let{productId:e,variantId:s,productName:r,unitPrice:o,quantity:n}=t;if(!e||!r||void 0===o||!n)return i.NextResponse.json({success:!1,error:"productId, productName, unitPrice, and quantity are required"},{status:400});let a=c.items.findIndex(t=>t.productId===e&&t.variantId===s);a>=0?c.items[a].quantity+=n:c.items.push({productId:e,variantId:s,productName:r,unitPrice:o,quantity:n});break}case"UPDATE_QUANTITY":{let{productId:e,variantId:s,quantity:r}=t,o=c.items.findIndex(t=>t.productId===e&&t.variantId===s);if(o<0)return i.NextResponse.json({success:!1,error:"Item not found in cart"},{status:404});r<=0?c.items.splice(o,1):c.items[o].quantity=r;break}case"REMOVE_ITEM":{let{productId:e,variantId:s}=t;c.items=c.items.filter(t=>!(t.productId===e&&t.variantId===s));break}case"APPLY_PROMO":{let{promotionCode:e}=t;c.promotionCode=e,c.discountTotal=.1*c.subtotal;break}case"REMOVE_PROMO":c.promotionCode=void 0,c.discountTotal=0;break;default:return i.NextResponse.json({success:!1,error:`Unknown action: ${n}`},{status:400})}return c.subtotal=c.items.reduce((e,t)=>e+t.unitPrice*t.quantity,0),c.updatedAt=new Date,u.set(a,c),i.NextResponse.json({success:!0,cart:{id:c.id,tenantId:c.tenantId,customerId:c.customerId,sessionId:c.sessionId,items:c.items,itemCount:c.items.reduce((e,t)=>e+t.quantity,0),subtotal:c.subtotal,promotionCode:c.promotionCode,discountTotal:c.discountTotal,total:c.subtotal-c.discountTotal,createdAt:c.createdAt.toISOString(),updatedAt:c.updatedAt.toISOString()}})}catch(e){return console.error("[SVM] Error updating cart:",e),i.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Internal server error"},{status:500})}}async function p(e){try{let{searchParams:t}=new URL(e.url),s=t.get("tenantId"),r=t.get("customerId"),o=t.get("sessionId");if(!s)return i.NextResponse.json({success:!1,error:"tenantId is required"},{status:400});if(!r&&!o)return i.NextResponse.json({success:!1,error:"Either customerId or sessionId is required"},{status:400});let n=d(s,r||void 0,o||void 0),a=u.get(n);if(!a)return i.NextResponse.json({success:!0,cart:{id:null,tenantId:s,customerId:r,sessionId:o,items:[],itemCount:0,subtotal:0,promotionCode:null,discountTotal:0,total:0}});return i.NextResponse.json({success:!0,cart:{id:a.id,tenantId:a.tenantId,customerId:a.customerId,sessionId:a.sessionId,items:a.items.map(e=>({...e,lineTotal:e.unitPrice*e.quantity})),itemCount:a.items.reduce((e,t)=>e+t.quantity,0),subtotal:a.subtotal,promotionCode:a.promotionCode,discountTotal:a.discountTotal,total:a.subtotal-a.discountTotal,createdAt:a.createdAt.toISOString(),updatedAt:a.updatedAt.toISOString()}})}catch(e){return console.error("[SVM] Error fetching cart:",e),i.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function l(e){try{let{searchParams:t}=new URL(e.url),s=t.get("tenantId"),r=t.get("customerId"),o=t.get("sessionId");if(!s)try{let t=await e.json();s=t.tenantId,r=t.customerId,o=t.sessionId}catch{}if(!s||!r&&!o)return i.NextResponse.json({success:!1,error:"tenantId and either customerId or sessionId are required"},{status:400});let n=d(s,r||void 0,o||void 0);return u.delete(n),i.NextResponse.json({success:!0,message:"Cart cleared"})}catch(e){return console.error("[SVM] Error clearing cart:",e),i.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Internal server error"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/svm/cart/route",pathname:"/api/svm/cart",filename:"route",bundlePath:"app/api/svm/cart/route"},resolvedPagePath:"/app/saas-core/src/app/api/svm/cart/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:I,staticGenerationAsyncStorage:g,serverHooks:f}=m,v="/api/svm/cart/route";function x(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[9380,5972],()=>s(66440));module.exports=r})();