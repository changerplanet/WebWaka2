"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/svm/cart/route";
exports.ids = ["app/api/svm/cart/route"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsvm%2Fcart%2Froute&page=%2Fapi%2Fsvm%2Fcart%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsvm%2Fcart%2Froute.ts&appDir=%2Fapp%2Fsaas-core%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp%2Fsaas-core&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsvm%2Fcart%2Froute&page=%2Fapi%2Fsvm%2Fcart%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsvm%2Fcart%2Froute.ts&appDir=%2Fapp%2Fsaas-core%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp%2Fsaas-core&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _app_saas_core_src_app_api_svm_cart_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/svm/cart/route.ts */ \"(rsc)/./src/app/api/svm/cart/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/svm/cart/route\",\n        pathname: \"/api/svm/cart\",\n        filename: \"route\",\n        bundlePath: \"app/api/svm/cart/route\"\n    },\n    resolvedPagePath: \"/app/saas-core/src/app/api/svm/cart/route.ts\",\n    nextConfigOutput,\n    userland: _app_saas_core_src_app_api_svm_cart_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/svm/cart/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZzdm0lMkZjYXJ0JTJGcm91dGUmcGFnZT0lMkZhcGklMkZzdm0lMkZjYXJ0JTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGc3ZtJTJGY2FydCUyRnJvdXRlLnRzJmFwcERpcj0lMkZhcHAlMkZzYWFzLWNvcmUlMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRmFwcCUyRnNhYXMtY29yZSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDSjtBQUN6RTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL3NhYXMtY29yZS8/ZDFhNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvYXBwL3NhYXMtY29yZS9zcmMvYXBwL2FwaS9zdm0vY2FydC9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvc3ZtL2NhcnQvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9zdm0vY2FydFwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvc3ZtL2NhcnQvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvYXBwL3NhYXMtY29yZS9zcmMvYXBwL2FwaS9zdm0vY2FydC9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvc3ZtL2NhcnQvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsvm%2Fcart%2Froute&page=%2Fapi%2Fsvm%2Fcart%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsvm%2Fcart%2Froute.ts&appDir=%2Fapp%2Fsaas-core%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp%2Fsaas-core&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/svm/cart/route.ts":
/*!***************************************!*\
  !*** ./src/app/api/svm/cart/route.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DELETE: () => (/* binding */ DELETE),\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_1__);\n/**\n * SVM Cart API - Persistent Storage\n * \n * POST /api/svm/cart - Create or update cart\n * GET /api/svm/cart - Get cart contents\n * DELETE /api/svm/cart - Clear cart\n * \n * Uses Prisma for persistent cart storage with session recovery support.\n */ \n\nconst prisma = new _prisma_client__WEBPACK_IMPORTED_MODULE_1__.PrismaClient();\nfunction generateCartId() {\n    return `cart_${Date.now().toString(36)}${Math.random().toString(36).substring(2, 9)}`;\n}\nfunction calculateCartTotals(items, discountRate = 0) {\n    const itemCount = items.reduce((sum, item)=>sum + item.quantity, 0);\n    const subtotal = items.reduce((sum, item)=>sum + Number(item.lineTotal), 0);\n    const discountTotal = subtotal * discountRate;\n    const taxTotal = (subtotal - discountTotal) * 0.08 // 8% tax\n    ;\n    const grandTotal = subtotal - discountTotal + taxTotal;\n    return {\n        itemCount,\n        subtotal,\n        discountTotal,\n        taxTotal,\n        grandTotal\n    };\n}\n/**\n * POST /api/svm/cart\n * Actions: ADD_ITEM, UPDATE_QUANTITY, REMOVE_ITEM, APPLY_PROMO, REMOVE_PROMO, SET_SHIPPING, MERGE_CART\n */ async function POST(request) {\n    try {\n        const body = await request.json();\n        const { tenantId, customerId, sessionId, action, email } = body;\n        if (!tenantId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"tenantId is required\"\n            }, {\n                status: 400\n            });\n        }\n        if (!customerId && !sessionId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Either customerId or sessionId is required\"\n            }, {\n                status: 400\n            });\n        }\n        // Find or create cart\n        let cart = await prisma.svmCart.findFirst({\n            where: {\n                tenantId,\n                status: \"ACTIVE\",\n                OR: [\n                    {\n                        customerId: customerId || undefined\n                    },\n                    {\n                        sessionId: sessionId || undefined\n                    }\n                ].filter(Boolean)\n            },\n            include: {\n                items: true\n            }\n        });\n        // If customer has no cart but session does, try to find session cart\n        if (!cart && customerId && sessionId) {\n            const sessionCart = await prisma.svmCart.findFirst({\n                where: {\n                    tenantId,\n                    sessionId,\n                    status: \"ACTIVE\"\n                },\n                include: {\n                    items: true\n                }\n            });\n            if (sessionCart) {\n                // Merge session cart to customer\n                cart = await prisma.svmCart.update({\n                    where: {\n                        id: sessionCart.id\n                    },\n                    data: {\n                        customerId,\n                        sessionId: null\n                    },\n                    include: {\n                        items: true\n                    }\n                });\n            }\n        }\n        // Create new cart if none exists\n        if (!cart) {\n            cart = await prisma.svmCart.create({\n                data: {\n                    tenantId,\n                    customerId: customerId || null,\n                    sessionId: customerId ? null : sessionId,\n                    email: email || null,\n                    status: \"ACTIVE\",\n                    expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000) // 7 days\n                },\n                include: {\n                    items: true\n                }\n            });\n        }\n        // Handle actions\n        switch(action){\n            case \"ADD_ITEM\":\n                {\n                    const { productId, variantId, productName, variantName, sku, imageUrl, unitPrice, quantity = 1 } = body;\n                    if (!productId || !productName || unitPrice === undefined) {\n                        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                            success: false,\n                            error: \"productId, productName, and unitPrice are required\"\n                        }, {\n                            status: 400\n                        });\n                    }\n                    // Check if item already exists\n                    const existingItem = await prisma.svmCartItem.findFirst({\n                        where: {\n                            cartId: cart.id,\n                            productId,\n                            variantId: variantId || null\n                        }\n                    });\n                    if (existingItem) {\n                        // Update quantity\n                        await prisma.svmCartItem.update({\n                            where: {\n                                id: existingItem.id\n                            },\n                            data: {\n                                quantity: existingItem.quantity + quantity,\n                                lineTotal: (existingItem.quantity + quantity) * Number(existingItem.unitPrice)\n                            }\n                        });\n                    } else {\n                        // Add new item\n                        await prisma.svmCartItem.create({\n                            data: {\n                                cartId: cart.id,\n                                productId,\n                                variantId: variantId || null,\n                                productName,\n                                variantName: variantName || null,\n                                sku: sku || null,\n                                imageUrl: imageUrl || null,\n                                unitPrice,\n                                quantity,\n                                lineTotal: unitPrice * quantity\n                            }\n                        });\n                    }\n                    break;\n                }\n            case \"UPDATE_QUANTITY\":\n                {\n                    const { productId, variantId, quantity } = body;\n                    const item = await prisma.svmCartItem.findFirst({\n                        where: {\n                            cartId: cart.id,\n                            productId,\n                            variantId: variantId || null\n                        }\n                    });\n                    if (!item) {\n                        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                            success: false,\n                            error: \"Item not found in cart\"\n                        }, {\n                            status: 404\n                        });\n                    }\n                    if (quantity <= 0) {\n                        await prisma.svmCartItem.delete({\n                            where: {\n                                id: item.id\n                            }\n                        });\n                    } else {\n                        await prisma.svmCartItem.update({\n                            where: {\n                                id: item.id\n                            },\n                            data: {\n                                quantity,\n                                lineTotal: quantity * Number(item.unitPrice)\n                            }\n                        });\n                    }\n                    break;\n                }\n            case \"REMOVE_ITEM\":\n                {\n                    const { productId, variantId } = body;\n                    await prisma.svmCartItem.deleteMany({\n                        where: {\n                            cartId: cart.id,\n                            productId,\n                            variantId: variantId || null\n                        }\n                    });\n                    break;\n                }\n            case \"APPLY_PROMO\":\n                {\n                    const { promotionCode } = body;\n                    if (!promotionCode) {\n                        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                            success: false,\n                            error: \"promotionCode is required\"\n                        }, {\n                            status: 400\n                        });\n                    }\n                    // Validate promotion code\n                    const promotion = await prisma.svmPromotion.findFirst({\n                        where: {\n                            tenantId,\n                            code: promotionCode.toUpperCase(),\n                            isActive: true,\n                            startsAt: {\n                                lte: new Date()\n                            },\n                            OR: [\n                                {\n                                    endsAt: null\n                                },\n                                {\n                                    endsAt: {\n                                        gte: new Date()\n                                    }\n                                }\n                            ]\n                        }\n                    });\n                    if (!promotion) {\n                        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                            success: false,\n                            error: \"Invalid or expired promotion code\"\n                        }, {\n                            status: 400\n                        });\n                    }\n                    await prisma.svmCart.update({\n                        where: {\n                            id: cart.id\n                        },\n                        data: {\n                            promotionCode: promotionCode.toUpperCase(),\n                            promotionId: promotion.id\n                        }\n                    });\n                    break;\n                }\n            case \"REMOVE_PROMO\":\n                {\n                    await prisma.svmCart.update({\n                        where: {\n                            id: cart.id\n                        },\n                        data: {\n                            promotionCode: null,\n                            promotionId: null,\n                            discountTotal: 0\n                        }\n                    });\n                    break;\n                }\n            case \"SET_SHIPPING\":\n                {\n                    const { shippingAddress, shippingZoneId, shippingRateId, shippingMethod, shippingTotal } = body;\n                    await prisma.svmCart.update({\n                        where: {\n                            id: cart.id\n                        },\n                        data: {\n                            shippingAddress: shippingAddress || undefined,\n                            shippingZoneId: shippingZoneId || null,\n                            shippingRateId: shippingRateId || null,\n                            shippingMethod: shippingMethod || null,\n                            shippingTotal: shippingTotal ?? 0\n                        }\n                    });\n                    break;\n                }\n            case \"SET_EMAIL\":\n                {\n                    const { email: cartEmail } = body;\n                    await prisma.svmCart.update({\n                        where: {\n                            id: cart.id\n                        },\n                        data: {\n                            email: cartEmail\n                        }\n                    });\n                    break;\n                }\n            default:\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    error: `Unknown action: ${action}`\n                }, {\n                    status: 400\n                });\n        }\n        // Reload cart with updated items\n        const updatedCart = await prisma.svmCart.findUnique({\n            where: {\n                id: cart.id\n            },\n            include: {\n                items: true\n            }\n        });\n        if (!updatedCart) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Cart not found after update\"\n            }, {\n                status: 500\n            });\n        }\n        // Calculate totals\n        const discountRate = updatedCart.promotionCode ? 0.1 : 0 // 10% for promo codes\n        ;\n        const totals = calculateCartTotals(updatedCart.items, discountRate);\n        // Update cart totals\n        await prisma.svmCart.update({\n            where: {\n                id: updatedCart.id\n            },\n            data: {\n                itemCount: totals.itemCount,\n                subtotal: totals.subtotal,\n                discountTotal: totals.discountTotal,\n                taxTotal: totals.taxTotal,\n                grandTotal: totals.grandTotal + Number(updatedCart.shippingTotal)\n            }\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            cart: {\n                id: updatedCart.id,\n                tenantId: updatedCart.tenantId,\n                customerId: updatedCart.customerId,\n                sessionId: updatedCart.sessionId,\n                email: updatedCart.email,\n                items: updatedCart.items.map((item)=>({\n                        productId: item.productId,\n                        variantId: item.variantId,\n                        productName: item.productName,\n                        variantName: item.variantName,\n                        sku: item.sku,\n                        imageUrl: item.imageUrl,\n                        unitPrice: Number(item.unitPrice),\n                        quantity: item.quantity,\n                        lineTotal: Number(item.lineTotal),\n                        discountAmount: Number(item.discountAmount)\n                    })),\n                itemCount: totals.itemCount,\n                subtotal: totals.subtotal,\n                promotionCode: updatedCart.promotionCode,\n                discountTotal: totals.discountTotal,\n                shippingTotal: Number(updatedCart.shippingTotal),\n                shippingMethod: updatedCart.shippingMethod,\n                taxTotal: totals.taxTotal,\n                grandTotal: totals.grandTotal + Number(updatedCart.shippingTotal),\n                shippingAddress: updatedCart.shippingAddress,\n                createdAt: updatedCart.createdAt.toISOString(),\n                updatedAt: updatedCart.updatedAt.toISOString()\n            }\n        });\n    } catch (error) {\n        console.error(\"[SVM Cart] Error updating cart:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: error instanceof Error ? error.message : \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\n/**\n * GET /api/svm/cart\n * Retrieve cart by customerId or sessionId\n */ async function GET(request) {\n    try {\n        const { searchParams } = new URL(request.url);\n        const tenantId = searchParams.get(\"tenantId\");\n        const customerId = searchParams.get(\"customerId\");\n        const sessionId = searchParams.get(\"sessionId\");\n        if (!tenantId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"tenantId is required\"\n            }, {\n                status: 400\n            });\n        }\n        if (!customerId && !sessionId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Either customerId or sessionId is required\"\n            }, {\n                status: 400\n            });\n        }\n        // Find active cart\n        const cart = await prisma.svmCart.findFirst({\n            where: {\n                tenantId,\n                status: \"ACTIVE\",\n                OR: [\n                    customerId ? {\n                        customerId\n                    } : {},\n                    sessionId ? {\n                        sessionId\n                    } : {}\n                ].filter((o)=>Object.keys(o).length > 0)\n            },\n            include: {\n                items: true\n            }\n        });\n        if (!cart) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                cart: {\n                    id: null,\n                    tenantId,\n                    customerId,\n                    sessionId,\n                    email: null,\n                    items: [],\n                    itemCount: 0,\n                    subtotal: 0,\n                    promotionCode: null,\n                    discountTotal: 0,\n                    shippingTotal: 0,\n                    shippingMethod: null,\n                    taxTotal: 0,\n                    grandTotal: 0,\n                    shippingAddress: null\n                }\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            cart: {\n                id: cart.id,\n                tenantId: cart.tenantId,\n                customerId: cart.customerId,\n                sessionId: cart.sessionId,\n                email: cart.email,\n                items: cart.items.map((item)=>({\n                        productId: item.productId,\n                        variantId: item.variantId,\n                        productName: item.productName,\n                        variantName: item.variantName,\n                        sku: item.sku,\n                        imageUrl: item.imageUrl,\n                        unitPrice: Number(item.unitPrice),\n                        quantity: item.quantity,\n                        lineTotal: Number(item.lineTotal),\n                        discountAmount: Number(item.discountAmount)\n                    })),\n                itemCount: Number(cart.itemCount),\n                subtotal: Number(cart.subtotal),\n                promotionCode: cart.promotionCode,\n                discountTotal: Number(cart.discountTotal),\n                shippingTotal: Number(cart.shippingTotal),\n                shippingMethod: cart.shippingMethod,\n                taxTotal: Number(cart.taxTotal),\n                grandTotal: Number(cart.grandTotal),\n                shippingAddress: cart.shippingAddress,\n                createdAt: cart.createdAt.toISOString(),\n                updatedAt: cart.updatedAt.toISOString()\n            }\n        });\n    } catch (error) {\n        console.error(\"[SVM Cart] Error fetching cart:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\n/**\n * DELETE /api/svm/cart\n * Clear cart contents or mark as abandoned\n */ async function DELETE(request) {\n    try {\n        const { searchParams } = new URL(request.url);\n        let tenantId = searchParams.get(\"tenantId\");\n        let customerId = searchParams.get(\"customerId\");\n        let sessionId = searchParams.get(\"sessionId\");\n        let markAbandoned = searchParams.get(\"markAbandoned\") === \"true\";\n        // If not in query params, try body\n        if (!tenantId) {\n            try {\n                const body = await request.json();\n                tenantId = body.tenantId;\n                customerId = body.customerId;\n                sessionId = body.sessionId;\n                markAbandoned = body.markAbandoned || false;\n            } catch  {\n            // Body parse failed\n            }\n        }\n        if (!tenantId || !customerId && !sessionId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"tenantId and either customerId or sessionId are required\"\n            }, {\n                status: 400\n            });\n        }\n        const cart = await prisma.svmCart.findFirst({\n            where: {\n                tenantId,\n                status: \"ACTIVE\",\n                OR: [\n                    customerId ? {\n                        customerId\n                    } : {},\n                    sessionId ? {\n                        sessionId\n                    } : {}\n                ].filter((o)=>Object.keys(o).length > 0)\n            }\n        });\n        if (cart) {\n            if (markAbandoned) {\n                // Mark as abandoned for potential recovery\n                await prisma.svmCart.update({\n                    where: {\n                        id: cart.id\n                    },\n                    data: {\n                        status: \"ABANDONED\"\n                    }\n                });\n            } else {\n                // Delete cart and items\n                await prisma.svmCartItem.deleteMany({\n                    where: {\n                        cartId: cart.id\n                    }\n                });\n                await prisma.svmCart.delete({\n                    where: {\n                        id: cart.id\n                    }\n                });\n            }\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            message: markAbandoned ? \"Cart marked as abandoned\" : \"Cart cleared\"\n        });\n    } catch (error) {\n        console.error(\"[SVM Cart] Error clearing cart:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: error instanceof Error ? error.message : \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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b0JBQVcsSUFBSSxDQUFDO29CQUMvQkMsWUFBWTt3QkFBRUE7b0JBQVUsSUFBSSxDQUFDO2lCQUM5QixDQUFDWSxNQUFNLENBQUNzRCxDQUFBQSxJQUFLQyxPQUFPQyxJQUFJLENBQUNGLEdBQUdHLE1BQU0sR0FBRztZQUN4QztRQUNGO1FBRUEsSUFBSS9ELE1BQU07WUFDUixJQUFJaUUsZUFBZTtnQkFDakIsMkNBQTJDO2dCQUMzQyxNQUFNbkcsT0FBT21DLE9BQU8sQ0FBQ1MsTUFBTSxDQUFDO29CQUMxQlAsT0FBTzt3QkFBRVEsSUFBSVgsS0FBS1csRUFBRTtvQkFBQztvQkFDckJDLE1BQU07d0JBQUViLFFBQVE7b0JBQVk7Z0JBQzlCO1lBQ0YsT0FBTztnQkFDTCx3QkFBd0I7Z0JBQ3hCLE1BQU1qQyxPQUFPeUQsV0FBVyxDQUFDRyxVQUFVLENBQUM7b0JBQUV2QixPQUFPO3dCQUFFcUIsUUFBUXhCLEtBQUtXLEVBQUU7b0JBQUM7Z0JBQUU7Z0JBQ2pFLE1BQU03QyxPQUFPbUMsT0FBTyxDQUFDd0IsTUFBTSxDQUFDO29CQUFFdEIsT0FBTzt3QkFBRVEsSUFBSVgsS0FBS1csRUFBRTtvQkFBQztnQkFBRTtZQUN2RDtRQUNGO1FBRUEsT0FBTy9DLHFEQUFZQSxDQUFDMkIsSUFBSSxDQUFDO1lBQ3ZCTSxTQUFTO1lBQ1R5RCxTQUFTVyxnQkFBZ0IsNkJBQTZCO1FBQ3hEO0lBRUYsRUFBRSxPQUFPbkUsT0FBTztRQUNkc0QsUUFBUXRELEtBQUssQ0FBQyxtQ0FBbUNBO1FBQ2pELE9BQU9sQyxxREFBWUEsQ0FBQzJCLElBQUksQ0FDdEI7WUFBRU0sU0FBUztZQUFPQyxPQUFPQSxpQkFBaUJ1RCxRQUFRdkQsTUFBTXdELE9BQU8sR0FBRztRQUF3QixHQUMxRjtZQUFFdkQsUUFBUTtRQUFJO0lBRWxCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zYWFzLWNvcmUvLi9zcmMvYXBwL2FwaS9zdm0vY2FydC9yb3V0ZS50cz8wMTcxIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU1ZNIENhcnQgQVBJIC0gUGVyc2lzdGVudCBTdG9yYWdlXG4gKiBcbiAqIFBPU1QgL2FwaS9zdm0vY2FydCAtIENyZWF0ZSBvciB1cGRhdGUgY2FydFxuICogR0VUIC9hcGkvc3ZtL2NhcnQgLSBHZXQgY2FydCBjb250ZW50c1xuICogREVMRVRFIC9hcGkvc3ZtL2NhcnQgLSBDbGVhciBjYXJ0XG4gKiBcbiAqIFVzZXMgUHJpc21hIGZvciBwZXJzaXN0ZW50IGNhcnQgc3RvcmFnZSB3aXRoIHNlc3Npb24gcmVjb3Zlcnkgc3VwcG9ydC5cbiAqL1xuXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgeyBQcmlzbWFDbGllbnQsIFN2bUNhcnRTdGF0dXMgfSBmcm9tICdAcHJpc21hL2NsaWVudCdcblxuY29uc3QgcHJpc21hID0gbmV3IFByaXNtYUNsaWVudCgpXG5cbmZ1bmN0aW9uIGdlbmVyYXRlQ2FydElkKCk6IHN0cmluZyB7XG4gIHJldHVybiBgY2FydF8ke0RhdGUubm93KCkudG9TdHJpbmcoMzYpfSR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDkpfWBcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlQ2FydFRvdGFscyhpdGVtczogYW55W10sIGRpc2NvdW50UmF0ZTogbnVtYmVyID0gMCkge1xuICBjb25zdCBpdGVtQ291bnQgPSBpdGVtcy5yZWR1Y2UoKHN1bSwgaXRlbSkgPT4gc3VtICsgaXRlbS5xdWFudGl0eSwgMClcbiAgY29uc3Qgc3VidG90YWwgPSBpdGVtcy5yZWR1Y2UoKHN1bSwgaXRlbSkgPT4gc3VtICsgTnVtYmVyKGl0ZW0ubGluZVRvdGFsKSwgMClcbiAgY29uc3QgZGlzY291bnRUb3RhbCA9IHN1YnRvdGFsICogZGlzY291bnRSYXRlXG4gIGNvbnN0IHRheFRvdGFsID0gKHN1YnRvdGFsIC0gZGlzY291bnRUb3RhbCkgKiAwLjA4IC8vIDglIHRheFxuICBjb25zdCBncmFuZFRvdGFsID0gc3VidG90YWwgLSBkaXNjb3VudFRvdGFsICsgdGF4VG90YWxcblxuICByZXR1cm4ge1xuICAgIGl0ZW1Db3VudCxcbiAgICBzdWJ0b3RhbCxcbiAgICBkaXNjb3VudFRvdGFsLFxuICAgIHRheFRvdGFsLFxuICAgIGdyYW5kVG90YWxcbiAgfVxufVxuXG4vKipcbiAqIFBPU1QgL2FwaS9zdm0vY2FydFxuICogQWN0aW9uczogQUREX0lURU0sIFVQREFURV9RVUFOVElUWSwgUkVNT1ZFX0lURU0sIEFQUExZX1BST01PLCBSRU1PVkVfUFJPTU8sIFNFVF9TSElQUElORywgTUVSR0VfQ0FSVFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKVxuICAgIGNvbnN0IHsgdGVuYW50SWQsIGN1c3RvbWVySWQsIHNlc3Npb25JZCwgYWN0aW9uLCBlbWFpbCB9ID0gYm9keVxuXG4gICAgaWYgKCF0ZW5hbnRJZCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ3RlbmFudElkIGlzIHJlcXVpcmVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBpZiAoIWN1c3RvbWVySWQgJiYgIXNlc3Npb25JZCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0VpdGhlciBjdXN0b21lcklkIG9yIHNlc3Npb25JZCBpcyByZXF1aXJlZCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgLy8gRmluZCBvciBjcmVhdGUgY2FydFxuICAgIGxldCBjYXJ0ID0gYXdhaXQgcHJpc21hLnN2bUNhcnQuZmluZEZpcnN0KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIHRlbmFudElkLFxuICAgICAgICBzdGF0dXM6ICdBQ1RJVkUnLFxuICAgICAgICBPUjogW1xuICAgICAgICAgIHsgY3VzdG9tZXJJZDogY3VzdG9tZXJJZCB8fCB1bmRlZmluZWQgfSxcbiAgICAgICAgICB7IHNlc3Npb25JZDogc2Vzc2lvbklkIHx8IHVuZGVmaW5lZCB9XG4gICAgICAgIF0uZmlsdGVyKEJvb2xlYW4pXG4gICAgICB9LFxuICAgICAgaW5jbHVkZTogeyBpdGVtczogdHJ1ZSB9XG4gICAgfSlcblxuICAgIC8vIElmIGN1c3RvbWVyIGhhcyBubyBjYXJ0IGJ1dCBzZXNzaW9uIGRvZXMsIHRyeSB0byBmaW5kIHNlc3Npb24gY2FydFxuICAgIGlmICghY2FydCAmJiBjdXN0b21lcklkICYmIHNlc3Npb25JZCkge1xuICAgICAgY29uc3Qgc2Vzc2lvbkNhcnQgPSBhd2FpdCBwcmlzbWEuc3ZtQ2FydC5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZTogeyB0ZW5hbnRJZCwgc2Vzc2lvbklkLCBzdGF0dXM6ICdBQ1RJVkUnIH0sXG4gICAgICAgIGluY2x1ZGU6IHsgaXRlbXM6IHRydWUgfVxuICAgICAgfSlcbiAgICAgIFxuICAgICAgaWYgKHNlc3Npb25DYXJ0KSB7XG4gICAgICAgIC8vIE1lcmdlIHNlc3Npb24gY2FydCB0byBjdXN0b21lclxuICAgICAgICBjYXJ0ID0gYXdhaXQgcHJpc21hLnN2bUNhcnQudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZDogc2Vzc2lvbkNhcnQuaWQgfSxcbiAgICAgICAgICBkYXRhOiB7IGN1c3RvbWVySWQsIHNlc3Npb25JZDogbnVsbCB9LFxuICAgICAgICAgIGluY2x1ZGU6IHsgaXRlbXM6IHRydWUgfVxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENyZWF0ZSBuZXcgY2FydCBpZiBub25lIGV4aXN0c1xuICAgIGlmICghY2FydCkge1xuICAgICAgY2FydCA9IGF3YWl0IHByaXNtYS5zdm1DYXJ0LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB0ZW5hbnRJZCxcbiAgICAgICAgICBjdXN0b21lcklkOiBjdXN0b21lcklkIHx8IG51bGwsXG4gICAgICAgICAgc2Vzc2lvbklkOiBjdXN0b21lcklkID8gbnVsbCA6IHNlc3Npb25JZCxcbiAgICAgICAgICBlbWFpbDogZW1haWwgfHwgbnVsbCxcbiAgICAgICAgICBzdGF0dXM6ICdBQ1RJVkUnLFxuICAgICAgICAgIGV4cGlyZXNBdDogbmV3IERhdGUoRGF0ZS5ub3coKSArIDcgKiAyNCAqIDYwICogNjAgKiAxMDAwKSAvLyA3IGRheXNcbiAgICAgICAgfSxcbiAgICAgICAgaW5jbHVkZTogeyBpdGVtczogdHJ1ZSB9XG4gICAgICB9KVxuICAgIH1cblxuICAgIC8vIEhhbmRsZSBhY3Rpb25zXG4gICAgc3dpdGNoIChhY3Rpb24pIHtcbiAgICAgIGNhc2UgJ0FERF9JVEVNJzoge1xuICAgICAgICBjb25zdCB7IHByb2R1Y3RJZCwgdmFyaWFudElkLCBwcm9kdWN0TmFtZSwgdmFyaWFudE5hbWUsIHNrdSwgaW1hZ2VVcmwsIHVuaXRQcmljZSwgcXVhbnRpdHkgPSAxIH0gPSBib2R5XG4gICAgICAgIFxuICAgICAgICBpZiAoIXByb2R1Y3RJZCB8fCAhcHJvZHVjdE5hbWUgfHwgdW5pdFByaWNlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ3Byb2R1Y3RJZCwgcHJvZHVjdE5hbWUsIGFuZCB1bml0UHJpY2UgYXJlIHJlcXVpcmVkJyB9LFxuICAgICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICAgKVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgaXRlbSBhbHJlYWR5IGV4aXN0c1xuICAgICAgICBjb25zdCBleGlzdGluZ0l0ZW0gPSBhd2FpdCBwcmlzbWEuc3ZtQ2FydEl0ZW0uZmluZEZpcnN0KHtcbiAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgY2FydElkOiBjYXJ0LmlkLFxuICAgICAgICAgICAgcHJvZHVjdElkLFxuICAgICAgICAgICAgdmFyaWFudElkOiB2YXJpYW50SWQgfHwgbnVsbFxuICAgICAgICAgIH1cbiAgICAgICAgfSlcblxuICAgICAgICBpZiAoZXhpc3RpbmdJdGVtKSB7XG4gICAgICAgICAgLy8gVXBkYXRlIHF1YW50aXR5XG4gICAgICAgICAgYXdhaXQgcHJpc21hLnN2bUNhcnRJdGVtLnVwZGF0ZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogZXhpc3RpbmdJdGVtLmlkIH0sXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIHF1YW50aXR5OiBleGlzdGluZ0l0ZW0ucXVhbnRpdHkgKyBxdWFudGl0eSxcbiAgICAgICAgICAgICAgbGluZVRvdGFsOiAoZXhpc3RpbmdJdGVtLnF1YW50aXR5ICsgcXVhbnRpdHkpICogTnVtYmVyKGV4aXN0aW5nSXRlbS51bml0UHJpY2UpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBBZGQgbmV3IGl0ZW1cbiAgICAgICAgICBhd2FpdCBwcmlzbWEuc3ZtQ2FydEl0ZW0uY3JlYXRlKHtcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgY2FydElkOiBjYXJ0LmlkLFxuICAgICAgICAgICAgICBwcm9kdWN0SWQsXG4gICAgICAgICAgICAgIHZhcmlhbnRJZDogdmFyaWFudElkIHx8IG51bGwsXG4gICAgICAgICAgICAgIHByb2R1Y3ROYW1lLFxuICAgICAgICAgICAgICB2YXJpYW50TmFtZTogdmFyaWFudE5hbWUgfHwgbnVsbCxcbiAgICAgICAgICAgICAgc2t1OiBza3UgfHwgbnVsbCxcbiAgICAgICAgICAgICAgaW1hZ2VVcmw6IGltYWdlVXJsIHx8IG51bGwsXG4gICAgICAgICAgICAgIHVuaXRQcmljZSxcbiAgICAgICAgICAgICAgcXVhbnRpdHksXG4gICAgICAgICAgICAgIGxpbmVUb3RhbDogdW5pdFByaWNlICogcXVhbnRpdHlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICAgIGJyZWFrXG4gICAgICB9XG5cbiAgICAgIGNhc2UgJ1VQREFURV9RVUFOVElUWSc6IHtcbiAgICAgICAgY29uc3QgeyBwcm9kdWN0SWQsIHZhcmlhbnRJZCwgcXVhbnRpdHkgfSA9IGJvZHlcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGl0ZW0gPSBhd2FpdCBwcmlzbWEuc3ZtQ2FydEl0ZW0uZmluZEZpcnN0KHtcbiAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgY2FydElkOiBjYXJ0LmlkLFxuICAgICAgICAgICAgcHJvZHVjdElkLFxuICAgICAgICAgICAgdmFyaWFudElkOiB2YXJpYW50SWQgfHwgbnVsbFxuICAgICAgICAgIH1cbiAgICAgICAgfSlcblxuICAgICAgICBpZiAoIWl0ZW0pIHtcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0l0ZW0gbm90IGZvdW5kIGluIGNhcnQnIH0sXG4gICAgICAgICAgICB7IHN0YXR1czogNDA0IH1cbiAgICAgICAgICApXG4gICAgICAgIH1cblxuICAgICAgICBpZiAocXVhbnRpdHkgPD0gMCkge1xuICAgICAgICAgIGF3YWl0IHByaXNtYS5zdm1DYXJ0SXRlbS5kZWxldGUoeyB3aGVyZTogeyBpZDogaXRlbS5pZCB9IH0pXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYXdhaXQgcHJpc21hLnN2bUNhcnRJdGVtLnVwZGF0ZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogaXRlbS5pZCB9LFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICBxdWFudGl0eSxcbiAgICAgICAgICAgICAgbGluZVRvdGFsOiBxdWFudGl0eSAqIE51bWJlcihpdGVtLnVuaXRQcmljZSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICAgIGJyZWFrXG4gICAgICB9XG5cbiAgICAgIGNhc2UgJ1JFTU9WRV9JVEVNJzoge1xuICAgICAgICBjb25zdCB7IHByb2R1Y3RJZCwgdmFyaWFudElkIH0gPSBib2R5XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBwcmlzbWEuc3ZtQ2FydEl0ZW0uZGVsZXRlTWFueSh7XG4gICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgIGNhcnRJZDogY2FydC5pZCxcbiAgICAgICAgICAgIHByb2R1Y3RJZCxcbiAgICAgICAgICAgIHZhcmlhbnRJZDogdmFyaWFudElkIHx8IG51bGxcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIGJyZWFrXG4gICAgICB9XG5cbiAgICAgIGNhc2UgJ0FQUExZX1BST01PJzoge1xuICAgICAgICBjb25zdCB7IHByb21vdGlvbkNvZGUgfSA9IGJvZHlcbiAgICAgICAgXG4gICAgICAgIGlmICghcHJvbW90aW9uQ29kZSkge1xuICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAncHJvbW90aW9uQ29kZSBpcyByZXF1aXJlZCcgfSxcbiAgICAgICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgICAgIClcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFZhbGlkYXRlIHByb21vdGlvbiBjb2RlXG4gICAgICAgIGNvbnN0IHByb21vdGlvbiA9IGF3YWl0IHByaXNtYS5zdm1Qcm9tb3Rpb24uZmluZEZpcnN0KHtcbiAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgdGVuYW50SWQsXG4gICAgICAgICAgICBjb2RlOiBwcm9tb3Rpb25Db2RlLnRvVXBwZXJDYXNlKCksXG4gICAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICAgIHN0YXJ0c0F0OiB7IGx0ZTogbmV3IERhdGUoKSB9LFxuICAgICAgICAgICAgT1I6IFtcbiAgICAgICAgICAgICAgeyBlbmRzQXQ6IG51bGwgfSxcbiAgICAgICAgICAgICAgeyBlbmRzQXQ6IHsgZ3RlOiBuZXcgRGF0ZSgpIH0gfVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcblxuICAgICAgICBpZiAoIXByb21vdGlvbikge1xuICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBvciBleHBpcmVkIHByb21vdGlvbiBjb2RlJyB9LFxuICAgICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICAgKVxuICAgICAgICB9XG5cbiAgICAgICAgYXdhaXQgcHJpc21hLnN2bUNhcnQudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZDogY2FydC5pZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHByb21vdGlvbkNvZGU6IHByb21vdGlvbkNvZGUudG9VcHBlckNhc2UoKSxcbiAgICAgICAgICAgIHByb21vdGlvbklkOiBwcm9tb3Rpb24uaWRcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIGJyZWFrXG4gICAgICB9XG5cbiAgICAgIGNhc2UgJ1JFTU9WRV9QUk9NTyc6IHtcbiAgICAgICAgYXdhaXQgcHJpc21hLnN2bUNhcnQudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZDogY2FydC5pZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHByb21vdGlvbkNvZGU6IG51bGwsXG4gICAgICAgICAgICBwcm9tb3Rpb25JZDogbnVsbCxcbiAgICAgICAgICAgIGRpc2NvdW50VG90YWw6IDBcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIGJyZWFrXG4gICAgICB9XG5cbiAgICAgIGNhc2UgJ1NFVF9TSElQUElORyc6IHtcbiAgICAgICAgY29uc3QgeyBzaGlwcGluZ0FkZHJlc3MsIHNoaXBwaW5nWm9uZUlkLCBzaGlwcGluZ1JhdGVJZCwgc2hpcHBpbmdNZXRob2QsIHNoaXBwaW5nVG90YWwgfSA9IGJvZHlcbiAgICAgICAgXG4gICAgICAgIGF3YWl0IHByaXNtYS5zdm1DYXJ0LnVwZGF0ZSh7XG4gICAgICAgICAgd2hlcmU6IHsgaWQ6IGNhcnQuaWQgfSxcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBzaGlwcGluZ0FkZHJlc3M6IHNoaXBwaW5nQWRkcmVzcyB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgICBzaGlwcGluZ1pvbmVJZDogc2hpcHBpbmdab25lSWQgfHwgbnVsbCxcbiAgICAgICAgICAgIHNoaXBwaW5nUmF0ZUlkOiBzaGlwcGluZ1JhdGVJZCB8fCBudWxsLFxuICAgICAgICAgICAgc2hpcHBpbmdNZXRob2Q6IHNoaXBwaW5nTWV0aG9kIHx8IG51bGwsXG4gICAgICAgICAgICBzaGlwcGluZ1RvdGFsOiBzaGlwcGluZ1RvdGFsID8/IDBcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIGJyZWFrXG4gICAgICB9XG5cbiAgICAgIGNhc2UgJ1NFVF9FTUFJTCc6IHtcbiAgICAgICAgY29uc3QgeyBlbWFpbDogY2FydEVtYWlsIH0gPSBib2R5XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBwcmlzbWEuc3ZtQ2FydC51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkOiBjYXJ0LmlkIH0sXG4gICAgICAgICAgZGF0YTogeyBlbWFpbDogY2FydEVtYWlsIH1cbiAgICAgICAgfSlcbiAgICAgICAgYnJlYWtcbiAgICAgIH1cblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBgVW5rbm93biBhY3Rpb246ICR7YWN0aW9ufWAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgKVxuICAgIH1cblxuICAgIC8vIFJlbG9hZCBjYXJ0IHdpdGggdXBkYXRlZCBpdGVtc1xuICAgIGNvbnN0IHVwZGF0ZWRDYXJ0ID0gYXdhaXQgcHJpc21hLnN2bUNhcnQuZmluZFVuaXF1ZSh7XG4gICAgICB3aGVyZTogeyBpZDogY2FydC5pZCB9LFxuICAgICAgaW5jbHVkZTogeyBpdGVtczogdHJ1ZSB9XG4gICAgfSlcblxuICAgIGlmICghdXBkYXRlZENhcnQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdDYXJ0IG5vdCBmb3VuZCBhZnRlciB1cGRhdGUnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIC8vIENhbGN1bGF0ZSB0b3RhbHNcbiAgICBjb25zdCBkaXNjb3VudFJhdGUgPSB1cGRhdGVkQ2FydC5wcm9tb3Rpb25Db2RlID8gMC4xIDogMCAvLyAxMCUgZm9yIHByb21vIGNvZGVzXG4gICAgY29uc3QgdG90YWxzID0gY2FsY3VsYXRlQ2FydFRvdGFscyh1cGRhdGVkQ2FydC5pdGVtcywgZGlzY291bnRSYXRlKVxuXG4gICAgLy8gVXBkYXRlIGNhcnQgdG90YWxzXG4gICAgYXdhaXQgcHJpc21hLnN2bUNhcnQudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiB1cGRhdGVkQ2FydC5pZCB9LFxuICAgICAgZGF0YToge1xuICAgICAgICBpdGVtQ291bnQ6IHRvdGFscy5pdGVtQ291bnQsXG4gICAgICAgIHN1YnRvdGFsOiB0b3RhbHMuc3VidG90YWwsXG4gICAgICAgIGRpc2NvdW50VG90YWw6IHRvdGFscy5kaXNjb3VudFRvdGFsLFxuICAgICAgICB0YXhUb3RhbDogdG90YWxzLnRheFRvdGFsLFxuICAgICAgICBncmFuZFRvdGFsOiB0b3RhbHMuZ3JhbmRUb3RhbCArIE51bWJlcih1cGRhdGVkQ2FydC5zaGlwcGluZ1RvdGFsKVxuICAgICAgfVxuICAgIH0pXG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGNhcnQ6IHtcbiAgICAgICAgaWQ6IHVwZGF0ZWRDYXJ0LmlkLFxuICAgICAgICB0ZW5hbnRJZDogdXBkYXRlZENhcnQudGVuYW50SWQsXG4gICAgICAgIGN1c3RvbWVySWQ6IHVwZGF0ZWRDYXJ0LmN1c3RvbWVySWQsXG4gICAgICAgIHNlc3Npb25JZDogdXBkYXRlZENhcnQuc2Vzc2lvbklkLFxuICAgICAgICBlbWFpbDogdXBkYXRlZENhcnQuZW1haWwsXG4gICAgICAgIGl0ZW1zOiB1cGRhdGVkQ2FydC5pdGVtcy5tYXAoaXRlbSA9PiAoe1xuICAgICAgICAgIHByb2R1Y3RJZDogaXRlbS5wcm9kdWN0SWQsXG4gICAgICAgICAgdmFyaWFudElkOiBpdGVtLnZhcmlhbnRJZCxcbiAgICAgICAgICBwcm9kdWN0TmFtZTogaXRlbS5wcm9kdWN0TmFtZSxcbiAgICAgICAgICB2YXJpYW50TmFtZTogaXRlbS52YXJpYW50TmFtZSxcbiAgICAgICAgICBza3U6IGl0ZW0uc2t1LFxuICAgICAgICAgIGltYWdlVXJsOiBpdGVtLmltYWdlVXJsLFxuICAgICAgICAgIHVuaXRQcmljZTogTnVtYmVyKGl0ZW0udW5pdFByaWNlKSxcbiAgICAgICAgICBxdWFudGl0eTogaXRlbS5xdWFudGl0eSxcbiAgICAgICAgICBsaW5lVG90YWw6IE51bWJlcihpdGVtLmxpbmVUb3RhbCksXG4gICAgICAgICAgZGlzY291bnRBbW91bnQ6IE51bWJlcihpdGVtLmRpc2NvdW50QW1vdW50KVxuICAgICAgICB9KSksXG4gICAgICAgIGl0ZW1Db3VudDogdG90YWxzLml0ZW1Db3VudCxcbiAgICAgICAgc3VidG90YWw6IHRvdGFscy5zdWJ0b3RhbCxcbiAgICAgICAgcHJvbW90aW9uQ29kZTogdXBkYXRlZENhcnQucHJvbW90aW9uQ29kZSxcbiAgICAgICAgZGlzY291bnRUb3RhbDogdG90YWxzLmRpc2NvdW50VG90YWwsXG4gICAgICAgIHNoaXBwaW5nVG90YWw6IE51bWJlcih1cGRhdGVkQ2FydC5zaGlwcGluZ1RvdGFsKSxcbiAgICAgICAgc2hpcHBpbmdNZXRob2Q6IHVwZGF0ZWRDYXJ0LnNoaXBwaW5nTWV0aG9kLFxuICAgICAgICB0YXhUb3RhbDogdG90YWxzLnRheFRvdGFsLFxuICAgICAgICBncmFuZFRvdGFsOiB0b3RhbHMuZ3JhbmRUb3RhbCArIE51bWJlcih1cGRhdGVkQ2FydC5zaGlwcGluZ1RvdGFsKSxcbiAgICAgICAgc2hpcHBpbmdBZGRyZXNzOiB1cGRhdGVkQ2FydC5zaGlwcGluZ0FkZHJlc3MsXG4gICAgICAgIGNyZWF0ZWRBdDogdXBkYXRlZENhcnQuY3JlYXRlZEF0LnRvSVNPU3RyaW5nKCksXG4gICAgICAgIHVwZGF0ZWRBdDogdXBkYXRlZENhcnQudXBkYXRlZEF0LnRvSVNPU3RyaW5nKClcbiAgICAgIH1cbiAgICB9KVxuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1NWTSBDYXJ0XSBFcnJvciB1cGRhdGluZyBjYXJ0OicsIGVycm9yKVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApXG4gIH1cbn1cblxuLyoqXG4gKiBHRVQgL2FwaS9zdm0vY2FydFxuICogUmV0cmlldmUgY2FydCBieSBjdXN0b21lcklkIG9yIHNlc3Npb25JZFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBzZWFyY2hQYXJhbXMgfSA9IG5ldyBVUkwocmVxdWVzdC51cmwpXG4gICAgY29uc3QgdGVuYW50SWQgPSBzZWFyY2hQYXJhbXMuZ2V0KCd0ZW5hbnRJZCcpXG4gICAgY29uc3QgY3VzdG9tZXJJZCA9IHNlYXJjaFBhcmFtcy5nZXQoJ2N1c3RvbWVySWQnKVxuICAgIGNvbnN0IHNlc3Npb25JZCA9IHNlYXJjaFBhcmFtcy5nZXQoJ3Nlc3Npb25JZCcpXG5cbiAgICBpZiAoIXRlbmFudElkKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAndGVuYW50SWQgaXMgcmVxdWlyZWQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIGlmICghY3VzdG9tZXJJZCAmJiAhc2Vzc2lvbklkKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRWl0aGVyIGN1c3RvbWVySWQgb3Igc2Vzc2lvbklkIGlzIHJlcXVpcmVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICAvLyBGaW5kIGFjdGl2ZSBjYXJ0XG4gICAgY29uc3QgY2FydCA9IGF3YWl0IHByaXNtYS5zdm1DYXJ0LmZpbmRGaXJzdCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICB0ZW5hbnRJZCxcbiAgICAgICAgc3RhdHVzOiAnQUNUSVZFJyxcbiAgICAgICAgT1I6IFtcbiAgICAgICAgICBjdXN0b21lcklkID8geyBjdXN0b21lcklkIH0gOiB7fSxcbiAgICAgICAgICBzZXNzaW9uSWQgPyB7IHNlc3Npb25JZCB9IDoge31cbiAgICAgICAgXS5maWx0ZXIobyA9PiBPYmplY3Qua2V5cyhvKS5sZW5ndGggPiAwKVxuICAgICAgfSxcbiAgICAgIGluY2x1ZGU6IHsgaXRlbXM6IHRydWUgfVxuICAgIH0pXG5cbiAgICBpZiAoIWNhcnQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGNhcnQ6IHtcbiAgICAgICAgICBpZDogbnVsbCxcbiAgICAgICAgICB0ZW5hbnRJZCxcbiAgICAgICAgICBjdXN0b21lcklkLFxuICAgICAgICAgIHNlc3Npb25JZCxcbiAgICAgICAgICBlbWFpbDogbnVsbCxcbiAgICAgICAgICBpdGVtczogW10sXG4gICAgICAgICAgaXRlbUNvdW50OiAwLFxuICAgICAgICAgIHN1YnRvdGFsOiAwLFxuICAgICAgICAgIHByb21vdGlvbkNvZGU6IG51bGwsXG4gICAgICAgICAgZGlzY291bnRUb3RhbDogMCxcbiAgICAgICAgICBzaGlwcGluZ1RvdGFsOiAwLFxuICAgICAgICAgIHNoaXBwaW5nTWV0aG9kOiBudWxsLFxuICAgICAgICAgIHRheFRvdGFsOiAwLFxuICAgICAgICAgIGdyYW5kVG90YWw6IDAsXG4gICAgICAgICAgc2hpcHBpbmdBZGRyZXNzOiBudWxsXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBjYXJ0OiB7XG4gICAgICAgIGlkOiBjYXJ0LmlkLFxuICAgICAgICB0ZW5hbnRJZDogY2FydC50ZW5hbnRJZCxcbiAgICAgICAgY3VzdG9tZXJJZDogY2FydC5jdXN0b21lcklkLFxuICAgICAgICBzZXNzaW9uSWQ6IGNhcnQuc2Vzc2lvbklkLFxuICAgICAgICBlbWFpbDogY2FydC5lbWFpbCxcbiAgICAgICAgaXRlbXM6IGNhcnQuaXRlbXMubWFwKGl0ZW0gPT4gKHtcbiAgICAgICAgICBwcm9kdWN0SWQ6IGl0ZW0ucHJvZHVjdElkLFxuICAgICAgICAgIHZhcmlhbnRJZDogaXRlbS52YXJpYW50SWQsXG4gICAgICAgICAgcHJvZHVjdE5hbWU6IGl0ZW0ucHJvZHVjdE5hbWUsXG4gICAgICAgICAgdmFyaWFudE5hbWU6IGl0ZW0udmFyaWFudE5hbWUsXG4gICAgICAgICAgc2t1OiBpdGVtLnNrdSxcbiAgICAgICAgICBpbWFnZVVybDogaXRlbS5pbWFnZVVybCxcbiAgICAgICAgICB1bml0UHJpY2U6IE51bWJlcihpdGVtLnVuaXRQcmljZSksXG4gICAgICAgICAgcXVhbnRpdHk6IGl0ZW0ucXVhbnRpdHksXG4gICAgICAgICAgbGluZVRvdGFsOiBOdW1iZXIoaXRlbS5saW5lVG90YWwpLFxuICAgICAgICAgIGRpc2NvdW50QW1vdW50OiBOdW1iZXIoaXRlbS5kaXNjb3VudEFtb3VudClcbiAgICAgICAgfSkpLFxuICAgICAgICBpdGVtQ291bnQ6IE51bWJlcihjYXJ0Lml0ZW1Db3VudCksXG4gICAgICAgIHN1YnRvdGFsOiBOdW1iZXIoY2FydC5zdWJ0b3RhbCksXG4gICAgICAgIHByb21vdGlvbkNvZGU6IGNhcnQucHJvbW90aW9uQ29kZSxcbiAgICAgICAgZGlzY291bnRUb3RhbDogTnVtYmVyKGNhcnQuZGlzY291bnRUb3RhbCksXG4gICAgICAgIHNoaXBwaW5nVG90YWw6IE51bWJlcihjYXJ0LnNoaXBwaW5nVG90YWwpLFxuICAgICAgICBzaGlwcGluZ01ldGhvZDogY2FydC5zaGlwcGluZ01ldGhvZCxcbiAgICAgICAgdGF4VG90YWw6IE51bWJlcihjYXJ0LnRheFRvdGFsKSxcbiAgICAgICAgZ3JhbmRUb3RhbDogTnVtYmVyKGNhcnQuZ3JhbmRUb3RhbCksXG4gICAgICAgIHNoaXBwaW5nQWRkcmVzczogY2FydC5zaGlwcGluZ0FkZHJlc3MsXG4gICAgICAgIGNyZWF0ZWRBdDogY2FydC5jcmVhdGVkQXQudG9JU09TdHJpbmcoKSxcbiAgICAgICAgdXBkYXRlZEF0OiBjYXJ0LnVwZGF0ZWRBdC50b0lTT1N0cmluZygpXG4gICAgICB9XG4gICAgfSlcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tTVk0gQ2FydF0gRXJyb3IgZmV0Y2hpbmcgY2FydDonLCBlcnJvcilcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgIClcbiAgfVxufVxuXG4vKipcbiAqIERFTEVURSAvYXBpL3N2bS9jYXJ0XG4gKiBDbGVhciBjYXJ0IGNvbnRlbnRzIG9yIG1hcmsgYXMgYWJhbmRvbmVkXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBERUxFVEUocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybClcbiAgICBsZXQgdGVuYW50SWQgPSBzZWFyY2hQYXJhbXMuZ2V0KCd0ZW5hbnRJZCcpXG4gICAgbGV0IGN1c3RvbWVySWQgPSBzZWFyY2hQYXJhbXMuZ2V0KCdjdXN0b21lcklkJylcbiAgICBsZXQgc2Vzc2lvbklkID0gc2VhcmNoUGFyYW1zLmdldCgnc2Vzc2lvbklkJylcbiAgICBsZXQgbWFya0FiYW5kb25lZCA9IHNlYXJjaFBhcmFtcy5nZXQoJ21hcmtBYmFuZG9uZWQnKSA9PT0gJ3RydWUnXG5cbiAgICAvLyBJZiBub3QgaW4gcXVlcnkgcGFyYW1zLCB0cnkgYm9keVxuICAgIGlmICghdGVuYW50SWQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKVxuICAgICAgICB0ZW5hbnRJZCA9IGJvZHkudGVuYW50SWRcbiAgICAgICAgY3VzdG9tZXJJZCA9IGJvZHkuY3VzdG9tZXJJZFxuICAgICAgICBzZXNzaW9uSWQgPSBib2R5LnNlc3Npb25JZFxuICAgICAgICBtYXJrQWJhbmRvbmVkID0gYm9keS5tYXJrQWJhbmRvbmVkIHx8IGZhbHNlXG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgLy8gQm9keSBwYXJzZSBmYWlsZWRcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIXRlbmFudElkIHx8ICghY3VzdG9tZXJJZCAmJiAhc2Vzc2lvbklkKSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ3RlbmFudElkIGFuZCBlaXRoZXIgY3VzdG9tZXJJZCBvciBzZXNzaW9uSWQgYXJlIHJlcXVpcmVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBjYXJ0ID0gYXdhaXQgcHJpc21hLnN2bUNhcnQuZmluZEZpcnN0KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIHRlbmFudElkLFxuICAgICAgICBzdGF0dXM6ICdBQ1RJVkUnLFxuICAgICAgICBPUjogW1xuICAgICAgICAgIGN1c3RvbWVySWQgPyB7IGN1c3RvbWVySWQgfSA6IHt9LFxuICAgICAgICAgIHNlc3Npb25JZCA/IHsgc2Vzc2lvbklkIH0gOiB7fVxuICAgICAgICBdLmZpbHRlcihvID0+IE9iamVjdC5rZXlzKG8pLmxlbmd0aCA+IDApXG4gICAgICB9XG4gICAgfSlcblxuICAgIGlmIChjYXJ0KSB7XG4gICAgICBpZiAobWFya0FiYW5kb25lZCkge1xuICAgICAgICAvLyBNYXJrIGFzIGFiYW5kb25lZCBmb3IgcG90ZW50aWFsIHJlY292ZXJ5XG4gICAgICAgIGF3YWl0IHByaXNtYS5zdm1DYXJ0LnVwZGF0ZSh7XG4gICAgICAgICAgd2hlcmU6IHsgaWQ6IGNhcnQuaWQgfSxcbiAgICAgICAgICBkYXRhOiB7IHN0YXR1czogJ0FCQU5ET05FRCcgfVxuICAgICAgICB9KVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRGVsZXRlIGNhcnQgYW5kIGl0ZW1zXG4gICAgICAgIGF3YWl0IHByaXNtYS5zdm1DYXJ0SXRlbS5kZWxldGVNYW55KHsgd2hlcmU6IHsgY2FydElkOiBjYXJ0LmlkIH0gfSlcbiAgICAgICAgYXdhaXQgcHJpc21hLnN2bUNhcnQuZGVsZXRlKHsgd2hlcmU6IHsgaWQ6IGNhcnQuaWQgfSB9KVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogbWFya0FiYW5kb25lZCA/ICdDYXJ0IG1hcmtlZCBhcyBhYmFuZG9uZWQnIDogJ0NhcnQgY2xlYXJlZCdcbiAgICB9KVxuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1NWTSBDYXJ0XSBFcnJvciBjbGVhcmluZyBjYXJ0OicsIGVycm9yKVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJQcmlzbWFDbGllbnQiLCJwcmlzbWEiLCJnZW5lcmF0ZUNhcnRJZCIsIkRhdGUiLCJub3ciLCJ0b1N0cmluZyIsIk1hdGgiLCJyYW5kb20iLCJzdWJzdHJpbmciLCJjYWxjdWxhdGVDYXJ0VG90YWxzIiwiaXRlbXMiLCJkaXNjb3VudFJhdGUiLCJpdGVtQ291bnQiLCJyZWR1Y2UiLCJzdW0iLCJpdGVtIiwicXVhbnRpdHkiLCJzdWJ0b3RhbCIsIk51bWJlciIsImxpbmVUb3RhbCIsImRpc2NvdW50VG90YWwiLCJ0YXhUb3RhbCIsImdyYW5kVG90YWwiLCJQT1NUIiwicmVxdWVzdCIsImJvZHkiLCJqc29uIiwidGVuYW50SWQiLCJjdXN0b21lcklkIiwic2Vzc2lvbklkIiwiYWN0aW9uIiwiZW1haWwiLCJzdWNjZXNzIiwiZXJyb3IiLCJzdGF0dXMiLCJjYXJ0Iiwic3ZtQ2FydCIsImZpbmRGaXJzdCIsIndoZXJlIiwiT1IiLCJ1bmRlZmluZWQiLCJmaWx0ZXIiLCJCb29sZWFuIiwiaW5jbHVkZSIsInNlc3Npb25DYXJ0IiwidXBkYXRlIiwiaWQiLCJkYXRhIiwiY3JlYXRlIiwiZXhwaXJlc0F0IiwicHJvZHVjdElkIiwidmFyaWFudElkIiwicHJvZHVjdE5hbWUiLCJ2YXJpYW50TmFtZSIsInNrdSIsImltYWdlVXJsIiwidW5pdFByaWNlIiwiZXhpc3RpbmdJdGVtIiwic3ZtQ2FydEl0ZW0iLCJjYXJ0SWQiLCJkZWxldGUiLCJkZWxldGVNYW55IiwicHJvbW90aW9uQ29kZSIsInByb21vdGlvbiIsInN2bVByb21vdGlvbiIsImNvZGUiLCJ0b1VwcGVyQ2FzZSIsImlzQWN0aXZlIiwic3RhcnRzQXQiLCJsdGUiLCJlbmRzQXQiLCJndGUiLCJwcm9tb3Rpb25JZCIsInNoaXBwaW5nQWRkcmVzcyIsInNoaXBwaW5nWm9uZUlkIiwic2hpcHBpbmdSYXRlSWQiLCJzaGlwcGluZ01ldGhvZCIsInNoaXBwaW5nVG90YWwiLCJjYXJ0RW1haWwiLCJ1cGRhdGVkQ2FydCIsImZpbmRVbmlxdWUiLCJ0b3RhbHMiLCJtYXAiLCJkaXNjb3VudEFtb3VudCIsImNyZWF0ZWRBdCIsInRvSVNPU3RyaW5nIiwidXBkYXRlZEF0IiwiY29uc29sZSIsIkVycm9yIiwibWVzc2FnZSIsIkdFVCIsInNlYXJjaFBhcmFtcyIsIlVSTCIsInVybCIsImdldCIsIm8iLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwiREVMRVRFIiwibWFya0FiYW5kb25lZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/svm/cart/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsvm%2Fcart%2Froute&page=%2Fapi%2Fsvm%2Fcart%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsvm%2Fcart%2Froute.ts&appDir=%2Fapp%2Fsaas-core%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp%2Fsaas-core&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();