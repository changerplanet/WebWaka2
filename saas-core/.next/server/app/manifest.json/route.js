"use strict";(()=>{var e={};e.id=496,e.ids=[496],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4535:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>f,patchFetch:()=>g,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var a={};n.r(a),n.d(a,{GET:()=>u});var o=n(9303),r=n(8716),i=n(670),s=n(7070),l=n(2315);async function u(e){try{let{searchParams:t}=new URL(e.url),n=t.get("tenant"),a=e.headers.get("host")||"",o={id:"default",name:"SaaS Core",slug:"default",appName:"SaaS Core",shortName:"SaaS",description:"Multi-Tenant SaaS Platform",primaryColor:"#6366f1",secondaryColor:"#8b5cf6",backgroundColor:"#ffffff",logoUrl:null,faviconUrl:null,updatedAt:new Date().toISOString()},r=null;if(n?r=await (0,l.G_)(n):a&&(r=await (0,l.FZ)(a)),r){let e=r.tenant;o={id:e.id,name:e.name,slug:e.slug,appName:e.appName,shortName:e.appName.substring(0,12),description:`${e.appName} - Powered by SaaS Core`,primaryColor:e.primaryColor,secondaryColor:e.secondaryColor,backgroundColor:"#ffffff",logoUrl:e.logoUrl,faviconUrl:e.faviconUrl,updatedAt:e.updatedAt.toISOString()}}let i={name:o.appName,short_name:o.shortName,description:o.description,start_url:`/?tenant=${o.slug}`,scope:"/",display:"standalone",orientation:"portrait-primary",background_color:o.backgroundColor,theme_color:o.primaryColor,icons:[{src:o.faviconUrl||`/api/icons/icon-72?tenant=${o.slug}`,sizes:"72x72",type:"image/png",purpose:"any"},{src:o.faviconUrl||`/api/icons/icon-96?tenant=${o.slug}`,sizes:"96x96",type:"image/png",purpose:"any"},{src:o.faviconUrl||`/api/icons/icon-128?tenant=${o.slug}`,sizes:"128x128",type:"image/png",purpose:"any"},{src:o.faviconUrl||`/api/icons/icon-144?tenant=${o.slug}`,sizes:"144x144",type:"image/png",purpose:"any"},{src:o.faviconUrl||`/api/icons/icon-152?tenant=${o.slug}`,sizes:"152x152",type:"image/png",purpose:"any"},{src:o.faviconUrl||`/api/icons/icon-192?tenant=${o.slug}`,sizes:"192x192",type:"image/png",purpose:"any maskable"},{src:o.faviconUrl||`/api/icons/icon-384?tenant=${o.slug}`,sizes:"384x384",type:"image/png",purpose:"any"},{src:o.faviconUrl||`/api/icons/icon-512?tenant=${o.slug}`,sizes:"512x512",type:"image/png",purpose:"any maskable"}],categories:["business","productivity"],shortcuts:[{name:"Dashboard",short_name:"Dashboard",url:`/dashboard?tenant=${o.slug}`,icons:[{src:`/api/icons/icon-96?tenant=${o.slug}`,sizes:"96x96"}]}],screenshots:[],related_applications:[],prefer_related_applications:!1,_tenant:{id:o.id,slug:o.slug,primaryColor:o.primaryColor,secondaryColor:o.secondaryColor}},u=`"${o.id}-${new Date(o.updatedAt).getTime()}"`;if(e.headers.get("if-none-match")===u)return new s.NextResponse(null,{status:304});return s.NextResponse.json(i,{headers:{"Content-Type":"application/manifest+json","Cache-Control":"private, max-age=3600, must-revalidate",ETag:u,Vary:"Host","Access-Control-Allow-Origin":"*"}})}catch(e){return console.error("Failed to generate manifest:",e),s.NextResponse.json({name:"SaaS Core",short_name:"SaaS",start_url:"/",display:"standalone",theme_color:"#6366f1",background_color:"#ffffff",icons:[]},{status:200,headers:{"Content-Type":"application/manifest+json","Cache-Control":"no-cache"}})}}let p=new o.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/manifest.json/route",pathname:"/manifest.json",filename:"route",bundlePath:"app/manifest.json/route"},resolvedPagePath:"/app/saas-core/src/app/manifest.json/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:c,staticGenerationAsyncStorage:d,serverHooks:m}=p,f="/manifest.json/route";function g(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}},6238:(e,t,n)=>{n.d(t,{xW:()=>u,eE:()=>l,KS:()=>c,qk:()=>s,_B:()=>m,G0:()=>p,ah:()=>d});var a=n(3524);let o=["TenantMembership","TenantDomain","AuditLog"],r=[];function i(e){let t={...e,timestamp:new Date};r.push(t),r.length>1e3&&r.shift(),console.error("[TENANT ISOLATION VIOLATION]",JSON.stringify(t,null,2))}function s(){return[...r]}function l(){r.length=0}class u extends Error{constructor(e,t,n,a){super(e),this.model=t,this.action=n,this.context=a,this.name="TenantIsolationError"}}function p(e,t,n,a){if(o.includes(e)){if(n?.bypassIsolation===!0){if(!n.isSuperAdmin){let o="Bypass isolation attempted without SUPER_ADMIN role";throw i({model:e,action:t,context:n,query:{queryTenantId:a},reason:o}),new u(o,e,t,n)}return}if(!n?.isSuperAdmin){if(!n){let o="No tenant context provided for tenant-scoped query";throw i({model:e,action:t,context:n,query:{queryTenantId:a},reason:o}),new u(o,e,t,n)}if(!n.tenantId){let o="No tenantId in context for tenant-scoped query";throw i({model:e,action:t,context:n,query:{queryTenantId:a},reason:o}),new u(o,e,t,n)}if(a&&a!==n.tenantId){let o=`Cross-tenant access attempt: query tenantId (${a}) != context tenantId (${n.tenantId})`;throw i({model:e,action:t,context:n,query:{queryTenantId:a},reason:o}),new u(o,e,t,n)}}}}function c(e,t,n,a=!1){return{tenantId:e,userId:t,isSuperAdmin:n,bypassIsolation:a}}function d(e,t){return{...e,tenantId:t}}let m=globalThis.prisma??new a.PrismaClient({log:["error"]})},2315:(e,t,n)=>{n.d(t,{FZ:()=>o,G_:()=>r});var a=n(6238);async function o(e){let t=e.split(":")[0].toLowerCase(),n=await a._B.tenantDomain.findFirst({where:{domain:t,type:"CUSTOM",status:"VERIFIED"},include:{tenant:{include:{domains:!0}}}});if(n&&"ACTIVE"===n.tenant.status)return{tenant:n.tenant,resolvedVia:"custom_domain",domain:t};let o=t.split(".");if(o.length>=3){let e=o[0];if(!["www","api","app","admin","preview","localhost"].includes(e)){let t=await a._B.tenantDomain.findFirst({where:{domain:e,type:"SUBDOMAIN",status:"VERIFIED"},include:{tenant:{include:{domains:!0}}}});if(t&&"ACTIVE"===t.tenant.status)return{tenant:t.tenant,resolvedVia:"subdomain",domain:e};let n=await a._B.tenant.findFirst({where:{slug:e,status:"ACTIVE"},include:{domains:!0}});if(n)return{tenant:n,resolvedVia:"subdomain",domain:e}}}return null}async function r(e){let t=await a._B.tenantDomain.findFirst({where:{domain:e.toLowerCase(),type:"SUBDOMAIN"},include:{tenant:{include:{domains:!0}}}});if(t&&"ACTIVE"===t.tenant.status)return{tenant:t.tenant,resolvedVia:"query",domain:e};let n=await a._B.tenant.findFirst({where:{slug:e.toLowerCase(),status:"ACTIVE"},include:{domains:!0}});return n?{tenant:n,resolvedVia:"query",domain:e}:null}}};var t=require("../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),a=t.X(0,[380,972],()=>n(4535));module.exports=a})();