"use strict";(()=>{var e={};e.id=1496,e.ids=[1496],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},34535:(e,n,t)=>{t.r(n),t.d(n,{originalPathname:()=>f,patchFetch:()=>g,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var a={};t.r(a),t.d(a,{GET:()=>u});var o=t(49303),r=t(88716),i=t(60670),s=t(87070),l=t(32315);async function u(e){try{let{searchParams:n}=new URL(e.url),t=n.get("tenant"),a=e.headers.get("host")||"",o={id:"default",name:"SaaS Core",slug:"default",appName:"SaaS Core",shortName:"SaaS",description:"Multi-Tenant SaaS Platform",primaryColor:"#6366f1",secondaryColor:"#8b5cf6",backgroundColor:"#ffffff",logoUrl:null,faviconUrl:null,updatedAt:new Date().toISOString()},r=null;if(t?r=await (0,l.G_)(t):a&&(r=await (0,l.FZ)(a)),r){let e=r.tenant;o={id:e.id,name:e.name,slug:e.slug,appName:e.appName,shortName:e.appName.substring(0,12),description:`${e.appName} - Powered by SaaS Core`,primaryColor:e.primaryColor,secondaryColor:e.secondaryColor,backgroundColor:"#ffffff",logoUrl:e.logoUrl,faviconUrl:e.faviconUrl,updatedAt:e.updatedAt.toISOString()}}let i={name:o.appName,short_name:o.shortName,description:o.description,start_url:`/?tenant=${o.slug}`,scope:"/",display:"standalone",orientation:"portrait-primary",background_color:o.backgroundColor,theme_color:o.primaryColor,icons:[{src:o.faviconUrl||`/api/icons/icon-72?tenant=${o.slug}`,sizes:"72x72",type:"image/png",purpose:"any"},{src:o.faviconUrl||`/api/icons/icon-96?tenant=${o.slug}`,sizes:"96x96",type:"image/png",purpose:"any"},{src:o.faviconUrl||`/api/icons/icon-128?tenant=${o.slug}`,sizes:"128x128",type:"image/png",purpose:"any"},{src:o.faviconUrl||`/api/icons/icon-144?tenant=${o.slug}`,sizes:"144x144",type:"image/png",purpose:"any"},{src:o.faviconUrl||`/api/icons/icon-152?tenant=${o.slug}`,sizes:"152x152",type:"image/png",purpose:"any"},{src:o.faviconUrl||`/api/icons/icon-192?tenant=${o.slug}`,sizes:"192x192",type:"image/png",purpose:"any maskable"},{src:o.faviconUrl||`/api/icons/icon-384?tenant=${o.slug}`,sizes:"384x384",type:"image/png",purpose:"any"},{src:o.faviconUrl||`/api/icons/icon-512?tenant=${o.slug}`,sizes:"512x512",type:"image/png",purpose:"any maskable"}],categories:["business","productivity"],shortcuts:[{name:"Dashboard",short_name:"Dashboard",url:`/dashboard?tenant=${o.slug}`,icons:[{src:`/api/icons/icon-96?tenant=${o.slug}`,sizes:"96x96"}]}],screenshots:[],related_applications:[],prefer_related_applications:!1,_tenant:{id:o.id,slug:o.slug,primaryColor:o.primaryColor,secondaryColor:o.secondaryColor}},u=`"${o.id}-${new Date(o.updatedAt).getTime()}"`;if(e.headers.get("if-none-match")===u)return new s.NextResponse(null,{status:304});return s.NextResponse.json(i,{headers:{"Content-Type":"application/manifest+json","Cache-Control":"private, max-age=3600, must-revalidate",ETag:u,Vary:"Host","Access-Control-Allow-Origin":"*"}})}catch(e){return console.error("Failed to generate manifest:",e),s.NextResponse.json({name:"SaaS Core",short_name:"SaaS",start_url:"/",display:"standalone",theme_color:"#6366f1",background_color:"#ffffff",icons:[]},{status:200,headers:{"Content-Type":"application/manifest+json","Cache-Control":"no-cache"}})}}let p=new o.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/manifest.json/route",pathname:"/manifest.json",filename:"route",bundlePath:"app/manifest.json/route"},resolvedPagePath:"/app/saas-core/src/app/manifest.json/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:c,staticGenerationAsyncStorage:d,serverHooks:m}=p,f="/manifest.json/route";function g(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}},56238:(e,n,t)=>{t.d(n,{xW:()=>u,eE:()=>l,KS:()=>c,qk:()=>s,_B:()=>m,G0:()=>p,ah:()=>d});var a=t(53524);let o=["TenantMembership","TenantDomain","AuditLog"],r=[];function i(e){let n={...e,timestamp:new Date};r.push(n),r.length>1e3&&r.shift(),console.error("[TENANT ISOLATION VIOLATION]",JSON.stringify(n,null,2))}function s(){return[...r]}function l(){r.length=0}class u extends Error{constructor(e,n,t,a){super(e),this.model=n,this.action=t,this.context=a,this.name="TenantIsolationError"}}function p(e,n,t,a){if(o.includes(e)){if(t?.bypassIsolation===!0){if(!t.isSuperAdmin){let o="Bypass isolation attempted without SUPER_ADMIN role";throw i({model:e,action:n,context:t,query:{queryTenantId:a},reason:o}),new u(o,e,n,t)}return}if(!t?.isSuperAdmin){if(!t){let o="No tenant context provided for tenant-scoped query";throw i({model:e,action:n,context:t,query:{queryTenantId:a},reason:o}),new u(o,e,n,t)}if(!t.tenantId){let o="No tenantId in context for tenant-scoped query";throw i({model:e,action:n,context:t,query:{queryTenantId:a},reason:o}),new u(o,e,n,t)}if(a&&a!==t.tenantId){let o=`Cross-tenant access attempt: query tenantId (${a}) != context tenantId (${t.tenantId})`;throw i({model:e,action:n,context:t,query:{queryTenantId:a},reason:o}),new u(o,e,n,t)}}}}function c(e,n,t,a=!1){return{tenantId:e,userId:n,isSuperAdmin:t,bypassIsolation:a}}function d(e,n){return{...e,tenantId:n}}let m=globalThis.prisma??new a.PrismaClient({log:["error"]})},32315:(e,n,t)=>{t.d(n,{FZ:()=>o,G_:()=>r,sP:()=>i});var a=t(56238);async function o(e){let n=e.split(":")[0].toLowerCase(),t=await a._B.tenantDomain.findFirst({where:{domain:n,type:"CUSTOM",status:"VERIFIED"},include:{tenant:{include:{domains:!0}}}});if(t&&"ACTIVE"===t.tenant.status)return{tenant:t.tenant,resolvedVia:"custom_domain",domain:n};let o=n.split(".");if(o.length>=3){let e=o[0];if(!["www","api","app","admin","preview","localhost"].includes(e)){let n=await a._B.tenantDomain.findFirst({where:{domain:e,type:"SUBDOMAIN",status:"VERIFIED"},include:{tenant:{include:{domains:!0}}}});if(n&&"ACTIVE"===n.tenant.status)return{tenant:n.tenant,resolvedVia:"subdomain",domain:e};let t=await a._B.tenant.findFirst({where:{slug:e,status:"ACTIVE"},include:{domains:!0}});if(t)return{tenant:t,resolvedVia:"subdomain",domain:e}}}return null}async function r(e){let n=await a._B.tenantDomain.findFirst({where:{domain:e.toLowerCase(),type:"SUBDOMAIN"},include:{tenant:{include:{domains:!0}}}});if(n&&"ACTIVE"===n.tenant.status)return{tenant:n.tenant,resolvedVia:"query",domain:e};let t=await a._B.tenant.findFirst({where:{slug:e.toLowerCase(),status:"ACTIVE"},include:{domains:!0}});return t?{tenant:t,resolvedVia:"query",domain:e}:null}let i=async function(e){return a._B.tenant.findUnique({where:{slug:e},include:{domains:!0}})}}};var n=require("../../webpack-runtime.js");n.C(e);var t=e=>n(n.s=e),a=n.X(0,[9380,5972],()=>t(34535));module.exports=a})();