Authorized. Below is the exact Replit execution prompt for Wave C1 ‚Äî Receipt Integration (SVM + MVM + ParkHub Parity), written to enforce strict scope control, schema discipline, and a hard stop for verification.

This prompt is intentionally explicit and non-negotiable.

‚∏ª

üî¥ REPLIT EXECUTION PROMPT

WAVE C1 ‚Äî RECEIPT INTEGRATION (SVM + MVM + PARKHUB PARITY)

üîí WAVE CLASSIFICATION
	‚Ä¢	Wave: C1
	‚Ä¢	Band: Commerce Completeness (Revenue-Critical)
	‚Ä¢	Mode: IMPLEMENTATION (Schema + Logic + UI where required)
	‚Ä¢	Stop Discipline: HARD STOP REQUIRED AFTER COMPLETION
	‚Ä¢	Verification Mandatory: YES

‚∏ª

üéØ OBJECTIVE (NON-NEGOTIABLE)

Bring full receipt parity to SVM and MVM, matching the existing POS/ParkHub receipt system, while preserving backward compatibility and tenant isolation.

After this wave:
	‚Ä¢	Every paid SVM order must have a verifiable receipt
	‚Ä¢	Every paid MVM parent order must have a verifiable receipt
	‚Ä¢	ParkHub receipts must be mandatory where payment exists
	‚Ä¢	Receipts must support:
	‚Ä¢	Verification
	‚Ä¢	WhatsApp / Email delivery
	‚Ä¢	Canonical proof traversal

‚∏ª

üö´ ABSOLUTE CONSTRAINTS

Replit MUST NOT:
	1.	Modify or weaken tenant isolation
	2.	Introduce background jobs beyond receipt delivery already used by POS/ParkHub
	3.	Change payment execution logic
	4.	Alter order state machines
	5.	Add audit trails or immutability (reserved for Wave D)
	6.	Invent new receipt concepts outside the existing receipt system
	7.	Auto-generate receipts for unpaid orders
	8.	Proceed to another wave after completion

‚∏ª

üß± SCOPE OF WORK (REQUIRED)

1Ô∏è‚É£ SCHEMA EXTENSIONS (REQUIRED)

Receipt Source Types
	‚Ä¢	Extend receipt system to support:
	‚Ä¢	SVM_ORDER
	‚Ä¢	MVM_PARENT_ORDER

Order Linkage
Add nullable foreign keys:
	‚Ä¢	svm_orders.receiptId
	‚Ä¢	mvm_parent_order.receiptId

Rules:
	‚Ä¢	Receipt IDs are written once (on payment success)
	‚Ä¢	No retroactive backfills in this wave

‚∏ª

2Ô∏è‚É£ RECEIPT GENERATION LOGIC

Trigger Conditions
	‚Ä¢	Receipt is generated ONLY WHEN:
	‚Ä¢	Payment status transitions to PAID / CAPTURED
	‚Ä¢	OR COD order is confirmed (explicit path)

Systems:

System	Receipt Required	Notes
SVM	‚úÖ Mandatory	New
MVM	‚úÖ Mandatory (parent order only)	Vendors rely on parent receipt
ParkHub	‚úÖ Mandatory when payment exists	Enforce consistency


‚∏ª

3Ô∏è‚É£ RECEIPT CONTENT PARITY

Receipts must include:
	‚Ä¢	Receipt number (existing format)
	‚Ä¢	Order reference
	‚Ä¢	Tenant branding
	‚Ä¢	Customer name
	‚Ä¢	Items summary
	‚Ä¢	Total amount
	‚Ä¢	Payment method
	‚Ä¢	Timestamp
	‚Ä¢	Verification QR / link

Do NOT invent new fields.

‚∏ª

4Ô∏è‚É£ DELIVERY CHANNELS

Use existing receipt delivery infrastructure:
	‚Ä¢	WhatsApp (if phone exists)
	‚Ä¢	Email (if email exists)
	‚Ä¢	Thermal print remains POS-only

Failures:
	‚Ä¢	Must be logged
	‚Ä¢	No retry logic in this wave (document only)

‚∏ª

5Ô∏è‚É£ PROOF SYSTEM INTEGRATION

Update canonical proof traversal so:
	‚Ä¢	getProofByOrder() works for:
	‚Ä¢	SVM orders
	‚Ä¢	MVM parent orders
	‚Ä¢	Receipt verification resolves:
	‚Ä¢	Order ‚Üí Receipt
	‚Ä¢	Receipt ‚Üí Order

‚∏ª

6Ô∏è‚É£ UI / PUBLIC SURFACES (MINIMAL)
	‚Ä¢	Customer order pages should:
	‚Ä¢	Display receipt link if available
	‚Ä¢	No new dashboards
	‚Ä¢	No redesign work

‚∏ª

üß™ VERIFICATION REQUIREMENTS (MANDATORY)

Replit MUST verify all of the following:

Functional Checks
	‚Ä¢	Paid SVM order generates receipt
	‚Ä¢	Paid MVM order generates receipt
	‚Ä¢	Receipt verification works publicly
	‚Ä¢	Receipt links back to correct order
	‚Ä¢	No receipt for unpaid orders
	‚Ä¢	No duplicate receipts on webhook retries

Security Checks
	‚Ä¢	Tenant isolation preserved
	‚Ä¢	Receipt verification does not leak cross-tenant data
	‚Ä¢	Demo tenant behavior unchanged

Regression Checks
	‚Ä¢	POS receipts unaffected
	‚Ä¢	ParkHub receipt flow still works
	‚Ä¢	Canonical proof APIs still pass

‚∏ª

üßæ REQUIRED DELIVERABLES

Replit MUST produce:
	1.	WAVE_C1_COMPLETION_REPORT.md
	‚Ä¢	Schema changes
	‚Ä¢	Logic changes
	‚Ä¢	Verification checklist (PASS/FAIL)
	‚Ä¢	Known limitations deferred
	2.	Updated Gap Status
	‚Ä¢	Mark CLOSED:
	‚Ä¢	B3-G1
	‚Ä¢	B3-G2
	‚Ä¢	B3-G7
	‚Ä¢	B3-G12
	3.	Explicit STOP CONFIRMATION
	‚Ä¢	No further work performed
	‚Ä¢	Awaiting next authorization

‚∏ª

üõë HARD STOP CONDITION

üö® STOP IMMEDIATELY AFTER COMPLETION

Replit must not:
	‚Ä¢	Begin Wave D
	‚Ä¢	Improve audit trails
	‚Ä¢	Add hashing
	‚Ä¢	Modify order mutability
	‚Ä¢	Touch payouts or ledgers

The only acceptable next action is to wait for explicit authorization.

‚∏ª

‚úÖ EXECUTION AUTHORIZED

Proceed with Wave C1 ‚Äî Receipt Integration exactly as specified above.