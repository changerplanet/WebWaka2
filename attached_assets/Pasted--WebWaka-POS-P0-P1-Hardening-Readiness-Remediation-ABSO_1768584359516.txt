
WebWaka POS â€” P0 + P1 Hardening & Readiness Remediation

â¸»

âš ï¸ ABSOLUTE EXECUTION RULES (NON-NEGOTIABLE)

You must follow ALL of the rules below:
	1.	Work strictly in the order provided â€” no skipping
	2.	Do not introduce new features beyond what is explicitly listed
	3.	Do not refactor unrelated code
	4.	Do not add demo data, mock flows, or placeholders
	5.	No UI polish unless explicitly required
	6.	Every fix must be wired end-to-end (API + UI + state)
	7.	No background jobs unless explicitly required
	8.	At the end, STOP and produce a verification report â€” do NOT continue

â¸»

ğŸ¯ OBJECTIVE

Bring the WebWaka POS from â€œLimited Pilot Riskâ€ to â€œPilot-Safe & Operationally Correctâ€ by fixing all P0 and P1 blockers identified in the POS Full Real-World Validation Audit.

This is NOT a redesign.
This is correctness, safety, and realism.

â¸»

ğŸ“¦ SCOPE OF WORK (EXECUTE IN THIS EXACT ORDER)

â¸»

ğŸ”´ STEP 1 â€” IMPLEMENT VOID SALE BACKEND (P0)

Problem
	â€¢	VoidSaleModal exists and is integrated
	â€¢	/api/pos/sales/void endpoint does NOT exist
	â€¢	UI currently fails with 404

Required Work
	1.	Create API endpoint:

POST /api/pos/sales/void


	2.	Input:
	â€¢	saleId
	â€¢	reason
	â€¢	supervisorId or supervisor PIN verification
	3.	Backend behavior:
	â€¢	Validate tenant + shift
	â€¢	Validate supervisor role
	â€¢	Ensure sale is VOIDABLE
	â€¢	Mark sale status = VOIDED
	â€¢	Reverse inventory movements
	â€¢	Reverse cash impact (if CASH)
	â€¢	Log audit trail
	4.	UI:
	â€¢	Wire existing VoidSaleModal to this endpoint
	â€¢	Show success/failure feedback
	â€¢	Ensure idempotency (cannot void twice)

âŒ Do NOT add refunds here
âŒ Do NOT change shift logic

â¸»

ğŸ”´ STEP 2 â€” IMPLEMENT REFUNDS (FULL + PARTIAL) (P0)

Problem
	â€¢	No refund functionality exists
	â€¢	Critical Nigerian retail blocker

Required Work
	1.	Create API:

POST /api/pos/sales/refund


	2.	Support:
	â€¢	Full refund
	â€¢	Partial refund (by item or amount)
	3.	Backend behavior:
	â€¢	Validate sale is refundable
	â€¢	Track refunded quantity/amount
	â€¢	Return inventory correctly
	â€¢	Record refund ledger entry
	â€¢	Prevent over-refund
	4.	UI:
	â€¢	Add â€œRefundâ€ action in TransactionHistory
	â€¢	Refund modal with:
	â€¢	Reason
	â€¢	Amount or items
	â€¢	Supervisor approval (PIN)
	5.	Audit:
	â€¢	Refund must be traceable
	â€¢	Original sale remains immutable

âŒ Do NOT implement exchange workflow
âŒ Do NOT integrate payment gateway refunds (cash/transfer only)

â¸»

ğŸ”´ STEP 3 â€” REMOVE DEMO PRODUCT FALLBACK (P0)

Problem
	â€¢	Demo coffee shop products appear when no products exist

Required Work
	1.	Identify demo fallback logic in POS product loading
	2.	Remove fallback entirely
	3.	Replace with:
	â€¢	Empty state UI
	â€¢	Clear message: â€œNo products configuredâ€
	â€¢	CTA: â€œGo to Inventory to add productsâ€

âŒ Do NOT auto-seed products
âŒ Do NOT keep demo data in production paths

â¸»

ğŸ”´ STEP 4 â€” ADD CLEAR CART CONFIRMATION (P0)

Problem
	â€¢	One tap clears cart with no warning

Required Work
	1.	Add confirmation modal on Clear Cart:
	â€¢	Show item count
	â€¢	Show total value
	2.	Require explicit confirmation
	3.	Preserve cart if cancelled

âŒ No redesign of cart UI

â¸»

ğŸŸ  STEP 5 â€” IMPLEMENT PARTIAL / SPLIT PAYMENTS (P1)

Problem
	â€¢	Nigerians frequently split payments (cash + transfer)

Required Work
	1.	Extend checkout flow to support:
	â€¢	Multiple payment entries per sale
	2.	Supported combinations:
	â€¢	CASH + TRANSFER
	â€¢	CASH + CASH
	â€¢	TRANSFER + TRANSFER
	3.	Validation:
	â€¢	Total payments must equal sale total
	4.	Receipt:
	â€¢	Show payment breakdown
	5.	Backend:
	â€¢	Persist payment splits per sale
	â€¢	Preserve offline safety

âŒ Do NOT add card/mobile gateway processing
âŒ Do NOT refactor entire payment system

â¸»

ğŸŸ  STEP 6 â€” ADD PERSISTENT SHIFT STATUS BANNER (P1)

Problem
	â€¢	Cashiers lose context of current shift

Required Work
	1.	Add visible banner/status indicator:
	â€¢	Shift number
	â€¢	Location
	â€¢	Register ID
	â€¢	OPEN / CLOSED state
	2.	Banner must:
	â€¢	Persist across views
	â€¢	Be visible during checkout
	â€¢	Update in real time

âŒ Do NOT clutter UI

â¸»

ğŸŸ  STEP 7 â€” IMPLEMENT PERCENTAGE DISCOUNTS (P1)

Problem
	â€¢	Only fixed amount discounts supported

Required Work
	1.	Extend discount logic to support:
	â€¢	Percentage discount per item
	2.	Validation:
	â€¢	Supervisor approval for > X%
	3.	Display:
	â€¢	Show discount clearly on receipt

âŒ No promo codes
âŒ No cart-wide discounts (out of scope)

â¸»

ğŸŸ  STEP 8 â€” MIGRATE OFFLINE QUEUE TO INDEXEDDB (P1)

Problem
	â€¢	Offline sales stored in localStorage (fragile)

Required Work
	1.	Move offline sales queue to IndexedDB
	2.	Preserve:
	â€¢	offlineId idempotency
	â€¢	sync behavior
	3.	Ensure:
	â€¢	No data loss on refresh
	â€¢	Recovery after browser restart

âŒ Do NOT remove offline support
âŒ Do NOT introduce background sync jobs

â¸»

ğŸ›‘ FINAL STEP â€” HARD STOP & VERIFICATION

After completing ALL steps above, STOP.

Produce a Verification & Test Report covering:
	1.	Void sale flow (happy + failure paths)
	2.	Refund flow (full + partial)
	3.	Split payment correctness
	4.	Inventory correctness after:
	â€¢	Sale
	â€¢	Void
	â€¢	Refund
	5.	Offline sale â†’ online sync durability
	6.	Demo data fully removed
	7.	Permissions enforced correctly
	8.	UX sanity check on mobile

ğŸš« DO NOT proceed to new features or suites
ğŸš« DO NOT refactor beyond scope

â¸»

âœ… SUCCESS CRITERIA

POS is considered PILOT-READY only if:
	â€¢	No fake/demo data appears
	â€¢	No irreversible cash mistakes possible
	â€¢	Refunds work
	â€¢	Split payments work
	â€¢	Offline sales survive refresh
	â€¢	Supervisors control sensitive actions
	â€¢	Audit trail is complete

â¸»

END OF PROMPT â€” EXECUTE EXACTLY AS WRITTEN