Below is the exact Replit execution prompt for Wave D2 ‚Äî Public Proof & Verification Hardening, written to enforce strict scope, discipline, and stop conditions, and aligned with everything already completed in Waves B3 ‚Üí C1 ‚Üí D1.

‚∏ª

üîê REPLIT EXECUTION PROMPT

WAVE D2 ‚Äî Public Proof & Verification Hardening

‚ö†Ô∏è MANDATE

You are executing Wave D2 of the WebWaka platform hardening plan.

This wave focuses exclusively on public-facing proof and verification surfaces (orders, receipts, tickets, manifests) to ensure they are:
	‚Ä¢	Secure
	‚Ä¢	Non-enumerable
	‚Ä¢	Tenant-safe
	‚Ä¢	Tamper-aware
	‚Ä¢	Consistent across SVM, MVM, and ParkHub

This is NOT a feature wave.
This is NOT a UI/branding wave.
This is NOT a payout or money movement wave.

‚∏ª

üß± STRICT CONSTRAINTS (NON-NEGOTIABLE)

‚ùå YOU MUST NOT:
	‚Ä¢	Add new product features
	‚Ä¢	Change business logic
	‚Ä¢	Introduce automation or background jobs
	‚Ä¢	Modify financial calculations
	‚Ä¢	Create partner or admin UI
	‚Ä¢	Expose new public endpoints beyond what is specified
	‚Ä¢	Proceed past Wave D2 without explicit stop

‚úÖ YOU MAY:
	‚Ä¢	Add schema fields only if required for verification or security
	‚Ä¢	Add guards, rate limits, and validation
	‚Ä¢	Harden existing public endpoints
	‚Ä¢	Add read-only metadata
	‚Ä¢	Improve tamper detection
	‚Ä¢	Improve tenant and identity verification
	‚Ä¢	Normalize public verification behavior across systems

‚∏ª

üéØ SCOPE OF WORK (REQUIRED DELIVERABLES)

1Ô∏è‚É£ Harden Public Order Verification

Applies to:
	‚Ä¢	/[tenantSlug]/orders/[orderRef]
	‚Ä¢	Any API resolving orders by reference

Required:
	‚Ä¢	Enforce identity verification (email or phone) for ALL live tenants
	‚Ä¢	Demo tenants remain unrestricted
	‚Ä¢	Order reference must no longer act as a bearer token
	‚Ä¢	Generic error messages (no order existence leakage)
	‚Ä¢	Ensure verification logic is order-specific, not tenant-wide

‚∏ª

2Ô∏è‚É£ Harden Receipt Verification

Applies to:
	‚Ä¢	/verify/receipt/[receiptId]

Required:
	‚Ä¢	Validate receipt integrity using verificationHash
	‚Ä¢	Detect and flag tampered receipts
	‚Ä¢	Ensure receipt.sourceType and sourceId are consistent
	‚Ä¢	Normalize response shape across:
	‚Ä¢	POS
	‚Ä¢	SVM
	‚Ä¢	MVM
	‚Ä¢	ParkHub
	‚Ä¢	Do NOT require authentication
	‚Ä¢	Do NOT introduce tenantSlug requirement (document why if unchanged)

‚∏ª

3Ô∏è‚É£ Harden Ticket Verification (ParkHub)

Applies to:
	‚Ä¢	/verify/ticket/[ticketRef] (or equivalent)

Required:
	‚Ä¢	Validate ticket hash and integrity
	‚Ä¢	Ensure ticket ‚Üî receipt ‚Üî manifest linkage is consistent
	‚Ä¢	Prevent enumeration (generic errors)
	‚Ä¢	Enforce phone verification for live tenants
	‚Ä¢	Demo tenants remain unrestricted

‚∏ª

4Ô∏è‚É£ Harden Manifest Verification

Applies to:
	‚Ä¢	/verify/manifest/[manifestNumber]

Required:
	‚Ä¢	Validate manifest hash chain
	‚Ä¢	Ensure manifest references only valid tickets
	‚Ä¢	Ensure manifests cannot be altered without detection
	‚Ä¢	Public access allowed (regulatory requirement)
	‚Ä¢	No tenant leakage

‚∏ª

5Ô∏è‚É£ Introduce Verification Result Semantics

Across ALL public verification endpoints, return explicit status metadata:

Example:

{
  "valid": true,
  "tampered": false,
  "revoked": false,
  "sourceType": "SVM_ORDER",
  "verifiedAt": "2026-01-16T12:00:00Z"
}

Do NOT invent revocation logic ‚Äî only support metadata flags.

‚∏ª

6Ô∏è‚É£ Documentation (MANDATORY)

Create:
	‚Ä¢	WAVE_D2_PUBLIC_VERIFICATION_REPORT.md

This must include:
	‚Ä¢	Every endpoint touched
	‚Ä¢	Verification logic applied
	‚Ä¢	What is verified (hash, identity, linkage)
	‚Ä¢	What is NOT verified (explicitly)
	‚Ä¢	Known residual risks
	‚Ä¢	Why remaining gaps are deferred

‚∏ª

üõë STOP CONDITIONS (ABSOLUTE)

When ALL of the following are true, you MUST STOP and report:
	‚Ä¢	‚úÖ All public verification endpoints hardened
	‚Ä¢	‚úÖ No enumeration vectors remain
	‚Ä¢	‚úÖ No tenant isolation regressions introduced
	‚Ä¢	‚úÖ Demo vs live behavior explicitly documented
	‚Ä¢	‚úÖ Hash verification enforced where available
	‚Ä¢	‚úÖ Report written and committed
	‚Ä¢	‚ùå NO UI work done
	‚Ä¢	‚ùå NO payouts or money movement touched
	‚Ä¢	‚ùå NO Wave D3, E, or beyond started

‚∏ª

üö´ FAILURE CONDITIONS (AUTO-REJECT)

Your work will be rejected if:
	‚Ä¢	You proceed beyond Wave D2
	‚Ä¢	You add unrelated features
	‚Ä¢	You modify commerce logic
	‚Ä¢	You introduce silent breaking changes
	‚Ä¢	You skip documentation
	‚Ä¢	You assume intent not present in code

‚∏ª

üß† REMINDER

This wave exists to make WebWaka defensible in audits, disputes, and regulatory scrutiny.

Precision > speed
Security > convenience
Evidence > appearance

‚∏ª

‚ñ∂Ô∏è BEGIN WAVE D2 NOW

Stop immediately when done and present a Wave D2 Completion Report.

‚∏ª
