Excellent. ‚úÖ
Wave K.2 is now AUTHORIZED.

Below is the tight, production-grade Replit execution prompt for Wave K.2 ‚Äî Multi-Vendor Checkout & Order Creation, written to enforce discipline, scope control, and architectural integrity.

‚∏ª

üîê WAVE K.2 ‚Äî REPLIT EXECUTION PROMPT

Multi-Vendor Checkout & Order Creation (MVM)

STATUS
	‚Ä¢	Wave: K.2
	‚Ä¢	Track: Commerce Completion (MVM)
	‚Ä¢	Prerequisite: Wave K.1 (Multi-Vendor Cart) ‚úÖ
	‚Ä¢	Authorization: ‚úÖ GRANTED
	‚Ä¢	STOP REQUIRED AFTER COMPLETION

‚∏ª

üéØ OBJECTIVE (NON-NEGOTIABLE)

Implement end-to-end multi-vendor checkout and order creation using existing systems only, converting a validated MVM cart into:
	‚Ä¢	A single parent order
	‚Ä¢	Multiple vendor-scoped sub-orders
	‚Ä¢	Correct payment initiation
	‚Ä¢	Correct commission attribution
	‚Ä¢	Correct inventory deduction
	‚Ä¢	Correct order visibility for:
	‚Ä¢	Customer
	‚Ä¢	Vendors
	‚Ä¢	Partner / Tenant Admin

‚ö†Ô∏è NO new commerce concepts may be invented.

‚∏ª

üö´ HARD CONSTRAINTS (STRICT)

You MUST NOT:
	‚Ä¢	‚ùå Invent new checkout logic
	‚Ä¢	‚ùå Create a new payment system
	‚Ä¢	‚ùå Modify commission rules
	‚Ä¢	‚ùå Introduce automation or background jobs
	‚Ä¢	‚ùå Add new pricing logic
	‚Ä¢	‚ùå Add new schemas unless absolutely required and explicitly justified
	‚Ä¢	‚ùå Bypass TenantContextResolver
	‚Ä¢	‚ùå Break SVM or ParkHub flows

If a gap exists:

Document it. DO NOT workaround it.

‚∏ª

üß± REQUIRED BUILDING BLOCKS (MANDATORY USE)

You MUST use only these existing systems:

Cart
	‚Ä¢	MultiVendorCartService
	‚Ä¢	mvm_cart, mvm_cart_item

Orders
	‚Ä¢	OrderSplittingService
	‚Ä¢	mvm_parent_order
	‚Ä¢	mvm_sub_order

Payments
	‚Ä¢	PaymentExecutionService
	‚Ä¢	Supported modes:
	‚Ä¢	Paystack
	‚Ä¢	Bank Transfer
	‚Ä¢	COD
	‚Ä¢	Demo-safe behavior must remain intact

Inventory
	‚Ä¢	InventorySyncEngine
	‚Ä¢	ProductChannelConfig rules (MVM visibility, inventory mode)

Tenant Security
	‚Ä¢	TenantContextResolver.resolveForMVM()
	‚Ä¢	No client-supplied tenantId

‚∏ª

üß© REQUIRED DELIVERABLES

1Ô∏è‚É£ Checkout API (NEW)

Create ONE canonical checkout endpoint:

POST /api/mvm/checkout

Responsibilities:
	‚Ä¢	Resolve tenant via TenantContextResolver
	‚Ä¢	Load active MVM cart
	‚Ä¢	Validate:
	‚Ä¢	Vendors are APPROVED
	‚Ä¢	Products are ACTIVE
	‚Ä¢	ProductChannelConfig allows MVM
	‚Ä¢	Inventory sufficiency (no reservation yet)
	‚Ä¢	Calculate totals using existing pricing
	‚Ä¢	Create:
	‚Ä¢	mvm_parent_order
	‚Ä¢	mvm_sub_order[] (via OrderSplittingService)
	‚Ä¢	Initiate payment via PaymentExecutionService
	‚Ä¢	Return:
	‚Ä¢	parentOrderRef
	‚Ä¢	payment status
	‚Ä¢	redirect URL (if applicable)

‚ùå No payment capture inside this endpoint
‚ùå No background processing

‚∏ª

2Ô∏è‚É£ Multi-Vendor Checkout UI

Expose checkout UI at:

/[tenantSlug]/marketplace/checkout

UI Requirements:
	‚Ä¢	Vendor-grouped order summary
	‚Ä¢	Per-vendor subtotals
	‚Ä¢	Unified customer info
	‚Ä¢	Payment method selection
	‚Ä¢	Trust signals (VendorTrustBadge)
	‚Ä¢	NGN formatting only
	‚Ä¢	Clear demo/live indicators

You may reuse:
	‚Ä¢	SVM checkout components
	‚Ä¢	Mobile checkout patterns

DO NOT fork business logic.

‚∏ª

3Ô∏è‚É£ Inventory Handling (STRICT)
	‚Ä¢	Deduct inventory ONLY AFTER order creation
	‚Ä¢	Respect ProductChannelConfig inventory modes:
	‚Ä¢	SHARED
	‚Ä¢	ALLOCATED
	‚Ä¢	UNLIMITED
	‚Ä¢	Use InventorySyncEngine events
	‚Ä¢	Handle insufficiency with user-visible error

‚∏ª

4Ô∏è‚É£ Post-Checkout Visibility

Ensure orders appear correctly in:

Role	Visibility
Customer	/[tenantSlug]/orders
Vendor	Vendor Dashboard
Partner/Admin	MVM Admin views

No new dashboards required ‚Äî reuse existing resolvers.

‚∏ª

üß™ DEMO VS LIVE BEHAVIOR

Mode	Behavior
Demo tenant	Orders + payments simulated
Live tenant	Real payment initiation
Missing payment config	Graceful failure
COD	Order created, payment deferred


‚∏ª

üìã MANDATORY GAP LOGGING

Create:

WAVE_K2_GAPS.md

You MUST log gaps such as (examples):
	‚Ä¢	Partial vendor payment failure handling
	‚Ä¢	Split refunds
	‚Ä¢	Mixed payment methods per vendor
	‚Ä¢	Inventory oversell edge cases
	‚Ä¢	Checkout recovery after payment abort

‚ö†Ô∏è DO NOT FIX THESE IN WAVE K.2
‚ö†Ô∏è ONLY DOCUMENT

‚∏ª

üì¶ REQUIRED COMPLETION REPORT

At STOP, produce WAVE_K2_COMPLETION_REPORT.md with:

Sections:
	1.	APIs Created
	2.	UI Routes Added
	3.	Services Used
	4.	Order Lifecycle (Step-by-Step)
	5.	Payment Flows (by method)
	6.	Inventory Handling Summary
	7.	Demo vs Live Behavior
	8.	Explicit Constraint Confirmation
	9.	Full Gap List

‚∏ª

üõë HARD STOP CONDITION

After completing Wave K.2, you MUST:
	‚Ä¢	‚ùå Not start Wave K.3
	‚Ä¢	‚ùå Not fix documented gaps
	‚Ä¢	‚ùå Not refactor adjacent systems

WAIT FOR EXPLICIT APPROVAL.

‚∏ª

üß† ARCHITECTURAL INTENT (DO NOT VIOLATE)

This wave exists to activate MVM commerce ‚Äî not perfect it.

Perfection comes later.
Correctness and discipline come now.

‚∏ª

üîì YOU ARE CLEARED TO EXECUTE WAVE K.2

Proceed carefully.
Document ruthlessly.
Stop on completion.

When the report is ready, paste it here for approval.