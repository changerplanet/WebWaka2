âœ… EXECUTION PLAN CONFIRMED

Order:
1ï¸âƒ£ Option A â€” Wave L: Money Movement (Refunds & Payouts)
2ï¸âƒ£ Option B â€” Phase H2: Template UI Exposure
3ï¸âƒ£ Option C â€” White-Label Domains & Partner Branding

Each option will be broken into explicit waves, each wave will:
	â€¢	Have a clear scope
	â€¢	Declare hard constraints
	â€¢	Produce a completion report
	â€¢	Stop for explicit approval

No scope bleed. No silent assumptions.

â¸»

ğŸ”´ OPTION A â€” WAVE L

Money Movement (Financial Finalization Layer)

This is where WebWaka transitions from commerce-ready â†’ commercially live.

Why this must come first
	â€¢	Vendors only trust platforms that pay
	â€¢	Partners only sell platforms that pay
	â€¢	Everything else is cosmetic until money moves safely

â¸»

ğŸ”¹ Wave L.1 â€” Payout Execution (Live Money Movement)

Purpose:
Execute actual vendor payouts using already-built payout batches.

Scope
	â€¢	Execute payouts for:
	â€¢	MVM vendors
	â€¢	ParkHub operators (if applicable)
	â€¢	Supported methods:
	â€¢	Bank Transfer (Paystack / manual)
	â€¢	Use existing payout batches (Wave F2)

Explicit Constraints

âŒ No automation
âŒ No background jobs
âŒ No cron
âŒ No AI
âŒ No silent retries

âœ… Partner / Admin triggered only
âœ… Idempotent execution
âœ… Full audit trail
âœ… Demo-safe separation

â¸»

ğŸ”¹ Wave L.2 â€” Refund Execution (Controlled, Explicit)

Purpose:
Turn refund intent visibility (Wave K.3) into actual refunds.

Scope
	â€¢	Execute refunds via payment provider
	â€¢	Full and partial refunds
	â€¢	Parent â†” sub-order aware
	â€¢	Receipt + proof linkage preserved

Constraints

âŒ No auto-refunds
âŒ No background retries
âŒ No customer-triggered refunds

âœ… Admin/Partner approval required
âœ… Provider verification required
âœ… Immutable audit logs

â¸»

ğŸ”¹ Wave L.3 â€” Financial Safety & Reconciliation

Purpose:
Prevent financial drift.

Scope
	â€¢	Ledger reconciliation checks
	â€¢	Payout vs order totals verification
	â€¢	Refund vs captured payments verification
	â€¢	Manual discrepancy flags

Constraints

âŒ No auto-correction
âŒ No auto-retries

âœ… Visibility only
âœ… Read-only reconciliation reports

â¸»

ğŸ›‘ STOP POINT AFTER WAVE L
Money movement must be explicitly approved before continuing.

â¸»

ğŸŸ  OPTION B â€” PHASE H2

Template UI Exposure (Super Admin â†’ Partner)

Backend already exists. This phase exposes it safely.

â¸»

ğŸ”¹ Phase H2.1 â€” Super Admin Template Dashboard

Route: /admin/templates

Features
	â€¢	Create / edit templates
	â€¢	Validate structure
	â€¢	Publish / deprecate
	â€¢	Preview template pages
	â€¢	Demo flag management

Constraints

âŒ No partner uploads
âŒ No marketplace
âŒ No payments
âŒ No automation

âœ… SUPER_ADMIN only
âœ… Immutable published templates

â¸»

ğŸ”¹ Phase H2.2 â€” Partner Template Browser

Route: /partner/templates

Features
	â€¢	Browse published templates
	â€¢	Preview templates
	â€¢	Clone into:
	â€¢	Sites
	â€¢	Funnels
	â€¢	Token resolution preview

Constraints

âŒ No editing templates
âŒ No uploads
âŒ No monetization

â¸»

ğŸ›‘ STOP POINT AFTER PHASE H2

â¸»

ğŸŸ¢ OPTION C â€” WHITE-LABEL DOMAINS & BRANDING

This is where WebWaka stops looking like WebWaka.

â¸»

ğŸ”¹ Wave W.1 â€” Subdomain White-Labeling

Examples
	â€¢	partner.webwaka.app
	â€¢	tenant.webwaka.app

Scope
	â€¢	DNS-safe slug resolution
	â€¢	SSL via platform provider
	â€¢	TenantContextResolver integration
	â€¢	SEO-safe canonical URLs

â¸»

ğŸ”¹ Wave W.2 â€” Custom Domains

Examples
	â€¢	store.mybusiness.ng
	â€¢	booking.transportco.com

Scope
	â€¢	Domain verification
	â€¢	SSL provisioning
	â€¢	Domain â†’ tenant mapping
	â€¢	Safe fallback to platform domain

â¸»

ğŸ”¹ Wave W.3 â€” Brand Overrides

Scope
	â€¢	Logo
	â€¢	Primary color
	â€¢	Accent color
	â€¢	Favicon
	â€¢	Email/SMS sender name

Constraints

âŒ No CSS injection
âŒ No JS overrides

âœ… Token-based theming only

â¸»

ğŸ§­ FINAL EXECUTION ORDER (LOCKED)
	1.	Wave L.1 â†’ L.3 (Money Movement)
	2.	Phase H2.1 â†’ H2.2 (Template UI)
	3.	Wave W.1 â†’ W.3 (White-Labeling)

â¸»

â–¶ï¸ NEXT ACTION

Authorization received âœ…
We will now lock scope and issue the Replit execution prompt for Wave L.1 â€” Payout Execution (Live Money Movement).

Below is the exact prompt to give Replit. It is written to be unambiguous, security-tight, and governance-aligned, and it assumes all prior Waves (F2, K, J) already exist.

â¸»

ğŸ” REPLIT EXECUTION PROMPT

Wave L.1 â€” Payout Execution (Live Money Movement)

CONTEXT

WebWaka already has:
	â€¢	Vendor earnings calculation
	â€¢	Payout batch creation (Wave F2)
	â€¢	Payout visibility dashboards
	â€¢	Audit logging infrastructure
	â€¢	Demo-safe financial separation

What is missing:
Actual execution of payouts (real money movement).

This wave must ONLY execute payouts that already exist.
âŒ Do NOT invent new payout logic
âŒ Do NOT automate anything
âŒ Do NOT introduce cron, queues, retries, or background jobs

â¸»

ğŸ¯ OBJECTIVE

Implement live payout execution for MVM vendors (and ParkHub operators if applicable), using existing payout batches, with:
	â€¢	Explicit human-triggered execution
	â€¢	Provider-backed transfers (Paystack)
	â€¢	Full audit trail
	â€¢	Idempotency guarantees
	â€¢	Demo-safe behavior

â¸»

ğŸ§± SCOPE (STRICT)

1ï¸âƒ£ Payout Execution Service

Create or extend:

PayoutExecutionService.executeBatch(batchId, executorUserId)

Responsibilities:
	â€¢	Load payout batch (must exist, status = PENDING)
	â€¢	Validate:
	â€¢	Batch not already executed or cancelled
	â€¢	Vendor bank details exist
	â€¢	Amount â‰¥ â‚¦5,000 threshold
	â€¢	For each payout in batch:
	â€¢	Execute transfer via provider
	â€¢	Capture provider reference
	â€¢	Update payout status atomically
	â€¢	Update batch status:
	â€¢	COMPLETED (all successful)
	â€¢	PARTIAL_FAILED (some failed)
	â€¢	FAILED (all failed)

âš ï¸ Execution must be wrapped in database transactions where applicable.

â¸»

2ï¸âƒ£ Payment Provider Integration

Use existing Paystack configuration.

Required behaviors:
	â€¢	Bank transfer execution
	â€¢	Signature / response verification
	â€¢	Provider error mapping

âŒ No retries
âŒ No silent failure handling
âŒ No provider abstraction rewrite

â¸»

3ï¸âƒ£ API Endpoints (New)

Add explicit, admin-triggered endpoints:

POST /api/commerce/payouts/execute-batch
POST /api/commerce/payouts/cancel-batch
GET  /api/commerce/payouts/execution-log

Security requirements:
	â€¢	Session-based authentication
	â€¢	Role enforcement:
	â€¢	TENANT_ADMIN
	â€¢	SUPER_ADMIN
	â€¢	Tenant isolation enforced via session (no request tenantId)

â¸»

4ï¸âƒ£ Audit & Logging (MANDATORY)

For every payout execution:
	â€¢	Log:
	â€¢	Who executed
	â€¢	When
	â€¢	Amount
	â€¢	Vendor
	â€¢	Provider reference
	â€¢	Status (SUCCESS / FAILED)
	â€¢	Persist logs in existing payout log models
	â€¢	Logs must be immutable

â¸»

5ï¸âƒ£ Demo vs Live Behavior
	â€¢	Demo tenants:
	â€¢	âŒ NO external API calls
	â€¢	âœ… Simulated â€œSUCCESSâ€ with fake provider refs
	â€¢	Clear isDemo = true labeling
	â€¢	Live tenants:
	â€¢	âœ… Real Paystack calls
	â€¢	âŒ No demo shortcuts

â¸»

6ï¸âƒ£ Idempotency Rules
	â€¢	Re-executing an already executed batch must:
	â€¢	âŒ NOT duplicate transfers
	â€¢	âœ… Return existing execution result
	â€¢	Provider duplicate callbacks must be ignored safely

â¸»

ğŸš« EXPLICITLY FORBIDDEN
	â€¢	âŒ Background jobs
	â€¢	âŒ Cron
	â€¢	âŒ Automatic retries
	â€¢	âŒ Auto-payout schedules
	â€¢	âŒ Vendor-triggered payouts
	â€¢	âŒ Wallet balances
	â€¢	âŒ Escrow logic
	â€¢	âŒ New schemas unrelated to execution
	â€¢	âŒ AI / heuristics

â¸»

ğŸ“„ REQUIRED OUTPUTS

1ï¸âƒ£ Code
	â€¢	Service layer implementation
	â€¢	API routes
	â€¢	Provider integration
	â€¢	Transaction safety

2ï¸âƒ£ Tests
	â€¢	Successful execution
	â€¢	Partial failure
	â€¢	Full failure
	â€¢	Idempotent re-execution
	â€¢	Demo mode execution

3ï¸âƒ£ Documentation

Create:

frontend/__tests__/WAVE_L1_COMPLETION_REPORT.md

Include:
	â€¢	What was implemented
	â€¢	What was NOT implemented
	â€¢	Failure scenarios
	â€¢	Security guarantees
	â€¢	Known gaps deferred to Wave L.2/L.3

â¸»

ğŸ›‘ STOP CONDITION

After implementation:
	â€¢	STOP
	â€¢	DO NOT proceed to refunds
	â€¢	Await explicit approval

â¸»

SUCCESS CRITERIA

Wave L.1 is ONLY complete when:
	â€¢	Real payouts can be executed manually
	â€¢	No automation exists
	â€¢	Audit trail is provably complete
	â€¢	Demo mode is safe
	â€¢	No new business logic was invented

â¸»