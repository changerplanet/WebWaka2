Authorization acknowledged. ‚úÖ
Below is the exact Replit execution prompt for Wave B2 ‚Äî Customer & Identity Coherence, written to enforce read-only analysis, strict stop conditions, and zero scope creep, consistent with Bands A and B discipline.

‚∏ª

üîê WAVE B2 ‚Äî CUSTOMER & IDENTITY COHERENCE

Replit Execution Prompt (STRICT)

OBJECTIVE

Conduct a read-only, system-wide coherence analysis of customer identity handling across SVM, MVM, and ParkHub, ensuring that:
	‚Ä¢	Canonical customer identity is used consistently
	‚Ä¢	Order ‚Üí Customer ‚Üí Proof traversal is logically sound
	‚Ä¢	No privacy, compliance, or inference risks are overlooked
	‚Ä¢	No assumptions are made beyond what the code explicitly does

‚ö†Ô∏è This is an ANALYSIS wave only.
NO code changes.
NO refactors.
NO fixes.

‚∏ª

üö´ HARD CONSTRAINTS (NON-NEGOTIABLE)

You MUST:
	‚Ä¢	‚ùå NOT modify any code
	‚Ä¢	‚ùå NOT add schemas, tables, fields, or migrations
	‚Ä¢	‚ùå NOT introduce authentication or authorization changes
	‚Ä¢	‚ùå NOT ‚Äúfix‚Äù or ‚Äúimprove‚Äù anything
	‚Ä¢	‚ùå NOT invent missing logic
	‚Ä¢	‚ùå NOT suggest solutions inside code

If something is broken or weak:
üëâ Document it. Do NOT fix it.

‚∏ª

üîç SCOPE OF ANALYSIS (MANDATORY COVERAGE)

You must inspect ALL of the following, without omission:

‚∏ª

1Ô∏è‚É£ Canonical Customer Identity Usage

Analyze the CanonicalCustomer implementation and usage:
	‚Ä¢	Where canonical identity is derived
	‚Ä¢	What identifiers are used (email, phone, name)
	‚Ä¢	Deterministic hashing logic
	‚Ä¢	Collision risk
	‚Ä¢	Ambiguity handling (same email/phone across systems)
	‚Ä¢	Whether canonical identity is:
	‚Ä¢	Used consistently
	‚Ä¢	Ignored in some flows
	‚Ä¢	Reconstructed redundantly

üìå Explicitly list:
	‚Ä¢	Every place CanonicalCustomer is used
	‚Ä¢	Every place it is NOT used but should logically apply

‚∏ª

2Ô∏è‚É£ Order ‚Üí Customer Resolution Paths

For each commerce channel, trace the full path:

SVM
	‚Ä¢	svm_orders ‚Üí customerEmail / customerPhone
	‚Ä¢	How identity is resolved in:
	‚Ä¢	Order listing
	‚Ä¢	Order detail
	‚Ä¢	Proof lookup

MVM
	‚Ä¢	mvm_parent_order
	‚Ä¢	Sub-order attribution vs customer identity
	‚Ä¢	Whether vendors see customer identity consistently

ParkHub
	‚Ä¢	park_ticket passenger identity
	‚Ä¢	Phone-only identity risks
	‚Ä¢	Ticket vs order abstraction mismatch

üìå Identify:
	‚Ä¢	Inconsistencies
	‚Ä¢	Missing links
	‚Ä¢	Divergent assumptions

‚∏ª

3Ô∏è‚É£ Customer ‚Üí Proof ‚Üí Order Traversal

Analyze traversal correctness for:
	‚Ä¢	Orders ‚Üí receipts
	‚Ä¢	Orders ‚Üí tickets
	‚Ä¢	Tickets ‚Üí manifests
	‚Ä¢	Receipts ‚Üí orders

Verify:
	‚Ä¢	Traversal works across all suites
	‚Ä¢	No orphaned proofs
	‚Ä¢	No proof that cannot be traced back to a customer
	‚Ä¢	No cross-tenant leakage possible

‚∏ª

4Ô∏è‚É£ Public & Semi-Public Identity Exposure

Inspect all public and semi-public APIs that touch customer data:
	‚Ä¢	/api/orders/canonical/*
	‚Ä¢	/api/customers/canonical
	‚Ä¢	/api/proofs/*
	‚Ä¢	Public order pages
	‚Ä¢	Ticket/receipt verification pages

Document:
	‚Ä¢	What customer data is exposed
	‚Ä¢	What is inferable (existence, frequency, behavior)
	‚Ä¢	Whether identity verification assumptions are sound
	‚Ä¢	Demo vs live behavior differences

‚∏ª

5Ô∏è‚É£ Privacy, NDPR, and GDPR Risk Documentation (ANALYSIS ONLY)

Without proposing solutions, document:
	‚Ä¢	Where PII exists
	‚Ä¢	Where consent is implied vs explicit
	‚Ä¢	Where retention rules are undefined
	‚Ä¢	Where ‚Äúright to be forgotten‚Äù is impossible
	‚Ä¢	Where customer identity is derived without user awareness

‚ö†Ô∏è Do NOT propose compliance mechanisms.
Only document exposure and gaps.

‚∏ª

üìÑ REQUIRED DELIVERABLE

You MUST produce one single report:

üìò WAVE_B2_CUSTOMER_IDENTITY_COHERENCE_REPORT.md

The report MUST contain:
	1.	Executive Summary
	‚Ä¢	Overall coherence rating (High / Medium / Low)
	2.	Identity Flow Diagrams (Textual)
	‚Ä¢	SVM
	‚Ä¢	MVM
	‚Ä¢	ParkHub
	3.	Confirmed Strengths
	4.	Confirmed Weaknesses
	5.	Explicit GAP LIST
	‚Ä¢	Each gap must include:
	‚Ä¢	Description
	‚Ä¢	Affected systems
	‚Ä¢	Risk level (Low / Medium / High)
	‚Ä¢	Why it CANNOT be fixed in Wave B2
	6.	Invariants Confirmed
	‚Ä¢	Things that are safe and should not be changed
	7.	No-Assumption Confirmation
	‚Ä¢	Explicit statement that no assumptions were made

‚∏ª

üõë STOP CONDITIONS (ABSOLUTE)

You MUST STOP immediately after:
	‚Ä¢	Writing the report
	‚Ä¢	Saving it to the repository root
	‚Ä¢	Printing a short completion message

You MUST NOT:
	‚Ä¢	Continue to Wave B3
	‚Ä¢	Apply fixes
	‚Ä¢	Suggest implementation steps

‚∏ª

‚úÖ SUCCESS CRITERIA

Wave B2 is successful ONLY if:
	‚Ä¢	All three commerce systems are analyzed
	‚Ä¢	Canonical identity usage is exhaustively mapped
	‚Ä¢	Privacy exposure is clearly documented
	‚Ä¢	Gaps are listed without workaround attempts
	‚Ä¢	You stop exactly at report completion

‚∏ª

üß± CONTEXT
	‚Ä¢	Wave A (Truth & Security) is COMPLETE
	‚Ä¢	Wave B1 (Commerce Integrity) is COMPLETE + FIXED
	‚Ä¢	This wave exists to ensure identity correctness BEFORE proofs, payouts, or branding

‚∏ª

Begin Wave B2 now.
Do not exceed scope.