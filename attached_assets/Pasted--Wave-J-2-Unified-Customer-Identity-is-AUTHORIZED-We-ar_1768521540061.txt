‚úÖ Wave J.2 ‚Äî Unified Customer Identity is AUTHORIZED

We are clear to proceed.

Below is the official Replit execution prompt for Wave J.2, written tightly to scope, aligned with lessons from Waves I & J.1, and enforcing all architectural constraints.

‚∏ª

üîê WAVE J.2 ‚Äî UNIFIED CUSTOMER IDENTITY

Replit Execution Prompt

OBJECTIVE

Introduce a read-only, canonical customer identity layer that unifies customer identification across SVM, MVM, and ParkHub without modifying any existing schemas or business logic.

This wave exists solely to normalize identity resolution, not to authenticate users or change flows.

‚∏ª

üö´ HARD CONSTRAINTS (NON-NEGOTIABLE)
	‚Ä¢	‚ùå NO schema changes
	‚Ä¢	‚ùå NO data mutations
	‚Ä¢	‚ùå NO authentication system
	‚Ä¢	‚ùå NO background jobs
	‚Ä¢	‚ùå NO automation
	‚Ä¢	‚ùå NO tenantId changes
	‚Ä¢	‚ùå NO modification of existing order logic
	‚Ä¢	‚ùå NO customer accounts
	‚Ä¢	‚ùå NO new tables
	‚Ä¢	‚ùå NO PII enrichment

This wave is purely a read-only abstraction.

‚∏ª

‚úÖ WHAT IS ALLOWED
	‚Ä¢	Canonical types (TypeScript only)
	‚Ä¢	Resolver functions
	‚Ä¢	Normalization logic
	‚Ä¢	Metadata preservation
	‚Ä¢	Documentation of gaps

‚∏ª

üéØ SCOPE OF WORK

1Ô∏è‚É£ Canonical Customer Type

Create a CanonicalCustomer type that represents a customer across all commerce systems:

CanonicalCustomer {
  canonicalId: string          // derived hash (email|phone)
  email?: string
  phone?: string
  name?: string
  sourceSystems: ("SVM" | "MVM" | "PARKHUB")[]
  originalReferences: {
    svmCustomerId?
    mvmCustomerId?
    parkPassengerId?
  }
  metadata: Record<string, any>
}

	‚Ä¢	canonicalId must be deterministic (e.g. hash of normalized email/phone)
	‚Ä¢	Preserve original system IDs only as metadata
	‚Ä¢	Do not invent missing data

‚∏ª

2Ô∏è‚É£ Identity Resolution Rules (STRICT)

Resolution priority (read-only):
	1.	Email (case-insensitive)
	2.	Phone (normalized to Nigerian formats)
	3.	Fallback: system-specific reference (ticketRef, orderRef)

‚ö†Ô∏è If multiple records match:
	‚Ä¢	DO NOT merge
	‚Ä¢	DO NOT guess
	‚Ä¢	Return multiple CanonicalCustomer entries
	‚Ä¢	Flag ambiguity in metadata

‚∏ª

3Ô∏è‚É£ Source Adapters (READ-ONLY)

Implement resolvers for:

System	Source
SVM	svm_orders, svm_customers (if exists)
MVM	mvm_parent_order, mvm_sub_order
ParkHub	park_ticket, passenger fields

Each resolver must:
	‚Ä¢	Read only
	‚Ä¢	Preserve original structures
	‚Ä¢	Map to CanonicalCustomer without mutation

‚∏ª

4Ô∏è‚É£ CanonicalCustomerService

Create a service with read-only APIs:

getByEmail(tenantSlug, email)
getByPhone(tenantSlug, phone)
resolveFromOrder(reference, tenantSlug)
listAmbiguous(tenantSlug)

	‚Ä¢	Tenant isolation enforced
	‚Ä¢	Demo tenants allowed without auth
	‚Ä¢	Live tenants require tenantSlug only (NO auth yet)

‚∏ª

5Ô∏è‚É£ Public API (READ-ONLY)

Expose internal-use APIs only (not UI-facing yet):

GET /api/customers/canonical?tenantSlug=X&email=Y
GET /api/customers/canonical?tenantSlug=X&phone=Z
GET /api/customers/canonical/from-order?reference=ABC&tenantSlug=X

All endpoints:
	‚Ä¢	Read-only
	‚Ä¢	JSON only
	‚Ä¢	No pagination (document gap)

‚∏ª

üìå REQUIRED GAP DOCUMENTATION (MANDATORY)

You MUST document the following gaps explicitly in code comments and report:
	1.	No persistent customer table
	2.	No authentication / login system
	3.	No deduplication or merge strategy
	4.	No customer consent tracking
	5.	No cross-tenant identity resolution
	6.	No customer profile UI
	7.	Phone number format inconsistencies
	8.	Email trustworthiness not guaranteed
	9.	No soft-delete handling
	10.	No customer lifecycle state

üìç These gaps must be listed in the Wave J.2 Completion Report.

‚∏ª

üß™ DEMO VS LIVE BEHAVIOR

Mode	Behavior
Demo	Works without auth
Live	Requires tenantSlug
Ambiguous	Returns multiple results
Missing identity	Returns empty array


‚∏ª

üìÑ REQUIRED DELIVERABLES

1Ô∏è‚É£ Wave J.2 Completion Report

Must include:
	‚Ä¢	CanonicalCustomer definition
	‚Ä¢	APIs created
	‚Ä¢	Resolver coverage (SVM/MVM/ParkHub)
	‚Ä¢	Explicit gap list
	‚Ä¢	Confirmation of constraint compliance

2Ô∏è‚É£ STOP CONDITION

After report is produced:
	‚Ä¢	üõë STOP
	‚Ä¢	Await approval
	‚Ä¢	DO NOT proceed to Wave J.3

‚∏ª

üß† CONTEXT REMINDER

This wave does not fix identity ‚Äî it reveals it safely.

It is the foundation for:
	‚Ä¢	Secure customer portals
	‚Ä¢	Receipts & proofs
	‚Ä¢	Notifications
	‚Ä¢	Authentication (later)
	‚Ä¢	Cross-suite analytics

‚∏ª

‚úÖ AUTHORIZATION CONFIRMED

Wave J.2 is unlocked.
Replit may proceed immediately under the above constraints.

When the completion report is ready, paste it here for review.