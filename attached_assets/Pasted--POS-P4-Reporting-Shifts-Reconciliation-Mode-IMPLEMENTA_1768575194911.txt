
POS-P4 ‚Äî Reporting, Shifts & Reconciliation

Mode: IMPLEMENTATION
Discipline: STRICT STEP-BY-STEP
Stop Condition: HARD STOP AFTER P4.4 FOR HUMAN VERIFICATION
Context: Nigeria-first ¬∑ Mobile-first ¬∑ Offline-first ¬∑ PWA-first
Prerequisites: POS-P1, POS-P2, POS-P3 completed and verified

‚∏ª

üö® GLOBAL CONSTRAINTS (NON-NEGOTIABLE)
	1.	Do NOT break offline-first behavior
	2.	Do NOT introduce accounting ledgers
	3.	Do NOT introduce background jobs
	4.	Do NOT remove demo mode
	5.	Do NOT assume constant internet
	6.	Do NOT merge waves or skip steps
	7.	Do NOT invent new roles beyond Cashier / Supervisor / Manager
	8.	Every feature must be location-aware
	9.	Every step must be testable before moving on

‚∏ª

üéØ POS-P4 OBJECTIVE

Make the POS operationally usable for:
	‚Ä¢	Multi-location businesses
	‚Ä¢	Cash supervision
	‚Ä¢	Shift-based operations
	‚Ä¢	Daily reconciliation
	‚Ä¢	Nigeria-standard X/Z reporting

This wave completes operational truth, not analytics or accounting.

‚∏ª

üì¶ POS-P4 EXECUTION PHASES

‚∏ª

üîπ P4.1 ‚Äî Shift Management (FOUNDATIONAL)

Backend
	‚Ä¢	Implement shift lifecycle:
	‚Ä¢	OPEN
	‚Ä¢	CLOSED
	‚Ä¢	Required fields:
	‚Ä¢	tenantId
	‚Ä¢	locationId
	‚Ä¢	openedByUserId
	‚Ä¢	openedAt
	‚Ä¢	openingCashAmount
	‚Ä¢	closedAt
	‚Ä¢	declaredClosingCash
	‚Ä¢	systemCalculatedCash
	‚Ä¢	varianceAmount
	‚Ä¢	closedByUserId
	‚Ä¢	Offline behavior:
	‚Ä¢	Shift open allowed offline
	‚Ä¢	Shift close queued if offline
	‚Ä¢	Variance computed on sync

Frontend
	‚Ä¢	Open Shift Screen
	‚Ä¢	Location selector (mandatory)
	‚Ä¢	Opening cash input (numeric keypad)
	‚Ä¢	Close Shift Screen
	‚Ä¢	Declared cash input
	‚Ä¢	Auto-calculated system cash
	‚Ä¢	Variance display
	‚Ä¢	Supervisor PIN required if variance ‚â† 0

Permissions
	‚Ä¢	Cashier: open shift
	‚Ä¢	Supervisor/Manager: close shift

üõë Checkpoint:
Shift can be opened/closed per location, works offline, variance recorded.

‚∏ª

üîπ P4.2 ‚Äî Register & Cash Drawer Context

Backend
	‚Ä¢	Introduce logical registerId:
	‚Ä¢	Derived from device + session
	‚Ä¢	Linked to shift + location
	‚Ä¢	Attach registerId to:
	‚Ä¢	POS sales
	‚Ä¢	Receipts
	‚Ä¢	Reconciliation summaries

Frontend
	‚Ä¢	Display active register badge in POS UI
	‚Ä¢	Register auto-created on shift open (no hardware assumptions)

üõë Checkpoint:
Sales and receipts are clearly tied to a register + location + shift.

‚∏ª

üîπ P4.3 ‚Äî X & Z Reports (Nigeria Standard)

X Report (Mid-Shift)
	‚Ä¢	Totals by payment method:
	‚Ä¢	Cash
	‚Ä¢	Transfer
	‚Ä¢	Card
	‚Ä¢	Mobile Money
	‚Ä¢	VAT collected (7.5%)
	‚Ä¢	Discounts total
	‚Ä¢	Transaction count
	‚Ä¢	Filter: current shift + location

Z Report (End-Shift)
	‚Ä¢	Final immutable totals
	‚Ä¢	Locks shift permanently
	‚Ä¢	Required for reconciliation
	‚Ä¢	Manager-only

Frontend
	‚Ä¢	Reports screen (mobile-friendly)
	‚Ä¢	Export: on-screen only (no PDF yet)

üõë Checkpoint:
X and Z reports render correctly per location and role.

‚∏ª

üîπ P4.4 ‚Äî Cash Reconciliation & Variance Workflow

Backend
	‚Ä¢	Reconciliation summary per shift:
	‚Ä¢	System cash
	‚Ä¢	Declared cash
	‚Ä¢	Variance
	‚Ä¢	Variance reasons enum:
	‚Ä¢	Short cash
	‚Ä¢	Excess cash
	‚Ä¢	Transfer mismatch
	‚Ä¢	Error correction
	‚Ä¢	Audit entry created on variance approval

Frontend
	‚Ä¢	Reconciliation screen:
	‚Ä¢	Variance explanation dropdown
	‚Ä¢	Notes field
	‚Ä¢	Supervisor PIN approval
	‚Ä¢	Read-only after approval

üõë HARD STOP ‚Äî VERIFICATION REQUIRED
	‚Ä¢	No further work beyond this point
	‚Ä¢	Prepare POS-P4 COMPLETION REPORT

‚∏ª

üìÑ REQUIRED FINAL DELIVERABLES

Replit must produce:
	1.	POS-P4 Completion Report
	‚Ä¢	Routes added
	‚Ä¢	Components added
	‚Ä¢	APIs added
	‚Ä¢	Offline behavior confirmed
	2.	Role Matrix Validation
	3.	Multi-Location Confirmation
	4.	Known Gaps (Deferred to POS-P5)
	‚Ä¢	Payroll
	‚Ä¢	Accounting ledger
	‚Ä¢	Bank reconciliation
	‚Ä¢	Advanced analytics

‚∏ª

‚ùå EXPLICITLY OUT OF SCOPE (DO NOT IMPLEMENT)
	‚Ä¢	Accounting journal entries
	‚Ä¢	Payroll
	‚Ä¢	Tax filing
	‚Ä¢	Background sync workers
	‚Ä¢	Cloud-only assumptions
	‚Ä¢	AI forecasting
	‚Ä¢	External integrations beyond existing payment stack

‚∏ª

‚úÖ SUCCESS CRITERIA

POS-P4 is complete only if:
	‚Ä¢	Shifts exist and are enforced
	‚Ä¢	Cash can be reconciled per location
	‚Ä¢	X/Z reports are accurate
	‚Ä¢	Supervisor workflows are enforced
	‚Ä¢	Offline sales reconcile safely
	‚Ä¢	Multi-location businesses can operate daily without spreadsheets

‚∏ª

END OF PROMPT

Awaiting Replit execution.
No further waves should begin until POS-P4 is explicitly verified and approved.