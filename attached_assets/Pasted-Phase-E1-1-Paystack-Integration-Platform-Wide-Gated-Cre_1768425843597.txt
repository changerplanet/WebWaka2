Phase E1.1 ‚Äî Paystack Integration (Platform-Wide, Gated, Credential-Deferred)

üéØ Objective (Non-Negotiable)

Implement Paystack as a platform-wide payment capability that:
	1.	Does NOT require Paystack keys at implementation time
	2.	Is disabled by default
	3.	Can be enabled by Super Admin per Partner (one by one)
	4.	Allows Partners to later supply their own Paystack credentials
	5.	Works across all relevant suites (Commerce, POS, SVM, MVM, Education fees, Health billing, Hospitality bookings, Sites & Funnels forms, etc.)
	6.	Does NOT break existing flows
	7.	Introduces zero hard dependencies on Paystack being active

This is a capability-layer integration, not a hardwired payment switch.

‚∏ª

üß± Architectural Principles (Must Be Enforced)

1. Capability-Based, Not Vendor-Hardcoded
	‚Ä¢	Introduce a generic payment capability layer
	‚Ä¢	Paystack is just one provider (first implementation)

Example:

payment_provider = 'paystack' | 'flutterwave' | 'manual' | 'none'


‚∏ª

2. Three-Level Control Model (CRITICAL)

Level	Control	Description
Super Admin	Enable Paystack for Partner	Platform trust gate
Partner	Configure Paystack credentials	Partner-owned keys
Tenant	Use payments if available	Inherits partner setting


‚∏ª

3. Credential-Deferred by Design
	‚Ä¢	No Paystack keys required
	‚Ä¢	No API calls to Paystack until:
	‚Ä¢	Super Admin enables Paystack for Partner
	‚Ä¢	Partner saves valid credentials
	‚Ä¢	A transaction is attempted

‚∏ª

4. Platform-Wide, Not Suite-Specific

Do NOT integrate Paystack inside:
	‚Ä¢	POS code
	‚Ä¢	Education fees
	‚Ä¢	Health billing
	‚Ä¢	Sites & Funnels forms

Instead:
	‚Ä¢	Create a central payment service
	‚Ä¢	Suites call createPaymentIntent() (generic)

‚∏ª

5. Safe Defaults
	‚Ä¢	If Paystack is not enabled:
	‚Ä¢	UI shows ‚ÄúPayments not enabled‚Äù
	‚Ä¢	APIs return a clear, non-error response
	‚Ä¢	No crashes
	‚Ä¢	No silent failures

‚∏ª

üß© What Must Be Built (Scope)

A. Database / Schema (Minimal, Additive)
	‚Ä¢	Partner-level payment configuration
	‚Ä¢	Provider-agnostic

No removal, no breaking changes.

‚∏ª

B. Super Admin Controls
	‚Ä¢	Enable / disable Paystack per Partner
	‚Ä¢	View status (Enabled / Disabled / Configured / Missing Keys)

‚∏ª

C. Partner Configuration UI (Stub)
	‚Ä¢	Save credentials (encrypted / masked)
	‚Ä¢	Validation deferred (no API call yet)
	‚Ä¢	‚ÄúTest connection‚Äù can be stubbed

‚∏ª

D. Payment Capability Service
	‚Ä¢	Abstract interface
	‚Ä¢	Paystack adapter behind it
	‚Ä¢	No real charge execution yet (can return mocked intent)

‚∏ª

E. Cross-Suite Compatibility Check

Ensure no suite assumes payments always exist:
	‚Ä¢	POS
	‚Ä¢	Online Store
	‚Ä¢	Marketplace
	‚Ä¢	Education fees
	‚Ä¢	Health billing
	‚Ä¢	Hospitality booking
	‚Ä¢	Sites & Funnels forms

‚∏ª

F. Documentation
	‚Ä¢	How Super Admin enables Paystack
	‚Ä¢	How Partners configure it
	‚Ä¢	What tenants will see
	‚Ä¢	What happens if not enabled

‚∏ª

üö´ Explicitly Out of Scope (Do NOT Do Now)
	‚Ä¢	‚ùå Live Paystack charges
	‚Ä¢	‚ùå Webhooks
	‚Ä¢	‚ùå Settlements
	‚Ä¢	‚ùå Payout automation
	‚Ä¢	‚ùå Partner revenue splits
	‚Ä¢	‚ùå Hardcoded Paystack UI in suites

Those come after this foundation.

‚∏ª

‚úÖ PHASE E1.1 ‚Äî REPLIT1 PROMPT (COPY & PASTE)

Use this exact prompt:

‚∏ª

TASK: Phase E1.1 ‚Äî Platform-Wide Paystack Integration (Capability-Based, Credential-Deferred)

MODE: IMPLEMENTATION
SCOPE: STRICT ‚Äî Follow exactly
STOP RULE: Stop after completion report. Do NOT proceed further.

‚∏ª

OBJECTIVE

Implement Paystack as a platform-wide payment capability with the following strict requirements:
	1.	Paystack is disabled by default
	2.	No Paystack API keys are required at implementation time
	3.	Super Admin can enable Paystack per Partner (one by one)
	4.	Partners can later add their own Paystack credentials
	5.	All suites must be able to use payments only if available
	6.	No suite may hard-depend on Paystack
	7.	No live charges or webhooks are required yet

This is a foundation layer, not a full payment rollout.

‚∏ª

HARD RULES (NON-NEGOTIABLE)
	‚Ä¢	‚ùå Do NOT hardcode Paystack inside any suite
	‚Ä¢	‚ùå Do NOT require real Paystack credentials
	‚Ä¢	‚ùå Do NOT call Paystack APIs
	‚Ä¢	‚ùå Do NOT break existing demo flows
	‚Ä¢	‚ùå Do NOT change auth, pricing logic, or partner earnings

‚∏ª

IMPLEMENTATION REQUIREMENTS

1. Payment Capability Layer

Create a provider-agnostic payment abstraction:
	‚Ä¢	Generic payment interface
	‚Ä¢	Paystack implemented as a provider adapter
	‚Ä¢	Must safely return ‚Äúnot enabled‚Äù if unavailable

2. Partner-Level Control
	‚Ä¢	Add ability for Super Admin to:
	‚Ä¢	Enable / disable Paystack per Partner
	‚Ä¢	Partner cannot use Paystack unless enabled by Super Admin

3. Partner Credential Storage (Stub)
	‚Ä¢	Allow Partner to save Paystack credentials
	‚Ä¢	Keys must be masked/encrypted
	‚Ä¢	No validation against Paystack required

4. Safe Fallback Behavior
	‚Ä¢	If Paystack is not enabled or not configured:
	‚Ä¢	UI shows clear ‚ÄúPayments not enabled‚Äù state
	‚Ä¢	APIs return structured, non-fatal responses

5. Cross-Suite Compatibility Audit

Verify all payment-touching suites:
	‚Ä¢	POS
	‚Ä¢	Online Store (SVM)
	‚Ä¢	Marketplace (MVM)
	‚Ä¢	Education fees
	‚Ä¢	Health billing
	‚Ä¢	Hospitality booking
	‚Ä¢	Sites & Funnels forms

Ensure none assume payments are always active.

6. Documentation

Create a single markdown doc explaining:
	‚Ä¢	Super Admin flow
	‚Ä¢	Partner setup flow
	‚Ä¢	Tenant behavior
	‚Ä¢	Future extension points

‚∏ª

DELIVERABLES
	‚Ä¢	Code changes (minimal, additive)
	‚Ä¢	Schema changes (if needed, additive only)
	‚Ä¢	Admin + Partner UI stubs
	‚Ä¢	Payment capability service
	‚Ä¢	Documentation
	‚Ä¢	Completion report

‚∏ª

STOP CONDITION

After implementation:
	‚Ä¢	Produce Phase E1.1 Completion Report
	‚Ä¢	List files changed
	‚Ä¢	List what is enabled vs stubbed
	‚Ä¢	Confirm no live payments executed

üõë STOP after report. Do not proceed to next phase.

‚∏ª

üß≠ What Comes Next (For You, Not Replit)

After this phase:
	‚Ä¢	Phase E1.2 ‚Üí Paystack transaction execution
	‚Ä¢	Phase E1.3 ‚Üí Webhooks
	‚Ä¢	Phase E1.4 ‚Üí Partner earnings & splits

But do not start those yet.