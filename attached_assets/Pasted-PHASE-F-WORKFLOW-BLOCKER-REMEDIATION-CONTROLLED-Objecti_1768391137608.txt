PHASE F ‚Äî WORKFLOW BLOCKER REMEDIATION (CONTROLLED)

Objective
Fix the blockers identified in Phase D5 so that seeded demo data is correctly surfaced and core workflows function as designed.

‚∏ª

Scope (STRICT)

‚úÖ Allowed
	‚Ä¢	Modify API route handlers
	‚Ä¢	Modify service-layer logic
	‚Ä¢	Fix capability guard logic
	‚Ä¢	Remove mock/stub responses
	‚Ä¢	Align APIs with existing Prisma models
	‚Ä¢	Add logging for verification (temporary, non-invasive)

‚ùå Forbidden
	‚Ä¢	‚ùå NO Prisma schema changes
	‚Ä¢	‚ùå NO database reseeding
	‚Ä¢	‚ùå NO data deletion
	‚Ä¢	‚ùå NO role/permission weakening
	‚Ä¢	‚ùå NO UI redesign
	‚Ä¢	‚ùå NO feature additions

If a fix requires reseeding or schema change:
‚û°Ô∏è STOP and REPORT.

‚∏ª

Fix Tasks (Execute in Order)

F1 ‚Äî Diagnostic Confirmation (Log-Only First)
	1.	Identify all Commerce/SVM APIs returning hardcoded or mock data
	2.	Confirm whether they bypass Prisma queries
	3.	Identify which POS tables (if any) were written to during D3
	4.	Log tenantId + partnerId resolution in failing APIs

üìå Produce a short diagnostic summary before applying fixes.

‚∏ª

F2 ‚Äî Commerce & SVM API Normalization
	1.	Replace mock responses with Prisma-backed queries
	2.	Ensure all queries are filtered by:
	‚Ä¢	tenantId
	‚Ä¢	partnerId
	3.	Confirm products seeded in DB are returned via API

‚∏ª

F3 ‚Äî POS Data Visibility Fix
	1.	Verify correct POS schema usage
	2.	Align POS API queries with existing tables
	3.	Ensure shifts and sales (if present) are retrievable
	4.	If no records exist:
	‚Ä¢	REPORT (do NOT reseed)

‚∏ª

F4 ‚Äî Capability Guard Alignment
	1.	Fix tenant context derivation:
	‚Ä¢	session ‚Üí tenantId
	‚Ä¢	route ‚Üí tenantId
	2.	Ensure valid demo tenants pass capability checks
	3.	Preserve strict role enforcement

‚∏ª

Verification (MANDATORY)

After fixes:
	‚Ä¢	Re-test D5-B workflows:
	‚Ä¢	Commerce (Products visible)
	‚Ä¢	POS (Shifts/Sales visible OR correctly reported missing)
	‚Ä¢	Education / Health APIs respond 200
	‚Ä¢	Confirm:
	‚Ä¢	No cross-tenant access
	‚Ä¢	No unauthorized access

‚∏ª

Deliverables
	1.	PHASE_F_FIX_REPORT.md
	‚Ä¢	Root cause per blocker
	‚Ä¢	Files modified
	‚Ä¢	Before/After behavior
	2.	Explicit PASS / FAIL for:
	‚Ä¢	Commerce workflows
	‚Ä¢	POS workflows
	‚Ä¢	Capability guards

‚∏ª

Stop Conditions
	‚Ä¢	‚ùó Do NOT proceed to Phase D6
	‚Ä¢	‚ùó Do NOT seed data
	‚Ä¢	‚ùó Do NOT deploy

STOP after report submission.

‚∏ª

üö¶BEGIN PHASE F NOW