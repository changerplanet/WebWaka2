generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model AuditLog {
  id         String      @id
  action     AuditAction
  actorId    String
  actorEmail String
  tenantId   String?
  targetType String?
  targetId   String?
  metadata   Json?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime    @default(now())

  @@index([action])
  @@index([actorId])
  @@index([createdAt])
  @@index([targetType, targetId])
  @@index([tenantId])
}

model BusinessProfile {
  id                 String   @id
  tenantId           String   @unique
  legalName          String?
  tradingName        String?
  taxId              String?
  registrationNumber String?
  businessType       String?
  industry           String?
  email              String?
  phone              String?
  website            String?
  addressLine1       String?
  addressLine2       String?
  city               String?
  state              String?
  postalCode         String?
  country            String?  @default("US")
  timezone           String   @default("UTC")
  currency           String   @default("USD")
  dateFormat         String   @default("YYYY-MM-DD")
  createdAt          DateTime @default(now())
  updatedAt          DateTime
  Tenant             Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model Customer {
  id                String            @id
  tenantId          String
  email             String?
  phone             String?
  firstName         String?
  lastName          String?
  fullName          String?
  company           String?
  taxId             String?
  defaultAddressId  String?
  status            CustomerStatus    @default(ACTIVE)
  acceptsMarketing  Boolean           @default(false)
  marketingOptInAt  DateTime?
  notes             String?
  tags              String[]          @default([])
  totalOrders       Int               @default(0)
  totalSpent        Decimal           @default(0) @db.Decimal(12, 2)
  averageOrderValue Decimal?          @db.Decimal(12, 2)
  lastOrderAt       DateTime?
  loyaltyPoints     Int               @default(0)
  loyaltyTier       String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  CustomerAddress   CustomerAddress[]
  Wallet            Wallet[]

  @@unique([tenantId, email])
  @@index([email])
  @@index([phone])
  @@index([status])
  @@index([tenantId])
}

model CustomerAddress {
  id           String      @id
  customerId   String
  type         AddressType @default(BOTH)
  firstName    String?
  lastName     String?
  company      String?
  phone        String?
  addressLine1 String
  addressLine2 String?
  city         String
  state        String?
  postalCode   String
  country      String
  isDefault    Boolean     @default(false)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime
  Customer     Customer    @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([customerId])
}

model Entitlement {
  id             String            @id
  tenantId       String
  subscriptionId String?
  module         String
  status         EntitlementStatus @default(ACTIVE)
  validFrom      DateTime          @default(now())
  validUntil     DateTime?
  limits         Json?
  source         String            @default("subscription")
  createdAt      DateTime          @default(now())
  updatedAt      DateTime
  Subscription   Subscription?     @relation(fields: [subscriptionId], references: [id])
  Tenant         Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, module])
  @@index([module])
  @@index([status])
  @@index([tenantId])
}

model InstanceFinancialSummary {
  id                        String           @id
  platformInstanceId        String           @unique
  partnerId                 String
  totalRevenue              Decimal          @default(0) @db.Decimal(14, 2)
  currentMonthRevenue       Decimal          @default(0) @db.Decimal(14, 2)
  lastMonthRevenue          Decimal          @default(0) @db.Decimal(14, 2)
  totalWholesaleCost        Decimal          @default(0) @db.Decimal(14, 2)
  currentMonthWholesaleCost Decimal          @default(0) @db.Decimal(14, 2)
  totalProfit               Decimal          @default(0) @db.Decimal(14, 2)
  currentMonthProfit        Decimal          @default(0) @db.Decimal(14, 2)
  outstandingBalance        Decimal          @default(0) @db.Decimal(14, 2)
  totalCommissionEarned     Decimal          @default(0) @db.Decimal(14, 2)
  pendingCommission         Decimal          @default(0) @db.Decimal(14, 2)
  paidCommission            Decimal          @default(0) @db.Decimal(14, 2)
  lastCalculatedAt          DateTime         @default(now())
  createdAt                 DateTime         @default(now())
  updatedAt                 DateTime
  Partner                   Partner          @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  PlatformInstance          PlatformInstance @relation(fields: [platformInstanceId], references: [id], onDelete: Cascade)

  @@index([lastCalculatedAt])
  @@index([partnerId])
}

model InstanceSubscription {
  id                 String                     @id
  platformInstanceId String                     @unique
  partnerId          String
  planId             String?
  status             InstanceSubscriptionStatus @default(TRIAL)
  billingInterval    String                     @default("monthly")
  currentPeriodStart DateTime
  currentPeriodEnd   DateTime
  amount             Decimal                    @db.Decimal(12, 2)
  currency           String                     @default("NGN")
  wholesaleCost      Decimal                    @db.Decimal(12, 2)
  partnerMargin      Decimal                    @db.Decimal(12, 2)
  trialStart         DateTime?
  trialEnd           DateTime?
  suspendedAt        DateTime?
  suspendedReason    String?
  cancelledAt        DateTime?
  cancelReason       String?
  cancelAtPeriodEnd  Boolean                    @default(false)
  metadata           Json?
  createdAt          DateTime                   @default(now())
  updatedAt          DateTime
  Partner            Partner                    @relation(fields: [partnerId], references: [id])
  SubscriptionPlan   SubscriptionPlan?          @relation(fields: [planId], references: [id])
  PlatformInstance   PlatformInstance           @relation(fields: [platformInstanceId], references: [id], onDelete: Cascade)

  @@index([currentPeriodEnd])
  @@index([partnerId])
  @@index([status])
}

model InventoryLevel {
  id                String          @id
  tenantId          String
  productId         String
  variantId         String?
  locationId        String
  quantityOnHand    Int             @default(0)
  quantityReserved  Int             @default(0)
  quantityAvailable Int             @default(0)
  quantityIncoming  Int             @default(0)
  reorderPoint      Int?
  reorderQuantity   Int?
  binLocation       String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime
  lastCountedAt     DateTime?
  Location          Location        @relation(fields: [locationId], references: [id], onDelete: Cascade)
  Product           Product         @relation(fields: [productId], references: [id], onDelete: Cascade)
  ProductVariant    ProductVariant? @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@unique([productId, variantId, locationId])
  @@index([locationId])
  @@index([productId])
  @@index([quantityAvailable])
  @@index([tenantId])
}

model Invoice {
  id             String       @id
  subscriptionId String
  tenantId       String
  invoiceNumber  String       @unique
  status         String
  subtotal       Decimal      @db.Decimal(12, 2)
  tax            Decimal      @default(0) @db.Decimal(12, 2)
  total          Decimal      @db.Decimal(12, 2)
  amountPaid     Decimal      @default(0) @db.Decimal(12, 2)
  amountDue      Decimal      @db.Decimal(12, 2)
  currency       String       @default("USD")
  periodStart    DateTime
  periodEnd      DateTime
  issuedAt       DateTime     @default(now())
  dueAt          DateTime
  paidAt         DateTime?
  externalId     String?
  hostedUrl      String?
  pdfUrl         String?
  partnerId      String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime
  Subscription   Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
  Tenant         Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([partnerId])
  @@index([status])
  @@index([subscriptionId])
  @@index([tenantId])
}

model Location {
  id                String           @id
  tenantId          String
  name              String
  code              String?
  type              String           @default("STORE")
  status            LocationStatus   @default(ACTIVE)
  email             String?
  phone             String?
  addressLine1      String?
  addressLine2      String?
  city              String?
  state             String?
  postalCode        String?
  country           String?
  latitude          Decimal?         @db.Decimal(10, 8)
  longitude         Decimal?         @db.Decimal(11, 8)
  operatingHours    Json?
  isDefaultLocation Boolean          @default(false)
  allowsPickup      Boolean          @default(false)
  allowsShipping    Boolean          @default(false)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime
  InventoryLevel    InventoryLevel[]
  StaffMember       StaffMember[]

  @@unique([tenantId, code])
  @@index([status])
  @@index([tenantId])
}

model MagicLink {
  id        String    @id
  token     String    @unique
  userId    String
  tenantId  String?
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime  @default(now())
  tenant    Tenant?   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([token])
  @@index([userId])
}

model Notification {
  id             String              @id
  tenantId       String?
  userId         String?
  recipientEmail String?
  recipientPhone String?
  channel        NotificationChannel
  title          String?
  body           String
  actionUrl      String?
  templateId     String?
  templateData   Json?
  status         NotificationStatus  @default(PENDING)
  scheduledAt    DateTime?
  sentAt         DateTime?
  deliveredAt    DateTime?
  readAt         DateTime?
  failedAt       DateTime?
  failureReason  String?
  sourceModule   String?
  sourceEvent    String?
  sourceId       String?
  createdAt      DateTime            @default(now())

  @@index([channel])
  @@index([createdAt])
  @@index([status])
  @@index([tenantId])
  @@index([userId])
}

model NotificationPreference {
  id        String   @id
  userId    String
  tenantId  String?
  category  String
  email     Boolean  @default(true)
  sms       Boolean  @default(false)
  push      Boolean  @default(true)
  inApp     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@unique([userId, tenantId, category])
  @@index([userId])
}

model OtpCode {
  id                String     @id
  phone             String?
  email             String?
  userId            String?
  code              String
  codeHash          String
  purpose           OtpPurpose @default(LOGIN)
  channel           OtpChannel @default(SMS)
  status            OtpStatus  @default(PENDING)
  attempts          Int        @default(0)
  maxAttempts       Int        @default(3)
  resendCount       Int        @default(0)
  maxResends        Int        @default(3)
  lastResentAt      DateTime?
  expiresAt         DateTime
  verifiedAt        DateTime?
  verifiedIp        String?
  verifiedUserAgent String?
  provider          String?
  providerMsgId     String?
  ipAddress         String?
  userAgent         String?
  deviceFingerprint String?
  createdAt         DateTime   @default(now())
  user              User?      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([email])
  @@index([expiresAt])
  @@index([phone])
  @@index([status])
  @@index([userId])
}

model Partner {
  id                         String                     @id
  name                       String
  slug                       String                     @unique
  email                      String
  phone                      String?
  website                    String?
  status                     PartnerStatus              @default(PENDING)
  tier                       PartnerTier                @default(BRONZE)
  companyNumber              String?
  taxId                      String?
  address                    Json?
  metadata                   Json?
  createdAt                  DateTime                   @default(now())
  updatedAt                  DateTime
  approvedAt                 DateTime?
  instanceFinancialSummaries InstanceFinancialSummary[]
  instanceSubscriptions      InstanceSubscription[]
  agreements                 PartnerAgreement[]
  earnings                   PartnerEarning[]
  instanceEarnings           PartnerInstanceEarning[]
  packages                   PartnerPackage[]
  payoutSettings             PartnerPayoutSettings?
  referrals                  PartnerReferral[]
  referralCodes              PartnerReferralCode[]
  users                      PartnerUser[]
  payoutBatches              PayoutBatch[]
  createdInstances           PlatformInstance[]
  paymentConfigs             PartnerPaymentConfig[]

  @@index([email])
  @@index([slug])
  @@index([status])
  @@index([tier])
}

model PartnerPaymentConfig {
  id                   String    @id @default(uuid())
  partnerId            String
  provider             String    // 'paystack' | 'flutterwave' | 'manual' | 'none'
  enabledBySuperAdmin  Boolean   @default(false)
  enabledAt            DateTime?
  enabledByUserId      String?
  publicKey            String?
  secretKeyEncrypted   String?   // Encrypted secret key
  webhookSecret        String?
  testMode             Boolean   @default(true)
  configuredAt         DateTime?
  lastValidatedAt      DateTime?
  validationStatus     String?   // 'valid' | 'invalid' | 'pending'
  validationError      String?
  metadata             Json?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  Partner              Partner   @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  @@unique([partnerId, provider])
  @@index([partnerId])
  @@index([provider])
  @@index([enabledBySuperAdmin])
}

// Platform-wide transaction model for payment execution (Phase E1.2)
// Provider-agnostic - works with Paystack, Flutterwave, or any future provider
model PaymentTransaction {
  id                   String                    @id @default(uuid())
  tenantId             String
  partnerId            String
  
  // Transaction identification
  reference            String                    @unique  // Platform-generated unique reference
  providerReference    String?                   // Provider's transaction reference (e.g., Paystack reference)
  
  // Transaction details
  type                 PaymentTransactionType    @default(PAYMENT)
  status               PaymentTransactionStatus  @default(PENDING)
  provider             String                    // 'paystack' | 'flutterwave' | 'manual' | 'demo'
  
  // Financial details
  amount               Decimal                   @db.Decimal(12, 2)
  currency             String                    @default("NGN")
  fee                  Decimal?                  @db.Decimal(12, 2)  // Provider fee if applicable
  netAmount            Decimal?                  @db.Decimal(12, 2)  // Amount after fee
  
  // Customer details (denormalized for query efficiency)
  customerEmail        String
  customerName         String?
  customerId           String?                   // Optional link to Customer model
  
  // Source context (which suite/module initiated this)
  sourceModule         String?                   // e.g., 'svm', 'pos', 'forms', etc.
  sourceType           String?                   // e.g., 'order', 'invoice', 'form_submission'
  sourceId             String?                   // ID of the source record
  
  // Provider response data
  authorizationUrl     String?                   // URL for customer to complete payment
  accessCode           String?                   // Provider access code
  channel              String?                   // Payment channel: card, bank, ussd, etc.
  gatewayResponse      String?                   // Raw gateway response message
  
  // Timestamps
  initiatedAt          DateTime                  @default(now())
  verifiedAt           DateTime?                 // When payment was verified
  completedAt          DateTime?                 // When transaction completed (success/fail)
  expiredAt            DateTime?                 // When transaction expired (if applicable)
  
  // Metadata for extensibility
  metadata             Json?                     // Additional context (items, descriptions, etc.)
  providerMetadata     Json?                     // Raw provider response for debugging
  
  // Error tracking
  errorCode            String?
  errorMessage         String?
  
  // Demo mode flag
  isDemo               Boolean                   @default(false)
  
  createdAt            DateTime                  @default(now())
  updatedAt            DateTime                  @updatedAt

  @@index([tenantId])
  @@index([partnerId])
  @@index([status])
  @@index([provider])
  @@index([customerEmail])
  @@index([sourceModule, sourceType, sourceId])
  @@index([initiatedAt])
  @@index([isDemo])
}

model PartnerAgreement {
  id                String            @id
  partnerId         String
  version           Int
  effectiveFrom     DateTime
  effectiveTo       DateTime?
  commissionType    CommissionType    @default(PERCENTAGE)
  commissionRate    Decimal           @db.Decimal(5, 4)
  commissionTiers   Json?
  terms             Json?
  status            AgreementStatus   @default(DRAFT)
  signedAt          DateTime?
  signedByUserId    String?
  approvedAt        DateTime?
  approvedByUserId  String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  clearanceDays     Int               @default(30)
  commissionRules   Json?
  commissionTrigger CommissionTrigger @default(ON_PAYMENT)
  currency          String            @default("USD")
  fixedAmount       Decimal?          @db.Decimal(12, 2)
  maxCommission     Decimal?          @db.Decimal(12, 2)
  minCommission     Decimal?          @db.Decimal(12, 2)
  setupFee          Decimal?          @db.Decimal(12, 2)
  Partner           Partner           @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  PartnerEarning    PartnerEarning[]

  @@unique([partnerId, version])
  @@index([effectiveFrom, effectiveTo])
  @@index([partnerId])
  @@index([status])
}

model PartnerEarning {
  id                  String           @id
  partnerId           String
  referralId          String
  agreementId         String
  periodStart         DateTime
  periodEnd           DateTime
  grossAmount         Decimal          @db.Decimal(12, 2)
  commissionRate      Decimal?         @db.Decimal(5, 4)
  commissionAmount    Decimal          @db.Decimal(12, 2)
  currency            String           @default("USD")
  status              EarningStatus    @default(PENDING)
  paidAt              DateTime?
  paymentReference    String?
  paymentMethod       String?
  createdAt           DateTime         @default(now())
  approvedAt          DateTime?
  approvedByUserId    String?
  calculationDetails  Json?
  clearedAt           DateTime?
  commissionType      CommissionType
  createdByUserId     String?
  disputedAt          DateTime?
  entryType           EarningEntryType @default(CREDIT)
  fixedAmount         Decimal?         @db.Decimal(12, 2)
  idempotencyKey      String           @unique
  metadata            Json?
  payoutBatchId       String?
  reversalEntryId     String?
  reversalReason      String?
  reversedAt          DateTime?
  reversedById        String?
  subscriptionEventId String?
  voidedAt            DateTime?
  PartnerAgreement    PartnerAgreement @relation(fields: [agreementId], references: [id])
  Partner             Partner          @relation(fields: [partnerId], references: [id])
  PartnerReferral     PartnerReferral  @relation(fields: [referralId], references: [id])

  @@index([agreementId])
  @@index([createdAt])
  @@index([entryType])
  @@index([partnerId])
  @@index([payoutBatchId])
  @@index([periodStart, periodEnd])
  @@index([referralId])
  @@index([status])
}

model PartnerInstanceEarning {
  id                 String           @id
  partnerId          String
  platformInstanceId String
  earningType        String
  description        String?
  referenceType      String?
  referenceId        String?
  grossAmount        Decimal          @db.Decimal(12, 2)
  commissionRate     Decimal          @db.Decimal(5, 4)
  commissionAmount   Decimal          @db.Decimal(12, 2)
  currency           String           @default("NGN")
  status             EarningStatus    @default(PENDING)
  clearsAt           DateTime?
  clearedAt          DateTime?
  payoutId           String?
  paidAt             DateTime?
  metadata           Json?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime
  Partner            Partner          @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  PlatformInstance   PlatformInstance @relation(fields: [platformInstanceId], references: [id], onDelete: Cascade)

  @@index([clearsAt])
  @@index([createdAt])
  @@index([partnerId])
  @@index([platformInstanceId])
  @@index([status])
}

model PartnerPackage {
  id                   String   @id
  partnerId            String
  name                 String
  slug                 String
  description          String?
  includedInstances    Int      @default(1)
  includedSuiteKeys    String[] @default([])
  priceMonthly         Decimal  @db.Decimal(12, 2)
  priceYearly          Decimal? @db.Decimal(12, 2)
  setupFee             Decimal? @db.Decimal(12, 2)
  trialDays            Int      @default(14)
  currency             String   @default("NGN")
  wholesaleCostMonthly Decimal? @db.Decimal(12, 2)
  features             Json?
  isActive             Boolean  @default(true)
  isPublic             Boolean  @default(true)
  sortOrder            Int      @default(0)
  createdAt            DateTime @default(now())
  updatedAt            DateTime
  Partner              Partner  @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  @@unique([partnerId, slug])
  @@index([isActive, isPublic])
  @@index([partnerId])
}

model PartnerPayoutSettings {
  id                    String    @id
  partnerId             String    @unique
  minimumPayout         Decimal   @default(100.00) @db.Decimal(12, 2)
  currency              String    @default("USD")
  payoutFrequency       String    @default("MONTHLY")
  taxWithholdingEnabled Boolean   @default(false)
  taxWithholdingRate    Decimal?  @db.Decimal(5, 4)
  taxWithholdingReason  String?
  taxDocumentStatus     String    @default("NOT_SUBMITTED")
  taxDocumentType       String?
  taxDocumentVerifiedAt DateTime?
  paymentMethodType     String?
  paymentMethodVerified Boolean   @default(false)
  paymentMethodDetails  Json?
  payoutHold            Boolean   @default(false)
  payoutHoldReason      String?
  payoutHoldUntil       DateTime?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime
  Partner               Partner   @relation(fields: [partnerId], references: [id], onDelete: Cascade)
}

model PartnerReferral {
  id                    String               @id
  partnerId             String
  tenantId              String               @unique
  referralCodeId        String?
  referredAt            DateTime             @default(now())
  attributionLocked     Boolean              @default(false)
  lockedAt              DateTime?
  referralSource        String?
  landingPage           String?
  metadata              Json?
  createdAt             DateTime             @default(now())
  attributionExpiresAt  DateTime?
  attributionMethod     AttributionMethod    @default(REFERRAL_LINK)
  attributionWindowDays Int?
  createdByUserId       String?
  PartnerEarning        PartnerEarning[]
  Partner               Partner              @relation(fields: [partnerId], references: [id])
  PartnerReferralCode   PartnerReferralCode? @relation(fields: [referralCodeId], references: [id])
  Tenant                Tenant               @relation(fields: [tenantId], references: [id])
  Subscription          Subscription[]

  @@index([attributionLocked])
  @@index([attributionMethod])
  @@index([partnerId])
  @@index([referredAt])
  @@index([tenantId])
}

model PartnerReferralCode {
  id              String            @id
  partnerId       String
  code            String            @unique
  isActive        Boolean           @default(true)
  usageLimit      Int?
  usageCount      Int               @default(0)
  expiresAt       DateTime?
  campaignName    String?
  metadata        Json?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  PartnerReferral PartnerReferral[]
  Partner         Partner           @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  @@index([code])
  @@index([isActive])
  @@index([partnerId])
}

model PartnerUser {
  id                String      @id
  partnerId         String
  userId            String      @unique
  role              PartnerRole @default(PARTNER_STAFF)
  isActive          Boolean     @default(true)
  createdAt         DateTime    @default(now())
  updatedAt         DateTime
  joinedAt          DateTime    @default(now())
  assignedTenantIds String[]    @default([])
  department        String?
  displayName       String?
  partner           Partner     @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  user              User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([partnerId, userId])
  @@index([partnerId])
  @@index([role])
}

model PayoutBatch {
  id                 String    @id
  partnerId          String
  batchNumber        String    @unique
  status             String    @default("DRAFT")
  currency           String    @default("USD")
  earningsCount      Int
  periodStart        DateTime
  periodEnd          DateTime
  paymentMethod      String?
  paymentReference   String?
  processedAt        DateTime?
  approvedAt         DateTime?
  approvedByUserId   String?
  createdAt          DateTime  @default(now())
  blockReason        String?
  cancellationReason String?
  cancelledAt        DateTime?
  cancelledByUserId  String?
  failureReason      String?
  grossAmount        Decimal   @db.Decimal(12, 2)
  internalNotes      String?
  netAmount          Decimal   @db.Decimal(12, 2)
  readinessChecks    Json?
  readinessStatus    String    @default("NOT_CHECKED")
  taxWithholding     Decimal   @default(0) @db.Decimal(12, 2)
  updatedAt          DateTime
  Partner            Partner   @relation(fields: [partnerId], references: [id])

  @@index([createdAt])
  @@index([partnerId])
  @@index([readinessStatus])
  @@index([status])
}

model PlatformInstance {
  id                       String                    @id
  tenantId                 String
  name                     String
  slug                     String
  description              String?
  suiteKeys                String[]                  @default([])
  displayName              String?
  logoUrl                  String?
  faviconUrl               String?
  primaryColor             String?
  secondaryColor           String?
  navigationConfig         Json?                     @default("{}")
  isDefault                Boolean                   @default(false)
  isActive                 Boolean                   @default(true)
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime
  createdByPartnerId       String?
  suspendedAt              DateTime?
  suspendedReason          String?
  InstanceFinancialSummary InstanceFinancialSummary?
  InstanceSubscription     InstanceSubscription?
  PartnerInstanceEarning   PartnerInstanceEarning[]
  createdByPartner         Partner?                  @relation(fields: [createdByPartnerId], references: [id])
  tenant                   Tenant                    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  domains                  TenantDomain[]

  @@unique([tenantId, slug])
  @@index([createdByPartnerId])
  @@index([isActive])
  @@index([isDefault])
  @@index([tenantId])
}

model PricingRule {
  id            String           @id
  tenantId      String
  name          String
  description   String?
  type          PricingRuleType
  value         Decimal          @db.Decimal(12, 4)
  scope         PricingRuleScope @default(ALL_PRODUCTS)
  scopeIds      String[]         @default([])
  minQuantity   Int?
  minOrderValue Decimal?         @db.Decimal(12, 2)
  startsAt      DateTime?
  endsAt        DateTime?
  priority      Int              @default(0)
  isActive      Boolean          @default(true)
  isStackable   Boolean          @default(false)
  createdAt     DateTime         @default(now())
  updatedAt     DateTime

  @@index([isActive])
  @@index([scope])
  @@index([startsAt, endsAt])
  @@index([tenantId])
}

model Product {
  id               String           @id
  tenantId         String
  name             String
  slug             String
  sku              String?
  barcode          String?
  description      String?
  shortDescription String?
  categoryId       String?
  tags             String[]         @default([])
  type             ProductType      @default(PHYSICAL)
  price            Decimal          @db.Decimal(12, 2)
  compareAtPrice   Decimal?         @db.Decimal(12, 2)
  costPrice        Decimal?         @db.Decimal(12, 2)
  taxable          Boolean          @default(true)
  taxCategoryId    String?
  weight           Decimal?         @db.Decimal(10, 4)
  weightUnit       String?          @default("kg")
  length           Decimal?         @db.Decimal(10, 2)
  width            Decimal?         @db.Decimal(10, 2)
  height           Decimal?         @db.Decimal(10, 2)
  dimensionUnit    String?          @default("cm")
  trackInventory   Boolean          @default(true)
  allowBackorder   Boolean          @default(false)
  images           Json?
  metaTitle        String?
  metaDescription  String?
  status           ProductStatus    @default(DRAFT)
  publishedAt      DateTime?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime
  InventoryLevel   InventoryLevel[]
  ProductCategory  ProductCategory? @relation(fields: [categoryId], references: [id])
  ProductVariant   ProductVariant[]

  @@unique([tenantId, sku])
  @@unique([tenantId, slug])
  @@index([barcode])
  @@index([categoryId])
  @@index([status])
  @@index([tenantId])
}

model ProductCategory {
  id                    String            @id
  tenantId              String
  name                  String
  slug                  String
  description           String?
  imageUrl              String?
  parentId              String?
  sortOrder             Int               @default(0)
  isActive              Boolean           @default(true)
  createdAt             DateTime          @default(now())
  updatedAt             DateTime
  Product               Product[]
  ProductCategory       ProductCategory?  @relation("ProductCategoryToProductCategory", fields: [parentId], references: [id])
  other_ProductCategory ProductCategory[] @relation("ProductCategoryToProductCategory")

  @@unique([tenantId, slug])
  @@index([parentId])
  @@index([tenantId])
}

model ProductVariant {
  id             String           @id
  productId      String
  name           String
  sku            String?
  barcode        String?
  options        Json?
  price          Decimal?         @db.Decimal(12, 2)
  compareAtPrice Decimal?         @db.Decimal(12, 2)
  costPrice      Decimal?         @db.Decimal(12, 2)
  weight         Decimal?         @db.Decimal(10, 4)
  imageUrl       String?
  isActive       Boolean          @default(true)
  position       Int              @default(0)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  InventoryLevel InventoryLevel[]
  Product        Product          @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([barcode])
  @@index([productId])
  @@index([sku])
}

model Session {
  id                String    @id
  userId            String
  token             String    @unique
  activeTenant      String?
  userAgent         String?
  ipAddress         String?
  expiresAt         DateTime
  createdAt         DateTime  @default(now())
  lastActiveAt      DateTime  @default(now())
  authMethod        String    @default("magic_link")
  deviceFingerprint String?
  deviceName        String?
  isRemembered      Boolean   @default(false)
  rememberedAt      DateTime?
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([deviceFingerprint])
  @@index([expiresAt])
  @@index([token])
  @@index([userId])
}

model SignupSession {
  id                String     @id
  sessionToken      String     @unique
  phone             String?
  email             String?
  currentStep       SignupStep @default(IDENTITY)
  stepsCompleted    String[]   @default([])
  userIntent        String?
  businessName      String?
  businessType      String?
  country           String     @default("NG")
  state             String?
  city              String?
  discoveryChoices  String[]   @default([])
  marketingIntent   String?
  marketingSource   String?
  referralCode      String?
  partnerId         String?
  userId            String?
  tenantId          String?
  completedAt       DateTime?
  expiresAt         DateTime
  lastActiveAt      DateTime   @default(now())
  ipAddress         String?
  userAgent         String?
  deviceFingerprint String?
  createdAt         DateTime   @default(now())
  updatedAt         DateTime

  @@index([currentStep])
  @@index([email])
  @@index([expiresAt])
  @@index([phone])
  @@index([sessionToken])
}

model StaffMember {
  id          String      @id
  tenantId    String
  userId      String?
  email       String
  firstName   String
  lastName    String
  phone       String?
  employeeId  String?
  department  String?
  jobTitle    String?
  hireDate    DateTime?
  locationId  String?
  status      StaffStatus @default(ACTIVE)
  permissions String[]    @default([])
  pinHash     String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime
  Location    Location?   @relation(fields: [locationId], references: [id])

  @@unique([tenantId, email])
  @@unique([tenantId, employeeId])
  @@index([locationId])
  @@index([status])
  @@index([tenantId])
}

model Subscription {
  id                 String              @id
  tenantId           String              @unique
  planId             String
  status             SubscriptionStatus  @default(PENDING)
  billingInterval    BillingInterval     @default(MONTHLY)
  currentPeriodStart DateTime
  currentPeriodEnd   DateTime
  amount             Decimal             @db.Decimal(12, 2)
  currency           String              @default("USD")
  trialStart         DateTime?
  trialEnd           DateTime?
  cancelledAt        DateTime?
  cancelReason       String?
  cancelAtPeriodEnd  Boolean             @default(false)
  externalId         String?
  paymentProvider    String?
  partnerReferralId  String?
  metadata           Json?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime
  gracePeriodDays    Int                 @default(7)
  gracePeriodEnd     DateTime?
  gracePeriodStart   DateTime?
  paymentFailedAt    DateTime?
  paymentRetryCount  Int                 @default(0)
  Entitlement        Entitlement[]
  Invoice            Invoice[]
  PartnerReferral    PartnerReferral?    @relation(fields: [partnerReferralId], references: [id])
  SubscriptionPlan   SubscriptionPlan    @relation(fields: [planId], references: [id])
  Tenant             Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  SubscriptionEvent  SubscriptionEvent[]

  @@index([currentPeriodEnd])
  @@index([partnerReferralId])
  @@index([status])
  @@index([tenantId])
}

model SubscriptionEvent {
  id              String                @id
  subscriptionId  String
  eventType       SubscriptionEventType
  tenantId        String
  partnerId       String?
  modules         String[]
  billingAmount   Decimal?              @db.Decimal(12, 2)
  billingCurrency String?
  billingInterval BillingInterval?
  periodStart     DateTime?
  periodEnd       DateTime?
  metadata        Json?
  externalEventId String?
  occurredAt      DateTime              @default(now())
  Subscription    Subscription          @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)

  @@index([eventType])
  @@index([occurredAt])
  @@index([partnerId])
  @@index([subscriptionId])
  @@index([tenantId])
}

model SubscriptionPlan {
  id                   String                 @id
  name                 String
  slug                 String                 @unique
  description          String?
  priceMonthly         Decimal                @db.Decimal(12, 2)
  priceYearly          Decimal                @db.Decimal(12, 2)
  currency             String                 @default("USD")
  includedModules      String[]
  maxUsers             Int?
  maxStorage           Int?
  features             Json?
  isActive             Boolean                @default(true)
  isPublic             Boolean                @default(true)
  sortOrder            Int                    @default(0)
  trialDays            Int                    @default(14)
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  gracePeriodDays      Int                    @default(7)
  InstanceSubscription InstanceSubscription[]
  Subscription         Subscription[]

  @@index([isActive, isPublic])
  @@index([slug])
}

model Supplier {
  id           String         @id
  tenantId     String
  name         String
  code         String?
  email        String?
  phone        String?
  website      String?
  contactName  String?
  contactEmail String?
  contactPhone String?
  addressLine1 String?
  addressLine2 String?
  city         String?
  state        String?
  postalCode   String?
  country      String?
  paymentTerms String?
  currency     String         @default("USD")
  status       SupplierStatus @default(ACTIVE)
  notes        String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime

  @@unique([tenantId, code])
  @@index([status])
  @@index([tenantId])
}

model TaxRate {
  id            String   @id
  taxRuleId     String
  taxCategoryId String?
  rate          Decimal? @db.Decimal(6, 4)
  isExempt      Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  TaxRule       TaxRule  @relation(fields: [taxRuleId], references: [id], onDelete: Cascade)

  @@index([taxCategoryId])
  @@index([taxRuleId])
}

model TaxRule {
  id                String    @id
  tenantId          String
  name              String
  code              String?
  country           String
  state             String?
  postalCode        String?
  city              String?
  rate              Decimal   @db.Decimal(6, 4)
  isCompound        Boolean   @default(false)
  priority          Int       @default(0)
  appliesToShipping Boolean   @default(false)
  isActive          Boolean   @default(true)
  validFrom         DateTime  @default(now())
  validUntil        DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  TaxRate           TaxRate[]

  @@unique([tenantId, code])
  @@index([country, state])
  @@index([isActive])
  @@index([tenantId])
}

model Tenant {
  id                String             @id
  name              String
  slug              String             @unique
  status            TenantStatus       @default(ACTIVE)
  appName           String             @default("SaaS App")
  logoUrl           String?
  faviconUrl        String?
  primaryColor      String             @default("#6366f1")
  secondaryColor    String             @default("#8b5cf6")
  createdAt         DateTime           @default(now())
  updatedAt         DateTime
  activatedAt       DateTime?
  activatedModules  String[]           @default([])
  requestedModules  String[]           @default([])
  businessProfile   BusinessProfile?
  entitlements      Entitlement[]
  invoices          Invoice[]
  magicLinks        MagicLink[]
  partnerReferral   PartnerReferral?
  platformInstances PlatformInstance[]
  subscription      Subscription?
  domains           TenantDomain[]
  memberships       TenantMembership[]

  @@index([slug])
  @@index([status])
}

model TenantDomain {
  id                 String            @id
  tenantId           String
  domain             String            @unique
  type               DomainType
  status             DomainStatus      @default(PENDING)
  isPrimary          Boolean           @default(false)
  verificationToken  String?
  verifiedAt         DateTime?
  createdAt          DateTime          @default(now())
  updatedAt          DateTime
  platformInstanceId String?
  platformInstance   PlatformInstance? @relation(fields: [platformInstanceId], references: [id])
  tenant             Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([domain])
  @@index([platformInstanceId])
  @@index([tenantId])
  @@index([type, status])
}

model TenantMembership {
  id        String     @id
  userId    String
  tenantId  String
  role      TenantRole @default(TENANT_USER)
  isActive  Boolean    @default(true)
  createdAt DateTime   @default(now())
  updatedAt DateTime
  joinedAt  DateTime   @default(now())
  tenant    Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, tenantId])
  @@index([role])
  @@index([tenantId])
  @@index([userId])
}

model User {
  id              String             @id
  email           String?            @unique
  name            String?
  avatarUrl       String?
  globalRole      GlobalRole         @default(USER)
  isActive        Boolean            @default(true)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime
  lastLoginAt     DateTime?
  emailVerifiedAt DateTime?
  passwordHash    String?
  passwordSetAt   DateTime?
  phone           String?            @unique
  phoneVerifiedAt DateTime?
  MagicLink       MagicLink[]
  OtpCode         OtpCode[]
  PartnerUser     PartnerUser?
  Session         Session[]
  memberships     TenantMembership[]
  user_intents    user_intents[]

  @@index([email])
  @@index([globalRole])
  @@index([phone])
}

model Wallet {
  id                String              @id
  tenantId          String
  customerId        String?
  type              WalletType
  code              String?
  balance           Decimal             @default(0) @db.Decimal(12, 2)
  currency          String              @default("USD")
  initialValue      Decimal?            @db.Decimal(12, 2)
  status            WalletStatus        @default(ACTIVE)
  expiresAt         DateTime?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  Customer          Customer?           @relation(fields: [customerId], references: [id])
  WalletTransaction WalletTransaction[]

  @@unique([tenantId, code])
  @@index([customerId])
  @@index([status])
  @@index([tenantId])
  @@index([type])
}

model WalletTransaction {
  id             String                @id
  walletId       String
  type           WalletTransactionType
  amount         Decimal               @db.Decimal(12, 2)
  balanceAfter   Decimal               @db.Decimal(12, 2)
  sourceModule   String?
  sourceType     String?
  sourceId       String?
  description    String?
  idempotencyKey String?               @unique
  createdAt      DateTime              @default(now())
  createdBy      String?
  Wallet         Wallet                @relation(fields: [walletId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([sourceModule, sourceId])
  @@index([walletId])
}

model access_scopes {
  id          String          @id
  key         String          @unique
  name        String
  resource    String
  permission  AccessScopeType
  description String?
  isHighRisk  Boolean         @default(false)
  moduleKey   String?
  isActive    Boolean         @default(true)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime

  @@index([permission])
  @@index([resource])
}

model acct_chart_of_accounts {
  id                           String                   @id
  tenantId                     String
  code                         String
  name                         String
  description                  String?
  accountType                  AcctAccountType
  accountSubType               AcctAccountSubType?
  parentId                     String?
  normalBalance                String                   @default("DEBIT")
  isSystemAccount              Boolean                  @default(false)
  isActive                     Boolean                  @default(true)
  isBankAccount                Boolean                  @default(false)
  isControlAccount             Boolean                  @default(false)
  taxCode                      String?
  isTaxAccount                 Boolean                  @default(false)
  sortOrder                    Int                      @default(0)
  metadata                     Json?
  createdAt                    DateTime                 @default(now())
  updatedAt                    DateTime
  createdBy                    String?
  acct_chart_of_accounts       acct_chart_of_accounts?  @relation("acct_chart_of_accountsToacct_chart_of_accounts", fields: [parentId], references: [id])
  other_acct_chart_of_accounts acct_chart_of_accounts[] @relation("acct_chart_of_accountsToacct_chart_of_accounts")
  acct_ledger_accounts         acct_ledger_accounts[]

  @@unique([tenantId, code])
  @@index([accountType])
  @@index([isActive])
  @@index([parentId])
  @@index([tenantId])
}

model acct_expense_records {
  id                     String                   @id
  tenantId               String
  expenseNumber          String
  expenseDate            DateTime
  ledgerAccountId        String
  categoryName           String?
  amount                 Decimal                  @db.Decimal(18, 4)
  currency               String                   @default("NGN")
  taxAmount              Decimal?                 @db.Decimal(18, 4)
  taxCode                String?
  isVatInclusive         Boolean                  @default(false)
  paymentMethod          AcctExpensePaymentMethod @default(CASH)
  paidFrom               String?
  vendorName             String?
  vendorId               String?
  vendorContact          String?
  vendorPhone            String?
  description            String
  memo                   String?
  receiptNumber          String?
  receiptDate            DateTime?
  attachmentUrls         String[]                 @default([])
  status                 AcctExpenseStatus        @default(DRAFT)
  submittedAt            DateTime?
  submittedBy            String?
  approvedAt             DateTime?
  approvedBy             String?
  rejectedAt             DateTime?
  rejectedBy             String?
  rejectionReason        String?
  journalEntryId         String?
  postedAt               DateTime?
  periodId               String?
  metadata               Json?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  createdBy              String?
  acct_financial_periods acct_financial_periods?  @relation(fields: [periodId], references: [id])

  @@unique([tenantId, expenseNumber])
  @@index([expenseDate])
  @@index([ledgerAccountId])
  @@index([periodId])
  @@index([status])
  @@index([tenantId])
  @@index([vendorId])
}

model acct_financial_periods {
  id                   String                 @id
  tenantId             String
  name                 String
  code                 String
  periodType           String                 @default("MONTHLY")
  startDate            DateTime
  endDate              DateTime
  status               AcctPeriodStatus       @default(OPEN)
  fiscalYear           Int
  closedAt             DateTime?
  closedBy             String?
  lockedAt             DateTime?
  lockedBy             String?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  acct_expense_records acct_expense_records[]
  acct_journal_entries acct_journal_entries[]
  acct_ledger_accounts acct_ledger_accounts[]
  acct_ledger_entries  acct_ledger_entries[]
  acct_tax_summaries   acct_tax_summaries[]

  @@unique([tenantId, code])
  @@index([fiscalYear])
  @@index([startDate, endDate])
  @@index([status])
  @@index([tenantId])
}

model acct_journal_entries {
  id                         String                 @id
  tenantId                   String
  journalNumber              String
  entryDate                  DateTime
  postDate                   DateTime?
  sourceType                 AcctJournalSourceType
  sourceId                   String?
  sourceModule               String?
  eventId                    String?
  idempotencyKey             String?                @unique
  description                String
  memo                       String?
  status                     AcctJournalStatus      @default(DRAFT)
  totalDebit                 Decimal                @db.Decimal(18, 4)
  totalCredit                Decimal                @db.Decimal(18, 4)
  currency                   String                 @default("NGN")
  taxAmount                  Decimal?               @db.Decimal(18, 4)
  taxCode                    String?
  periodId                   String
  isReversal                 Boolean                @default(false)
  reversedJournalId          String?                @unique
  attachmentUrls             String[]               @default([])
  metadata                   Json?
  createdAt                  DateTime               @default(now())
  updatedAt                  DateTime
  createdBy                  String?
  postedBy                   String?
  postedAt                   DateTime?
  acct_financial_periods     acct_financial_periods @relation(fields: [periodId], references: [id])
  acct_journal_entries       acct_journal_entries?  @relation("acct_journal_entriesToacct_journal_entries", fields: [reversedJournalId], references: [id])
  other_acct_journal_entries acct_journal_entries?  @relation("acct_journal_entriesToacct_journal_entries")
  acct_ledger_entries        acct_ledger_entries[]

  @@unique([tenantId, journalNumber])
  @@index([entryDate])
  @@index([eventId])
  @@index([periodId])
  @@index([sourceId])
  @@index([sourceType])
  @@index([status])
  @@index([tenantId])
}

model acct_ledger_accounts {
  id                     String                  @id
  tenantId               String
  chartOfAccountId       String
  currentBalance         Decimal                 @default(0) @db.Decimal(18, 4)
  currency               String                  @default("NGN")
  openingBalance         Decimal                 @default(0) @db.Decimal(18, 4)
  periodDebit            Decimal                 @default(0) @db.Decimal(18, 4)
  periodCredit           Decimal                 @default(0) @db.Decimal(18, 4)
  currentPeriodId        String?
  isActive               Boolean                 @default(true)
  lastReconciledAt       DateTime?
  lastReconciledBalance  Decimal?                @db.Decimal(18, 4)
  createdAt              DateTime                @default(now())
  updatedAt              DateTime
  acct_chart_of_accounts acct_chart_of_accounts  @relation(fields: [chartOfAccountId], references: [id])
  acct_financial_periods acct_financial_periods? @relation(fields: [currentPeriodId], references: [id])
  acct_ledger_entries    acct_ledger_entries[]

  @@unique([tenantId, chartOfAccountId, currency])
  @@index([chartOfAccountId])
  @@index([currentPeriodId])
  @@index([tenantId])
}

model acct_ledger_entries {
  id                     String                 @id
  tenantId               String
  ledgerAccountId        String
  journalEntryId         String
  entryDate              DateTime
  debitAmount            Decimal                @default(0) @db.Decimal(18, 4)
  creditAmount           Decimal                @default(0) @db.Decimal(18, 4)
  balanceAfter           Decimal                @db.Decimal(18, 4)
  currency               String                 @default("NGN")
  description            String?
  memo                   String?
  referenceType          String?
  referenceId            String?
  referenceNumber        String?
  periodId               String
  createdAt              DateTime               @default(now())
  createdBy              String?
  lineNumber             Int
  acct_journal_entries   acct_journal_entries   @relation(fields: [journalEntryId], references: [id])
  acct_ledger_accounts   acct_ledger_accounts   @relation(fields: [ledgerAccountId], references: [id])
  acct_financial_periods acct_financial_periods @relation(fields: [periodId], references: [id])

  @@index([entryDate])
  @@index([journalEntryId])
  @@index([ledgerAccountId])
  @@index([periodId])
  @@index([referenceType, referenceId])
  @@index([tenantId])
}

model acct_tax_summaries {
  id                     String                 @id
  tenantId               String
  periodId               String
  taxCode                String
  taxName                String
  taxRate                Decimal                @db.Decimal(6, 4)
  taxableAmount          Decimal                @db.Decimal(18, 4)
  taxCollected           Decimal                @db.Decimal(18, 4)
  taxPaid                Decimal                @db.Decimal(18, 4)
  netTaxLiability        Decimal                @db.Decimal(18, 4)
  currency               String                 @default("NGN")
  salesTaxAmount         Decimal                @default(0) @db.Decimal(18, 4)
  expenseTaxAmount       Decimal                @default(0) @db.Decimal(18, 4)
  adjustmentAmount       Decimal                @default(0) @db.Decimal(18, 4)
  reportGeneratedAt      DateTime?
  reportGeneratedBy      String?
  notes                  String?
  createdAt              DateTime               @default(now())
  updatedAt              DateTime
  acct_financial_periods acct_financial_periods @relation(fields: [periodId], references: [id])

  @@unique([tenantId, periodId, taxCode])
  @@index([periodId])
  @@index([taxCode])
  @@index([tenantId])
}

model ai_event_logs {
  id               String   @id
  tenantId         String?
  eventType        String
  eventData        Json
  insightId        String?
  recommendationId String?
  ruleId           String?
  runId            String?
  actorId          String?
  actorType        String?
  occurredAt       DateTime @default(now())

  @@index([eventType])
  @@index([occurredAt])
  @@index([tenantId])
}

model ai_insights {
  id              String    @id
  tenantId        String
  insightType     String
  title           String
  summary         String
  details         Json
  explanation     String
  dataSourcesUsed String[]
  confidence      Decimal   @db.Decimal(5, 2)
  severity        String    @default("INFO")
  relatedType     String?
  relatedId       String?
  status          String    @default("ACTIVE")
  acknowledgedAt  DateTime?
  acknowledgedBy  String?
  validFrom       DateTime  @default(now())
  validTo         DateTime?
  metadata        Json?
  createdAt       DateTime  @default(now())

  @@index([insightType])
  @@index([status])
  @@index([tenantId])
}

model ai_recommendations {
  id                 String    @id
  tenantId           String
  recommendationType String
  title              String
  summary            String
  details            Json
  explanation        String
  expectedOutcome    String
  dataSourcesUsed    String[]
  confidence         Decimal   @db.Decimal(5, 2)
  relatedType        String?
  relatedId          String?
  suggestedAction    Json
  status             String    @default("PENDING")
  acceptedAt         DateTime?
  acceptedBy         String?
  rejectedAt         DateTime?
  rejectedBy         String?
  rejectionReason    String?
  expiresAt          DateTime?
  metadata           Json?
  createdAt          DateTime  @default(now())

  @@index([recommendationType])
  @@index([status])
  @@index([tenantId])
}

model analytics_configurations {
  id                    String    @id
  tenantId              String    @unique
  analyticsEnabled      Boolean   @default(true)
  dashboardsEnabled     Boolean   @default(true)
  reportsEnabled        Boolean   @default(true)
  forecastingEnabled    Boolean   @default(false)
  exportEnabled         Boolean   @default(true)
  snapshotRetentionDays Int       @default(365)
  autoRefreshEnabled    Boolean   @default(true)
  refreshIntervalMins   Int       @default(60)
  lastRefreshedAt       DateTime?
  defaultCurrency       String    @default("NGN")
  timezone              String    @default("Africa/Lagos")
  fiscalYearStart       Int       @default(1)
  metadata              Json?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime
}

model analytics_dashboard_widgets {
  id                   String               @id
  dashboardId          String
  title                String
  type                 String
  metricKeys           Json
  dimensions           Json?
  config               Json
  gridX                Int
  gridY                Int
  gridW                Int
  gridH                Int
  isActive             Boolean              @default(true)
  sortOrder            Int                  @default(0)
  analytics_dashboards analytics_dashboards @relation(fields: [dashboardId], references: [id], onDelete: Cascade)

  @@index([dashboardId])
}

model analytics_dashboards {
  id                          String                        @id
  tenantId                    String
  key                         String
  name                        String
  description                 String?
  layout                      Json
  isSystem                    Boolean                       @default(false)
  isDefault                   Boolean                       @default(false)
  isActive                    Boolean                       @default(true)
  visibility                  String                        @default("TENANT")
  metadata                    Json?
  createdBy                   String?
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime
  analytics_dashboard_widgets analytics_dashboard_widgets[]

  @@unique([tenantId, key])
  @@index([tenantId])
}

model analytics_event_logs {
  id             String   @id
  tenantId       String
  sourceModule   String
  eventType      String
  eventId        String
  eventData      Json
  processedAt    DateTime @default(now())
  metricsUpdated Json?

  @@unique([tenantId, sourceModule, eventId])
  @@index([eventType])
  @@index([processedAt])
  @@index([tenantId])
}

model analytics_insights {
  id              String    @id
  tenantId        String
  type            String
  title           String
  description     String
  severity        String
  category        String
  data            Json
  suggestedAction String?
  actionUrl       String?
  status          String    @default("NEW")
  acknowledgedBy  String?
  acknowledgedAt  DateTime?
  resolvedAt      DateTime?
  validUntil      DateTime?
  metadata        Json?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime

  @@index([severity])
  @@index([status])
  @@index([tenantId])
  @@index([type])
}

model analytics_metric_definitions {
  id                         String                       @id
  tenantId                   String
  key                        String
  name                       String
  description                String?
  category                   String
  aggregationType            String
  sourceEvent                String
  sourceField                String?
  formula                    String?
  format                     String                       @default("number")
  unit                       String?
  precision                  Int                          @default(2)
  isSystem                   Boolean                      @default(false)
  isActive                   Boolean                      @default(true)
  metadata                   Json?
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime
  analytics_metric_snapshots analytics_metric_snapshots[]

  @@unique([tenantId, key])
  @@index([category])
  @@index([tenantId])
}

model analytics_metric_snapshots {
  id                           String                       @id
  tenantId                     String
  metricId                     String
  periodType                   String
  periodStart                  DateTime
  periodEnd                    DateTime
  value                        Decimal                      @db.Decimal(20, 4)
  count                        Int                          @default(1)
  dimensionKey                 String?
  dimensionValue               String?
  previousValue                Decimal?                     @db.Decimal(20, 4)
  changePercent                Decimal?                     @db.Decimal(10, 4)
  computedAt                   DateTime                     @default(now())
  analytics_metric_definitions analytics_metric_definitions @relation(fields: [metricId], references: [id], onDelete: Cascade)

  @@unique([metricId, periodType, periodStart, dimensionKey, dimensionValue])
  @@index([metricId])
  @@index([periodType, periodStart])
  @@index([tenantId])
}

model analytics_report_definitions {
  id              String    @id
  tenantId        String
  key             String
  name            String
  description     String?
  category        String
  metricKeys      Json
  dimensions      Json?
  filters         Json?
  format          String    @default("PDF")
  isScheduled     Boolean   @default(false)
  schedule        String?
  recipients      Json?
  isSystem        Boolean   @default(false)
  isActive        Boolean   @default(true)
  metadata        Json?
  lastGeneratedAt DateTime?
  createdBy       String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime

  @@unique([tenantId, key])
  @@index([tenantId])
}

model api_keys {
  id             String         @id
  appId          String
  tenantId       String?
  name           String
  keyPrefix      String
  keyHash        String
  scopes         String[]
  status         ApiKeyStatus   @default(ACTIVE)
  expiresAt      DateTime?
  rateLimit      Int?
  lastUsedAt     DateTime?
  usageCount     Int            @default(0)
  allowedIps     String[]
  createdAt      DateTime       @default(now())
  updatedAt      DateTime
  revokedAt      DateTime?
  revokedBy      String?
  revokedReason  String?
  developer_apps developer_apps @relation(fields: [appId], references: [id], onDelete: Cascade)

  @@index([appId])
  @@index([keyPrefix])
  @@index([status])
  @@index([tenantId])
}

model audit_artifacts {
  id           String    @id
  tenantId     String
  artifactType String
  artifactName String
  periodStart  DateTime?
  periodEnd    DateTime?
  artifactData Json
  sourceType   String?
  sourceId     String?
  status       String    @default("ACTIVE")
  metadata     Json?
  createdAt    DateTime  @default(now())

  @@index([artifactType])
  @@index([sourceType, sourceId])
  @@index([tenantId])
}

model automation_rules {
  id                String            @id
  tenantId          String
  name              String
  description       String?
  triggerType       String
  triggerConfig     Json
  actionType        String
  actionConfig      Json
  requiresApproval  Boolean           @default(false)
  approvalConfig    Json?
  isActive          Boolean           @default(true)
  lastTriggeredAt   DateTime?
  triggerCount      Int               @default(0)
  maxTriggersPerDay Int?
  cooldownMinutes   Int?
  metadata          Json?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  automation_runs   automation_runs[]

  @@index([isActive])
  @@index([tenantId])
}

model automation_runs {
  id               String           @id
  tenantId         String
  ruleId           String
  triggeredAt      DateTime         @default(now())
  triggerData      Json
  actionTaken      String
  actionData       Json
  status           String           @default("COMPLETED")
  resultMessage    String?
  approvedAt       DateTime?
  approvedBy       String?
  rejectedAt       DateTime?
  rejectedBy       String?
  metadata         Json?
  createdAt        DateTime         @default(now())
  automation_rules automation_rules @relation(fields: [ruleId], references: [id])

  @@index([ruleId])
  @@index([status])
  @@index([tenantId])
}

model b2b_bulk_order_drafts {
  id                    String                @id
  tenantId              String
  profileId             String
  name                  String?
  description           String?
  items                 Json
  itemCount             Int                   @default(0)
  subtotal              Decimal               @default(0) @db.Decimal(12, 2)
  discountTotal         Decimal               @default(0) @db.Decimal(12, 2)
  estimatedTotal        Decimal               @default(0) @db.Decimal(12, 2)
  status                B2BBulkOrderStatus    @default(DRAFT)
  pricingSnapshot       Json?
  convertedOrderId      String?
  convertedAt           DateTime?
  offlineId             String?
  createdBy             String?
  submittedBy           String?
  submittedAt           DateTime?
  metadata              Json?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime
  b2b_customer_profiles b2b_customer_profiles @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@unique([tenantId, offlineId])
  @@index([createdAt])
  @@index([profileId])
  @@index([status])
  @@index([tenantId])
}

model b2b_configurations {
  id                       String   @id
  tenantId                 String   @unique
  b2bEnabled               Boolean  @default(true)
  wholesalePricing         Boolean  @default(true)
  creditSalesEnabled       Boolean  @default(false)
  bulkOrderingEnabled      Boolean  @default(true)
  defaultCreditDays        Int      @default(30)
  defaultCreditLimit       Decimal  @default(0) @db.Decimal(12, 2)
  defaultMinOrderValue     Decimal  @default(0) @db.Decimal(12, 2)
  defaultCurrency          String   @default("NGN")
  wholesaleTaxExempt       Boolean  @default(false)
  vatRate                  Decimal  @default(7.5) @db.Decimal(5, 2)
  creditApprovalRequired   Boolean  @default(true)
  autoApproveBelow         Decimal  @default(0) @db.Decimal(12, 2)
  negotiatedPricingEnabled Boolean  @default(true)
  manualOverrideEnabled    Boolean  @default(true)
  metadata                 Json?
  createdAt                DateTime @default(now())
  updatedAt                DateTime
}

model b2b_credit_ledger {
  id                    String                   @id
  tenantId              String
  profileId             String
  transactionType       B2BCreditTransactionType
  amount                Decimal                  @db.Decimal(12, 2)
  balanceBefore         Decimal                  @db.Decimal(12, 2)
  balanceAfter          Decimal                  @db.Decimal(12, 2)
  referenceType         String?
  referenceId           String?
  invoiceId             String?
  description           String?
  dueDate               DateTime?
  performedBy           String?
  performedAt           DateTime                 @default(now())
  notes                 String?
  metadata              Json?
  createdAt             DateTime                 @default(now())
  b2b_invoices          b2b_invoices?            @relation(fields: [invoiceId], references: [id])
  b2b_customer_profiles b2b_customer_profiles    @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([invoiceId])
  @@index([profileId])
  @@index([tenantId])
  @@index([transactionType])
}

model b2b_credit_terms {
  id                    String                  @id
  tenantId              String
  name                  String
  code                  String
  description           String?
  creditDays            Int                     @default(30)
  creditLimit           Decimal                 @default(0) @db.Decimal(12, 2)
  gracePeriod           Int                     @default(0)
  lateFeeType           B2BLateFeeType          @default(NONE)
  lateFeeValue          Decimal                 @default(0) @db.Decimal(5, 2)
  depositRequired       Boolean                 @default(false)
  depositPercent        Decimal                 @default(0) @db.Decimal(5, 2)
  isActive              Boolean                 @default(true)
  metadata              Json?
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  b2b_customer_profiles b2b_customer_profiles[]

  @@unique([tenantId, code])
  @@index([tenantId])
}

model b2b_customer_profiles {
  id                      String                  @id
  tenantId                String
  customerId              String                  @unique
  isB2B                   Boolean                 @default(true)
  customerType            B2BCustomerType         @default(RETAILER)
  businessName            String?
  businessRegNo           String?
  taxId                   String?
  primaryContact          String?
  primaryPhone            String?
  primaryEmail            String?
  businessAddress         Json?
  priceTierId             String?
  creditTermId            String?
  creditLimit             Decimal                 @default(0) @db.Decimal(12, 2)
  creditUsed              Decimal                 @default(0) @db.Decimal(12, 2)
  creditStatus            B2BCreditStatus         @default(ACTIVE)
  preferredPaymentMethod  String?
  preferredShippingMethod String?
  allowCashPurchase       Boolean                 @default(true)
  allowCreditPurchase     Boolean                 @default(false)
  status                  B2BProfileStatus        @default(ACTIVE)
  verifiedAt              DateTime?
  verifiedBy              String?
  notes                   String?
  metadata                Json?
  createdAt               DateTime                @default(now())
  updatedAt               DateTime
  b2b_bulk_order_drafts   b2b_bulk_order_drafts[]
  b2b_credit_ledger       b2b_credit_ledger[]
  b2b_credit_terms        b2b_credit_terms?       @relation(fields: [creditTermId], references: [id])
  b2b_price_tiers         b2b_price_tiers?        @relation(fields: [priceTierId], references: [id])
  b2b_invoices            b2b_invoices[]

  @@unique([tenantId, customerId])
  @@index([customerId])
  @@index([priceTierId])
  @@index([status])
  @@index([tenantId])
}

model b2b_event_logs {
  id         String   @id
  tenantId   String
  eventType  String
  eventData  Json
  profileId  String?
  invoiceId  String?
  orderId    String?
  actorId    String?
  actorType  String?
  occurredAt DateTime @default(now())

  @@index([eventType])
  @@index([occurredAt])
  @@index([profileId])
  @@index([tenantId])
}

model b2b_invoices {
  id                    String                @id
  tenantId              String
  invoiceNumber         String
  profileId             String
  orderId               String?
  orderNumber           String?
  subtotal              Decimal               @db.Decimal(12, 2)
  discountTotal         Decimal               @default(0) @db.Decimal(12, 2)
  taxTotal              Decimal               @default(0) @db.Decimal(12, 2)
  totalAmount           Decimal               @db.Decimal(12, 2)
  amountPaid            Decimal               @default(0) @db.Decimal(12, 2)
  amountDue             Decimal               @db.Decimal(12, 2)
  invoiceDate           DateTime              @default(now())
  dueDate               DateTime
  paidDate              DateTime?
  status                B2BInvoiceStatus      @default(DRAFT)
  creditTermId          String?
  paymentTerms          String?
  lineItems             Json?
  notes                 String?
  internalNotes         String?
  createdBy             String?
  approvedBy            String?
  approvedAt            DateTime?
  metadata              Json?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime
  b2b_credit_ledger     b2b_credit_ledger[]
  b2b_customer_profiles b2b_customer_profiles @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@unique([tenantId, invoiceNumber])
  @@index([dueDate])
  @@index([orderId])
  @@index([profileId])
  @@index([status])
  @@index([tenantId])
}

model b2b_price_tiers {
  id                        String                      @id
  tenantId                  String
  name                      String
  code                      String
  description               String?
  defaultDiscount           Decimal                     @default(0) @db.Decimal(5, 2)
  discountType              B2BDiscountType             @default(PERCENTAGE)
  minOrderValue             Decimal                     @default(0) @db.Decimal(12, 2)
  minOrderQuantity          Int                         @default(1)
  priority                  Int                         @default(0)
  isActive                  Boolean                     @default(true)
  metadata                  Json?
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime
  b2b_customer_profiles     b2b_customer_profiles[]
  b2b_wholesale_price_rules b2b_wholesale_price_rules[]

  @@unique([tenantId, code])
  @@index([tenantId])
}

model b2b_wholesale_price_rules {
  id              String           @id
  tenantId        String
  productId       String?
  categoryId      String?
  priceTierId     String?
  name            String
  description     String?
  priceType       B2BPriceType     @default(DISCOUNT_PERCENTAGE)
  value           Decimal          @db.Decimal(12, 2)
  quantityBreaks  Json?
  validFrom       DateTime?
  validTo         DateTime?
  priority        Int              @default(0)
  isActive        Boolean          @default(true)
  createdBy       String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime
  b2b_price_tiers b2b_price_tiers? @relation(fields: [priceTierId], references: [id])

  @@index([categoryId])
  @@index([isActive])
  @@index([priceTierId])
  @@index([productId])
  @@index([tenantId])
}

model billing_addon_subscriptions {
  id              String         @id
  tenantId        String
  subscriptionId  String
  addOnId         String
  quantity        Int            @default(1)
  priceAtPurchase Decimal        @db.Decimal(12, 2)
  currency        String         @default("NGN")
  status          AddOnStatus    @default(ACTIVE)
  startDate       DateTime       @default(now())
  endDate         DateTime?
  cancelledAt     DateTime?
  metadata        Json?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime
  billing_addons  billing_addons @relation(fields: [addOnId], references: [id])

  @@index([status])
  @@index([subscriptionId])
  @@index([tenantId])
}

model billing_addons {
  id                          String                        @id
  tenantId                    String?
  name                        String
  slug                        String
  description                 String?
  addOnType                   AddOnType                     @default(FEATURE)
  price                       Decimal                       @db.Decimal(12, 2)
  currency                    String                        @default("NGN")
  billingInterval             String                        @default("MONTHLY")
  isQuantityBased             Boolean                       @default(false)
  unitName                    String?
  minQuantity                 Int                           @default(1)
  maxQuantity                 Int?
  moduleKey                   String?
  featureKey                  String?
  featureValue                Json?
  isActive                    Boolean                       @default(true)
  metadata                    Json?
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime
  billing_addon_subscriptions billing_addon_subscriptions[]

  @@unique([tenantId, slug])
  @@index([isActive])
}

model billing_adjustments {
  id             String           @id
  tenantId       String
  subscriptionId String?
  type           AdjustmentType
  reason         String
  description    String?
  amount         Decimal          @db.Decimal(12, 2)
  currency       String           @default("NGN")
  appliedAt      DateTime?
  expiresAt      DateTime?
  status         AdjustmentStatus @default(PENDING)
  createdBy      String?
  approvedBy     String?
  approvedAt     DateTime?
  metadata       Json?
  createdAt      DateTime         @default(now())

  @@index([status])
  @@index([subscriptionId])
  @@index([tenantId])
}

model billing_bundle_items {
  id              String          @id
  bundleId        String
  moduleKey       String
  moduleName      String?
  featureLimits   Json?
  displayOrder    Int             @default(0)
  isHighlighted   Boolean         @default(false)
  createdAt       DateTime        @default(now())
  billing_bundles billing_bundles @relation(fields: [bundleId], references: [id], onDelete: Cascade)

  @@unique([bundleId, moduleKey])
}

model billing_bundles {
  id                   String                 @id
  tenantId             String?
  name                 String
  slug                 String
  description          String?
  price                Decimal                @db.Decimal(12, 2)
  currency             String                 @default("NGN")
  billingInterval      String                 @default("MONTHLY")
  savingsPercent       Decimal?               @db.Decimal(5, 2)
  isActive             Boolean                @default(true)
  isPromoted           Boolean                @default(false)
  displayOrder         Int                    @default(0)
  badgeText            String?
  metadata             Json?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  billing_bundle_items billing_bundle_items[]

  @@unique([tenantId, slug])
  @@index([isActive])
}

model billing_configurations {
  id                      String   @id
  tenantId                String   @unique
  bundlesEnabled          Boolean  @default(false)
  addOnsEnabled           Boolean  @default(false)
  usageBillingEnabled     Boolean  @default(false)
  gracePeriodsEnabled     Boolean  @default(true)
  defaultGraceDays        Int      @default(7)
  graceSuspendFeatures    Boolean  @default(true)
  usageAlertThreshold     Int      @default(80)
  manualRenewalsAllowed   Boolean  @default(true)
  informalUpgradesAllowed Boolean  @default(true)
  metadata                Json?
  createdAt               DateTime @default(now())
  updatedAt               DateTime
}

model billing_discount_rules {
  id               String       @id
  tenantId         String?
  name             String
  code             String?      @unique
  description      String?
  discountType     DiscountType @default(PERCENTAGE)
  value            Decimal      @db.Decimal(12, 2)
  planIds          String[]     @default([])
  moduleIds        String[]     @default([])
  partnerId        String?
  maxUses          Int?
  maxUsesPerTenant Int?
  currentUses      Int          @default(0)
  validFrom        DateTime?
  validTo          DateTime?
  minOrderValue    Decimal?     @db.Decimal(12, 2)
  firstTimeOnly    Boolean      @default(false)
  isActive         Boolean      @default(true)
  metadata         Json?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime

  @@index([isActive])
  @@index([partnerId])
}

model billing_event_logs {
  id             String   @id
  tenantId       String?
  eventType      String
  eventData      Json
  subscriptionId String?
  bundleId       String?
  addOnId        String?
  adjustmentId   String?
  actorId        String?
  actorType      String?
  occurredAt     DateTime @default(now())

  @@index([eventType])
  @@index([occurredAt])
  @@index([subscriptionId])
  @@index([tenantId])
}

// ============================================================================
// BILLING & SUBSCRIPTIONS SUITE  CANONICAL INVOICE TABLES (S2)
// ============================================================================

model bill_invoices {
  id                 String                  @id
  tenantId           String
  invoiceNumber      String
  // Customer details (denormalized for invoice permanence)
  customerId         String?
  customerType       BillCustomerType        @default(INDIVIDUAL)
  customerName       String
  customerEmail      String?
  customerPhone      String?
  customerAddress    String?
  customerCity       String?
  customerState      String?
  customerTIN        String? // Tax Identification Number (optional)
  // Amounts (NGN default)
  subtotal           Decimal                 @db.Decimal(12, 2)
  discountTotal      Decimal                 @default(0) @db.Decimal(12, 2)
  taxTotal           Decimal                 @default(0) @db.Decimal(12, 2)
  grandTotal         Decimal                 @db.Decimal(12, 2)
  amountPaid         Decimal                 @default(0) @db.Decimal(12, 2)
  amountDue          Decimal                 @db.Decimal(12, 2)
  currency           String                  @default("NGN")
  // VAT (Nigeria-first: 7.5%)
  vatRate            Decimal                 @default(7.5) @db.Decimal(5, 2)
  vatInclusive       Boolean                 @default(false)
  vatExempt          Boolean                 @default(false)
  vatExemptReason    String?
  // Dates
  invoiceDate        DateTime                @default(now())
  dueDate            DateTime
  paidDate           DateTime?
  sentAt             DateTime?
  viewedAt           DateTime?
  // Status
  status             BillInvoiceStatus       @default(DRAFT)
  statusNote         String?
  // Payment terms
  paymentTerms       String? // e.g., "Net 30"
  paymentTermDays    Int                     @default(30)
  // References
  orderId            String?
  orderNumber        String?
  subscriptionId     String?
  paymentIntentId    String?
  // Notes
  notes              String? // Customer-visible
  internalNotes      String? // Admin-only
  // Metadata
  createdBy          String?
  approvedBy         String?
  approvedAt         DateTime?
  cancelledBy        String?
  cancelledAt        DateTime?
  cancellationReason String?
  metadata           Json?
  createdAt          DateTime                @default(now())
  updatedAt          DateTime
  // Relations
  items              bill_invoice_items[]
  payments           bill_invoice_payments[]

  @@unique([tenantId, invoiceNumber])
  @@index([customerId])
  @@index([dueDate])
  @@index([orderId])
  @@index([status])
  @@index([tenantId])
  @@index([subscriptionId])
}

model bill_invoice_items {
  id              String        @id
  invoiceId       String
  lineNumber      Int           @default(1)
  // Item details
  description     String
  quantity        Decimal       @db.Decimal(10, 2)
  unitPrice       Decimal       @db.Decimal(12, 2)
  lineTotal       Decimal       @db.Decimal(12, 2)
  // Tax
  taxRate         Decimal       @default(0) @db.Decimal(5, 2)
  taxAmount       Decimal       @default(0) @db.Decimal(12, 2)
  taxExempt       Boolean       @default(false)
  // Discount
  discountAmount  Decimal       @default(0) @db.Decimal(12, 2)
  discountPercent Decimal       @default(0) @db.Decimal(5, 2)
  // Product reference (optional)
  productId       String?
  productName     String?
  sku             String?
  // Metadata
  metadata        Json?
  createdAt       DateTime      @default(now())
  // Relations
  invoice         bill_invoices @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@index([productId])
}

model bill_invoice_payments {
  id               String            @id
  invoiceId        String
  // Payment details
  amount           Decimal           @db.Decimal(12, 2)
  paymentMethod    String // BANK_TRANSFER, CARD, CASH, etc.
  paymentReference String?
  transactionId    String? // Links to pay_payment_transactions
  // Status
  status           BillPaymentStatus @default(PENDING)
  // Dates
  paidAt           DateTime?
  confirmedAt      DateTime?
  confirmedBy      String?
  // Metadata
  notes            String?
  metadata         Json?
  createdAt        DateTime          @default(now())
  // Relations
  invoice          bill_invoices     @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@index([transactionId])
}

model bill_credit_notes {
  id               String           @id
  tenantId         String
  creditNoteNumber String
  // Reference invoice
  invoiceId        String?
  invoiceNumber    String?
  // Customer
  customerId       String?
  customerName     String
  // Amounts
  amount           Decimal          @db.Decimal(12, 2)
  currency         String           @default("NGN")
  // Reason
  reason           BillCreditReason @default(OTHER)
  description      String?
  // Status
  status           BillCreditStatus @default(DRAFT)
  appliedAt        DateTime?
  appliedToInvoice String?
  // Audit
  createdBy        String?
  approvedBy       String?
  approvedAt       DateTime?
  metadata         Json?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime

  @@unique([tenantId, creditNoteNumber])
  @@index([customerId])
  @@index([invoiceId])
  @@index([status])
  @@index([tenantId])
}

// Enums for Billing Suite
enum BillInvoiceStatus {
  DRAFT
  SENT
  VIEWED
  PARTIALLY_PAID
  PAID
  OVERDUE
  CANCELLED
  VOID
  DISPUTED
}

enum BillCustomerType {
  INDIVIDUAL
  BUSINESS
  GOVERNMENT
  NGO
}

enum BillPaymentStatus {
  PENDING
  CONFIRMED
  FAILED
  REFUNDED
}

enum BillCreditReason {
  RETURN
  PRICING_ERROR
  SERVICE_ISSUE
  DUPLICATE_CHARGE
  GOODWILL
  OTHER
}

enum BillCreditStatus {
  DRAFT
  APPROVED
  APPLIED
  CANCELLED
  EXPIRED
}

model billing_grace_policies {
  id                    String   @id
  tenantId              String?
  name                  String
  description           String?
  graceDays             Int      @default(7)
  limitFeatures         Boolean  @default(true)
  sendReminders         Boolean  @default(true)
  reminderDays          Int[]    @default([1, 3, 7])
  suspendAfterGrace     Boolean  @default(true)
  dataRetentionDays     Int      @default(90)
  manualOverrideAllowed Boolean  @default(true)
  isActive              Boolean  @default(true)
  isDefault             Boolean  @default(false)
  metadata              Json?
  createdAt             DateTime @default(now())
  updatedAt             DateTime
}

model billing_usage_metrics {
  id                    String                  @id
  tenantId              String?
  key                   String
  name                  String
  description           String?
  unit                  String
  aggregationType       UsageAggregationType    @default(SUM)
  includedUnits         Int?
  overageRate           Decimal?                @db.Decimal(12, 4)
  billingPeriod         String                  @default("MONTHLY")
  isActive              Boolean                 @default(true)
  metadata              Json?
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  billing_usage_records billing_usage_records[]

  @@unique([tenantId, key])
}

model billing_usage_records {
  id                    String                @id
  tenantId              String
  metricId              String
  periodStart           DateTime
  periodEnd             DateTime
  quantity              Decimal               @db.Decimal(16, 4)
  sourceType            String?
  sourceId              String?
  metadata              Json?
  createdAt             DateTime              @default(now())
  billing_usage_metrics billing_usage_metrics @relation(fields: [metricId], references: [id])

  @@index([metricId])
  @@index([periodStart, periodEnd])
  @@index([tenantId])
}

model commerce_payouts {
  id             String             @id
  tenantId       String
  walletId       String
  walletType     CommerceWalletType
  amount         Decimal            @db.Decimal(12, 2)
  currency       String             @default("USD")
  processingFee  Decimal            @default(0) @db.Decimal(12, 2)
  netAmount      Decimal            @db.Decimal(12, 2)
  status         PayoutStatus       @default(PENDING)
  paymentMethod  String?
  paymentDetails Json?
  externalRef    String?
  processedAt    DateTime?
  completedAt    DateTime?
  failedAt       DateTime?
  failureReason  String?
  failureCode    String?
  triggeredBy    String?
  ledgerEntryId  String?
  createdAt      DateTime           @default(now())
  updatedAt      DateTime

  @@index([createdAt])
  @@index([status])
  @@index([tenantId])
  @@index([walletId])
}

model commerce_wallet_ledger {
  id                    String            @id
  walletId              String
  entryType             LedgerEntryType
  status                LedgerEntryStatus @default(COMPLETED)
  amount                Decimal           @db.Decimal(12, 2)
  currency              String            @default("USD")
  balanceAfter          Decimal           @db.Decimal(12, 2)
  pendingBalanceAfter   Decimal           @default(0) @db.Decimal(12, 2)
  availableBalanceAfter Decimal           @db.Decimal(12, 2)
  referenceType         String?
  referenceId           String?
  counterpartyWalletId  String?
  holdId                String?
  idempotencyKey        String            @unique
  description           String?
  metadata              Json?
  createdAt             DateTime          @default(now())
  createdBy             String?
  commerce_wallets      commerce_wallets  @relation(fields: [walletId], references: [id])

  @@index([createdAt])
  @@index([entryType])
  @@index([holdId])
  @@index([referenceType, referenceId])
  @@index([status])
  @@index([walletId])
}

model commerce_wallets {
  id                     String                   @id
  tenantId               String
  type                   CommerceWalletType
  customerId             String?
  vendorId               String?
  balance                Decimal                  @default(0) @db.Decimal(12, 2)
  pendingBalance         Decimal                  @default(0) @db.Decimal(12, 2)
  availableBalance       Decimal                  @default(0) @db.Decimal(12, 2)
  currency               String                   @default("USD")
  status                 CommerceWalletStatus     @default(ACTIVE)
  metadata               Json?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  commerce_wallet_ledger commerce_wallet_ledger[]

  @@unique([tenantId, type, customerId, vendorId])
  @@index([customerId])
  @@index([status])
  @@index([tenantId])
  @@index([type])
  @@index([vendorId])
}

model compliance_event_logs {
  id         String   @id
  tenantId   String?
  eventType  String
  eventData  Json
  profileId  String?
  reportId   String?
  artifactId String?
  actorId    String?
  actorType  String?
  occurredAt DateTime @default(now())

  @@index([eventType])
  @@index([occurredAt])
  @@index([tenantId])
}

model compliance_profiles {
  id                    String                  @id
  tenantId              String                  @unique
  businessRegistered    Boolean                 @default(false)
  vatRegistered         Boolean                 @default(false)
  tinRegistered         Boolean                 @default(false)
  cacNumber             String?
  tinNumber             String?
  vatNumber             String?
  industryCode          String?
  businessCategory      String?
  maturityLevel         ComplianceMaturityLevel @default(INFORMAL)
  taxTrackingEnabled    Boolean                 @default(false)
  auditTrailEnabled     Boolean                 @default(true)
  reportingEnabled      Boolean                 @default(false)
  progressiveActivation Boolean                 @default(true)
  metadata              Json?
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  tax_configurations    tax_configurations?
}

model compliance_statuses {
  id              String    @id
  tenantId        String
  statusType      String
  severity        String    @default("INFO")
  title           String
  description     String
  suggestedAction String?
  isResolved      Boolean   @default(false)
  resolvedAt      DateTime?
  isDismissable   Boolean   @default(true)
  dismissedAt     DateTime?
  metadata        Json?
  createdAt       DateTime  @default(now())

  @@index([isResolved])
  @@index([statusType])
  @@index([tenantId])
}

model core_capabilities {
  id                                 String                               @id
  key                                String                               @unique
  displayName                        String
  domain                             String
  description                        String?
  dependencies                       String[]                             @default([])
  isCore                             Boolean                              @default(false)
  isAvailable                        Boolean                              @default(true)
  sortOrder                          Int                                  @default(0)
  icon                               String?
  metadata                           Json?
  createdAt                          DateTime                             @default(now())
  updatedAt                          DateTime
  core_tenant_capability_activations core_tenant_capability_activations[]

  @@index([domain])
  @@index([isAvailable])
  @@index([isCore])
}

model core_capability_event_logs {
  id             String              @id
  eventType      String
  tenantId       String
  capabilityKey  String
  triggeredBy    CapabilityActivator
  userId         String?
  previousStatus String?
  newStatus      String?
  reason         String?
  metadata       Json?
  timestamp      DateTime            @default(now())

  @@index([capabilityKey])
  @@index([eventType])
  @@index([tenantId])
  @@index([timestamp])
}

model core_tenant_capability_activations {
  id                String               @id
  tenantId          String
  capabilityKey     String
  status            CapabilityStatus     @default(INACTIVE)
  activatedAt       DateTime?
  deactivatedAt     DateTime?
  suspendedAt       DateTime?
  activatedBy       CapabilityActivator?
  activatedByUserId String?
  suspensionReason  String?
  configuration     Json?
  auditLog          Json?
  createdAt         DateTime             @default(now())
  updatedAt         DateTime
  core_capabilities core_capabilities    @relation(fields: [capabilityKey], references: [key], onDelete: Cascade)

  @@unique([tenantId, capabilityKey])
  @@index([capabilityKey])
  @@index([status])
  @@index([tenantId])
}

model crm_campaign_audiences {
  id                    String                 @id
  tenantId              String
  campaignId            String
  audienceType          String
  segmentId             String?
  customerIds           String[]               @default([])
  excludeSegmentIds     String[]               @default([])
  excludeCustomerIds    String[]               @default([])
  estimatedReach        Int?
  createdAt             DateTime               @default(now())
  crm_campaigns         crm_campaigns          @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  crm_customer_segments crm_customer_segments? @relation(fields: [segmentId], references: [id])

  @@index([campaignId])
  @@index([segmentId])
}

model crm_campaigns {
  id                     String                   @id
  tenantId               String
  name                   String
  slug                   String
  description            String?
  campaignType           CrmCampaignType
  status                 CrmCampaignStatus        @default(DRAFT)
  channels               CrmCampaignChannel[]
  content                Json?
  scheduledAt            DateTime?
  startsAt               DateTime?
  endsAt                 DateTime?
  triggerConfig          Json?
  offerType              String?
  offerValue             Decimal?                 @db.Decimal(10, 2)
  offerCode              String?
  budgetLimit            Decimal?                 @db.Decimal(12, 2)
  budgetUsed             Decimal                  @default(0) @db.Decimal(12, 2)
  maxRecipients          Int?
  currentRecipients      Int                      @default(0)
  sentCount              Int                      @default(0)
  deliveredCount         Int                      @default(0)
  openedCount            Int                      @default(0)
  clickedCount           Int                      @default(0)
  convertedCount         Int                      @default(0)
  tags                   String[]                 @default([])
  metadata               Json?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  createdBy              String?
  publishedAt            DateTime?
  publishedBy            String?
  crm_campaign_audiences crm_campaign_audiences[]

  @@unique([tenantId, slug])
  @@index([campaignType])
  @@index([scheduledAt])
  @@index([status])
  @@index([tenantId])
}

model crm_configurations {
  id                     String   @id
  tenantId               String   @unique
  autoUpdateSegments     Boolean  @default(true)
  segmentUpdateFrequency String   @default("HOURLY")
  loyaltyEnabled         Boolean  @default(false)
  loyaltyProgramId       String?
  campaignsEnabled       Boolean  @default(false)
  defaultSmsTemplate     String?
  defaultEmailTemplate   String?
  smsEnabled             Boolean  @default(true)
  emailEnabled           Boolean  @default(true)
  pushEnabled            Boolean  @default(false)
  whatsappEnabled        Boolean  @default(false)
  phoneNumberFormat      String   @default("NG")
  defaultCurrency        String   @default("NGN")
  metadata               Json?
  createdAt              DateTime @default(now())
  updatedAt              DateTime
}

model crm_customer_segments {
  id                      String                    @id
  tenantId                String
  name                    String
  slug                    String
  description             String?
  segmentType             CrmSegmentType            @default(DYNAMIC)
  status                  CrmSegmentStatus          @default(ACTIVE)
  rules                   Json?
  memberCount             Int                       @default(0)
  lastComputedAt          DateTime?
  computeError            String?
  priority                Int                       @default(0)
  tags                    String[]                  @default([])
  metadata                Json?
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  createdBy               String?
  crm_campaign_audiences  crm_campaign_audiences[]
  crm_loyalty_rules       crm_loyalty_rules[]
  crm_segment_memberships crm_segment_memberships[]

  @@unique([tenantId, slug])
  @@index([segmentType])
  @@index([status])
  @@index([tenantId])
}

model crm_engagement_events {
  id            String            @id
  tenantId      String
  customerId    String
  eventType     CrmEngagementType
  channel       String?
  description   String?
  sourceType    String?
  sourceId      String?
  monetaryValue Decimal?          @db.Decimal(12, 2)
  pointsValue   Int?
  campaignId    String?
  sessionId     String?
  deviceId      String?
  ipAddress     String?
  userAgent     String?
  metadata      Json?
  occurredAt    DateTime          @default(now())

  @@index([campaignId])
  @@index([customerId])
  @@index([eventType])
  @@index([occurredAt])
  @@index([tenantId])
}

model crm_loyalty_programs {
  id                       String                     @id
  tenantId                 String                     @unique
  name                     String
  description              String?
  isActive                 Boolean                    @default(true)
  startsAt                 DateTime?
  endsAt                   DateTime?
  pointsName               String                     @default("Points")
  pointsSymbol             String                     @default("pts")
  pointsPerCurrency        Decimal                    @default(1) @db.Decimal(10, 4)
  currencyPerPoint         Decimal?                   @db.Decimal(10, 4)
  pointsExpireMonths       Int?
  tierConfig               Json?
  metadata                 Json?
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime
  createdBy                String?
  crm_loyalty_rules        crm_loyalty_rules[]
  crm_loyalty_transactions crm_loyalty_transactions[]
}

model crm_loyalty_rules {
  id                    String                 @id
  tenantId              String
  programId             String
  name                  String
  description           String?
  ruleType              String
  conditions            Json?
  pointsValue           Int?
  pointsMultiplier      Decimal?               @db.Decimal(5, 2)
  percentValue          Decimal?               @db.Decimal(5, 2)
  segmentId             String?
  isActive              Boolean                @default(true)
  startsAt              DateTime?
  endsAt                DateTime?
  maxUsesPerCustomer    Int?
  maxTotalUses          Int?
  currentUses           Int                    @default(0)
  priority              Int                    @default(0)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime
  crm_loyalty_programs  crm_loyalty_programs   @relation(fields: [programId], references: [id], onDelete: Cascade)
  crm_customer_segments crm_customer_segments? @relation(fields: [segmentId], references: [id])

  @@index([programId])
  @@index([ruleType])
  @@index([tenantId])
}

model crm_loyalty_transactions {
  id                   String                    @id
  tenantId             String
  programId            String
  customerId           String
  transactionType      CrmLoyaltyTransactionType
  points               Int
  balanceAfter         Int
  sourceType           String?
  sourceId             String?
  ruleId               String?
  description          String?
  memo                 String?
  expiresAt            DateTime?
  isExpired            Boolean                   @default(false)
  metadata             Json?
  createdAt            DateTime                  @default(now())
  createdBy            String?
  crm_loyalty_programs crm_loyalty_programs      @relation(fields: [programId], references: [id])

  @@index([customerId])
  @@index([expiresAt])
  @@index([programId])
  @@index([sourceType, sourceId])
  @@index([tenantId])
  @@index([transactionType])
}

model crm_segment_memberships {
  id                    String                @id
  tenantId              String
  segmentId             String
  customerId            String
  addedAt               DateTime              @default(now())
  addedBy               String?
  isManual              Boolean               @default(false)
  score                 Float?
  metadata              Json?
  crm_customer_segments crm_customer_segments @relation(fields: [segmentId], references: [id], onDelete: Cascade)

  @@unique([segmentId, customerId])
  @@index([customerId])
  @@index([tenantId])
}

model developer_apps {
  id             String     @id
  tenantId       String?
  name           String
  description    String?
  logoUrl        String?
  websiteUrl     String?
  developerName  String
  developerEmail String
  clientId       String     @unique
  clientSecret   String
  redirectUris   String[]
  allowedScopes  String[]
  isVerified     Boolean    @default(false)
  isActive       Boolean    @default(true)
  rateLimit      Int        @default(100)
  totalRequests  Int        @default(0)
  lastRequestAt  DateTime?
  createdAt      DateTime   @default(now())
  updatedAt      DateTime
  verifiedAt     DateTime?
  verifiedBy     String?
  api_keys       api_keys[]

  @@index([clientId])
  @@index([isVerified])
  @@index([tenantId])
}

model hr_attendance_records {
  id                   String               @id
  tenantId             String
  employeeProfileId    String
  date                 DateTime             @db.Date
  clockIn              DateTime?
  clockOut             DateTime?
  breakStart           DateTime?
  breakEnd             DateTime?
  status               HrAttendanceStatus   @default(PRESENT)
  scheduledMinutes     Int?
  workedMinutes        Int?
  breakMinutes         Int?
  overtimeMinutes      Int?
  lateMinutes          Int?
  earlyLeaveMinutes    Int?
  clockInMethod        HrClockMethod?
  clockOutMethod       HrClockMethod?
  clockInLocationId    String?
  clockOutLocationId   String?
  clockInLatitude      Decimal?             @db.Decimal(10, 8)
  clockInLongitude     Decimal?             @db.Decimal(11, 8)
  clockOutLatitude     Decimal?             @db.Decimal(10, 8)
  clockOutLongitude    Decimal?             @db.Decimal(11, 8)
  leaveRequestId       String?
  requiresApproval     Boolean              @default(false)
  approvedBy           String?
  approvedAt           DateTime?
  rejectedBy           String?
  rejectedAt           DateTime?
  rejectionReason      String?
  offlineId            String?
  recordedAt           DateTime             @default(now())
  syncedAt             DateTime?
  notes                String?
  adminNotes           String?
  createdAt            DateTime             @default(now())
  updatedAt            DateTime
  createdBy            String?
  updatedBy            String?
  hr_employee_profiles hr_employee_profiles @relation(fields: [employeeProfileId], references: [id], onDelete: Cascade)

  @@unique([employeeProfileId, date])
  @@index([date])
  @@index([employeeProfileId])
  @@index([offlineId])
  @@index([status])
  @@index([tenantId])
}

model hr_configurations {
  id                         String          @id
  tenantId                   String          @unique
  hrEnabled                  Boolean         @default(true)
  attendanceEnabled          Boolean         @default(true)
  leaveEnabled               Boolean         @default(true)
  payrollEnabled             Boolean         @default(true)
  defaultPayFrequency        HrPayFrequency  @default(MONTHLY)
  defaultPaymentMethod       HrPaymentMethod @default(CASH)
  defaultCurrency            String          @default("NGN")
  defaultWorkHoursPerDay     Int             @default(8)
  defaultWorkDaysPerWeek     Int             @default(5)
  overtimeMultiplier         Decimal         @default(1.5) @db.Decimal(5, 2)
  allowManualAttendance      Boolean         @default(true)
  allowSelfClockIn           Boolean         @default(true)
  requireLocationForClockIn  Boolean         @default(false)
  lateThresholdMinutes       Int             @default(15)
  earlyLeaveThresholdMinutes Int             @default(15)
  defaultAnnualLeave         Int             @default(15)
  defaultSickLeave           Int             @default(10)
  defaultCasualLeave         Int             @default(5)
  leaveCarryForwardLimit     Int             @default(5)
  requireLeaveApproval       Boolean         @default(true)
  requirePayrollApproval     Boolean         @default(true)
  autoCalculatePayroll       Boolean         @default(false)
  payeTaxEnabled             Boolean         @default(true)
  pensionEnabled             Boolean         @default(true)
  pensionEmployeeRate        Decimal         @default(8) @db.Decimal(5, 2)
  pensionEmployerRate        Decimal         @default(10) @db.Decimal(5, 2)
  nhfEnabled                 Boolean         @default(false)
  nhfRate                    Decimal         @default(2.5) @db.Decimal(5, 2)
  operatingHours             Json?
  metadata                   Json?
  createdAt                  DateTime        @default(now())
  updatedAt                  DateTime
}

model hr_employee_profiles {
  id                       String                    @id
  tenantId                 String
  staffId                  String                    @unique
  employmentType           HrEmploymentType          @default(FULL_TIME)
  jobTitle                 String?
  department               String?
  grade                    String?
  baseSalary               Decimal?                  @db.Decimal(12, 2)
  hourlyRate               Decimal?                  @db.Decimal(12, 2)
  dailyRate                Decimal?                  @db.Decimal(12, 2)
  payFrequency             HrPayFrequency            @default(MONTHLY)
  paymentMethod            HrPaymentMethod           @default(CASH)
  currency                 String                    @default("NGN")
  bankName                 String?
  bankAccountNumber        String?
  bankAccountName          String?
  mobileMoneyProvider      String?
  mobileMoneyNumber        String?
  hireDate                 DateTime?
  confirmationDate         DateTime?
  terminationDate          DateTime?
  terminationReason        String?
  primaryLocationId        String?
  supervisorStaffId        String?
  annualLeaveEntitlement   Int                       @default(15)
  sickLeaveEntitlement     Int                       @default(10)
  casualLeaveEntitlement   Int                       @default(5)
  taxIdNumber              String?
  pensionNumber            String?
  nhfNumber                String?
  emergencyContactName     String?
  emergencyContactPhone    String?
  emergencyContactRelation String?
  metadata                 Json?
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime
  hr_attendance_records    hr_attendance_records[]
  hr_employment_contracts  hr_employment_contracts[]
  hr_leave_balances        hr_leave_balances[]
  hr_leave_requests        hr_leave_requests[]
  hr_payroll_calculations  hr_payroll_calculations[]
  hr_payslips              hr_payslips[]
  hr_work_schedules        hr_work_schedules[]

  @@index([department])
  @@index([employmentType])
  @@index([staffId])
  @@index([tenantId])
}

model hr_employment_contracts {
  id                   String               @id
  tenantId             String
  employeeProfileId    String
  contractNumber       String?
  contractType         HrEmploymentType
  status               HrContractStatus     @default(DRAFT)
  startDate            DateTime
  endDate              DateTime?
  probationEndDate     DateTime?
  agreedSalary         Decimal              @db.Decimal(12, 2)
  salaryType           String               @default("MONTHLY")
  currency             String               @default("NGN")
  benefits             Json?
  allowances           Json?
  deductions           Json?
  workHoursPerDay      Int                  @default(8)
  workDaysPerWeek      Int                  @default(5)
  overtimeRate         Decimal?             @db.Decimal(5, 2)
  noticePeriodDays     Int                  @default(30)
  employeeSignedAt     DateTime?
  employerSignedAt     DateTime?
  signedBy             String?
  metadata             Json?
  notes                String?
  createdAt            DateTime             @default(now())
  updatedAt            DateTime
  hr_employee_profiles hr_employee_profiles @relation(fields: [employeeProfileId], references: [id], onDelete: Cascade)

  @@index([employeeProfileId])
  @@index([status])
  @@index([tenantId])
}

model hr_leave_balances {
  id                   String               @id
  tenantId             String
  employeeProfileId    String
  year                 Int
  leaveType            HrLeaveType
  entitlement          Int                  @default(0)
  carriedForward       Int                  @default(0)
  adjustments          Int                  @default(0)
  used                 Int                  @default(0)
  pending              Int                  @default(0)
  available            Int                  @default(0)
  notes                String?
  createdAt            DateTime             @default(now())
  updatedAt            DateTime
  hr_employee_profiles hr_employee_profiles @relation(fields: [employeeProfileId], references: [id], onDelete: Cascade)

  @@unique([employeeProfileId, year, leaveType])
  @@index([employeeProfileId])
  @@index([tenantId])
  @@index([year])
}

model hr_leave_requests {
  id                   String               @id
  tenantId             String
  employeeProfileId    String
  leaveType            HrLeaveType
  status               HrLeaveStatus        @default(PENDING)
  startDate            DateTime             @db.Date
  endDate              DateTime             @db.Date
  totalDays            Int
  halfDay              Boolean              @default(false)
  halfDayType          String?
  reason               String?
  attachmentUrl        String?
  approverStaffId      String?
  approvedBy           String?
  approvedAt           DateTime?
  rejectedBy           String?
  rejectedAt           DateTime?
  rejectionReason      String?
  cancelledBy          String?
  cancelledAt          DateTime?
  cancellationReason   String?
  balanceDeducted      Int?
  balanceType          HrLeaveType?
  reliefStaffId        String?
  handoverNotes        String?
  offlineId            String?
  syncedAt             DateTime?
  createdAt            DateTime             @default(now())
  updatedAt            DateTime
  hr_employee_profiles hr_employee_profiles @relation(fields: [employeeProfileId], references: [id], onDelete: Cascade)

  @@index([employeeProfileId])
  @@index([offlineId])
  @@index([startDate])
  @@index([status])
  @@index([tenantId])
}

model hr_payroll_calculations {
  id                   String                     @id
  tenantId             String
  payrollPeriodId      String
  employeeProfileId    String
  status               HrPayrollCalculationStatus @default(PENDING)
  basePay              Decimal                    @default(0) @db.Decimal(12, 2)
  overtimePay          Decimal                    @default(0) @db.Decimal(12, 2)
  allowances           Decimal                    @default(0) @db.Decimal(12, 2)
  bonuses              Decimal                    @default(0) @db.Decimal(12, 2)
  otherEarnings        Decimal                    @default(0) @db.Decimal(12, 2)
  grossPay             Decimal                    @default(0) @db.Decimal(12, 2)
  taxDeduction         Decimal                    @default(0) @db.Decimal(12, 2)
  pensionDeduction     Decimal                    @default(0) @db.Decimal(12, 2)
  nhfDeduction         Decimal                    @default(0) @db.Decimal(12, 2)
  loanDeduction        Decimal                    @default(0) @db.Decimal(12, 2)
  advanceDeduction     Decimal                    @default(0) @db.Decimal(12, 2)
  otherDeductions      Decimal                    @default(0) @db.Decimal(12, 2)
  totalDeductions      Decimal                    @default(0) @db.Decimal(12, 2)
  netPay               Decimal                    @default(0) @db.Decimal(12, 2)
  currency             String                     @default("NGN")
  earningsBreakdown    Json?
  deductionsBreakdown  Json?
  daysWorked           Int                        @default(0)
  daysAbsent           Int                        @default(0)
  daysLeave            Int                        @default(0)
  overtimeHours        Decimal                    @default(0) @db.Decimal(10, 2)
  lateCount            Int                        @default(0)
  approvedBy           String?
  approvedAt           DateTime?
  rejectedBy           String?
  rejectedAt           DateTime?
  rejectionReason      String?
  notes                String?
  adminNotes           String?
  createdAt            DateTime                   @default(now())
  updatedAt            DateTime
  hr_employee_profiles hr_employee_profiles       @relation(fields: [employeeProfileId], references: [id], onDelete: Cascade)
  hr_payroll_periods   hr_payroll_periods         @relation(fields: [payrollPeriodId], references: [id], onDelete: Cascade)

  @@unique([payrollPeriodId, employeeProfileId])
  @@index([employeeProfileId])
  @@index([payrollPeriodId])
  @@index([status])
  @@index([tenantId])
}

model hr_payroll_periods {
  id                      String                    @id
  tenantId                String
  name                    String
  payFrequency            HrPayFrequency
  periodStart             DateTime                  @db.Date
  periodEnd               DateTime                  @db.Date
  payDate                 DateTime                  @db.Date
  status                  HrPayrollPeriodStatus     @default(DRAFT)
  calculatedAt            DateTime?
  calculatedBy            String?
  finalizedAt             DateTime?
  finalizedBy             String?
  paidMarkedAt            DateTime?
  paidMarkedBy            String?
  employeeCount           Int                       @default(0)
  totalGrossPay           Decimal                   @default(0) @db.Decimal(14, 2)
  totalDeductions         Decimal                   @default(0) @db.Decimal(14, 2)
  totalNetPay             Decimal                   @default(0) @db.Decimal(14, 2)
  currency                String                    @default("NGN")
  notes                   String?
  metadata                Json?
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  hr_payroll_calculations hr_payroll_calculations[]
  hr_payslips             hr_payslips[]

  @@unique([tenantId, periodStart, periodEnd, payFrequency])
  @@index([periodStart])
  @@index([status])
  @@index([tenantId])
}

model hr_payslips {
  id                   String               @id
  tenantId             String
  payrollPeriodId      String
  employeeProfileId    String
  payslipNumber        String               @unique
  employeeName         String
  employeeId           String
  department           String?
  jobTitle             String?
  bankName             String?
  bankAccountNumber    String?
  periodStart          DateTime             @db.Date
  periodEnd            DateTime             @db.Date
  payDate              DateTime             @db.Date
  basePay              Decimal              @db.Decimal(12, 2)
  overtimePay          Decimal              @default(0) @db.Decimal(12, 2)
  allowances           Decimal              @default(0) @db.Decimal(12, 2)
  bonuses              Decimal              @default(0) @db.Decimal(12, 2)
  otherEarnings        Decimal              @default(0) @db.Decimal(12, 2)
  grossPay             Decimal              @db.Decimal(12, 2)
  taxDeduction         Decimal              @default(0) @db.Decimal(12, 2)
  pensionDeduction     Decimal              @default(0) @db.Decimal(12, 2)
  nhfDeduction         Decimal              @default(0) @db.Decimal(12, 2)
  loanDeduction        Decimal              @default(0) @db.Decimal(12, 2)
  advanceDeduction     Decimal              @default(0) @db.Decimal(12, 2)
  otherDeductions      Decimal              @default(0) @db.Decimal(12, 2)
  totalDeductions      Decimal              @db.Decimal(12, 2)
  netPay               Decimal              @db.Decimal(12, 2)
  currency             String               @default("NGN")
  earningsDetails      Json?
  deductionsDetails    Json?
  daysWorked           Int
  daysAbsent           Int
  daysLeave            Int
  overtimeHours        Decimal              @db.Decimal(10, 2)
  paymentMethod        HrPaymentMethod      @default(CASH)
  paymentStatus        String               @default("PENDING")
  paymentReference     String?
  paidAt               DateTime?
  paidBy               String?
  deliveredAt          DateTime?
  deliveredMethod      String?
  viewedAt             DateTime?
  isFinalized          Boolean              @default(true)
  generatedAt          DateTime             @default(now())
  generatedBy          String?
  hr_employee_profiles hr_employee_profiles @relation(fields: [employeeProfileId], references: [id])
  hr_payroll_periods   hr_payroll_periods   @relation(fields: [payrollPeriodId], references: [id])

  @@index([employeeProfileId])
  @@index([paymentStatus])
  @@index([payrollPeriodId])
  @@index([periodStart])
  @@index([tenantId])
}

model hr_work_schedules {
  id                      String                @id
  tenantId                String
  name                    String
  description             String?
  scheduleType            HrScheduleType        @default(FIXED)
  isDefault               Boolean               @default(false)
  employeeProfileId       String?
  locationId              String?
  effectiveFrom           DateTime
  effectiveUntil          DateTime?
  weeklySchedule          Json
  hoursPerDay             Int                   @default(8)
  hoursPerWeek            Int                   @default(40)
  overtimeThresholdDaily  Int?
  overtimeThresholdWeekly Int?
  isActive                Boolean               @default(true)
  metadata                Json?
  createdAt               DateTime              @default(now())
  updatedAt               DateTime
  hr_employee_profiles    hr_employee_profiles? @relation(fields: [employeeProfileId], references: [id])

  @@index([employeeProfileId])
  @@index([isActive])
  @@index([tenantId])
}

model integration_credentials {
  id                    String                @id
  instanceId            String
  key                   String
  encryptedValue        String
  isRequired            Boolean               @default(true)
  lastRotated           DateTime?
  expiresAt             DateTime?
  maskedValue           String?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime
  createdBy             String?
  integration_instances integration_instances @relation(fields: [instanceId], references: [id], onDelete: Cascade)

  @@unique([instanceId, key])
  @@index([instanceId])
}

model integration_event_logs {
  id         String   @id
  tenantId   String?
  eventType  String
  eventData  Json
  providerId String?
  instanceId String?
  appId      String?
  keyId      String?
  actorId    String?
  actorType  String?
  occurredAt DateTime @default(now())

  @@index([eventType])
  @@index([occurredAt])
  @@index([tenantId])
}

model integration_instances {
  id                      String                    @id
  tenantId                String
  providerId              String
  displayName             String?
  environment             String                    @default("production")
  status                  IntegrationInstanceStatus @default(PENDING_SETUP)
  enabledScopes           String[]
  configuration           Json?
  activatedAt             DateTime?
  activatedBy             String?
  suspendedAt             DateTime?
  suspendedBy             String?
  suspensionReason        String?
  revokedAt               DateTime?
  revokedBy               String?
  revocationReason        String?
  lastHealthCheck         DateTime?
  healthStatus            String?
  lastError               String?
  errorCount              Int                       @default(0)
  rateLimitOverride       Int?
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  integration_credentials integration_credentials[]
  integration_providers   integration_providers     @relation(fields: [providerId], references: [id])
  integration_logs        integration_logs[]
  integration_webhooks    integration_webhooks[]

  @@unique([tenantId, providerId, environment])
  @@index([providerId])
  @@index([status])
  @@index([tenantId])
}

model integration_logs {
  id                    String                 @id
  tenantId              String
  instanceId            String?
  logType               String
  direction             String
  method                String?
  url                   String?
  requestHeaders        Json?
  requestBody           Json?
  responseStatus        Int?
  responseHeaders       Json?
  responseBody          Json?
  startedAt             DateTime
  completedAt           DateTime?
  durationMs            Int?
  success               Boolean
  errorCode             String?
  errorMessage          String?
  retryCount            Int                    @default(0)
  isRetry               Boolean                @default(false)
  parentLogId           String?
  actorId               String?
  actorType             String?
  metadata              Json?
  createdAt             DateTime               @default(now())
  integration_instances integration_instances? @relation(fields: [instanceId], references: [id])

  @@index([createdAt])
  @@index([instanceId])
  @@index([logType])
  @@index([success])
  @@index([tenantId])
}

model integration_providers {
  id                    String                    @id
  key                   String                    @unique
  name                  String
  category              IntegrationCategory
  description           String?
  logoUrl               String?
  websiteUrl            String?
  documentationUrl      String?
  apiBaseUrl            String?
  apiVersion            String?
  isNigeriaFirst        Boolean                   @default(false)
  supportedScopes       String[]
  requiredCredentials   String[]
  supportsWebhooks      Boolean                   @default(false)
  webhookSignatureAlgo  String?
  defaultRateLimit      Int?
  status                IntegrationProviderStatus @default(ACTIVE)
  version               String                    @default("1.0.0")
  createdAt             DateTime                  @default(now())
  updatedAt             DateTime
  createdBy             String?
  integration_instances integration_instances[]

  @@index([category])
  @@index([isNigeriaFirst])
  @@index([status])
}

model integration_webhooks {
  id                    String                @id
  instanceId            String
  name                  String
  direction             WebhookDirection
  url                   String
  events                String[]
  secretKey             String?
  status                WebhookStatus         @default(ACTIVE)
  retryEnabled          Boolean               @default(true)
  maxRetries            Int                   @default(3)
  retryDelayMs          Int                   @default(1000)
  totalCalls            Int                   @default(0)
  successCount          Int                   @default(0)
  failureCount          Int                   @default(0)
  lastCalledAt          DateTime?
  lastSuccessAt         DateTime?
  lastFailureAt         DateTime?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime
  integration_instances integration_instances @relation(fields: [instanceId], references: [id], onDelete: Cascade)

  @@index([direction])
  @@index([instanceId])
  @@index([status])
}

model inv_audit_items {
  id                     String     @id
  auditId                String
  productId              String
  variantId              String?
  productName            String
  variantName            String?
  sku                    String?
  binLocation            String?
  expectedQuantity       Int
  countedQuantity        Int?
  varianceQuantity       Int?
  varianceValue          Decimal?   @db.Decimal(12, 2)
  varianceReason         String?
  unitCost               Decimal?   @db.Decimal(12, 2)
  batchNumber            String?
  lotNumber              String?
  countedById            String?
  countedByName          String?
  countedAt              DateTime?
  recountRequired        Boolean    @default(false)
  recountedAt            DateTime?
  adjustmentApproved     Boolean    @default(false)
  adjustmentApprovedById String?
  adjustmentApprovedAt   DateTime?
  notes                  String?
  createdAt              DateTime   @default(now())
  updatedAt              DateTime
  inv_audits             inv_audits @relation(fields: [auditId], references: [id], onDelete: Cascade)

  @@unique([auditId, productId, variantId, binLocation, batchNumber])
  @@index([auditId])
  @@index([productId])
  @@index([varianceQuantity])
}

model inv_audits {
  id                     String               @id
  tenantId               String
  auditNumber            String               @unique
  warehouseId            String
  categoryIds            String[]             @default([])
  productIds             String[]             @default([])
  binLocations           String[]             @default([])
  auditType              String               @default("FULL")
  status                 InventoryAuditStatus @default(DRAFT)
  scheduledDate          DateTime?
  startedAt              DateTime?
  completedAt            DateTime?
  approvedAt             DateTime?
  totalItemsCounted      Int                  @default(0)
  itemsWithVariance      Int                  @default(0)
  totalVarianceValue     Decimal?             @db.Decimal(12, 2)
  variancePercentage     Decimal?             @db.Decimal(5, 2)
  currency               String               @default("NGN")
  createdById            String?
  createdByName          String?
  supervisorId           String?
  supervisorName         String?
  approvedById           String?
  approvedByName         String?
  notes                  String?
  internalNotes          String?
  requiresApproval       Boolean              @default(true)
  varianceThresholdPct   Decimal?             @db.Decimal(5, 2)
  varianceThresholdValue Decimal?             @db.Decimal(12, 2)
  adjustmentEventId      String?
  isOfflineCreated       Boolean              @default(false)
  offlineId              String?
  syncedAt               DateTime?
  metadata               Json?
  createdAt              DateTime             @default(now())
  updatedAt              DateTime
  inv_audit_items        inv_audit_items[]
  inv_warehouses         inv_warehouses       @relation(fields: [warehouseId], references: [id])

  @@index([auditType])
  @@index([scheduledDate])
  @@index([status])
  @@index([tenantId])
  @@index([warehouseId])
}

model inv_reorder_rules {
  id                      String                    @id
  tenantId                String
  productId               String?
  variantId               String?
  categoryId              String?
  locationId              String?
  name                    String
  description             String?
  triggerType             ReorderTriggerType        @default(BELOW_THRESHOLD)
  reorderPoint            Int?
  reorderQuantity         Int?
  minDaysOfStock          Int?
  targetDaysOfStock       Int?
  velocityPeriodDays      Int                       @default(30)
  preferredSupplierId     String?
  minOrderQuantity        Int?
  maxOrderQuantity        Int?
  orderMultiple           Int?
  supplierLeadTimeDays    Int                       @default(7)
  maxUnitCost             Decimal?                  @db.Decimal(12, 2)
  currency                String                    @default("NGN")
  scheduleExpression      String?
  isActive                Boolean                   @default(true)
  priority                Int                       @default(0)
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  inv_reorder_suggestions inv_reorder_suggestions[]

  @@index([categoryId])
  @@index([isActive])
  @@index([locationId])
  @@index([productId])
  @@index([tenantId])
}

model inv_reorder_suggestions {
  id                    String                  @id
  tenantId              String
  ruleId                String?
  productId             String
  variantId             String?
  productName           String
  variantName           String?
  sku                   String?
  locationId            String
  locationName          String
  currentQuantity       Int
  reservedQuantity      Int
  availableQuantity     Int
  avgDailySales         Decimal?                @db.Decimal(10, 2)
  daysOfStockLeft       Int?
  velocityTrend         String?
  suggestedQuantity     Int
  suggestedSupplierId   String?
  suggestedSupplierName String?
  estimatedUnitCost     Decimal?                @db.Decimal(12, 2)
  estimatedTotalCost    Decimal?                @db.Decimal(12, 2)
  currency              String                  @default("NGN")
  urgency               String                  @default("NORMAL")
  status                ReorderSuggestionStatus @default(PENDING)
  reviewedById          String?
  reviewedByName        String?
  reviewedAt            DateTime?
  rejectionReason       String?
  expiresAt             DateTime
  notes                 String?
  calculationDetails    Json?
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  inv_reorder_rules     inv_reorder_rules?      @relation(fields: [ruleId], references: [id])

  @@index([createdAt])
  @@index([expiresAt])
  @@index([locationId])
  @@index([productId])
  @@index([status])
  @@index([tenantId])
  @@index([urgency])
}

model inv_stock_movements {
  id               String              @id
  tenantId         String
  productId        String
  variantId        String?
  locationId       String
  reason           StockMovementReason
  quantity         Int
  quantityBefore   Int
  unitCost         Decimal?            @db.Decimal(12, 2)
  currency         String              @default("NGN")
  referenceType    String?
  referenceId      String?
  batchNumber      String?
  lotNumber        String?
  expiryDate       DateTime?
  serialNumbers    String[]            @default([])
  binLocation      String?
  notes            String?
  eventId          String?             @unique
  eventEmittedAt   DateTime?
  eventProcessed   Boolean             @default(false)
  performedBy      String?
  performedByName  String?
  isOfflineCreated Boolean             @default(false)
  offlineId        String?
  syncedAt         DateTime?
  createdAt        DateTime            @default(now())

  @@index([batchNumber])
  @@index([createdAt])
  @@index([eventProcessed])
  @@index([expiryDate])
  @@index([locationId])
  @@index([productId])
  @@index([reason])
  @@index([referenceType, referenceId])
  @@index([tenantId])
  @@index([variantId])
}

model inv_stock_transfer_items {
  id                  String              @id
  transferId          String
  productId           String
  variantId           String?
  productName         String
  variantName         String?
  sku                 String?
  quantityRequested   Int
  quantityShipped     Int                 @default(0)
  quantityReceived    Int                 @default(0)
  varianceQuantity    Int?
  varianceReason      String?
  batchNumber         String?
  lotNumber           String?
  expiryDate          DateTime?
  unitCost            Decimal?            @db.Decimal(12, 2)
  fromBinLocation     String?
  toBinLocation       String?
  notes               String?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime
  inv_stock_transfers inv_stock_transfers @relation(fields: [transferId], references: [id], onDelete: Cascade)

  @@unique([transferId, productId, variantId, batchNumber])
  @@index([productId])
  @@index([transferId])
}

model inv_stock_transfers {
  id                                                                 String                     @id
  tenantId                                                           String
  transferNumber                                                     String                     @unique
  fromWarehouseId                                                    String
  toWarehouseId                                                      String
  status                                                             StockTransferStatus        @default(DRAFT)
  requestedDate                                                      DateTime                   @default(now())
  approvedDate                                                       DateTime?
  shippedDate                                                        DateTime?
  expectedArrival                                                    DateTime?
  receivedDate                                                       DateTime?
  priority                                                           String                     @default("NORMAL")
  reason                                                             String?
  shippingMethod                                                     String?
  trackingNumber                                                     String?
  carrierName                                                        String?
  shippingCost                                                       Decimal?                   @db.Decimal(12, 2)
  currency                                                           String                     @default("NGN")
  notes                                                              String?
  internalNotes                                                      String?
  requestedById                                                      String?
  requestedByName                                                    String?
  approvedById                                                       String?
  approvedByName                                                     String?
  rejectedById                                                       String?
  rejectedByName                                                     String?
  rejectionReason                                                    String?
  receivedById                                                       String?
  receivedByName                                                     String?
  receivingNotes                                                     String?
  eventId                                                            String?                    @unique
  eventEmittedAt                                                     DateTime?
  isOfflineCreated                                                   Boolean                    @default(false)
  offlineId                                                          String?
  syncedAt                                                           DateTime?
  metadata                                                           Json?
  createdAt                                                          DateTime                   @default(now())
  updatedAt                                                          DateTime
  inv_stock_transfer_items                                           inv_stock_transfer_items[]
  inv_warehouses_inv_stock_transfers_fromWarehouseIdToinv_warehouses inv_warehouses             @relation("inv_stock_transfers_fromWarehouseIdToinv_warehouses", fields: [fromWarehouseId], references: [id])
  inv_warehouses_inv_stock_transfers_toWarehouseIdToinv_warehouses   inv_warehouses             @relation("inv_stock_transfers_toWarehouseIdToinv_warehouses", fields: [toWarehouseId], references: [id])

  @@index([fromWarehouseId])
  @@index([priority])
  @@index([requestedDate])
  @@index([status])
  @@index([tenantId])
  @@index([toWarehouseId])
}

model inv_supplier_replenishment_rules {
  id                       String          @id
  tenantId                 String
  supplierId               String
  warehouseId              String?
  name                     String
  description              String?
  supplierName             String
  supplierContact          String?
  supplierPhone            String?
  supplierEmail            String?
  preferredOrderDays       String[]        @default([])
  minimumOrderValue        Decimal?        @db.Decimal(12, 2)
  minimumOrderQuantity     Int?
  currency                 String          @default("NGN")
  standardLeadTimeDays     Int             @default(7)
  expressLeadTimeDays      Int?
  orderMethod              String          @default("MANUAL")
  paymentTerms             String?
  creditLimit              Decimal?        @db.Decimal(12, 2)
  productIds               String[]        @default([])
  categoryIds              String[]        @default([])
  isPreferredForCategories Boolean         @default(false)
  discountPercentage       Decimal?        @db.Decimal(5, 2)
  volumeDiscounts          Json?
  reliabilityScore         Int?
  qualityScore             Int?
  lastDeliveryRating       Int?
  isActive                 Boolean         @default(true)
  notes                    String?
  metadata                 Json?
  createdAt                DateTime        @default(now())
  updatedAt                DateTime
  inv_warehouses           inv_warehouses? @relation(fields: [warehouseId], references: [id])

  @@unique([tenantId, supplierId, warehouseId])
  @@index([isActive])
  @@index([supplierId])
  @@index([tenantId])
  @@index([warehouseId])
}

model inv_warehouses {
  id                                                                      String                             @id
  tenantId                                                                String
  locationId                                                              String                             @unique
  name                                                                    String
  code                                                                    String
  description                                                             String?
  warehouseType                                                           String                             @default("GENERAL")
  totalCapacity                                                           Int?
  usedCapacity                                                            Int?
  capacityUnit                                                            String?
  fulfillmentPriority                                                     Int                                @default(0)
  isActive                                                                Boolean                            @default(true)
  acceptsTransfersIn                                                      Boolean                            @default(true)
  acceptsTransfersOut                                                     Boolean                            @default(true)
  isDefaultForReceiving                                                   Boolean                            @default(false)
  managerName                                                             String?
  managerPhone                                                            String?
  managerEmail                                                            String?
  operatingHours                                                          Json?
  lgaCode                                                                 String?
  stateCode                                                               String?
  metadata                                                                Json?
  createdAt                                                               DateTime                           @default(now())
  updatedAt                                                               DateTime
  inv_audits                                                              inv_audits[]
  inv_stock_transfers_inv_stock_transfers_fromWarehouseIdToinv_warehouses inv_stock_transfers[]              @relation("inv_stock_transfers_fromWarehouseIdToinv_warehouses")
  inv_stock_transfers_inv_stock_transfers_toWarehouseIdToinv_warehouses   inv_stock_transfers[]              @relation("inv_stock_transfers_toWarehouseIdToinv_warehouses")
  inv_supplier_replenishment_rules                                        inv_supplier_replenishment_rules[]

  @@unique([tenantId, code])
  @@index([isActive])
  @@index([locationId])
  @@index([tenantId])
  @@index([warehouseType])
}

model logistics_configurations {
  id                         String                    @id
  tenantId                   String                    @unique
  deliveryEnabled            Boolean                   @default(true)
  autoAssignmentEnabled      Boolean                   @default(false)
  realTimeTrackingEnabled    Boolean                   @default(false)
  proofOfDeliveryRequired    Boolean                   @default(true)
  defaultPriority            LogisticsDeliveryPriority @default(STANDARD)
  defaultCurrency            String                    @default("NGN")
  photoProofRequired         Boolean                   @default(true)
  signatureProofRequired     Boolean                   @default(false)
  pinVerificationEnabled     Boolean                   @default(false)
  otpVerificationEnabled     Boolean                   @default(false)
  assignmentAlgorithm        String                    @default("NEAREST")
  maxConcurrentDeliveries    Int                       @default(5)
  defaultDeliveryWindowHours Int                       @default(4)
  expressDeliveryWindowHours Int                       @default(2)
  sameDayDeliveryWindowHours Int                       @default(6)
  operatingHours             Json?
  maxDeliveryAttempts        Int                       @default(3)
  retryDelayHours            Int                       @default(24)
  notifyCustomerOnAssignment Boolean                   @default(true)
  notifyCustomerOnPickup     Boolean                   @default(true)
  notifyCustomerOnTransit    Boolean                   @default(true)
  notifyCustomerOnArrival    Boolean                   @default(true)
  notifyCustomerOnDelivery   Boolean                   @default(true)
  notifyCustomerOnFailure    Boolean                   @default(true)
  supportInformalAddresses   Boolean                   @default(true)
  landmarkRequired           Boolean                   @default(true)
  metadata                   Json?
  createdAt                  DateTime                  @default(now())
  updatedAt                  DateTime
}

model logistics_delivery_agents {
  id                             String                           @id
  tenantId                       String
  firstName                      String
  lastName                       String
  phone                          String
  email                          String?
  photoUrl                       String?
  agentType                      LogisticsAgentType               @default(IN_HOUSE)
  vehicleType                    String?
  vehiclePlate                   String?
  vehicleModel                   String?
  defaultZoneId                  String?
  assignedZoneIds                String[]                         @default([])
  status                         LogisticsAgentStatus             @default(ACTIVE)
  availability                   LogisticsAgentAvailability       @default(OFFLINE)
  lastLatitude                   Decimal?                         @db.Decimal(10, 8)
  lastLongitude                  Decimal?                         @db.Decimal(11, 8)
  lastLocationAt                 DateTime?
  totalDeliveries                Int                              @default(0)
  completedDeliveries            Int                              @default(0)
  failedDeliveries               Int                              @default(0)
  averageRating                  Decimal?                         @db.Decimal(3, 2)
  totalRatings                   Int                              @default(0)
  employeeId                     String?
  hireDate                       DateTime?
  terminatedAt                   DateTime?
  bankName                       String?
  bankAccount                    String?
  bankAccountName                String?
  metadata                       Json?
  createdAt                      DateTime                         @default(now())
  updatedAt                      DateTime
  logistics_delivery_assignments logistics_delivery_assignments[]

  @@unique([tenantId, phone])
  @@index([agentType])
  @@index([availability])
  @@index([status])
  @@index([tenantId])
}

model logistics_delivery_assignments {
  id                                String                              @id
  tenantId                          String
  orderId                           String
  orderType                         String
  orderNumber                       String?
  customerId                        String?
  customerName                      String?
  customerPhone                     String?
  zoneId                            String?
  agentId                           String?
  deliveryAddress                   Json?
  deliveryLatitude                  Decimal?                            @db.Decimal(10, 8)
  deliveryLongitude                 Decimal?                            @db.Decimal(11, 8)
  pickupLocationId                  String?
  pickupAddress                     Json?
  pickupLatitude                    Decimal?                            @db.Decimal(10, 8)
  pickupLongitude                   Decimal?                            @db.Decimal(11, 8)
  status                            LogisticsDeliveryStatus             @default(PENDING)
  priority                          LogisticsDeliveryPriority           @default(STANDARD)
  estimatedFee                      Decimal?                            @db.Decimal(12, 2)
  actualFee                         Decimal?                            @db.Decimal(12, 2)
  currency                          String                              @default("NGN")
  feeCalculation                    Json?
  estimatedDistanceKm               Decimal?                            @db.Decimal(10, 2)
  estimatedDurationMin              Int?
  actualDistanceKm                  Decimal?                            @db.Decimal(10, 2)
  actualDurationMin                 Int?
  scheduledPickupAt                 DateTime?
  scheduledDeliveryAt               DateTime?
  actualPickupAt                    DateTime?
  actualDeliveryAt                  DateTime?
  deliveryWindowStart               DateTime?
  deliveryWindowEnd                 DateTime?
  specialInstructions               String?
  contactOnArrival                  Boolean                             @default(true)
  packageCount                      Int                                 @default(1)
  totalWeight                       Decimal?                            @db.Decimal(10, 2)
  packageDetails                    Json?
  failureReason                     String?
  failureCode                       String?
  failedAttempts                    Int                                 @default(0)
  maxAttempts                       Int                                 @default(3)
  customerRating                    Int?
  customerReview                    String?
  ratedAt                           DateTime?
  assignedBy                        String?
  assignedAt                        DateTime?
  autoAssigned                      Boolean                             @default(false)
  metadata                          Json?
  createdAt                         DateTime                            @default(now())
  updatedAt                         DateTime
  logistics_delivery_agents         logistics_delivery_agents?          @relation(fields: [agentId], references: [id])
  logistics_delivery_zones          logistics_delivery_zones?           @relation(fields: [zoneId], references: [id])
  logistics_delivery_proofs         logistics_delivery_proofs[]
  logistics_delivery_status_history logistics_delivery_status_history[]

  @@unique([orderId, orderType])
  @@index([agentId])
  @@index([createdAt])
  @@index([orderId])
  @@index([scheduledDeliveryAt])
  @@index([status])
  @@index([tenantId])
}

model logistics_delivery_pricing_rules {
  id                       String                   @id
  tenantId                 String
  zoneId                   String
  name                     String
  description              String?
  pricingType              LogisticsPricingType     @default(FLAT_RATE)
  baseFee                  Decimal                  @default(0) @db.Decimal(12, 2)
  feePerKm                 Decimal?                 @db.Decimal(12, 2)
  feePerKg                 Decimal?                 @db.Decimal(12, 2)
  percentOfOrder           Decimal?                 @db.Decimal(5, 2)
  freeDeliveryThreshold    Decimal?                 @db.Decimal(12, 2)
  minOrderValue            Decimal?                 @db.Decimal(12, 2)
  maxOrderValue            Decimal?                 @db.Decimal(12, 2)
  minFee                   Decimal?                 @db.Decimal(12, 2)
  maxFee                   Decimal?                 @db.Decimal(12, 2)
  tiers                    Json?
  expressMultiplier        Decimal?                 @db.Decimal(5, 2)
  weekendMultiplier        Decimal?                 @db.Decimal(5, 2)
  peakHourMultiplier       Decimal?                 @db.Decimal(5, 2)
  currency                 String                   @default("NGN")
  isActive                 Boolean                  @default(true)
  priority                 Int                      @default(0)
  validFrom                DateTime?
  validUntil               DateTime?
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime
  logistics_delivery_zones logistics_delivery_zones @relation(fields: [zoneId], references: [id], onDelete: Cascade)

  @@index([isActive])
  @@index([tenantId])
  @@index([zoneId])
}

model logistics_delivery_proofs {
  id                             String                         @id
  assignmentId                   String
  proofType                      LogisticsProofType
  imageUrl                       String?
  signatureData                  String?
  pinCode                        String?
  otpCode                        String?
  recipientName                  String?
  notes                          String?
  latitude                       Decimal?                       @db.Decimal(10, 8)
  longitude                      Decimal?                       @db.Decimal(11, 8)
  capturedBy                     String?
  capturedByType                 String?
  offlineId                      String?
  capturedAt                     DateTime
  syncedAt                       DateTime?
  metadata                       Json?
  createdAt                      DateTime                       @default(now())
  logistics_delivery_assignments logistics_delivery_assignments @relation(fields: [assignmentId], references: [id], onDelete: Cascade)

  @@index([assignmentId])
  @@index([capturedAt])
  @@index([proofType])
}

model logistics_delivery_status_history {
  id                             String                         @id
  assignmentId                   String
  fromStatus                     LogisticsDeliveryStatus?
  toStatus                       LogisticsDeliveryStatus
  latitude                       Decimal?                       @db.Decimal(10, 8)
  longitude                      Decimal?                       @db.Decimal(11, 8)
  address                        String?
  changedBy                      String?
  changedByType                  String?
  notes                          String?
  offlineId                      String?
  recordedAt                     DateTime
  syncedAt                       DateTime?
  metadata                       Json?
  createdAt                      DateTime                       @default(now())
  logistics_delivery_assignments logistics_delivery_assignments @relation(fields: [assignmentId], references: [id], onDelete: Cascade)

  @@index([assignmentId])
  @@index([offlineId])
  @@index([recordedAt])
  @@index([toStatus])
}

model logistics_delivery_zones {
  id                               String                             @id
  tenantId                         String
  name                             String
  code                             String?
  description                      String?
  zoneType                         LogisticsZoneType                  @default(CITY)
  city                             String?
  state                            String?
  lga                              String?
  postalCodes                      String[]                           @default([])
  centerLatitude                   Decimal?                           @db.Decimal(10, 8)
  centerLongitude                  Decimal?                           @db.Decimal(11, 8)
  radiusKm                         Decimal?                           @db.Decimal(10, 2)
  polygon                          Json?
  status                           LogisticsZoneStatus                @default(ACTIVE)
  sortOrder                        Int                                @default(0)
  metadata                         Json?
  createdAt                        DateTime                           @default(now())
  updatedAt                        DateTime
  createdBy                        String?
  logistics_delivery_assignments   logistics_delivery_assignments[]
  logistics_delivery_pricing_rules logistics_delivery_pricing_rules[]

  @@unique([tenantId, code])
  @@index([city])
  @@index([lga])
  @@index([state])
  @@index([status])
  @@index([tenantId])
}

model mkt_automation_actions {
  id                       String                   @id
  workflowId               String
  type                     MktActionType
  config                   Json
  delayMinutes             Int                      @default(0)
  sortOrder                Int                      @default(0)
  isActive                 Boolean                  @default(true)
  mkt_automation_workflows mkt_automation_workflows @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([workflowId])
}

model mkt_automation_logs {
  id         String   @id
  tenantId   String
  eventType  String
  eventData  Json
  workflowId String?
  runId      String?
  customerId String?
  actorId    String?
  actorType  String?
  occurredAt DateTime @default(now())

  @@index([occurredAt])
  @@index([runId])
  @@index([tenantId])
  @@index([workflowId])
}

model mkt_automation_runs {
  id                       String                   @id
  tenantId                 String
  workflowId               String
  customerId               String?
  customerPhone            String?
  triggeredBy              String
  triggerData              Json?
  status                   MktRunStatus             @default(PENDING)
  startedAt                DateTime?
  completedAt              DateTime?
  errorMessage             String?
  actionsExecuted          Int                      @default(0)
  actionResults            Json?
  coreRequestId            String?
  metadata                 Json?
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime
  mkt_automation_workflows mkt_automation_workflows @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([customerId])
  @@index([status])
  @@index([tenantId])
  @@index([workflowId])
}

model mkt_automation_triggers {
  id                       String                   @id
  workflowId               String
  type                     MktTriggerType
  eventName                String?
  conditions               Json?
  scheduleType             String?
  scheduleDays             Int?
  sortOrder                Int                      @default(0)
  isActive                 Boolean                  @default(true)
  mkt_automation_workflows mkt_automation_workflows @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([workflowId])
}

model mkt_automation_workflows {
  id                      String                    @id
  tenantId                String
  name                    String
  description             String?
  status                  MktAutomationStatus       @default(DRAFT)
  isRecurring             Boolean                   @default(true)
  startDate               DateTime?
  endDate                 DateTime?
  templateKey             String?
  isTemplate              Boolean                   @default(false)
  totalRuns               Int                       @default(0)
  successfulRuns          Int                       @default(0)
  failedRuns              Int                       @default(0)
  lastRunAt               DateTime?
  offlineId               String?
  metadata                Json?
  createdBy               String?
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  mkt_automation_actions  mkt_automation_actions[]
  mkt_automation_runs     mkt_automation_runs[]
  mkt_automation_triggers mkt_automation_triggers[]

  @@unique([tenantId, offlineId])
  @@index([status])
  @@index([tenantId])
}

model mkt_configurations {
  id                     String   @id
  tenantId               String   @unique
  automationEnabled      Boolean  @default(true)
  smsAutomation          Boolean  @default(true)
  emailAutomation        Boolean  @default(true)
  pushAutomation         Boolean  @default(false)
  maxMessagesPerDay      Int      @default(100)
  maxMessagesPerCustomer Int      @default(3)
  quietHoursStart        Int?
  quietHoursEnd          Int?
  defaultChannel         String   @default("SMS")
  smsFirst               Boolean  @default(true)
  timezone               String   @default("Africa/Lagos")
  metadata               Json?
  createdAt              DateTime @default(now())
  updatedAt              DateTime
}

model partner_attributions_ext {
  id                             String                           @id
  partnerId                      String
  referralLinkId                 String?
  tenantId                       String                           @unique
  tenantSlug                     String?
  attributedAt                   DateTime                         @default(now())
  firstSubscription              DateTime?
  utmSource                      String?
  utmMedium                      String?
  utmCampaign                    String?
  status                         AttributionStatus                @default(ATTRIBUTED)
  isLocked                       Boolean                          @default(false)
  lockedAt                       DateTime?
  metadata                       Json?
  createdAt                      DateTime                         @default(now())
  partner_referral_links_ext     partner_referral_links_ext?      @relation(fields: [referralLinkId], references: [id])
  partner_commission_records_ext partner_commission_records_ext[]

  @@index([attributedAt])
  @@index([partnerId])
  @@index([tenantId])
}

model partner_commission_records_ext {
  id                       String                   @id
  partnerId                String
  attributionId            String
  eventType                CommissionEventType
  eventId                  String?
  eventDate                DateTime
  grossAmount              Decimal                  @db.Decimal(12, 2)
  commissionRate           Decimal                  @db.Decimal(5, 2)
  commissionAmount         Decimal                  @db.Decimal(12, 2)
  currency                 String                   @default("NGN")
  status                   CommissionStatusExt      @default(PENDING)
  payoutId                 String?
  paidAt                   DateTime?
  metadata                 Json?
  createdAt                DateTime                 @default(now())
  partner_attributions_ext partner_attributions_ext @relation(fields: [attributionId], references: [id])

  @@index([attributionId])
  @@index([eventDate])
  @@index([partnerId])
  @@index([status])
}

model partner_commission_rules_ext {
  id             String            @id
  partnerId      String?
  name           String
  description    String?
  planId         String?
  moduleId       String?
  commissionType CommissionTypeExt @default(PERCENTAGE)
  value          Decimal           @db.Decimal(12, 2)
  isRecurring    Boolean           @default(true)
  maxRecurrences Int?
  validFrom      DateTime?
  validTo        DateTime?
  priority       Int               @default(0)
  isActive       Boolean           @default(true)
  metadata       Json?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime

  @@index([isActive])
  @@index([partnerId])
  @@index([planId])
}

model partner_configurations {
  id                   String   @id
  programEnabled       Boolean  @default(true)
  autoApproval         Boolean  @default(false)
  minPayoutThreshold   Decimal  @default(10000) @db.Decimal(12, 2)
  defaultCommission    Decimal  @default(10) @db.Decimal(5, 2)
  attributionWindow    Int      @default(30)
  cookieDuration       Int      @default(30)
  attributionLock      Boolean  @default(true)
  verificationRequired Boolean  @default(true)
  manualVerification   Boolean  @default(true)
  metadata             Json?
  createdAt            DateTime @default(now())
  updatedAt            DateTime
}

model partner_event_logs_ext {
  id            String   @id
  eventType     String
  eventData     Json
  partnerId     String?
  attributionId String?
  commissionId  String?
  actorId       String?
  actorType     String?
  occurredAt    DateTime @default(now())

  @@index([eventType])
  @@index([occurredAt])
  @@index([partnerId])
}

model partner_profiles_ext {
  id              String      @id
  partnerId       String      @unique
  partnerType     PartnerType @default(INDIVIDUAL)
  cacNumber       String?
  tinNumber       String?
  bankName        String?
  bankCode        String?
  accountNumber   String?
  accountName     String?
  bio             String?
  linkedinUrl     String?
  industries      String[]    @default([])
  specialties     String[]    @default([])
  languages       String[]    @default(["en"])
  teamSize        Int?
  yearsExperience Int?
  servicesOffered String[]    @default([])
  regionsServed   String[]    @default([])
  totalReferrals  Int         @default(0)
  totalEarnings   Decimal     @default(0) @db.Decimal(12, 2)
  pendingEarnings Decimal     @default(0) @db.Decimal(12, 2)
  metadata        Json?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime

  @@index([partnerId])
}

model partner_referral_links_ext {
  id                       String                     @id
  partnerId                String
  code                     String                     @unique
  name                     String?
  destinationUrl           String?
  campaign                 String?
  source                   String?
  medium                   String?
  isActive                 Boolean                    @default(true)
  expiresAt                DateTime?
  clicks                   Int                        @default(0)
  signups                  Int                        @default(0)
  conversions              Int                        @default(0)
  metadata                 Json?
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime
  partner_attributions_ext partner_attributions_ext[]

  @@index([code])
  @@index([isActive])
  @@index([partnerId])
}

model partner_verifications {
  id              String             @id
  partnerId       String             @unique
  documentType    String?
  documentNumber  String?
  documentUrl     String?
  status          VerificationStatus @default(PENDING)
  verifiedAt      DateTime?
  verifiedBy      String?
  rejectedAt      DateTime?
  rejectedBy      String?
  rejectionReason String?
  attempts        Int                @default(0)
  lastAttemptAt   DateTime?
  metadata        Json?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime

  @@index([partnerId])
  @@index([status])
}

model pay_configurations {
  id                     String   @id
  tenantId               String   @unique
  paymentsEnabled        Boolean  @default(true)
  walletsEnabled         Boolean  @default(true)
  refundsEnabled         Boolean  @default(true)
  defaultCurrency        String   @default("NGN")
  supportedCurrencies    Json     @default("[\"NGN\"]")
  cashEnabled            Boolean  @default(true)
  cardEnabled            Boolean  @default(false)
  bankTransferEnabled    Boolean  @default(true)
  mobileMoneyEnabled     Boolean  @default(false)
  ussdEnabled            Boolean  @default(false)
  podEnabled             Boolean  @default(true)
  podMaxAmount           Decimal  @default(500000) @db.Decimal(12, 2)
  podFee                 Decimal  @default(500) @db.Decimal(12, 2)
  podExcludedStates      Json     @default("[\"Borno\", \"Yobe\", \"Adamawa\"]")
  paystackEnabled        Boolean  @default(false)
  paystackPublicKey      String?
  paystackSecretKey      String?
  flutterwaveEnabled     Boolean  @default(false)
  flutterwavePublicKey   String?
  flutterwaveSecretKey   String?
  autoSettlement         Boolean  @default(false)
  settlementSchedule     String   @default("MANUAL")
  settlementThreshold    Decimal  @default(0) @db.Decimal(12, 2)
  vendorPayoutsEnabled   Boolean  @default(false)
  platformCommission     Decimal  @default(0) @db.Decimal(5, 2)
  offlineCashEnabled     Boolean  @default(true)
  partialPaymentsEnabled Boolean  @default(false)
  metadata               Json?
  createdAt              DateTime @default(now())
  updatedAt              DateTime
}

model pay_event_logs {
  id           String   @id
  tenantId     String
  eventType    String
  eventData    Json
  walletId     String?
  paymentId    String?
  refundId     String?
  settlementId String?
  payoutId     String?
  actorId      String?
  actorType    String?
  occurredAt   DateTime @default(now())

  @@index([eventType])
  @@index([occurredAt])
  @@index([paymentId])
  @@index([tenantId])
  @@index([walletId])
}

model pay_payment_intents {
  id               String            @id
  tenantId         String
  intentId         String            @unique
  amount           Decimal           @db.Decimal(12, 2)
  currency         String            @default("NGN")
  orderId          String?
  orderNumber      String?
  customerId       String?
  customerEmail    String?
  customerPhone    String?
  paymentMethod    PayPaymentMethod?
  methodDetails    Json?
  gatewayProvider  String?
  gatewayReference String?
  gatewayResponse  Json?
  status           PayIntentStatus   @default(CREATED)
  expiresAt        DateTime?
  paymentId        String?
  idempotencyKey   String?
  metadata         Json?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime

  @@unique([tenantId, idempotencyKey])
  @@index([customerId])
  @@index([gatewayReference])
  @@index([orderId])
  @@index([status])
  @@index([tenantId])
}

model pay_payment_transactions {
  id                      String                    @id
  tenantId                String
  transactionNumber       String
  intentId                String?
  amount                  Decimal                   @db.Decimal(12, 2)
  currency                String                    @default("NGN")
  gatewayFee              Decimal                   @default(0) @db.Decimal(12, 2)
  platformFee             Decimal                   @default(0) @db.Decimal(12, 2)
  netAmount               Decimal                   @db.Decimal(12, 2)
  orderId                 String?
  orderNumber             String?
  customerId              String?
  customerEmail           String?
  customerPhone           String?
  paymentMethod           PayPaymentMethod
  methodDetails           Json?
  gatewayProvider         String?
  gatewayReference        String?
  gatewayResponse         Json?
  destinationWalletId     String?
  status                  PayPaymentStatus          @default(PENDING)
  statusMessage           String?
  confirmedAt             DateTime?
  failedAt                DateTime?
  idempotencyKey          String?
  processedBy             String?
  isPartialPayment        Boolean                   @default(false)
  partialPaymentOf        String?
  proofAttachmentUrl      String?
  proofUploadedAt         DateTime?
  proofVerifiedAt         DateTime?
  proofVerifiedBy         String?
  metadata                Json?
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  pay_refunds             pay_refunds[]
  pay_settlement_items    pay_settlement_items[]
  pay_wallet_transactions pay_wallet_transactions[]

  @@unique([tenantId, idempotencyKey])
  @@unique([tenantId, transactionNumber])
  @@index([createdAt])
  @@index([customerId])
  @@index([gatewayReference])
  @@index([orderId])
  @@index([status])
  @@index([tenantId])
  @@index([partialPaymentOf])
}

model pay_payout_requests {
  id               String          @id
  tenantId         String
  payoutNumber     String
  walletId         String
  amount           Decimal         @db.Decimal(12, 2)
  currency         String          @default("NGN")
  fee              Decimal         @default(0) @db.Decimal(12, 2)
  netAmount        Decimal         @db.Decimal(12, 2)
  payoutMethod     PayPayoutMethod
  bankName         String?
  bankCode         String?
  accountNumber    String?
  accountName      String?
  status           PayPayoutStatus @default(PENDING)
  gatewayReference String?
  gatewayResponse  Json?
  processedAt      DateTime?
  failedAt         DateTime?
  failureReason    String?
  requestedBy      String?
  approvedBy       String?
  approvedAt       DateTime?
  metadata         Json?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime
  pay_wallets      pay_wallets     @relation(fields: [walletId], references: [id])

  @@unique([tenantId, payoutNumber])
  @@index([status])
  @@index([tenantId])
  @@index([walletId])
}

model pay_refunds {
  id                       String                   @id
  tenantId                 String
  refundNumber             String
  paymentId                String
  amount                   Decimal                  @db.Decimal(12, 2)
  currency                 String                   @default("NGN")
  reason                   PayRefundReason
  notes                    String?
  gatewayReference         String?
  gatewayResponse          Json?
  status                   PayRefundStatus          @default(PENDING)
  refundMethod             PayRefundMethod          @default(ORIGINAL_METHOD)
  processedAt              DateTime?
  failedAt                 DateTime?
  requestedBy              String?
  approvedBy               String?
  metadata                 Json?
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime
  pay_payment_transactions pay_payment_transactions @relation(fields: [paymentId], references: [id])

  @@unique([tenantId, refundNumber])
  @@index([paymentId])
  @@index([status])
  @@index([tenantId])
}

model pay_settlement_items {
  id                       String                   @id
  settlementId             String
  paymentId                String
  grossAmount              Decimal                  @db.Decimal(12, 2)
  commissionAmount         Decimal                  @db.Decimal(12, 2)
  netAmount                Decimal                  @db.Decimal(12, 2)
  createdAt                DateTime                 @default(now())
  pay_payment_transactions pay_payment_transactions @relation(fields: [paymentId], references: [id])
  pay_settlements          pay_settlements          @relation(fields: [settlementId], references: [id], onDelete: Cascade)

  @@index([paymentId])
  @@index([settlementId])
}

model pay_settlements {
  id                   String                 @id
  tenantId             String
  settlementNumber     String
  walletId             String
  periodStart          DateTime
  periodEnd            DateTime
  grossAmount          Decimal                @db.Decimal(12, 2)
  commissionAmount     Decimal                @db.Decimal(12, 2)
  feeAmount            Decimal                @db.Decimal(12, 2)
  refundAmount         Decimal                @db.Decimal(12, 2)
  netAmount            Decimal                @db.Decimal(12, 2)
  itemCount            Int                    @default(0)
  status               PaySettlementStatus    @default(PENDING)
  processedAt          DateTime?
  paidAt               DateTime?
  payoutId             String?
  createdBy            String?
  approvedBy           String?
  approvedAt           DateTime?
  metadata             Json?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  pay_settlement_items pay_settlement_items[]
  pay_wallets          pay_wallets            @relation(fields: [walletId], references: [id])

  @@unique([tenantId, settlementNumber])
  @@index([periodStart, periodEnd])
  @@index([status])
  @@index([tenantId])
  @@index([walletId])
}

model pay_wallet_transactions {
  id                       String                    @id
  tenantId                 String
  walletId                 String
  transactionNumber        String
  type                     PayTransactionType
  direction                PayTransactionDirection
  amount                   Decimal                   @db.Decimal(12, 2)
  currency                 String                    @default("NGN")
  balanceBefore            Decimal                   @db.Decimal(12, 2)
  balanceAfter             Decimal                   @db.Decimal(12, 2)
  referenceType            String?
  referenceId              String?
  paymentId                String?
  settlementId             String?
  payoutId                 String?
  description              String?
  status                   PayTxStatus               @default(COMPLETED)
  performedBy              String?
  performedAt              DateTime                  @default(now())
  metadata                 Json?
  createdAt                DateTime                  @default(now())
  pay_payment_transactions pay_payment_transactions? @relation(fields: [paymentId], references: [id])
  pay_wallets              pay_wallets               @relation(fields: [walletId], references: [id])

  @@unique([tenantId, transactionNumber])
  @@index([createdAt])
  @@index([referenceType, referenceId])
  @@index([tenantId])
  @@index([type])
  @@index([walletId])
}

model pay_wallets {
  id                      String                    @id
  tenantId                String
  ownerType               PayWalletOwnerType
  ownerId                 String?
  walletNumber            String
  name                    String?
  currency                String                    @default("NGN")
  balance                 Decimal                   @default(0) @db.Decimal(12, 2)
  pendingBalance          Decimal                   @default(0) @db.Decimal(12, 2)
  totalBalance            Decimal                   @default(0) @db.Decimal(12, 2)
  dailyLimit              Decimal?                  @db.Decimal(12, 2)
  monthlyLimit            Decimal?                  @db.Decimal(12, 2)
  minBalance              Decimal                   @default(0) @db.Decimal(12, 2)
  status                  PayWalletStatus           @default(ACTIVE)
  suspendedAt             DateTime?
  suspendedReason         String?
  metadata                Json?
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  pay_payout_requests     pay_payout_requests[]
  pay_settlements         pay_settlements[]
  pay_wallet_transactions pay_wallet_transactions[]

  @@unique([tenantId, ownerType, ownerId, currency])
  @@unique([tenantId, walletNumber])
  @@index([ownerType, ownerId])
  @@index([status])
  @@index([tenantId])
}

model proc_configurations {
  id                         String   @id
  tenantId                   String   @unique
  procurementEnabled         Boolean  @default(true)
  purchaseRequestsEnabled    Boolean  @default(true)
  supplierPriceListEnabled   Boolean  @default(true)
  performanceTrackingEnabled Boolean  @default(true)
  requireApprovalForPR       Boolean  @default(true)
  approvalThresholdAmount    Decimal? @db.Decimal(15, 2)
  defaultPaymentTerms        String   @default("NET30")
  defaultCurrency            String   @default("NGN")
  allowInformalSuppliers     Boolean  @default(true)
  allowCashPurchases         Boolean  @default(true)
  requireReceiptPhotos       Boolean  @default(false)
  poNumberPrefix             String   @default("PO")
  poNumberSequence           Int      @default(1)
  autoConfirmPO              Boolean  @default(false)
  notifyOnPRApproval         Boolean  @default(true)
  notifyOnPOConfirmation     Boolean  @default(true)
  notifyOnGoodsReceipt       Boolean  @default(true)
  metadata                   Json?
  createdAt                  DateTime @default(now())
  updatedAt                  DateTime
}

model proc_event_logs {
  id         String   @id
  tenantId   String
  eventType  String
  eventData  Json
  entityType String
  entityId   String
  actorId    String?
  actorType  String?
  occurredAt DateTime @default(now())
  metadata   Json?

  @@index([entityType, entityId])
  @@index([eventType])
  @@index([occurredAt])
  @@index([tenantId])
}

model proc_goods_receipt_items {
  id                  String              @id
  goodsReceiptId      String
  purchaseOrderItemId String
  productId           String
  productSku          String?
  productName         String
  orderedQuantity     Decimal             @db.Decimal(15, 4)
  receivedQuantity    Decimal             @db.Decimal(15, 4)
  acceptedQuantity    Decimal             @default(0) @db.Decimal(15, 4)
  rejectedQuantity    Decimal             @default(0) @db.Decimal(15, 4)
  damagedQuantity     Decimal             @default(0) @db.Decimal(15, 4)
  missingQuantity     Decimal             @default(0) @db.Decimal(15, 4)
  unit                String              @default("UNIT")
  qualityStatus       String?
  qualityNotes        String?
  batchNumber         String?
  expiryDate          DateTime?
  serialNumbers       Json?
  notes               String?
  proc_goods_receipts proc_goods_receipts @relation(fields: [goodsReceiptId], references: [id], onDelete: Cascade)

  @@index([goodsReceiptId])
  @@index([productId])
  @@index([purchaseOrderItemId])
}

model proc_goods_receipts {
  id                       String                     @id
  tenantId                 String
  receiptNumber            String
  purchaseOrderId          String
  status                   ProcGoodsReceiptStatus     @default(PENDING)
  receivedDate             DateTime                   @default(now())
  receivedBy               String
  locationId               String?
  deliveryNote             String?
  invoiceNumber            String?
  invoiceDate              DateTime?
  qualityCheckedBy         String?
  qualityCheckedAt         DateTime?
  qualityNotes             String?
  inventoryEventEmitted    Boolean                    @default(false)
  inventoryEventId         String?
  inventoryEventAt         DateTime?
  photoUrls                Json?
  offlineId                String?
  notes                    String?
  metadata                 Json?
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime
  proc_goods_receipt_items proc_goods_receipt_items[]
  proc_purchase_orders     proc_purchase_orders       @relation(fields: [purchaseOrderId], references: [id])

  @@unique([tenantId, offlineId])
  @@unique([tenantId, receiptNumber])
  @@index([purchaseOrderId])
  @@index([receivedDate])
  @@index([status])
  @@index([tenantId])
}

model proc_purchase_order_items {
  id                   String               @id
  purchaseOrderId      String
  productId            String
  productSku           String?
  productName          String
  orderedQuantity      Decimal              @db.Decimal(15, 4)
  receivedQuantity     Decimal              @default(0) @db.Decimal(15, 4)
  pendingQuantity      Decimal              @db.Decimal(15, 4)
  unit                 String               @default("UNIT")
  unitPrice            Decimal              @db.Decimal(15, 4)
  taxRate              Decimal              @default(0) @db.Decimal(5, 4)
  discount             Decimal              @default(0) @db.Decimal(15, 2)
  lineTotal            Decimal              @db.Decimal(15, 2)
  specifications       String?
  notes                String?
  lineNumber           Int
  isFulfilled          Boolean              @default(false)
  proc_purchase_orders proc_purchase_orders @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([purchaseOrderId])
}

model proc_purchase_orders {
  id                        String                      @id
  tenantId                  String
  poNumber                  String
  status                    ProcPurchaseOrderStatus     @default(DRAFT)
  priority                  ProcPriority                @default(NORMAL)
  supplierId                String
  supplierName              String
  supplierPhone             String?
  purchaseRequestId         String?
  shipToLocationId          String?
  shipToAddress             String?
  orderDate                 DateTime                    @default(now())
  expectedDelivery          DateTime?
  confirmedDelivery         DateTime?
  paymentTerms              String                      @default("NET30")
  currency                  String                      @default("NGN")
  subtotal                  Decimal                     @db.Decimal(15, 2)
  taxAmount                 Decimal                     @default(0) @db.Decimal(15, 2)
  shippingCost              Decimal                     @default(0) @db.Decimal(15, 2)
  discount                  Decimal                     @default(0) @db.Decimal(15, 2)
  totalAmount               Decimal                     @db.Decimal(15, 2)
  createdBy                 String
  confirmedBy               String?
  confirmedAt               DateTime?
  cancelledBy               String?
  cancelledAt               DateTime?
  cancellationReason        String?
  closedAt                  DateTime?
  isCashPurchase            Boolean                     @default(false)
  supplierContactPhone      String?
  offlineId                 String?
  internalNotes             String?
  supplierNotes             String?
  termsAndConditions        String?
  metadata                  Json?
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime
  proc_goods_receipts       proc_goods_receipts[]
  proc_purchase_order_items proc_purchase_order_items[]

  @@unique([tenantId, offlineId])
  @@unique([tenantId, poNumber])
  @@index([orderDate])
  @@index([status])
  @@index([supplierId])
  @@index([tenantId])
}

model proc_purchase_request_items {
  id                     String                 @id
  purchaseRequestId      String
  productId              String
  productSku             String?
  productName            String
  quantity               Decimal                @db.Decimal(15, 4)
  unit                   String                 @default("UNIT")
  estimatedUnitPrice     Decimal?               @db.Decimal(15, 4)
  estimatedTotal         Decimal?               @db.Decimal(15, 2)
  specifications         String?
  notes                  String?
  lineNumber             Int
  proc_purchase_requests proc_purchase_requests @relation(fields: [purchaseRequestId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([purchaseRequestId])
}

model proc_purchase_requests {
  id                          String                        @id
  tenantId                    String
  requestNumber               String
  status                      ProcPurchaseRequestStatus     @default(DRAFT)
  priority                    ProcPriority                  @default(NORMAL)
  requestedBy                 String
  requestedAt                 DateTime                      @default(now())
  department                  String?
  locationId                  String?
  preferredSupplierId         String?
  title                       String
  description                 String?
  justification               String?
  estimatedTotal              Decimal?                      @db.Decimal(15, 2)
  budgetCode                  String?
  neededByDate                DateTime?
  approvedBy                  String?
  approvedAt                  DateTime?
  rejectedBy                  String?
  rejectedAt                  DateTime?
  rejectionReason             String?
  convertedToPOId             String?
  convertedAt                 DateTime?
  offlineId                   String?
  notes                       String?
  metadata                    Json?
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime
  proc_purchase_request_items proc_purchase_request_items[]

  @@unique([tenantId, offlineId])
  @@unique([tenantId, requestNumber])
  @@index([preferredSupplierId])
  @@index([requestedBy])
  @@index([status])
  @@index([tenantId])
}

model proc_supplier_performance {
  id                 String   @id
  tenantId           String
  supplierId         String
  periodStart        DateTime
  periodEnd          DateTime
  totalOrders        Int      @default(0)
  completedOrders    Int      @default(0)
  cancelledOrders    Int      @default(0)
  totalOrderValue    Decimal  @default(0) @db.Decimal(15, 2)
  onTimeDeliveries   Int      @default(0)
  lateDeliveries     Int      @default(0)
  avgDeliveryDays    Decimal? @db.Decimal(5, 2)
  totalItemsReceived Int      @default(0)
  acceptedItems      Int      @default(0)
  rejectedItems      Int      @default(0)
  damagedItems       Int      @default(0)
  qualityScore       Decimal? @db.Decimal(5, 2)
  priceVariance      Decimal? @db.Decimal(5, 2)
  overallScore       Decimal? @db.Decimal(5, 2)
  notes              String?
  calculatedAt       DateTime @default(now())
  createdAt          DateTime @default(now())
  updatedAt          DateTime

  @@unique([tenantId, supplierId, periodStart, periodEnd])
  @@index([periodStart])
  @@index([supplierId])
  @@index([tenantId])
}

model proc_supplier_price_lists {
  id               String    @id
  tenantId         String
  supplierId       String
  productId        String
  unitPrice        Decimal   @db.Decimal(15, 4)
  currency         String    @default("NGN")
  minOrderQuantity Decimal   @default(1) @db.Decimal(15, 4)
  unit             String    @default("UNIT")
  validFrom        DateTime  @default(now())
  validTo          DateTime?
  isActive         Boolean   @default(true)
  leadTimeDays     Int?
  notes            String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime

  @@unique([tenantId, supplierId, productId, validFrom])
  @@index([isActive])
  @@index([productId])
  @@index([supplierId])
  @@index([tenantId])
}

model regulatory_reports {
  id              String   @id
  tenantId        String
  reportType      String
  reportName      String
  periodStart     DateTime
  periodEnd       DateTime
  reportData      Json
  format          String   @default("JSON")
  exportUrl       String?
  status          String   @default("GENERATED")
  referenceNumber String?
  disclaimer      String   @default("NOT FILED - For informational purposes only")
  generatedAt     DateTime @default(now())
  generatedBy     String?
  metadata        Json?
  createdAt       DateTime @default(now())

  @@index([periodStart, periodEnd])
  @@index([reportType])
  @@index([tenantId])
}

model svm_cart_items {
  id             String    @id
  cartId         String
  productId      String
  variantId      String?
  productName    String
  variantName    String?
  sku            String?
  imageUrl       String?
  unitPrice      Decimal   @db.Decimal(12, 2)
  quantity       Int       @default(1)
  lineTotal      Decimal   @db.Decimal(12, 2)
  discountAmount Decimal   @default(0) @db.Decimal(12, 2)
  customizations Json?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime
  svm_carts      svm_carts @relation(fields: [cartId], references: [id], onDelete: Cascade)

  @@unique([cartId, productId, variantId])
  @@index([cartId])
  @@index([productId])
}

model svm_carts {
  id                  String           @id
  tenantId            String
  customerId          String?
  sessionId           String?
  email               String?
  status              SvmCartStatus    @default(ACTIVE)
  expiresAt           DateTime?
  itemCount           Int              @default(0)
  subtotal            Decimal          @default(0) @db.Decimal(12, 2)
  discountTotal       Decimal          @default(0) @db.Decimal(12, 2)
  shippingTotal       Decimal          @default(0) @db.Decimal(12, 2)
  taxTotal            Decimal          @default(0) @db.Decimal(12, 2)
  grandTotal          Decimal          @default(0) @db.Decimal(12, 2)
  promotionCode       String?
  promotionId         String?
  shippingZoneId      String?
  shippingRateId      String?
  shippingMethod      String?
  currency            String           @default("NGN")
  shippingAddress     Json?
  convertedToOrderId  String?
  convertedAt         DateTime?
  recoveryEmailSentAt DateTime?
  createdAt           DateTime         @default(now())
  updatedAt           DateTime
  svm_cart_items      svm_cart_items[]

  @@unique([tenantId, sessionId])
  @@index([customerId])
  @@index([email])
  @@index([sessionId])
  @@index([status])
  @@index([tenantId])
}

model svm_order_items {
  id                String     @id
  orderId           String
  productId         String
  variantId         String?
  productName       String
  variantName       String?
  sku               String?
  imageUrl          String?
  unitPrice         Decimal    @db.Decimal(12, 2)
  quantity          Int
  discountAmount    Decimal    @default(0) @db.Decimal(12, 2)
  taxAmount         Decimal    @default(0) @db.Decimal(12, 2)
  lineTotal         Decimal    @db.Decimal(12, 2)
  fulfilledQuantity Int        @default(0)
  refundedQuantity  Int        @default(0)
  customizations    Json?
  createdAt         DateTime   @default(now())
  svm_orders        svm_orders @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([productId])
}

model svm_orders {
  id                String               @id
  tenantId          String
  orderNumber       String               @unique
  customerId        String?
  customerEmail     String
  customerPhone     String?
  customerName      String?
  status            SvmOrderStatus       @default(PENDING)
  paymentStatus     SvmPaymentStatus     @default(PENDING)
  fulfillmentStatus SvmFulfillmentStatus @default(UNFULFILLED)
  sourceCartId      String?
  channel           String               @default("WEB")
  shippingAddress   Json
  billingAddress    Json?
  shippingMethod    String?
  shippingCarrier   String?
  shippingTotal     Decimal              @db.Decimal(12, 2)
  trackingNumber    String?
  trackingUrl       String?
  shippedAt         DateTime?
  estimatedDelivery DateTime?
  deliveredAt       DateTime?
  currency          String               @default("NGN")
  subtotal          Decimal              @db.Decimal(12, 2)
  discountTotal     Decimal              @default(0) @db.Decimal(12, 2)
  taxTotal          Decimal              @db.Decimal(12, 2)
  grandTotal        Decimal              @db.Decimal(12, 2)
  promotionCode     String?
  promotionId       String?
  paymentMethod     String?
  paymentRef        String?
  paidAt            DateTime?
  refundedAmount    Decimal              @default(0) @db.Decimal(12, 2)
  refundedAt        DateTime?
  refundReason      String?
  customerNotes     String?
  internalNotes     String?
  ipAddress         String?
  userAgent         String?
  createdAt         DateTime             @default(now())
  updatedAt         DateTime
  cancelledAt       DateTime?
  svm_order_items   svm_order_items[]

  @@index([createdAt])
  @@index([customerEmail])
  @@index([customerId])
  @@index([orderNumber])
  @@index([paymentStatus])
  @@index([status])
  @@index([tenantId])
}

model svm_promotion_usages {
  id              String         @id
  promotionId     String
  orderId         String
  customerId      String?
  discountApplied Decimal        @db.Decimal(10, 2)
  createdAt       DateTime       @default(now())
  svm_promotions  svm_promotions @relation(fields: [promotionId], references: [id], onDelete: Cascade)

  @@index([customerId])
  @@index([promotionId])
}

model svm_promotions {
  id                   String                 @id
  tenantId             String
  name                 String
  description          String?
  code                 String?
  type                 SvmPromotionType       @default(COUPON)
  discountType         SvmDiscountType
  discountValue        Decimal                @db.Decimal(10, 2)
  maxDiscount          Decimal?               @db.Decimal(10, 2)
  minOrderTotal        Decimal?               @db.Decimal(10, 2)
  minQuantity          Int?
  productIds           String[]
  categoryIds          String[]
  excludeProductIds    String[]
  customerIds          String[]
  firstOrderOnly       Boolean                @default(false)
  usageLimit           Int?
  usageCount           Int                    @default(0)
  perCustomerLimit     Int?
  buyQuantity          Int?
  getQuantity          Int?
  getDiscountPercent   Int?
  startsAt             DateTime               @default(now())
  endsAt               DateTime?
  isActive             Boolean                @default(true)
  stackable            Boolean                @default(false)
  priority             Int                    @default(0)
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  svm_promotion_usages svm_promotion_usages[]

  @@unique([tenantId, code])
  @@index([code])
  @@index([isActive, startsAt, endsAt])
  @@index([tenantId])
}

model svm_shipping_rates {
  id                  String              @id
  zoneId              String
  name                String
  description         String?
  carrier             String?
  rateType            SvmShippingRateType @default(FLAT)
  flatRate            Decimal?            @db.Decimal(10, 2)
  minWeight           Decimal?            @db.Decimal(10, 2)
  maxWeight           Decimal?            @db.Decimal(10, 2)
  weightRate          Decimal?            @db.Decimal(10, 4)
  baseWeightFee       Decimal?            @db.Decimal(10, 2)
  minOrderTotal       Decimal?            @db.Decimal(10, 2)
  maxOrderTotal       Decimal?            @db.Decimal(10, 2)
  percentageRate      Decimal?            @db.Decimal(5, 4)
  perItemRate         Decimal?            @db.Decimal(10, 2)
  allowedProductIds   String[]
  excludedProductIds  String[]
  allowedCategoryIds  String[]
  excludedCategoryIds String[]
  freeAbove           Decimal?            @db.Decimal(10, 2)
  minDays             Int?
  maxDays             Int?
  isActive            Boolean             @default(true)
  priority            Int                 @default(0)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime
  svm_shipping_zones  svm_shipping_zones  @relation(fields: [zoneId], references: [id], onDelete: Cascade)

  @@index([zoneId])
}

model svm_shipping_zones {
  id                 String               @id
  tenantId           String
  name               String
  description        String?
  countries          String[]
  states             String[]
  postalCodes        String[]
  cities             String[]
  isDefault          Boolean              @default(false)
  isActive           Boolean              @default(true)
  priority           Int                  @default(0)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  svm_shipping_rates svm_shipping_rates[]

  @@index([tenantId])
}

model tax_computation_records {
  id               String    @id
  tenantId         String
  periodStart      DateTime
  periodEnd        DateTime
  periodType       String    @default("MONTHLY")
  totalSales       Decimal   @db.Decimal(14, 2)
  exemptSales      Decimal   @default(0) @db.Decimal(14, 2)
  taxableSales     Decimal   @db.Decimal(14, 2)
  outputVat        Decimal   @db.Decimal(14, 2)
  totalPurchases   Decimal   @default(0) @db.Decimal(14, 2)
  exemptPurchases  Decimal   @default(0) @db.Decimal(14, 2)
  taxablePurchases Decimal   @default(0) @db.Decimal(14, 2)
  inputVat         Decimal   @default(0) @db.Decimal(14, 2)
  netVatPayable    Decimal   @db.Decimal(14, 2)
  status           String    @default("COMPUTED")
  computedAt       DateTime  @default(now())
  computedBy       String?
  verifiedAt       DateTime?
  verifiedBy       String?
  sourceType       String    @default("AUTO")
  metadata         Json?
  createdAt        DateTime  @default(now())

  @@index([periodStart, periodEnd])
  @@index([tenantId])
}

model tax_configurations {
  id                  String              @id
  tenantId            String              @unique
  vatEnabled          Boolean             @default(false)
  vatRate             Decimal             @default(7.5) @db.Decimal(5, 2)
  vatInclusive        Boolean             @default(true)
  isSmallBusiness     Boolean             @default(true)
  annualThreshold     Decimal?            @db.Decimal(14, 2)
  multiStateEnabled   Boolean             @default(false)
  primaryState        String?
  operatingStates     String[]            @default([])
  roundingMode        String              @default("ROUND_HALF_UP")
  decimalPlaces       Int                 @default(2)
  exemptCategories    String[]            @default([])
  exemptProducts      String[]            @default([])
  metadata            Json?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime
  compliance_profiles compliance_profiles @relation(fields: [tenantId], references: [tenantId])
}

model user_intents {
  id           String       @id
  userId       String?
  tenantId     String?
  intentKey    String
  intentDomain IntentDomain @default(COMMERCE)
  intentSource IntentSource @default(DIRECT)
  sourceUrl    String?
  campaignId   String?
  referralCode String?
  metadata     Json?
  isProcessed  Boolean      @default(false)
  processedAt  DateTime?
  capturedAt   DateTime     @default(now())
  expiresAt    DateTime?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime
  User         User?        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([capturedAt])
  @@index([intentDomain])
  @@index([intentKey])
  @@index([tenantId])
  @@index([userId])
}

enum AccessScopeType {
  READ
  WRITE
  ADMIN
}

enum AcctAccountSubType {
  CASH
  BANK
  ACCOUNTS_RECEIVABLE
  INVENTORY
  PREPAID_EXPENSE
  FIXED_ASSET
  OTHER_ASSET
  ACCOUNTS_PAYABLE
  ACCRUED_EXPENSE
  VAT_PAYABLE
  OTHER_TAX_PAYABLE
  SHORT_TERM_DEBT
  LONG_TERM_DEBT
  OTHER_LIABILITY
  OWNER_EQUITY
  RETAINED_EARNINGS
  OWNER_DRAW
  SALES_REVENUE
  SERVICE_REVENUE
  OTHER_INCOME
  COST_OF_GOODS
  OPERATING_EXPENSE
  PAYROLL_EXPENSE
  RENT_EXPENSE
  UTILITIES_EXPENSE
  MARKETING_EXPENSE
  OTHER_EXPENSE
}

enum AcctAccountType {
  ASSET
  LIABILITY
  EQUITY
  REVENUE
  EXPENSE
  CONTRA_ASSET
  CONTRA_LIABILITY
  CONTRA_EQUITY
  CONTRA_REVENUE
  CONTRA_EXPENSE
}

enum AcctExpensePaymentMethod {
  CASH
  BANK_TRANSFER
  MOBILE_MONEY
  CARD
  CREDIT
  OTHER
}

enum AcctExpenseStatus {
  DRAFT
  SUBMITTED
  APPROVED
  REJECTED
  POSTED
}

enum AcctJournalSourceType {
  MANUAL
  POS_SALE
  SVM_ORDER
  MVM_ORDER
  REFUND
  INVENTORY_ADJUSTMENT
  EXPENSE
  WALLET_TRANSACTION
  SYSTEM
}

enum AcctJournalStatus {
  DRAFT
  POSTED
  VOIDED
}

enum AcctPeriodStatus {
  OPEN
  CLOSING
  CLOSED
  LOCKED
}

enum AddOnStatus {
  ACTIVE
  CANCELLED
  EXPIRED
}

enum AddOnType {
  FEATURE
  CAPACITY
  MODULE
  TIME_BOUND
}

enum AddressType {
  SHIPPING
  BILLING
  BOTH
}

enum AdjustmentStatus {
  PENDING
  APPROVED
  APPLIED
  EXPIRED
  CANCELLED
}

enum AdjustmentType {
  CREDIT
  DISCOUNT
  REFUND
  PROMO
  WAIVER
}

enum AgreementStatus {
  DRAFT
  ACTIVE
  SUPERSEDED
  TERMINATED
}

enum ApiKeyStatus {
  ACTIVE
  REVOKED
  EXPIRED
  RATE_LIMITED
}

enum AttributionMethod {
  PARTNER_CREATED
  REFERRAL_LINK
  MANUAL_ASSIGNMENT
}

enum AttributionStatus {
  ATTRIBUTED
  CONVERTED
  CHURNED
  EXPIRED
}

enum AuditAction {
  TENANT_CREATED
  TENANT_UPDATED
  TENANT_SUSPENDED
  TENANT_ACTIVATED
  TENANT_DEACTIVATED
  DOMAIN_ADDED
  DOMAIN_REMOVED
  DOMAIN_VERIFIED
  USER_INVITED
  USER_REMOVED
  USER_ROLE_CHANGED
  USER_LOGIN
  USER_LOGOUT
  SUPER_ADMIN_IMPERSONATION_START
  SUPER_ADMIN_IMPERSONATION_END
  PARTNER_CREATED
  PARTNER_UPDATED
  PARTNER_APPROVED
  PARTNER_SUSPENDED
  PARTNER_TERMINATED
  PARTNER_USER_ADDED
  PARTNER_USER_REMOVED
  PARTNER_AGREEMENT_CREATED
  PARTNER_AGREEMENT_SIGNED
  PARTNER_AGREEMENT_APPROVED
  PARTNER_REFERRAL_CREATED
  PARTNER_REFERRAL_LOCKED
  PARTNER_EARNING_CREATED
  PARTNER_EARNING_APPROVED
  PARTNER_EARNING_PAID
  ATTRIBUTION_CREATED
  ATTRIBUTION_LOCKED
  ATTRIBUTION_LOCK_ATTEMPTED
  ATTRIBUTION_REASSIGN_BLOCKED
  PARTNER_TENANT_CREATED
  PARTNER_TENANT_ACTIVATED
  SUBSCRIPTION_CREATED
  SUBSCRIPTION_ACTIVATED
  SUBSCRIPTION_RENEWED
  SUBSCRIPTION_CANCELLED
  SUBSCRIPTION_PAUSED
  SUBSCRIPTION_RESUMED
  SUBSCRIPTION_UPGRADED
  SUBSCRIPTION_DOWNGRADED
  SUBSCRIPTION_EXPIRED
  ENTITLEMENT_GRANTED
  ENTITLEMENT_REVOKED
  ENTITLEMENT_EXPIRED
  INVOICE_CREATED
  INVOICE_PAID
  INVOICE_VOIDED
  COMMISSION_CALCULATED
  EARNING_CREATED
  EARNING_CLEARED
  EARNING_APPROVED
  EARNING_PAID
  EARNING_DISPUTED
  EARNING_REVERSED
  EARNING_VOIDED
  PAYOUT_BATCH_CREATED
  PAYOUT_BATCH_APPROVED
  PAYOUT_BATCH_PROCESSED
  PAYOUT_BATCH_FAILED
  PAYOUT_BATCH_CANCELLED
  PAYOUT_READINESS_CHECKED
  PAYOUT_HOLD_APPLIED
  PAYOUT_HOLD_RELEASED
  PAYOUT_SETTINGS_UPDATED
  TAX_DOCUMENT_SUBMITTED
  TAX_DOCUMENT_VERIFIED
  SUBSCRIPTION_UPDATED
  SUBSCRIPTION_GRACE_PERIOD_STARTED
  SUBSCRIPTION_SUSPENDED
}

enum B2BBulkOrderStatus {
  DRAFT
  SUBMITTED
  APPROVED
  REJECTED
  CONVERTED
  CANCELLED
  EXPIRED
}

enum B2BCreditStatus {
  ACTIVE
  SUSPENDED
  EXCEEDED
  BLOCKED
}

enum B2BCreditTransactionType {
  CREDIT_GRANTED
  CREDIT_REDUCED
  PURCHASE
  PAYMENT
  REFUND
  ADJUSTMENT
  LATE_FEE
  WRITE_OFF
}

enum B2BCustomerType {
  RETAILER
  DISTRIBUTOR
  WHOLESALER
  AGENT
  RESELLER
  OTHER
}

enum B2BDiscountType {
  PERCENTAGE
  FIXED_AMOUNT
  TIERED_QUANTITY
}

enum B2BInvoiceStatus {
  DRAFT
  SENT
  VIEWED
  PARTIAL
  PAID
  OVERDUE
  CANCELLED
  DISPUTED
}

enum B2BLateFeeType {
  NONE
  FIXED
  PERCENTAGE_DAILY
  PERCENTAGE_TOTAL
}

enum B2BPriceType {
  FIXED_PRICE
  DISCOUNT_PERCENTAGE
  DISCOUNT_AMOUNT
  TIERED_PRICE
}

enum B2BProfileStatus {
  PENDING
  ACTIVE
  SUSPENDED
  INACTIVE
}

enum BillingInterval {
  MONTHLY
  QUARTERLY
  YEARLY
}

enum CapabilityActivator {
  SELF
  ADMIN
  SYSTEM
}

enum CapabilityStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum CommerceWalletStatus {
  ACTIVE
  FROZEN
  SUSPENDED
  CLOSED
}

enum CommerceWalletType {
  CUSTOMER
  VENDOR
  PLATFORM
}

enum CommissionEventType {
  SUBSCRIPTION_CREATED
  SUBSCRIPTION_RENEWED
  SUBSCRIPTION_UPGRADED
  ONE_TIME_PURCHASE
}

enum CommissionStatusExt {
  PENDING
  EARNED
  READY_FOR_PAYOUT
  PAID
  CANCELLED
}

enum CommissionTrigger {
  ON_PAYMENT
  ON_ACTIVATION
  ON_RENEWAL
  ON_SIGNUP
}

enum CommissionType {
  PERCENTAGE
  FIXED
  TIERED
  HYBRID
}

enum CommissionTypeExt {
  PERCENTAGE
  FIXED
  TIERED
}

enum ComplianceMaturityLevel {
  INFORMAL
  EMERGING
  COMPLIANT
  ADVANCED
}

enum CrmCampaignChannel {
  SMS
  EMAIL
  PUSH
  WHATSAPP
  IN_APP
}

enum CrmCampaignStatus {
  DRAFT
  SCHEDULED
  ACTIVE
  PAUSED
  COMPLETED
  CANCELLED
}

enum CrmCampaignType {
  PROMOTIONAL
  LOYALTY
  ENGAGEMENT
  ANNOUNCEMENT
  BIRTHDAY
  WINBACK
}

enum CrmEngagementType {
  PURCHASE
  VISIT
  CART_ABANDON
  WISHLIST_ADD
  REVIEW_SUBMIT
  REFERRAL
  CAMPAIGN_RESPONSE
  LOYALTY_REDEEM
  SUPPORT_CONTACT
}

enum CrmLoyaltyTier {
  BRONZE
  SILVER
  GOLD
  PLATINUM
  DIAMOND
}

enum CrmLoyaltyTransactionType {
  EARN
  REDEEM
  BONUS
  ADJUSTMENT
  EXPIRY
  TRANSFER_IN
  TRANSFER_OUT
}

enum CrmSegmentStatus {
  ACTIVE
  PAUSED
  ARCHIVED
}

enum CrmSegmentType {
  DYNAMIC
  STATIC
  COMBINED
}

enum CustomerStatus {
  ACTIVE
  INACTIVE
  BLOCKED
}

enum DiscountType {
  PERCENTAGE
  FIXED_AMOUNT
  FREE_MONTHS
}

enum DomainStatus {
  PENDING
  VERIFIED
  FAILED
}

enum DomainType {
  SUBDOMAIN
  CUSTOM
}

enum EarningEntryType {
  CREDIT
  DEBIT
  ADJUSTMENT
}

enum EarningStatus {
  PENDING
  CLEARED
  APPROVED
  PAID
  DISPUTED
  REVERSED
  VOIDED
}

enum EntitlementStatus {
  ACTIVE
  SUSPENDED
  EXPIRED
}

enum GlobalRole {
  SUPER_ADMIN
  USER
}

enum HrAttendanceStatus {
  PRESENT
  ABSENT
  LATE
  HALF_DAY
  LEAVE
  HOLIDAY
  REST_DAY
}

enum HrClockMethod {
  MANUAL
  SELF_SERVICE
  BIOMETRIC
  LOCATION
  QR_CODE
}

enum HrContractStatus {
  DRAFT
  ACTIVE
  EXPIRED
  TERMINATED
  RENEWED
}

enum HrEmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
  CASUAL
  INTERN
  APPRENTICE
}

enum HrLeaveStatus {
  DRAFT
  PENDING
  APPROVED
  REJECTED
  CANCELLED
  COMPLETED
}

enum HrLeaveType {
  ANNUAL
  SICK
  CASUAL
  MATERNITY
  PATERNITY
  COMPASSIONATE
  UNPAID
  STUDY
}

enum HrPayFrequency {
  DAILY
  WEEKLY
  BI_WEEKLY
  MONTHLY
}

enum HrPaymentMethod {
  CASH
  BANK_TRANSFER
  MOBILE_MONEY
  CHECK
}

enum HrPayrollCalculationStatus {
  PENDING
  CALCULATED
  APPROVED
  FINALIZED
}

enum HrPayrollPeriodStatus {
  DRAFT
  OPEN
  PROCESSING
  FINALIZED
  PAID
  CLOSED
}

enum HrScheduleType {
  FIXED
  ROTATING
  FLEXIBLE
  ON_CALL
}

enum InstanceSubscriptionStatus {
  TRIAL
  ACTIVE
  PAST_DUE
  SUSPENDED
  CANCELLED
}

enum IntegrationCategory {
  PAYMENT_GATEWAY
  BANKING
  LOGISTICS
  SMS_GATEWAY
  WHATSAPP
  EMAIL
  ACCOUNTING
  ERP
  CRM
  MARKETPLACE
  CUSTOM
}

enum IntegrationInstanceStatus {
  PENDING_SETUP
  ACTIVE
  SUSPENDED
  REVOKED
  FAILED
}

enum IntegrationProviderStatus {
  ACTIVE
  DEPRECATED
  DISABLED
  BETA
}

enum IntentDomain {
  COMMERCE
  EDUCATION
  HEALTHCARE
  HOSPITALITY
  SERVICES
  LOGISTICS
  GENERAL
}

enum IntentSource {
  MARKETING_PAGE
  PARTNER_LINK
  DIRECT
  APP_STORE
  CAMPAIGN
}

enum InventoryAuditStatus {
  DRAFT
  IN_PROGRESS
  PENDING_REVIEW
  APPROVED
  ADJUSTMENTS_PENDING
  COMPLETED
  CANCELLED
}

enum LedgerEntryStatus {
  PENDING
  COMPLETED
  FAILED
  REVERSED
}

enum LedgerEntryType {
  CREDIT_ORDER_PAYMENT
  CREDIT_REFUND
  CREDIT_SALE_PROCEEDS
  CREDIT_PLATFORM_FEE
  CREDIT_ADJUSTMENT
  CREDIT_TRANSFER_IN
  CREDIT_PAYOUT_REVERSAL
  DEBIT_ORDER_PAYMENT
  DEBIT_VENDOR_COMMISSION
  DEBIT_PLATFORM_FEE
  DEBIT_PAYOUT
  DEBIT_ADJUSTMENT
  DEBIT_TRANSFER_OUT
  DEBIT_CHARGEBACK
  HOLD_CREATED
  HOLD_RELEASED
  HOLD_CAPTURED
}

enum LocationStatus {
  ACTIVE
  INACTIVE
  CLOSED
}

enum LogisticsAgentAvailability {
  AVAILABLE
  BUSY
  OFFLINE
  ON_DELIVERY
}

enum LogisticsAgentStatus {
  ACTIVE
  INACTIVE
  ON_LEAVE
  SUSPENDED
  TERMINATED
}

enum LogisticsAgentType {
  IN_HOUSE
  FREELANCE
  THIRD_PARTY
}

enum LogisticsDeliveryPriority {
  STANDARD
  EXPRESS
  SAME_DAY
  NEXT_DAY
}

enum LogisticsDeliveryStatus {
  PENDING
  ASSIGNED
  ACCEPTED
  PICKING_UP
  PICKED_UP
  IN_TRANSIT
  ARRIVING
  DELIVERED
  FAILED
  RETURNED
  CANCELLED
}

enum LogisticsPricingType {
  FLAT_RATE
  DISTANCE_BASED
  WEIGHT_BASED
  ORDER_VALUE
  TIERED
}

enum LogisticsProofType {
  PHOTO
  SIGNATURE
  PIN_CODE
  OTP
  RECIPIENT_NAME
  NOTES
}

enum LogisticsZoneStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum LogisticsZoneType {
  CITY
  LGA
  STATE
  DISTANCE
  CUSTOM
}

enum MktActionType {
  SEND_MESSAGE
  APPLY_TAG
  AWARD_POINTS
  INTERNAL_NOTIFY
  WAIT
}

enum MktAutomationStatus {
  DRAFT
  ACTIVE
  PAUSED
  COMPLETED
  ARCHIVED
}

enum MktRunStatus {
  PENDING
  RUNNING
  COMPLETED
  FAILED
  SKIPPED
  CANCELLED
}

enum MktTriggerType {
  EVENT
  TIME
  CONDITION
  MANUAL
}

enum NotificationChannel {
  IN_APP
  EMAIL
  SMS
  PUSH
}

enum NotificationStatus {
  PENDING
  SENT
  DELIVERED
  FAILED
  READ
}

enum OtpChannel {
  SMS
  VOICE
  EMAIL
  WHATSAPP
}

enum OtpPurpose {
  LOGIN
  SIGNUP
  PASSWORD_RESET
  PHONE_VERIFY
  EMAIL_VERIFY
}

enum OtpStatus {
  PENDING
  VERIFIED
  EXPIRED
  FAILED
}

enum PartnerRole {
  PARTNER_OWNER
  PARTNER_STAFF
  PARTNER_ADMIN
  PARTNER_SALES
  PARTNER_SUPPORT
}

enum PartnerStatus {
  PENDING
  ACTIVE
  SUSPENDED
  TERMINATED
}

enum PartnerTier {
  BRONZE
  SILVER
  GOLD
  PLATINUM
}

enum PartnerType {
  INDIVIDUAL
  COMPANY
  CONSULTANT
  AGENCY
  RESELLER
}

enum PayIntentStatus {
  CREATED
  PROCESSING
  REQUIRES_ACTION
  SUCCEEDED
  FAILED
  CANCELLED
  EXPIRED
}

enum PayPaymentMethod {
  CASH
  CARD
  BANK_TRANSFER
  MOBILE_MONEY
  WALLET
  POS_TERMINAL
  USSD
  PAY_ON_DELIVERY
}

enum PayPaymentStatus {
  PENDING
  PROCESSING
  CONFIRMED
  FAILED
  CANCELLED
  REFUNDED
  PARTIALLY_REFUNDED
}

enum PayPayoutMethod {
  BANK_TRANSFER
  MOBILE_MONEY
  CASH
}

enum PayPayoutStatus {
  PENDING
  APPROVED
  PROCESSING
  COMPLETED
  FAILED
  REJECTED
}

enum PayRefundMethod {
  ORIGINAL_METHOD
  WALLET
  BANK_TRANSFER
  CASH
}

enum PayRefundReason {
  CUSTOMER_REQUEST
  ORDER_CANCELLED
  DUPLICATE_PAYMENT
  FRAUD
  OTHER
}

enum PayRefundStatus {
  PENDING
  APPROVED
  PROCESSING
  COMPLETED
  FAILED
  REJECTED
}

enum PaySettlementStatus {
  PENDING
  CALCULATED
  APPROVED
  PROCESSING
  PAID
  FAILED
}

enum PayTransactionDirection {
  CREDIT
  DEBIT
}

enum PayTransactionType {
  DEPOSIT
  WITHDRAWAL
  PAYMENT_RECEIVED
  PAYMENT_MADE
  REFUND_RECEIVED
  REFUND_MADE
  SETTLEMENT
  PAYOUT
  COMMISSION
  FEE
  ADJUSTMENT
  TRANSFER_IN
  TRANSFER_OUT
}

enum PayTxStatus {
  PENDING
  COMPLETED
  FAILED
  REVERSED
}

enum PayWalletOwnerType {
  BUSINESS
  VENDOR
  CUSTOMER
  PLATFORM
}

enum PayWalletStatus {
  ACTIVE
  SUSPENDED
  FROZEN
  CLOSED
}

enum PayoutStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

enum PricingRuleScope {
  ALL_PRODUCTS
  CATEGORY
  PRODUCT
  VARIANT
  CUSTOMER_GROUP
}

enum PricingRuleType {
  PERCENTAGE_DISCOUNT
  FIXED_DISCOUNT
  PERCENTAGE_MARKUP
  FIXED_MARKUP
  FIXED_PRICE
}

enum ProcGoodsReceiptStatus {
  PENDING
  VERIFIED
  REJECTED
  ACCEPTED
}

enum ProcPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum ProcPurchaseOrderStatus {
  DRAFT
  PENDING
  CONFIRMED
  PARTIALLY_RECEIVED
  RECEIVED
  CANCELLED
  CLOSED
}

enum ProcPurchaseRequestStatus {
  DRAFT
  SUBMITTED
  APPROVED
  REJECTED
  CANCELLED
  CONVERTED
}

enum ProductStatus {
  DRAFT
  ACTIVE
  ARCHIVED
}

enum ProductType {
  PHYSICAL
  DIGITAL
  SERVICE
  BUNDLE
}

enum ReorderSuggestionStatus {
  PENDING
  APPROVED
  REJECTED
  CONVERTED
  EXPIRED
}

enum ReorderTriggerType {
  BELOW_THRESHOLD
  VELOCITY_BASED
  SCHEDULED
  MANUAL
}

enum SignupStep {
  IDENTITY
  OTP_SENT
  OTP_VERIFIED
  USER_INTENT
  BUSINESS_BASICS
  DISCOVERY
  COMPLETED
  ABANDONED
}

enum StaffStatus {
  ACTIVE
  INACTIVE
  TERMINATED
}

enum StockMovementReason {
  PURCHASE_ORDER
  SALE
  RETURN_FROM_CUSTOMER
  RETURN_TO_SUPPLIER
  TRANSFER_IN
  TRANSFER_OUT
  ADJUSTMENT_POSITIVE
  ADJUSTMENT_NEGATIVE
  AUDIT_CORRECTION
  INITIAL_STOCK
  EXPIRED
  DAMAGED
  THEFT
  WRITE_OFF
}

enum StockTransferStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  IN_TRANSIT
  PARTIALLY_RECEIVED
  COMPLETED
  CANCELLED
  REJECTED
}

enum SubscriptionEventType {
  SUBSCRIPTION_CREATED
  SUBSCRIPTION_ACTIVATED
  SUBSCRIPTION_RENEWED
  SUBSCRIPTION_CANCELLED
  SUBSCRIPTION_PAUSED
  SUBSCRIPTION_RESUMED
  SUBSCRIPTION_UPGRADED
  SUBSCRIPTION_DOWNGRADED
  SUBSCRIPTION_EXPIRED
  PAYMENT_SUCCEEDED
  PAYMENT_FAILED
  TRIAL_STARTED
  TRIAL_ENDED
  SUBSCRIPTION_SUSPENDED
  SUBSCRIPTION_GRACE_PERIOD_STARTED
  SUBSCRIPTION_RECOVERED
}

enum SubscriptionStatus {
  PENDING
  TRIALING
  ACTIVE
  PAST_DUE
  CANCELLED
  EXPIRED
  PAUSED
  GRACE_PERIOD
  SUSPENDED
}

enum SupplierStatus {
  ACTIVE
  INACTIVE
}

enum SvmCartStatus {
  ACTIVE
  CONVERTED
  ABANDONED
  EXPIRED
}

enum SvmDiscountType {
  PERCENTAGE
  FIXED_AMOUNT
  FIXED_PER_ITEM
  FREE_SHIPPING
  BUY_X_GET_Y
}

enum SvmFulfillmentStatus {
  UNFULFILLED
  PARTIALLY_FULFILLED
  FULFILLED
  CANCELLED
}

enum SvmOrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
  PARTIALLY_REFUNDED
}

enum SvmPaymentStatus {
  PENDING
  AUTHORIZED
  CAPTURED
  FAILED
  REFUNDED
  PARTIALLY_REFUNDED
}

enum SvmPromotionType {
  COUPON
  AUTOMATIC
  FLASH_SALE
}

enum SvmShippingRateType {
  FLAT
  WEIGHT_BASED
  PRICE_BASED
  ITEM_BASED
}

enum TenantRole {
  TENANT_ADMIN
  TENANT_USER
}

enum TenantStatus {
  ACTIVE
  SUSPENDED
  DEACTIVATED
  PENDING_ACTIVATION
}

// Payment Transaction Types (Phase E1.2)
enum PaymentTransactionType {
  PAYMENT           // Standard payment
  REFUND            // Refund (future use)
  AUTHORIZATION     // Pre-authorization (future use)
  CAPTURE           // Capture of pre-auth (future use)
}

// Payment Transaction Status (Phase E1.2)
enum PaymentTransactionStatus {
  PENDING           // Transaction initiated, awaiting customer action
  PROCESSING        // Payment in progress with provider
  SUCCESS           // Payment completed successfully
  FAILED            // Payment failed
  ABANDONED         // Customer abandoned payment flow
  EXPIRED           // Transaction expired before completion
  CANCELLED         // Transaction cancelled
}

enum UsageAggregationType {
  SUM
  MAX
  AVG
  COUNT
}

enum VerificationStatus {
  PENDING
  IN_REVIEW
  VERIFIED
  REJECTED
  EXPIRED
}

enum WalletStatus {
  ACTIVE
  FROZEN
  EXPIRED
}

enum WalletTransactionType {
  CREDIT
  DEBIT
  ADJUSTMENT
  EXPIRY
}

enum WalletType {
  STORE_CREDIT
  GIFT_CARD
  LOYALTY_POINTS
  PREPAID
}

enum WebhookDirection {
  INBOUND
  OUTBOUND
}

enum WebhookStatus {
  ACTIVE
  PAUSED
  DISABLED
}

// ============================================================================
// PHASE 5: SITES & FUNNELS MODULE
// Partner-built websites and marketing funnels
// ============================================================================

// Site Status
enum SiteStatus {
  DRAFT
  PUBLISHED
  UNPUBLISHED
  ARCHIVED
}

// Funnel Status
enum FunnelStatus {
  DRAFT
  ACTIVE
  PAUSED
  COMPLETED
  ARCHIVED
}

// Page Type
enum PageType {
  LANDING
  CONTENT
  CONTACT
  FUNNEL_STEP
  THANK_YOU
  CHECKOUT
  CUSTOM
}

// Template Category
model sf_template_categories {
  id          String   @id @default(uuid())
  name        String
  slug        String   @unique
  description String?
  industry    String? // e.g., "retail", "healthcare", "education"
  icon        String?
  sortOrder   Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  templates sf_templates[]

  @@index([industry])
  @@index([isActive])
}

// Template (Read-only, cloneable)
model sf_templates {
  id              String  @id @default(uuid())
  categoryId      String
  name            String
  slug            String  @unique
  description     String?
  previewImageUrl String?
  thumbnailUrl    String?

  // Template metadata
  industry String? // Target industry
  useCase  String? // e.g., "lead_generation", "product_showcase"
  pageType PageType @default(LANDING)

  // Template content (JSON)
  blocks   Json  @default("[]") // Page blocks/sections
  styles   Json? // Custom styles
  settings Json? // Template settings

  // Versioning
  version  String  @default("1.0.0")
  isLatest Boolean @default(true)

  // Status
  isActive  Boolean @default(true)
  isPremium Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  category sf_template_categories @relation(fields: [categoryId], references: [id])

  @@index([categoryId])
  @@index([industry])
  @@index([useCase])
  @@index([pageType])
  @@index([isActive])
}

// Site (Partner-owned)
model sf_sites {
  id                 String  @id @default(uuid())
  tenantId           String
  platformInstanceId String?
  partnerId          String

  // Site details
  name        String
  slug        String
  description String?

  // Status
  status        SiteStatus @default(DRAFT)
  publishedAt   DateTime?
  unpublishedAt DateTime?

  // Branding (inherits from Instance if not set)
  logoUrl        String?
  faviconUrl     String?
  primaryColor   String?
  secondaryColor String?
  fontFamily     String?

  // SEO
  metaTitle       String?
  metaDescription String?
  metaKeywords    String[] @default([])
  ogImageUrl      String?

  // Settings
  settings   Json?
  customCss  String? // Limited custom CSS
  headerCode String? // Analytics/tracking scripts
  footerCode String?

  // Analytics
  viewCount Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String
  updatedBy String?

  pages           sf_pages[]
  domainMappings  sf_domain_mappings[]
  analyticsEvents sf_analytics_events[]

  @@unique([tenantId, slug])
  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([partnerId])
  @@index([status])
}

// Funnel (Partner-owned)
model sf_funnels {
  id                 String  @id @default(uuid())
  tenantId           String
  platformInstanceId String?
  partnerId          String
  siteId             String? // Optional: can be standalone or part of a site

  // Funnel details
  name        String
  slug        String
  description String?

  // Status
  status FunnelStatus @default(DRAFT)

  // Conversion goal
  goalType  String? // e.g., "lead", "booking", "purchase", "signup"
  goalValue Decimal? @db.Decimal(10, 2)

  // Settings
  settings Json?

  // Analytics
  totalVisitors    Int      @default(0)
  totalConversions Int      @default(0)
  conversionRate   Decimal? @db.Decimal(5, 2)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String
  updatedBy String?

  pages           sf_pages[]
  analyticsEvents sf_analytics_events[]

  @@unique([tenantId, slug])
  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([partnerId])
  @@index([siteId])
  @@index([status])
}

// Page (Content + Layout)
model sf_pages {
  id       String  @id @default(uuid())
  tenantId String
  siteId   String?
  funnelId String?

  // Page details
  name     String
  slug     String
  pageType PageType @default(CONTENT)

  // Funnel positioning
  funnelOrder Int? // Order in funnel (1, 2, 3...)

  // Content (JSON blocks)
  blocks Json @default("[]")

  // SEO
  metaTitle       String?
  metaDescription String?
  ogImageUrl      String?

  // Status
  isPublished Boolean   @default(false)
  publishedAt DateTime?

  // Settings
  settings  Json?
  customCss String?

  // Analytics
  viewCount Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String
  updatedBy String?

  site       sf_sites?        @relation(fields: [siteId], references: [id], onDelete: Cascade)
  funnel     sf_funnels?      @relation(fields: [funnelId], references: [id], onDelete: Cascade)
  pageBlocks sf_page_blocks[]

  @@unique([siteId, slug])
  @@unique([funnelId, slug])
  @@index([tenantId])
  @@index([siteId])
  @@index([funnelId])
  @@index([pageType])
}

// Page Block (Individual content sections)
model sf_page_blocks {
  id     String @id @default(uuid())
  pageId String

  // Block details
  blockType String // e.g., "hero", "features", "testimonials", "cta", "form"
  name      String?

  // Content (JSON)
  content  Json  @default("{}")
  styles   Json?
  settings Json?

  // Positioning
  sortOrder Int @default(0)

  // Visibility
  isVisible Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  page sf_pages @relation(fields: [pageId], references: [id], onDelete: Cascade)

  @@index([pageId])
  @@index([blockType])
}

// Domain Mapping
model sf_domain_mappings {
  id     String @id @default(uuid())
  siteId String

  // Domain details
  domain    String  @unique
  subdomain String?

  // Type
  domainType String @default("custom") // "custom", "partner", "instance"

  // SSL
  sslStatus    String    @default("pending") // "pending", "active", "failed"
  sslExpiresAt DateTime?

  // Status
  isActive   Boolean   @default(true)
  isPrimary  Boolean   @default(false)
  verifiedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  site sf_sites @relation(fields: [siteId], references: [id], onDelete: Cascade)

  @@index([siteId])
  @@index([domain])
  @@index([isActive])
}

// AI Content Logs (Audit trail for AI usage)
model sf_ai_content_logs {
  id                 String  @id @default(uuid())
  tenantId           String
  platformInstanceId String?
  partnerId          String

  // Request details
  promptType String // e.g., "headline", "body", "cta", "seo"
  prompt     String @db.Text

  // Response
  generatedContent String @db.Text

  // Approval
  status     String    @default("pending") // "pending", "approved", "rejected", "edited"
  approvedBy String?
  approvedAt DateTime?

  // Usage tracking
  tokensUsed Int?
  model      String? // AI model used

  // Context
  siteId   String?
  funnelId String?
  pageId   String?

  createdAt DateTime @default(now())
  createdBy String

  @@index([tenantId])
  @@index([partnerId])
  @@index([status])
  @@index([createdAt])
}

// Analytics Events
model sf_analytics_events {
  id                 String  @id @default(uuid())
  tenantId           String
  platformInstanceId String?

  // Event details
  eventType String // "page_view", "funnel_start", "funnel_step", "conversion", "form_submit"
  eventData Json?

  // Context
  siteId   String?
  funnelId String?
  pageId   String?

  // Visitor info (anonymized)
  visitorId String? // Anonymous visitor tracking
  sessionId String?

  // Source
  referrer    String?
  utmSource   String?
  utmMedium   String?
  utmCampaign String?

  // Device info
  deviceType String? // "desktop", "mobile", "tablet"
  browser    String?
  country    String?

  createdAt DateTime @default(now())

  site   sf_sites?   @relation(fields: [siteId], references: [id], onDelete: SetNull)
  funnel sf_funnels? @relation(fields: [funnelId], references: [id], onDelete: SetNull)

  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([eventType])
  @@index([siteId])
  @@index([funnelId])
  @@index([createdAt])
  @@index([visitorId])
}

// ============================================================================
// REAL ESTATE MANAGEMENT  PHASE 7A
// Added: January 6, 2026
// Status: APPROVED (Additive-only, no breaking changes)
// ============================================================================

// Property Types Enum
enum re_PropertyType {
  RESIDENTIAL
  COMMERCIAL
  MIXED
  LAND
}

enum re_PropertyStatus {
  AVAILABLE
  OCCUPIED
  MAINTENANCE
  UNLISTED
}

enum re_UnitType {
  FLAT
  ROOM
  SHOP
  OFFICE
  WAREHOUSE
  PARKING
}

enum re_UnitStatus {
  VACANT
  OCCUPIED
  RESERVED
  MAINTENANCE
}

enum re_LeaseStatus {
  DRAFT
  ACTIVE
  EXPIRED
  TERMINATED
  RENEWED
}

enum re_RentFrequency {
  MONTHLY
  QUARTERLY
  BIANNUALLY
  ANNUALLY
}

enum re_RentPaymentStatus {
  PENDING
  PAID
  PARTIAL
  OVERDUE
  WAIVED
}

enum re_MaintenanceCategory {
  PLUMBING
  ELECTRICAL
  STRUCTURAL
  HVAC
  CLEANING
  SECURITY
  OTHER
}

enum re_MaintenancePriority {
  LOW
  MEDIUM
  HIGH
  EMERGENCY
}

enum re_MaintenanceStatus {
  OPEN
  ASSIGNED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

// Property Model
model re_property {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Basic Info
  name         String
  propertyType re_PropertyType
  status       re_PropertyStatus @default(AVAILABLE)

  // Address (Nigerian format)
  address  String
  city     String
  state    String
  lga      String? // Local Government Area
  landmark String? // Nigerian convention

  // Details
  description String?
  yearBuilt   Int?
  totalUnits  Int     @default(1)
  amenities   Json? // Flexible metadata

  // Media
  photos    String[] @default([])
  documents String[] @default([])

  // Owner (linked to CRM Contact)
  ownerId    String?
  ownerName  String?
  ownerPhone String?
  ownerEmail String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?

  // Relations
  units               re_unit[]
  maintenanceRequests re_maintenance_request[]

  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([status])
  @@index([propertyType])
  @@index([state])
}

// Unit Model
model re_unit {
  id         String @id @default(cuid())
  tenantId   String
  propertyId String

  // Basic Info
  unitNumber String // e.g., "Flat 5", "Shop A3"
  unitType   re_UnitType
  status     re_UnitStatus @default(VACANT)

  // Specifications
  bedrooms  Int?
  bathrooms Int?
  sizeSqm   Float?
  floor     Int?

  // Pricing (NGN)
  monthlyRent    Float
  serviceCharge  Float @default(0)
  cautionDeposit Float @default(0)

  // Features
  features String[] @default([])
  photos   String[] @default([])

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  property re_property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  leases   re_lease[]

  @@unique([propertyId, unitNumber])
  @@index([tenantId])
  @@index([status])
  @@index([propertyId])
  @@index([unitType])
}

// Lease Model
model re_lease {
  id       String @id @default(cuid())
  tenantId String
  unitId   String

  // Lease Number
  leaseNumber String @unique

  // Tenant Info (linked to CRM Contact)
  tenantContactId String?
  tenantName      String
  tenantPhone     String
  tenantEmail     String?

  // Lease Terms
  startDate DateTime
  endDate   DateTime
  status    re_LeaseStatus @default(DRAFT)

  // Financial Terms (NGN)
  monthlyRent     Float
  serviceCharge   Float   @default(0)
  securityDeposit Float   @default(0)
  depositPaid     Boolean @default(false)

  // Terms
  rentFrequency    re_RentFrequency @default(ANNUALLY)
  noticePeriodDays Int              @default(30)

  // Documents
  documents String[] @default([])
  notes     String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?

  // Relations
  unit          re_unit            @relation(fields: [unitId], references: [id])
  rentSchedules re_rent_schedule[]

  @@index([tenantId])
  @@index([unitId])
  @@index([status])
  @@index([tenantContactId])
  @@index([startDate])
  @@index([endDate])
}

// Rent Schedule Model
model re_rent_schedule {
  id       String @id @default(cuid())
  tenantId String
  leaseId  String

  // Schedule Details
  dueDate     DateTime
  amount      Float // NGN
  description String? // e.g., "January 2026 Rent"

  // Payment Status
  status     re_RentPaymentStatus @default(PENDING)
  paidAmount Float                @default(0)
  paidDate   DateTime?

  // Late Fees
  lateFee        Float   @default(0)
  lateFeeApplied Boolean @default(false)

  // Payment Reference (links to Payments module)
  paymentReference String?
  receiptNumber    String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  lease re_lease @relation(fields: [leaseId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([leaseId])
  @@index([status])
  @@index([dueDate])
}

// Maintenance Request Model
model re_maintenance_request {
  id         String  @id @default(cuid())
  tenantId   String
  propertyId String
  unitId     String?
  leaseId    String?

  // Request Details
  requestNumber String                 @unique
  category      re_MaintenanceCategory
  priority      re_MaintenancePriority @default(MEDIUM)
  status        re_MaintenanceStatus   @default(OPEN)

  // Description
  title       String
  description String

  // Requester (Tenant)
  requesterName  String
  requesterPhone String
  requesterEmail String?

  // Assignment (links to Logistics)
  assignedTo    String?
  assignedName  String?
  scheduledDate DateTime?
  completedDate DateTime?

  // Cost (links to Accounting)
  estimatedCost Float?
  actualCost    Float?
  costNotes     String?

  // Media
  photosBefore String[] @default([])
  photosAfter  String[] @default([])

  // Resolution
  resolutionNotes String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  property re_property @relation(fields: [propertyId], references: [id])

  @@index([tenantId])
  @@index([propertyId])
  @@index([status])
  @@index([priority])
  @@index([category])
  @@index([createdAt])
}

// ============================================================================
// LEGAL PRACTICE SUITE  Phase 7B.1
// Practice management for Nigerian law firms, chambers, and legal departments
// ============================================================================

// --- LEGAL PRACTICE ENUMS ---

enum leg_MatterType {
  CIVIL
  CRIMINAL
  CORPORATE
  FAMILY
  PROPERTY
  EMPLOYMENT
  INTELLECTUAL_PROPERTY
  TAX
  BANKING
  ADMINISTRATIVE
  ARBITRATION
  OTHER
}

enum leg_MatterStatus {
  DRAFT
  ACTIVE
  ON_HOLD
  CLOSED
  ARCHIVED
}

enum leg_ActivityType {
  RESEARCH
  DRAFTING
  REVIEW
  APPEARANCE
  CALL
  MEETING
  TRAVEL
  FILING
  CORRESPONDENCE
  CONSULTATION
  OTHER
}

enum leg_DeadlineType {
  COURT_DATE
  FILING_DEADLINE
  LIMITATION
  INTERNAL
  COMPLIANCE
  OTHER
}

enum leg_DeadlineStatus {
  PENDING
  COMPLETED
  MISSED
  EXTENDED
  CANCELLED
}

enum leg_PartyRole {
  CLIENT
  OPPOSING_PARTY
  OPPOSING_COUNSEL
  WITNESS
  EXPERT
  JUDGE
  REGISTRAR
  CO_COUNSEL
  OTHER
}

enum leg_DisbursementCategory {
  FILING_FEE
  TRANSPORT
  PRINTING
  COURIER
  ACCOMMODATION
  EXPERT_FEE
  COURT_FEE
  SEARCH_FEE
  OTHER
}

enum leg_RetainerTransactionType {
  DEPOSIT
  WITHDRAWAL
  ADJUSTMENT
  REFUND
  TRANSFER
}

enum leg_FilingType {
  ORIGINATING_PROCESS
  MOTION
  BRIEF
  AFFIDAVIT
  EXHIBIT
  JUDGMENT
  ORDER
  RULING
  NOTICE
  OTHER
}

// --- LEGAL PRACTICE MODELS ---

// Legal Matter (Case)
model leg_matter {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Matter Identification
  matterNumber String  @unique
  title        String
  description  String?

  // Classification
  matterType   leg_MatterType
  status       leg_MatterStatus @default(DRAFT)
  practiceArea String? // e.g., "Litigation", "Corporate"

  // Client (links to CRM)
  clientId    String // References Customer in CRM
  clientName  String // Denormalized for display
  clientPhone String?
  clientEmail String?

  // Court Information (manual tracking)
  court       String? // e.g., "Federal High Court, Lagos"
  division    String? // e.g., "Commercial Division"
  suitNumber  String? // e.g., "FHC/L/CS/123/2026"
  judgeRef    String? // Judge name (reference only)
  registryRef String? // Registry contact (reference only)

  // Dates
  openDate   DateTime  @default(now())
  closeDate  DateTime?
  trialDate  DateTime?
  nextAction DateTime?

  // Financials (NGN)
  estimatedValue Float?
  billingType    String? // "RETAINER", "HOURLY", "FLAT_FEE", "CONTINGENCY"
  agreedFee      Float?
  retainerAmount Float?

  // Team Assignment
  leadLawyerId   String? // User ID
  leadLawyerName String?

  // Notes
  notes           String?
  internalNotes   String?
  opposingCounsel String?

  // Metadata
  tags      String[] @default([])
  createdBy String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  parties       leg_matter_party[]
  timeEntries   leg_time_entry[]
  deadlines     leg_deadline[]
  disbursements leg_disbursement[]
  filings       leg_filing[]
  documents     leg_document[]
  retainer      leg_retainer?

  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([clientId])
  @@index([status])
  @@index([matterType])
  @@index([court])
  @@index([openDate])
  @@index([suitNumber])
}

// Matter Parties (Clients, Opposing Parties, Witnesses, etc.)
model leg_matter_party {
  id       String @id @default(cuid())
  tenantId String
  matterId String

  // Party Details (can link to CRM or be standalone)
  contactId    String? // Optional link to CRM Customer
  partyRole    leg_PartyRole
  name         String
  phone        String?
  email        String?
  address      String?
  organization String?

  // Additional Info
  notes          String?
  representedBy  String? // Counsel name if applicable
  isAdverseParty Boolean @default(false)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  matter leg_matter @relation(fields: [matterId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([matterId])
  @@index([partyRole])
  @@index([contactId])
}

// Time Entry (Billable Hours)
model leg_time_entry {
  id       String @id @default(cuid())
  tenantId String
  matterId String

  // Entry Details
  date         DateTime
  hours        Float // e.g., 2.5 hours
  minutes      Int? // Alternative: track in minutes
  activityType leg_ActivityType
  description  String

  // Billing
  billable Boolean @default(true)
  rate     Float? // Hourly rate in NGN
  amount   Float? // Calculated: hours * rate

  // Staff
  staffId   String // User ID
  staffName String
  staffRole String? // "Partner", "Associate", "Paralegal"

  // Approval
  approved   Boolean   @default(false)
  approvedBy String?
  approvedAt DateTime?

  // Invoice Link
  invoiced   Boolean @default(false)
  invoiceId  String?
  invoiceRef String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  matter leg_matter @relation(fields: [matterId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([matterId])
  @@index([staffId])
  @@index([date])
  @@index([billable])
  @@index([approved])
  @@index([invoiced])
}

// Retainer Account
model leg_retainer {
  id       String @id @default(cuid())
  tenantId String
  matterId String @unique // One retainer per matter

  // Client Reference
  clientId   String
  clientName String

  // Retainer Details
  initialAmount  Float // Initial deposit in NGN
  currentBalance Float  @default(0) // Current balance
  minimumBalance Float? // Alert threshold
  currency       String @default("NGN")

  // Status
  isActive    Boolean   @default(true)
  exhausted   Boolean   @default(false)
  exhaustedAt DateTime?

  // Notes
  notes String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  matter       leg_matter                 @relation(fields: [matterId], references: [id], onDelete: Cascade)
  transactions leg_retainer_transaction[]

  @@index([tenantId])
  @@index([clientId])
  @@index([isActive])
}

// Retainer Transactions
model leg_retainer_transaction {
  id         String @id @default(cuid())
  tenantId   String
  retainerId String

  // Transaction Details
  transactionType leg_RetainerTransactionType
  amount          Float // Positive for deposits, negative for withdrawals
  balanceAfter    Float
  description     String
  reference       String? // Payment reference

  // Date
  transactionDate DateTime @default(now())

  // Staff
  processedBy   String?
  processedName String?

  // Link to Time/Disbursement
  timeEntryId    String?
  disbursementId String?

  // Timestamps
  createdAt DateTime @default(now())

  // Relations
  retainer leg_retainer @relation(fields: [retainerId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([retainerId])
  @@index([transactionDate])
  @@index([transactionType])
}

// Deadlines & Court Dates
model leg_deadline {
  id       String @id @default(cuid())
  tenantId String
  matterId String

  // Deadline Details
  deadlineType leg_DeadlineType
  title        String
  description  String?
  dueDate      DateTime
  dueTime      String? // e.g., "09:00"

  // Court Details (if court date)
  court     String?
  courtroom String?
  judgeRef  String?

  // Status
  status        leg_DeadlineStatus @default(PENDING)
  completedDate DateTime?
  completedBy   String?

  // Reminder
  reminderDays Int?      @default(3) // Days before to remind
  reminderSent Boolean   @default(false)
  reminderDate DateTime?

  // Assignment
  assignedTo   String? // User ID
  assignedName String?

  // Notes
  notes String?

  // Priority
  priority Int @default(2) // 1=High, 2=Medium, 3=Low

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  matter leg_matter @relation(fields: [matterId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([matterId])
  @@index([deadlineType])
  @@index([status])
  @@index([dueDate])
  @@index([priority])
}

// Disbursements (Expenses)
model leg_disbursement {
  id       String @id @default(cuid())
  tenantId String
  matterId String

  // Expense Details
  category    leg_DisbursementCategory
  description String
  amount      Float // NGN
  date        DateTime

  // Vendor/Payee
  vendor  String?
  receipt String? // Receipt reference or file ID

  // Billing
  billable   Boolean @default(true)
  invoiced   Boolean @default(false)
  invoiceId  String?
  invoiceRef String?

  // Retainer
  chargedToRetainer Boolean @default(false)
  retainerTxnId     String?

  // Staff
  submittedBy   String?
  submittedName String?
  approvedBy    String?
  approvedAt    DateTime?

  // Notes
  notes String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  matter leg_matter @relation(fields: [matterId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([matterId])
  @@index([category])
  @@index([date])
  @@index([billable])
  @@index([invoiced])
}

// Court Filings
model leg_filing {
  id       String @id @default(cuid())
  tenantId String
  matterId String

  // Filing Details
  filingType  leg_FilingType
  title       String
  description String?

  // Court
  court         String
  filedDate     DateTime
  filedBy       String? // Staff name
  stampedCopyId String? // Document ID of stamped copy

  // Reference Numbers
  filingNumber String? // Court-assigned number
  receiptRef   String? // Payment receipt

  // Fees
  filingFee Float? // NGN
  feePaid   Boolean @default(false)

  // Service (if applicable)
  served     Boolean   @default(false)
  servedDate DateTime?
  servedOn   String? // Party served

  // Status
  acknowledged     Boolean   @default(false)
  acknowledgedDate DateTime?

  // Related Document
  documentId String? // Link to leg_document

  // Notes
  notes String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  matter leg_matter @relation(fields: [matterId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([matterId])
  @@index([filingType])
  @@index([filedDate])
  @@index([court])
}

// Legal Documents
model leg_document {
  id       String @id @default(cuid())
  tenantId String
  matterId String

  // Document Details
  title       String
  description String?
  category    String? // "Brief", "Motion", "Evidence", "Correspondence"
  docType     String? // More specific type

  // File Reference (links to Files module)
  fileId   String? // External file storage ID
  fileUrl  String?
  fileName String?
  fileSize Int?
  mimeType String?

  // Version Control
  version     Int     @default(1)
  parentDocId String? // Previous version

  // Evidence (if applicable)
  isEvidence    Boolean @default(false)
  exhibitNumber String? // e.g., "Exhibit A"
  exhibitLabel  String?

  // Confidentiality
  isConfidential   Boolean @default(false)
  accessRestricted Boolean @default(false)

  // Status
  status    String? // "Draft", "Final", "Filed"
  filedDate DateTime?
  filingId  String? // Link to leg_filing

  // Authorship
  authorId   String?
  authorName String?

  // Notes
  notes String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  matter leg_matter @relation(fields: [matterId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([matterId])
  @@index([category])
  @@index([isEvidence])
  @@index([createdAt])
}

// =============================================================================
// RECRUITMENT & ONBOARDING SUITE  Phase 7C.1
// =============================================================================

// Recruitment Enums
enum recruit_JobStatus {
  DRAFT
  OPEN
  ON_HOLD
  CLOSED
  FILLED
  CANCELLED
}

enum recruit_EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERNSHIP
  TEMPORARY
  VOLUNTEER
}

enum recruit_ApplicationStage {
  APPLIED
  SCREENING
  INTERVIEW
  ASSESSMENT
  OFFER
  HIRED
  REJECTED
  WITHDRAWN
}

enum recruit_InterviewType {
  PHONE
  VIDEO
  IN_PERSON
  PANEL
  ASSESSMENT
  TECHNICAL
}

enum recruit_InterviewResult {
  PENDING
  PASS
  FAIL
  NO_SHOW
  RESCHEDULED
  CANCELLED
}

enum recruit_OfferStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  SENT
  VIEWED
  ACCEPTED
  DECLINED
  EXPIRED
  WITHDRAWN
  NEGOTIATING
}

enum recruit_OnboardingStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  OVERDUE
  SKIPPED
}

// =============================================================================
// RECRUITMENT MODELS
// =============================================================================

// Job Requisition
model recruit_job {
  id                 String @id @default(cuid())
  tenantId           String
  platformInstanceId String

  // Job Details
  jobCode          String? // Internal job code e.g., "JOB-2026-001"
  title            String
  department       String?
  location         String? // City/Office location
  workLocation     String? // "On-site", "Remote", "Hybrid"
  description      String? @db.Text
  requirements     String? @db.Text
  responsibilities String? @db.Text
  qualifications   String? @db.Text

  // Employment Terms
  employmentType recruit_EmploymentType @default(FULL_TIME)
  salaryMin      Float? // NGN
  salaryMax      Float? // NGN
  salaryCurrency String                 @default("NGN")
  salaryPeriod   String                 @default("MONTHLY") // MONTHLY, ANNUAL
  benefits       String?                @db.Text // JSON or text description

  // Positions
  openings    Int @default(1) // Number of positions
  filledCount Int @default(0) // How many hired

  // Status & Workflow
  status         recruit_JobStatus @default(DRAFT)
  approvalStatus String? // PENDING, APPROVED, REJECTED
  approvedBy     String?
  approvedAt     DateTime?

  // Dates
  postedDate     DateTime?
  closingDate    DateTime?
  targetHireDate DateTime?

  // Assignment
  recruiterId       String? // Primary recruiter
  recruiterName     String?
  hiringManager     String? // Hiring manager ID
  hiringManagerName String?

  // Visibility
  isInternal     Boolean @default(false) // Internal posting only
  isConfidential Boolean @default(false) // Confidential search
  shareableLink  String? // Public application link slug

  // Source Tracking
  source String? // Where job was posted

  // Tags & Categorization
  tags   String[] // Keywords for filtering
  skills String[] // Required skills

  // Notes
  notes String? @db.Text

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?

  // Relations
  applications recruit_application[]

  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([status])
  @@index([department])
  @@index([employmentType])
  @@index([postedDate])
  @@index([closingDate])
  @@index([recruiterId])
}

// Job Application (links Applicant to Job)
model recruit_application {
  id                 String @id @default(cuid())
  tenantId           String
  platformInstanceId String

  // Job Reference
  jobId String

  // Applicant (can link to CRM Contact or standalone)
  applicantContactId String? // Link to CRM Contact if exists
  applicantName      String
  applicantEmail     String?
  applicantPhone     String?
  applicantLocation  String? // City/State

  // Application Details
  applicationDate DateTime @default(now())
  source          String? // "Direct", "Referral", "LinkedIn", "Jobberman", etc.
  referredBy      String? // Referrer name/ID

  // Documents
  cvFileId       String? // File storage ID
  cvFileName     String?
  coverLetter    String? @db.Text
  additionalDocs Json? // Array of {fileId, fileName, docType}

  // Pipeline Stage
  stage          recruit_ApplicationStage @default(APPLIED)
  stageChangedAt DateTime?
  stageChangedBy String?

  // Assignment
  assignedTo     String? // Recruiter handling this application
  assignedToName String?

  // Scoring & Evaluation
  score  Int? // 1-5 or 1-100
  rating Int? // Star rating 1-5
  tags   String[] // Screening tags

  // Screening
  screeningNotes String?   @db.Text
  screeningDate  DateTime?
  screenedBy     String?

  // Flags
  isShortlisted   Boolean   @default(false)
  isRejected      Boolean   @default(false)
  rejectionReason String?
  rejectedAt      DateTime?
  rejectedBy      String?

  // Withdrawal
  isWithdrawn     Boolean   @default(false)
  withdrawnAt     DateTime?
  withdrawnReason String?

  // Offer (if reached offer stage)
  offerId String? // Link to recruit_offer

  // Expected Salary
  expectedSalary Float?
  noticePeriod   String? // e.g., "2 weeks", "1 month"
  availableFrom  DateTime?

  // Notes
  notes String? @db.Text

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  job             recruit_job               @relation(fields: [jobId], references: [id], onDelete: Cascade)
  interviews      recruit_interview[]
  offer           recruit_offer?
  onboardingTasks recruit_onboarding_task[]

  @@unique([jobId, applicantEmail])
  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([jobId])
  @@index([applicantContactId])
  @@index([stage])
  @@index([assignedTo])
  @@index([applicationDate])
  @@index([isShortlisted])
}

// Interview Record
model recruit_interview {
  id                 String @id @default(cuid())
  tenantId           String
  platformInstanceId String

  // Application Reference
  applicationId String

  // Interview Details
  interviewType recruit_InterviewType @default(PHONE)
  title         String? // e.g., "First Round", "Technical Interview"
  round         Int                   @default(1) // Interview round number

  // Scheduling
  scheduledDate DateTime?
  scheduledTime String? // "10:00 AM"
  duration      Int? // Minutes
  timezone      String    @default("Africa/Lagos")

  // Location/Link
  location        String? // Physical address or video link
  meetingLink     String? // Zoom/Teams/Google Meet link
  meetingId       String? // Meeting ID if needed
  meetingPassword String?

  // Interviewers
  interviewers        Json? // Array of {id, name, role}
  leadInterviewer     String? // Primary interviewer ID
  leadInterviewerName String?

  // Outcome
  result     recruit_InterviewResult @default(PENDING)
  resultDate DateTime?
  resultBy   String?

  // Feedback
  feedback       String? @db.Text
  strengths      String? @db.Text
  weaknesses     String? @db.Text
  recommendation String? // "Hire", "No Hire", "Maybe", "Next Round"

  // Scorecard
  scorecard    Json? // Structured scoring {criteria: score}
  overallScore Int? // 1-10 or 1-100

  // Status
  status          String    @default("SCHEDULED") // SCHEDULED, COMPLETED, CANCELLED, NO_SHOW
  isCancelled     Boolean   @default(false)
  cancelledReason String?
  cancelledAt     DateTime?

  // Rescheduling
  isRescheduled     Boolean   @default(false)
  rescheduledFrom   DateTime?
  rescheduledReason String?

  // Calendar Event (if integrated)
  calendarEventId String?

  // Notes
  notes String? @db.Text

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?

  // Relations
  application recruit_application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([applicationId])
  @@index([interviewType])
  @@index([scheduledDate])
  @@index([result])
  @@index([leadInterviewer])
}

// Offer Record
model recruit_offer {
  id                 String @id @default(cuid())
  tenantId           String
  platformInstanceId String

  // Application Reference
  applicationId String @unique

  // Offer Details
  offerCode   String? // e.g., "OFF-2026-001"
  position    String // Job title offered
  department  String?
  reportingTo String? // Manager name

  // Compensation
  baseSalary     Float // NGN
  salaryCurrency String @default("NGN")
  salaryPeriod   String @default("MONTHLY")

  // Allowances (Nigerian context)
  housingAllowance   Float?
  transportAllowance Float?
  mealAllowance      Float?
  otherAllowances    Json? // {name, amount}[]

  // Benefits
  benefits            String? @db.Text
  leaveEntitlement    Int? // Days per year
  probationPeriod     Int? // Months
  pensionContribution Float? // Employer %
  healthInsurance     String? // HMO details

  // Bonus
  signingBonus Float?
  annualBonus  String? // Description or %

  // Dates
  startDate        DateTime?
  responseDeadline DateTime?
  expiryDate       DateTime?

  // Status
  status          recruit_OfferStatus @default(DRAFT)
  statusChangedAt DateTime?
  statusChangedBy String?

  // Approval
  approvalStatus String? // PENDING, APPROVED, REJECTED
  approvedBy     String?
  approvedAt     DateTime?
  approverNotes  String?

  // Sending
  sentAt  DateTime?
  sentBy  String?
  sentVia String? // "Email", "In Person"

  // Response
  viewedAt      DateTime?
  respondedAt   DateTime?
  responseNotes String?

  // Negotiation
  isNegotiating      Boolean @default(false)
  negotiationHistory Json? // Array of {date, request, response}
  counterOffer       Float? // If candidate countered

  // Documents
  offerLetterFileId String?
  signedCopyFileId  String?

  // Notes
  notes String? @db.Text

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?

  // Relations
  application recruit_application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([applicationId])
  @@index([status])
  @@index([startDate])
  @@index([responseDeadline])
}

// Onboarding Task
model recruit_onboarding_task {
  id                 String @id @default(cuid())
  tenantId           String
  platformInstanceId String

  // Application Reference (hired candidate)
  applicationId String

  // Task Details
  taskName    String
  description String? @db.Text
  category    String? // "Documents", "IT Setup", "Training", "Orientation", "Admin"

  // Assignment
  assignedTo         String? // Staff ID responsible
  assignedToName     String?
  assignedDepartment String? // "HR", "IT", "Finance"

  // Due Date
  dueDate  DateTime?
  dueOrder Int? // Sequence order

  // Status
  status          recruit_OnboardingStatus @default(PENDING)
  statusChangedAt DateTime?
  statusChangedBy String?

  // Completion
  completedAt     DateTime?
  completedBy     String?
  completionNotes String?

  // Document Collection (if applicable)
  requiresDocument Boolean   @default(false)
  documentType     String? // e.g., "ID Copy", "Degree Certificate"
  documentFileId   String? // Uploaded document
  documentFileName String?
  documentVerified Boolean   @default(false)
  verifiedBy       String?
  verifiedAt       DateTime?

  // Reminders
  reminderSent   Boolean   @default(false)
  reminderSentAt DateTime?

  // Notes
  notes String? @db.Text

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  application recruit_application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([applicationId])
  @@index([status])
  @@index([dueDate])
  @@index([assignedTo])
  @@index([category])
}

// ============================================================================
// PROJECT MANAGEMENT SUITE (Phase 7C.2)
// 5 Tables, 6 Enums - Lightweight project tracking for Nigerian SMEs
// ============================================================================

// --- ENUMS ---

enum project_Status {
  DRAFT
  ACTIVE
  ON_HOLD
  COMPLETED
  CANCELLED
  ARCHIVED
}

enum project_Priority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum project_Health {
  ON_TRACK
  AT_RISK
  DELAYED
}

enum project_TaskStatus {
  TODO
  IN_PROGRESS
  REVIEW
  DONE
  BLOCKED
}

enum project_TaskPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum project_MemberRole {
  OWNER
  MANAGER
  LEAD
  MEMBER
  OBSERVER
}

// --- TABLES ---

// Core project entity
model project_project {
  id                 String @id @default(cuid())
  tenantId           String
  platformInstanceId String

  // Project Identity
  projectCode String // Auto-generated: PRJ-2026-0001
  name        String
  description String? @db.Text
  category    String? // "Construction", "NGO Program", "Client Project", "Internal"

  // Client Association (CRM reuse)
  clientId   String? // References CRM Contact/Customer
  clientName String? // Denormalized for display

  // Ownership (HR reuse)
  ownerId     String? // Staff ID
  ownerName   String? // Denormalized
  managerId   String? // Optional project manager
  managerName String?

  // Status & Priority
  status   project_Status   @default(DRAFT)
  priority project_Priority @default(MEDIUM)
  health   project_Health   @default(ON_TRACK)

  // Dates
  startDate     DateTime?
  targetEndDate DateTime?
  actualEndDate DateTime?

  // Budget (Light - NGN)
  budgetEstimated Decimal? @db.Decimal(14, 2) // Up to 100B NGN
  budgetCurrency  String   @default("NGN")

  // Progress
  progressPercent Int @default(0) // 0-100

  // Visibility
  visibility String @default("TEAM") // PRIVATE, TEAM, ORGANIZATION

  // Metadata
  tags  String[] @default([])
  color String? // UI display color

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  updatedBy String?

  // Relations
  milestones  project_milestone[]
  tasks       project_task[]
  teamMembers project_team_member[]
  budgetItems project_budget_item[]

  @@unique([tenantId, projectCode])
  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([status])
  @@index([priority])
  @@index([clientId])
  @@index([ownerId])
  @@index([targetEndDate])
}

// Milestones within a project
model project_milestone {
  id                 String @id @default(cuid())
  tenantId           String
  platformInstanceId String
  projectId          String

  // Milestone Details
  name         String
  description  String? @db.Text
  deliverables String? @db.Text // Description of deliverables

  // Ordering & Dependencies
  orderIndex  Int     @default(0)
  dependsOnId String? // Simple dependency: must complete this first

  // Dates
  targetDate    DateTime?
  completedDate DateTime?

  // Status
  isCompleted Boolean @default(false)
  completedBy String?

  // Progress (calculated from tasks)
  progressPercent Int @default(0)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?

  // Relations
  project             project_project     @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tasks               project_task[]
  dependsOn           project_milestone?  @relation("MilestoneDependency", fields: [dependsOnId], references: [id])
  dependentMilestones project_milestone[] @relation("MilestoneDependency")

  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([projectId])
  @@index([targetDate])
  @@index([isCompleted])
}

// Tasks / work items
model project_task {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String
  projectId          String
  milestoneId        String? // Optional: can be project-level task

  // Task Details
  title       String
  description String? @db.Text

  // Assignment (HR reuse)
  assigneeId   String? // Staff ID
  assigneeName String? // Denormalized

  // Status & Priority
  status   project_TaskStatus   @default(TODO)
  priority project_TaskPriority @default(MEDIUM)

  // Dates
  dueDate     DateTime?
  startedAt   DateTime?
  completedAt DateTime?

  // Time Tracking (optional, manual)
  estimatedHours Decimal? @db.Decimal(6, 2)
  actualHours    Decimal? @db.Decimal(6, 2)

  // Dependencies
  blockedById String? // Another task that blocks this one

  // Checklist (JSON array of subtasks)
  checklist         Json? // [{id, text, completed}]
  checklistProgress Int   @default(0) // % of checklist items done

  // Ordering
  orderIndex Int @default(0)

  // Metadata
  tags String[] @default([])

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  updatedBy String?

  // Relations
  project       project_project    @relation(fields: [projectId], references: [id], onDelete: Cascade)
  milestone     project_milestone? @relation(fields: [milestoneId], references: [id], onDelete: SetNull)
  blockedBy     project_task?      @relation("TaskDependency", fields: [blockedById], references: [id])
  blockingTasks project_task[]     @relation("TaskDependency")

  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([projectId])
  @@index([milestoneId])
  @@index([assigneeId])
  @@index([status])
  @@index([priority])
  @@index([dueDate])
}

// Project team members
model project_team_member {
  id                 String @id @default(cuid())
  tenantId           String
  platformInstanceId String
  projectId          String

  // Member Identity
  memberId    String // Staff ID (HR) or Contact ID (CRM)
  memberType  String  @default("STAFF") // STAFF, EXTERNAL
  memberName  String // Denormalized
  memberEmail String?

  // Role
  role project_MemberRole @default(MEMBER)

  // Status
  isActive Boolean   @default(true)
  joinedAt DateTime  @default(now())
  leftAt   DateTime?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  addedBy   String?

  // Relations
  project project_project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, memberId])
  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([projectId])
  @@index([memberId])
  @@index([role])
}

// Budget line items (light budget tracking)
model project_budget_item {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String
  projectId          String
  milestoneId        String? // Optional: associate with milestone

  // Item Details
  category    String // "Materials", "Labor", "Equipment", "Consulting", "Other"
  description String

  // Amounts (NGN)
  estimatedAmount Decimal  @db.Decimal(14, 2)
  actualAmount    Decimal? @db.Decimal(14, 2)
  currency        String   @default("NGN")

  // Accounting Link (optional)
  expenseId String? // Reference to Accounting expense record
  invoiceId String? // Reference to invoice if billed to client

  // Status
  isApproved Boolean   @default(false)
  approvedBy String?
  approvedAt DateTime?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?

  // Relations
  project project_project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([projectId])
  @@index([milestoneId])
  @@index([category])
}

// =============================================================================
// ADVANCED WAREHOUSE SUITE (Phase 7C.3)
// =============================================================================
// Multi-location warehouse operations for Nigerian distributors, wholesalers,
// e-commerce fulfillment, pharma distributors, and NGO logistics hubs.
// Extends existing inv_* tables with structured zones, bins, and workflows.
// =============================================================================

// -----------------------------------------------------------------------------
// ENUMS
// -----------------------------------------------------------------------------

enum wh_ZoneType {
  RECEIVING // Goods-in area
  STORAGE // Main storage area
  PICKING // Active picking area
  SHIPPING // Goods-out staging
  QUARANTINE // Held for inspection/issues
  RETURNS // Returns processing
  BULK // Bulk/pallet storage
  COLD // Temperature-controlled
  HAZMAT // Hazardous materials
}

enum wh_BinType {
  PALLET // Floor pallet position
  SHELF // Shelving unit slot
  BULK // Bulk storage area
  COLD // Refrigerated bin
  HAZMAT // Hazardous storage
  FLOOR // Floor location (no rack)
  RACK // Racking position
  MEZZANINE // Mezzanine level
}

enum wh_ReceiptStatus {
  EXPECTED // ASN received, awaiting delivery
  RECEIVING // Currently being received
  INSPECTING // Under quality inspection
  COMPLETED // Fully received and put away
  PARTIAL // Partially received
  CANCELLED // Receipt cancelled
}

enum wh_PutawayStatus {
  PENDING // Waiting to be assigned
  ASSIGNED // Assigned to operator
  IN_PROGRESS // Being executed
  COMPLETED // Stock placed in bin
  CANCELLED // Task cancelled
}

enum wh_PickStatus {
  PENDING // Pick list created
  ASSIGNED // Assigned to picker
  PICKING // In progress
  PICKED // All items picked
  PACKED // Packed and ready
  DISPATCHED // Handed to dispatch
  CANCELLED // Pick cancelled
  SHORT // Short-pick recorded
}

enum wh_MovementType {
  RECEIPT // Goods receipt into warehouse
  PUTAWAY // Placement into bin
  PICK // Picking for order/transfer
  TRANSFER_OUT // Shipped to another warehouse
  TRANSFER_IN // Received from another warehouse
  ADJUSTMENT // Stock adjustment
  RELOCATION // Move between bins
  SCRAP // Write-off/damage
  RETURN // Customer return
  CYCLE_COUNT // Count adjustment
}

// -----------------------------------------------------------------------------
// MODELS
// -----------------------------------------------------------------------------

// Warehouse Zones - Logical areas within a warehouse
model wh_zone {
  id                 String @id @default(cuid())
  tenantId           String
  platformInstanceId String
  warehouseId        String // FK to inv_warehouses

  // Zone Identity
  code        String // e.g., "RCV-01", "STG-A", "SHIP-01"
  name        String // e.g., "Receiving Bay 1", "Storage A"
  description String?
  zoneType    wh_ZoneType @default(STORAGE)

  // Capacity (optional)
  totalCapacity Int? // Total bin slots
  usedCapacity  Int? // Occupied slots
  capacityUnit  String? // "BINS", "PALLETS", "SQM"

  // Rules
  defaultForProductTypes String[] @default([]) // Product categories that default here
  allowMixedProducts     Boolean  @default(true) // Allow different SKUs in same zone
  requiresInspection     Boolean  @default(false) // Items must be inspected before leaving

  // Status
  isActive Boolean @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?

  // Relations
  bins         wh_bin[]
  putawayTasks wh_putaway_task[]

  @@unique([tenantId, warehouseId, code])
  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([warehouseId])
  @@index([zoneType])
  @@index([isActive])
}

// Bin/Slot Locations - Physical storage positions
model wh_bin {
  id                 String @id @default(cuid())
  tenantId           String
  platformInstanceId String
  warehouseId        String // FK to inv_warehouses
  zoneId             String // FK to wh_zone

  // Bin Address (e.g., A-01-02-03 = Aisle A, Rack 01, Level 02, Position 03)
  code     String // Full bin code
  aisle    String? // Aisle identifier
  rack     String? // Rack number
  level    String? // Vertical level
  position String? // Horizontal position

  // Bin Characteristics
  binType   wh_BinType @default(SHELF)
  maxWeight Decimal?   @db.Decimal(10, 2) // kg
  maxVolume Decimal?   @db.Decimal(10, 3) // cubic meters
  maxUnits  Int? // Maximum unit count

  // Current State
  currentWeight Decimal? @db.Decimal(10, 2)
  currentUnits  Int      @default(0)
  isEmpty       Boolean  @default(true)

  // Rules
  restrictedToProductId String? // Only this product allowed
  restrictedToCategory  String? // Only this category allowed
  allowMixedBatches     Boolean @default(false) // Allow different batches

  // Status
  isActive    Boolean @default(true)
  isBlocked   Boolean @default(false) // Temporarily unavailable
  blockReason String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  zone           wh_zone             @relation(fields: [zoneId], references: [id])
  putawayTasks   wh_putaway_task[]
  pickListItems  wh_pick_list_item[]
  stockMovements wh_stock_movement[]

  @@unique([tenantId, warehouseId, code])
  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([warehouseId])
  @@index([zoneId])
  @@index([binType])
  @@index([isEmpty])
  @@index([isActive])
}

// Batch/Lot Registry - Tracking batches with expiry
model wh_batch {
  id                 String @id @default(cuid())
  tenantId           String
  platformInstanceId String

  // Product Reference
  productId String // FK to Product
  variantId String? // FK to ProductVariant

  // Batch Identity
  batchNumber  String // Supplier or internal batch number
  lotNumber    String? // Additional lot tracking
  serialNumber String? // For serialized items

  // Dates
  manufacturingDate DateTime?
  expiryDate        DateTime?
  receivedDate      DateTime  @default(now())

  // Supplier Info
  supplierId       String? // FK to Supplier
  supplierBatchRef String? // Supplier's batch reference
  purchaseOrderId  String? // FK to PO if applicable

  // Quantities
  initialQuantity  Int // Quantity when received
  currentQuantity  Int // Current available quantity
  reservedQuantity Int @default(0)

  // Quality
  qualityStatus   String  @default("APPROVED") // PENDING, APPROVED, REJECTED, QUARANTINE
  inspectionNotes String?

  // Status
  isActive     Boolean   @default(true)
  isRecalled   Boolean   @default(false)
  recallReason String?
  recallDate   DateTime?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?

  // Relations
  receiptItems   wh_receipt_item[]
  stockMovements wh_stock_movement[]

  @@unique([tenantId, productId, batchNumber])
  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([productId])
  @@index([variantId])
  @@index([batchNumber])
  @@index([expiryDate])
  @@index([qualityStatus])
  @@index([isRecalled])
}

// Goods Receipt Header - Receiving shipments
model wh_receipt {
  id                 String @id @default(cuid())
  tenantId           String
  platformInstanceId String
  warehouseId        String // FK to inv_warehouses

  // Receipt Identity
  receiptNumber String  @unique // GRN-YYYYMM-XXXX
  referenceType String  @default("PO") // PO, TRANSFER, RETURN, MANUAL
  referenceId   String? // FK to source document

  // Supplier Info (for PO receipts)
  supplierId   String?
  supplierName String?
  supplierRef  String? // Supplier's delivery note number

  // Expected vs Actual
  expectedDate DateTime?
  receivedDate DateTime?

  // Status
  status wh_ReceiptStatus @default(EXPECTED)

  // Totals
  totalExpectedLines Int @default(0)
  totalReceivedLines Int @default(0)
  totalExpectedQty   Int @default(0)
  totalReceivedQty   Int @default(0)

  // Receiving Details
  receivedById   String?
  receivedByName String?
  receivingBay   String? // Dock/bay where received

  // Quality
  requiresInspection Boolean   @default(false)
  inspectionStatus   String? // PENDING, PASSED, FAILED
  inspectedById      String?
  inspectedByName    String?
  inspectionDate     DateTime?
  inspectionNotes    String?

  // Notes
  notes         String?
  internalNotes String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?

  // Relations
  items wh_receipt_item[]

  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([warehouseId])
  @@index([supplierId])
  @@index([status])
  @@index([expectedDate])
  @@index([receivedDate])
}

// Goods Receipt Line Items
model wh_receipt_item {
  id        String @id @default(cuid())
  tenantId  String
  receiptId String // FK to wh_receipt

  // Product
  productId   String // FK to Product
  variantId   String? // FK to ProductVariant
  productName String // Denormalized
  sku         String?

  // Quantities
  expectedQuantity Int
  receivedQuantity Int     @default(0)
  damagedQuantity  Int     @default(0)
  varianceQuantity Int     @default(0) // received - expected
  varianceReason   String?

  // Batch/Lot
  batchId     String? // FK to wh_batch
  batchNumber String?
  expiryDate  DateTime?

  // Unit of Measure
  unitOfMeasure String @default("UNIT")
  unitsPerCase  Int    @default(1)

  // Costs (NGN)
  unitCost  Decimal? @db.Decimal(12, 2)
  totalCost Decimal? @db.Decimal(14, 2)
  currency  String   @default("NGN")

  // Status
  isComplete Boolean @default(false)
  isPutaway  Boolean @default(false)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  receipt      wh_receipt        @relation(fields: [receiptId], references: [id], onDelete: Cascade)
  batch        wh_batch?         @relation(fields: [batchId], references: [id])
  putawayTasks wh_putaway_task[]

  @@index([tenantId])
  @@index([receiptId])
  @@index([productId])
  @@index([batchId])
  @@index([isComplete])
}

// Putaway Tasks - Moving received goods to bins
model wh_putaway_task {
  id                 String @id @default(cuid())
  tenantId           String
  platformInstanceId String
  warehouseId        String // FK to inv_warehouses

  // Task Identity
  taskNumber String @unique // PUT-YYYYMM-XXXX

  // Source (from receiving)
  receiptId     String? // FK to wh_receipt
  receiptItemId String? // FK to wh_receipt_item
  transferId    String? // FK to inv_stock_transfers (for transfer receipts)

  // Product
  productId   String // FK to Product
  variantId   String?
  productName String // Denormalized
  sku         String?
  batchId     String? // FK to wh_batch

  // Quantity
  quantity        Int
  quantityPutaway Int @default(0)

  // Destination
  suggestedZoneId String? // FK to wh_zone
  suggestedBinId  String? // FK to wh_bin
  actualZoneId    String? // FK to wh_zone
  actualBinId     String? // FK to wh_bin

  // Assignment
  assignedToId   String?
  assignedToName String?
  assignedAt     DateTime?

  // Status
  status   wh_PutawayStatus @default(PENDING)
  priority String           @default("NORMAL") // LOW, NORMAL, HIGH, URGENT

  // Completion
  completedAt     DateTime?
  completedById   String?
  completedByName String?

  // Notes
  notes String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?

  // Relations
  receiptItem   wh_receipt_item? @relation(fields: [receiptItemId], references: [id])
  suggestedZone wh_zone?         @relation(fields: [suggestedZoneId], references: [id])
  suggestedBin  wh_bin?          @relation(fields: [suggestedBinId], references: [id])

  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([warehouseId])
  @@index([receiptId])
  @@index([productId])
  @@index([status])
  @@index([priority])
  @@index([assignedToId])
}

// Pick List Header - Orders/transfers to be picked
model wh_pick_list {
  id                 String @id @default(cuid())
  tenantId           String
  platformInstanceId String
  warehouseId        String // FK to inv_warehouses

  // Pick List Identity
  pickNumber String @unique // PICK-YYYYMM-XXXX
  pickType   String @default("ORDER") // ORDER, TRANSFER, REPLENISH

  // Source Reference
  sourceType String  @default("ORDER") // ORDER, TRANSFER, MANUAL
  sourceId   String? // FK to Order or inv_stock_transfers

  // Assignment
  assignedToId   String?
  assignedToName String?
  assignedAt     DateTime?

  // Status
  status   wh_PickStatus @default(PENDING)
  priority String        @default("NORMAL") // LOW, NORMAL, HIGH, URGENT, EXPRESS

  // Totals
  totalLines  Int @default(0)
  pickedLines Int @default(0)
  shortLines  Int @default(0)

  // Timing
  startedAt    DateTime?
  completedAt  DateTime?
  packedAt     DateTime?
  dispatchedAt DateTime?

  // Packing
  packageCount Int      @default(0)
  totalWeight  Decimal? @db.Decimal(10, 2) // kg
  packingNotes String?

  // Dispatch Reference
  dispatchManifestId String? // FK to logistics dispatch
  waybillNumber      String?
  carrierName        String?

  // Notes
  notes         String?
  internalNotes String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?

  // Relations
  items wh_pick_list_item[]

  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([warehouseId])
  @@index([sourceType, sourceId])
  @@index([status])
  @@index([priority])
  @@index([assignedToId])
  @@index([createdAt])
}

// Pick List Line Items
model wh_pick_list_item {
  id         String @id @default(cuid())
  tenantId   String
  pickListId String // FK to wh_pick_list

  // Product
  productId   String // FK to Product
  variantId   String?
  productName String // Denormalized
  sku         String?

  // Quantities
  requestedQuantity Int
  pickedQuantity    Int @default(0)
  shortQuantity     Int @default(0)

  // Location (FIFO/FEFO suggested)
  suggestedBinId   String? // FK to wh_bin
  suggestedBinCode String?
  actualBinId      String? // FK to wh_bin (where actually picked)
  actualBinCode    String?

  // Batch (FIFO/FEFO allocated)
  suggestedBatchId     String? // FK to wh_batch
  suggestedBatchNumber String?
  actualBatchId        String?
  actualBatchNumber    String?

  // Status
  isPicked    Boolean @default(false)
  isShort     Boolean @default(false)
  shortReason String?

  // Picker
  pickedById   String?
  pickedByName String?
  pickedAt     DateTime?

  // Notes
  notes String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  pickList     wh_pick_list @relation(fields: [pickListId], references: [id], onDelete: Cascade)
  suggestedBin wh_bin?      @relation(fields: [suggestedBinId], references: [id])

  @@index([tenantId])
  @@index([pickListId])
  @@index([productId])
  @@index([suggestedBinId])
  @@index([isPicked])
}

// Stock Movement Log - Comprehensive movement audit trail
model wh_stock_movement {
  id                 String @id @default(cuid())
  tenantId           String
  platformInstanceId String
  warehouseId        String // FK to inv_warehouses

  // Movement Identity
  movementNumber String          @unique // MOV-YYYYMM-XXXXXX
  movementType   wh_MovementType

  // Product
  productId   String // FK to Product
  variantId   String?
  productName String // Denormalized
  sku         String?

  // Batch
  batchId     String? // FK to wh_batch
  batchNumber String?
  expiryDate  DateTime?

  // Quantity
  quantity       Int // Positive = in, Negative = out
  beforeQuantity Int? // Quantity before movement
  afterQuantity  Int? // Quantity after movement

  // Location (From/To)
  fromZoneId  String?
  fromBinId   String? // FK to wh_bin
  fromBinCode String?
  toZoneId    String?
  toBinId     String? // FK to wh_bin
  toBinCode   String?

  // Cost (NGN)
  unitCost  Decimal? @db.Decimal(12, 2)
  totalCost Decimal? @db.Decimal(14, 2)
  currency  String   @default("NGN")

  // Reference
  referenceType   String? // RECEIPT, TRANSFER, ORDER, ADJUSTMENT, etc.
  referenceId     String? // FK to source document
  referenceNumber String?

  // Reason (for adjustments)
  reasonCode        String? // DAMAGE, EXPIRED, STOLEN, RECOUNT, etc.
  reasonDescription String?

  // Operator
  performedById   String?
  performedByName String?
  performedAt     DateTime @default(now())

  // Verification
  verifiedById   String?
  verifiedByName String?
  verifiedAt     DateTime?

  // Notes
  notes String?

  // Timestamps
  createdAt DateTime @default(now())

  // Relations
  fromBin wh_bin?   @relation(fields: [fromBinId], references: [id])
  batch   wh_batch? @relation(fields: [batchId], references: [id])

  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([warehouseId])
  @@index([productId])
  @@index([batchId])
  @@index([movementType])
  @@index([fromBinId])
  @@index([toBinId])
  @@index([referenceType, referenceId])
  @@index([performedAt])
  @@index([createdAt])
}

// =============================================================================
// POS & RETAIL OPERATIONS SUITE
// =============================================================================
// Added for PC-SCP: Commerce Suite Re-Canonicalization (December 2025)
// Purpose: Shift management, sale records, and Z-report support

// POS Shift Status
enum pos_ShiftStatus {
  OPEN
  CLOSED
  RECONCILED
  VOID
}

// POS Cash Movement Type
enum pos_CashMovementType {
  OPEN_FLOAT // Opening cash balance
  SALE // Cash from sale
  REFUND // Cash refund payout
  PAYOUT // Manual cash removal (paid out)
  PAY_IN // Manual cash addition
  DROP // Safe drop (excess cash to safe)
  ADJUSTMENT // Count adjustment
}

// POS Sale Status
enum pos_SaleStatus {
  COMPLETED
  VOIDED
  REFUNDED
  PARTIALLY_REFUNDED
}

// POS Shift - Track register shifts
model pos_shift {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?
  locationId         String // FK to Location
  registerId         String? // Optional register identifier

  // Shift Identity
  shiftNumber String @unique // SHIFT-YYYYMMDD-XXX

  // Staff
  openedById   String // User ID who opened
  openedByName String
  closedById   String? // User ID who closed
  closedByName String?

  // Timing
  openedAt DateTime  @default(now())
  closedAt DateTime?

  // Status
  status pos_ShiftStatus @default(OPEN)

  // Cash Summary (NGN)
  openingFloat Decimal  @default(0) @db.Decimal(12, 2)
  expectedCash Decimal? @db.Decimal(12, 2)
  actualCash   Decimal? @db.Decimal(12, 2)
  cashVariance Decimal? @db.Decimal(12, 2)
  currency     String   @default("NGN")

  // Sales Summary
  totalSales       Decimal @default(0) @db.Decimal(14, 2)
  totalRefunds     Decimal @default(0) @db.Decimal(12, 2)
  netSales         Decimal @default(0) @db.Decimal(14, 2)
  transactionCount Int     @default(0)
  refundCount      Int     @default(0)

  // Payment Method Breakdown
  cashTotal        Decimal @default(0) @db.Decimal(12, 2)
  cardTotal        Decimal @default(0) @db.Decimal(12, 2)
  transferTotal    Decimal @default(0) @db.Decimal(12, 2)
  mobileMoneyTotal Decimal @default(0) @db.Decimal(12, 2)
  walletTotal      Decimal @default(0) @db.Decimal(12, 2)
  otherTotal       Decimal @default(0) @db.Decimal(12, 2)

  // Reconciliation Notes
  notes          String?
  varianceReason String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  sales         pos_sale[]
  cashMovements pos_cash_movement[]

  @@index([tenantId])
  @@index([locationId])
  @@index([openedById])
  @@index([status])
  @@index([openedAt])
  @@index([closedAt])
}

// POS Sale - Individual sale records
model pos_sale {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?
  locationId         String // FK to Location
  shiftId            String? // FK to pos_shift (optional for backwards compat)

  // Sale Identity
  saleNumber    String  @unique // SALE-YYYYMMDD-XXXXX
  receiptNumber String? // Customer-facing receipt number

  // Staff
  staffId   String
  staffName String

  // Customer (optional)
  customerId    String? // FK to Customer
  customerName  String?
  customerPhone String?

  // Timing
  saleDate    DateTime  @default(now())
  completedAt DateTime?

  // Status
  status       pos_SaleStatus @default(COMPLETED)
  voidedById   String?
  voidedByName String?
  voidedAt     DateTime?
  voidReason   String?

  // Amounts (NGN)
  subtotal       Decimal  @db.Decimal(14, 2)
  discountTotal  Decimal  @default(0) @db.Decimal(12, 2)
  discountReason String?
  taxTotal       Decimal  @default(0) @db.Decimal(12, 2)
  taxRate        Decimal? @db.Decimal(6, 4) // Captured at time of sale
  grandTotal     Decimal  @db.Decimal(14, 2)
  currency       String   @default("NGN")

  // Payment
  paymentMethod  String // CASH, CARD, TRANSFER, MOBILE_MONEY, SPLIT
  amountTendered Decimal? @db.Decimal(12, 2) // For cash
  changeGiven    Decimal? @db.Decimal(12, 2) // For cash

  // For bank transfer payments
  transferReference String? // Bank reference/narration
  transferBank      String? // Sender bank name

  // For split payments
  splitPayments Json? // Array of {method, amount}

  // Offline tracking
  offlineId String? // Client-generated ID for offline sales
  syncedAt  DateTime? // When synced from offline

  // Notes
  notes String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  shift pos_shift?      @relation(fields: [shiftId], references: [id])
  items pos_sale_item[]

  @@index([tenantId])
  @@index([locationId])
  @@index([shiftId])
  @@index([staffId])
  @@index([customerId])
  @@index([saleDate])
  @@index([status])
  @@index([paymentMethod])
  @@index([offlineId])
}

// POS Sale Item - Line items for each sale
model pos_sale_item {
  id     String @id @default(cuid())
  saleId String // FK to pos_sale

  // Product
  productId   String // FK to Product
  variantId   String?
  productName String // Denormalized
  sku         String?

  // Quantity & Price (NGN)
  quantity       Int
  unitPrice      Decimal @db.Decimal(12, 2)
  discount       Decimal @default(0) @db.Decimal(12, 2)
  discountReason String?
  tax            Decimal @default(0) @db.Decimal(10, 2)
  lineTotal      Decimal @db.Decimal(14, 2)

  // Cost (for margin tracking)
  unitCost Decimal? @db.Decimal(12, 2)

  // For returns/refunds
  returnedQuantity Int     @default(0)
  refundedAmount   Decimal @default(0) @db.Decimal(12, 2)

  // Notes
  notes String?

  // Timestamps
  createdAt DateTime @default(now())

  // Relations
  sale pos_sale @relation(fields: [saleId], references: [id], onDelete: Cascade)

  @@index([saleId])
  @@index([productId])
}

// POS Cash Movement - Track all cash drawer operations
model pos_cash_movement {
  id       String @id @default(cuid())
  tenantId String
  shiftId  String // FK to pos_shift

  // Movement
  movementType pos_CashMovementType
  amount       Decimal              @db.Decimal(12, 2) // Always positive
  direction    String               @default("IN") // IN or OUT

  // Reference
  referenceType   String? // SALE, REFUND, MANUAL
  referenceId     String? // FK to source document
  referenceNumber String? // e.g., sale number

  // Balances (NGN)
  balanceBefore Decimal? @db.Decimal(12, 2)
  balanceAfter  Decimal? @db.Decimal(12, 2)
  currency      String   @default("NGN")

  // Staff
  performedById   String
  performedByName String

  // Approval (for large amounts)
  approvedById   String?
  approvedByName String?

  // Reason/Notes
  reason String?
  notes  String?

  // Timestamps
  performedAt DateTime @default(now())
  createdAt   DateTime @default(now())

  // Relations
  shift pos_shift @relation(fields: [shiftId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([shiftId])
  @@index([movementType])
  @@index([performedAt])
}

// ============================================================================
// MVM (MULTI-VENDOR MARKETPLACE) SUITE
// ============================================================================
// Platform Canonicalization: December 2025
// Nigeria-First: NGN currency, 7.5% VAT, Nigerian settlement patterns
// ============================================================================

// --------------------------------------------------------------------------
// MVM ENUMS
// --------------------------------------------------------------------------

enum MvmVendorStatus {
  PENDING_APPROVAL
  APPROVED
  SUSPENDED
  REJECTED
  CHURNED
}

enum MvmOnboardingStep {
  REGISTERED
  PROFILE_COMPLETED
  BANK_INFO_ADDED
  PRODUCTS_ADDED
  AGREEMENT_SIGNED
  COMPLETED
}

enum MvmVendorStaffRole {
  OWNER
  MANAGER
  STAFF
  VIEWER
}

enum MvmSubOrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum MvmCommissionStatus {
  PENDING
  PROCESSING
  CLEARED
  PAID
  DISPUTED
  REVERSED
}

enum MvmPayoutStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

enum MvmPayoutMethod {
  BANK_TRANSFER
  MOBILE_MONEY
  WALLET
}

// --------------------------------------------------------------------------
// MVM VENDOR - Core vendor/seller entity
// --------------------------------------------------------------------------
model mvm_vendor {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Identity
  name  String
  slug  String
  email String
  phone String?

  // Business Info
  legalName    String?
  taxId        String? // Nigerian TIN
  businessType String?
  description  String?
  logo         String?
  banner       String?

  // Address (Nigerian format)
  addressLine1 String?
  addressLine2 String?
  city         String?
  state        String? // Nigerian state
  postalCode   String?
  country      String  @default("NG")

  // Status & Lifecycle
  status         MvmVendorStatus   @default(PENDING_APPROVAL)
  onboardingStep MvmOnboardingStep @default(REGISTERED)
  isVerified     Boolean           @default(false)
  verifiedAt     DateTime?
  verifiedBy     String?

  // Tier & Commission
  tierId             String?
  commissionOverride Decimal? @db.Decimal(5, 2) // Override tier rate

  // Performance Metrics (denormalized for dashboard)
  totalSales    Decimal  @default(0) @db.Decimal(14, 2)
  totalOrders   Int      @default(0)
  averageRating Decimal? @db.Decimal(3, 2)
  reviewCount   Int      @default(0)

  // Bank Details for Payouts
  bankName      String?
  bankCode      String? // Nigerian bank code
  accountNumber String?
  accountName   String?

  // Approval Workflow
  approvedAt       DateTime?
  approvedBy       String?
  rejectedAt       DateTime?
  rejectedBy       String?
  rejectionReason  String?
  suspendedAt      DateTime?
  suspendedBy      String?
  suspensionReason String?

  // Metadata
  metadata  Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  tier            mvm_vendor_tier?      @relation(fields: [tierId], references: [id])
  staff           mvm_vendor_staff[]
  productMappings mvm_product_mapping[]
  subOrders       mvm_sub_order[]
  commissions     mvm_commission[]
  payouts         mvm_payout[]

  @@unique([tenantId, slug])
  @@unique([tenantId, email])
  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([status])
  @@index([tierId])
}

// --------------------------------------------------------------------------
// MVM VENDOR TIER - Performance-based commission tiers
// --------------------------------------------------------------------------
model mvm_vendor_tier {
  id       String @id @default(cuid())
  tenantId String

  // Tier Info
  name        String // e.g., "Bronze", "Silver", "Gold", "Platinum"
  code        String // e.g., "BRONZE", "SILVER"
  description String?

  // Commission (NGN)
  commissionRate Decimal @db.Decimal(5, 2) // e.g., 15.00 = 15%

  // Benefits
  priorityLevel Int    @default(0) // Higher = better placement
  featuredSlots Int    @default(0) // Number of featured product slots
  supportLevel  String @default("STANDARD") // STANDARD, PRIORITY, DEDICATED

  // Qualification Requirements
  minMonthlySales Decimal? @db.Decimal(14, 2) // Min monthly sales in NGN
  minRating       Decimal? @db.Decimal(3, 2) // Min average rating
  minOrderCount   Int? // Min total orders

  // Status
  isActive  Boolean @default(true)
  isDefault Boolean @default(false) // Default for new vendors
  sortOrder Int     @default(0)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  vendors mvm_vendor[]

  @@unique([tenantId, code])
  @@index([tenantId])
  @@index([isActive])
}

// --------------------------------------------------------------------------
// MVM VENDOR STAFF - Staff members for each vendor
// --------------------------------------------------------------------------
model mvm_vendor_staff {
  id       String @id @default(cuid())
  vendorId String

  // Identity
  email String
  name  String
  phone String?

  // Role & Permissions
  role        MvmVendorStaffRole @default(STAFF)
  permissions String[]           @default([])

  // Status
  isActive    Boolean   @default(true)
  invitedAt   DateTime?
  acceptedAt  DateTime?
  lastLoginAt DateTime?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  vendor mvm_vendor @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@unique([vendorId, email])
  @@index([vendorId])
  @@index([email])
}

// --------------------------------------------------------------------------
// MVM PRODUCT MAPPING - Maps Core products to vendors
// --------------------------------------------------------------------------
model mvm_product_mapping {
  id       String @id @default(cuid())
  tenantId String
  vendorId String

  // Product Reference (from Core catalog)
  productId String
  variantId String?

  // Vendor-specific Pricing (NGN)
  vendorPrice    Decimal? @db.Decimal(12, 2) // Vendor's selling price
  compareAtPrice Decimal? @db.Decimal(12, 2) // Strike-through price
  minPrice       Decimal? @db.Decimal(12, 2) // Floor price constraint
  maxPrice       Decimal? @db.Decimal(12, 2) // Ceiling price constraint

  // Stock Allocation
  allocatedStock Int? // Vendor's allocated qty

  // Commission Override
  commissionOverride Decimal? @db.Decimal(5, 2) // Override vendor/tier rate

  // Status
  isActive   Boolean @default(true)
  isFeatured Boolean @default(false)

  // Performance (denormalized)
  salesCount Int     @default(0)
  revenue    Decimal @default(0) @db.Decimal(14, 2)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  vendor mvm_vendor @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@unique([vendorId, productId, variantId])
  @@index([tenantId])
  @@index([vendorId])
  @@index([productId])
  @@index([isActive])
  @@index([isFeatured])
}

// --------------------------------------------------------------------------
// MVM PARENT ORDER - Customer's original order (before splitting)
// --------------------------------------------------------------------------
model mvm_parent_order {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Order Identity
  orderNumber String @unique

  // Customer
  customerId    String?
  customerEmail String
  customerPhone String?
  customerName  String?

  // Status
  status String @default("PENDING") // PENDING, SPLIT, COMPLETED, CANCELLED

  // Shipping Address (Nigerian format)
  shippingAddress Json
  billingAddress  Json?

  // Totals (NGN)
  currency      String  @default("NGN")
  subtotal      Decimal @db.Decimal(14, 2)
  discountTotal Decimal @default(0) @db.Decimal(12, 2)
  shippingTotal Decimal @default(0) @db.Decimal(12, 2)
  taxTotal      Decimal @default(0) @db.Decimal(12, 2) // 7.5% VAT
  grandTotal    Decimal @db.Decimal(14, 2)

  // Payment
  paymentMethod String? // CARD, BANK_TRANSFER, USSD, POD, MOBILE_MONEY
  paymentStatus String    @default("PENDING")
  paymentRef    String?
  paidAt        DateTime?

  // Promotion
  promotionCode String?
  promotionId   String?

  // Source
  channel      String  @default("WEB")
  sourceCartId String?
  ipAddress    String?
  userAgent    String?

  // Notes
  customerNotes String?
  internalNotes String?

  // Timestamps
  splitAt      DateTime? // When split into sub-orders
  completedAt  DateTime?
  cancelledAt  DateTime?
  cancelReason String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  // Relations
  items     mvm_parent_order_item[]
  subOrders mvm_sub_order[]

  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([customerId])
  @@index([customerEmail])
  @@index([status])
  @@index([paymentStatus])
  @@index([createdAt])
}

// --------------------------------------------------------------------------
// MVM PARENT ORDER ITEM - Line items before vendor split
// --------------------------------------------------------------------------
model mvm_parent_order_item {
  id            String @id @default(cuid())
  parentOrderId String

  // Vendor Attribution
  vendorId String

  // Product
  productId   String
  variantId   String?
  productName String // Denormalized
  variantName String?
  sku         String?
  imageUrl    String?

  // Quantity & Price (NGN)
  quantity  Int
  unitPrice Decimal @db.Decimal(12, 2)
  discount  Decimal @default(0) @db.Decimal(10, 2)
  tax       Decimal @default(0) @db.Decimal(10, 2)
  lineTotal Decimal @db.Decimal(14, 2)

  // Timestamps
  createdAt DateTime @default(now())

  // Relations
  parentOrder mvm_parent_order @relation(fields: [parentOrderId], references: [id], onDelete: Cascade)

  @@index([parentOrderId])
  @@index([vendorId])
  @@index([productId])
}

// --------------------------------------------------------------------------
// MVM SUB ORDER - Vendor-specific portion of an order
// --------------------------------------------------------------------------
model mvm_sub_order {
  id            String @id @default(cuid())
  tenantId      String
  parentOrderId String
  vendorId      String

  // Sub-Order Identity
  subOrderNumber String @unique

  // Status
  status MvmSubOrderStatus @default(PENDING)

  // Customer Info (sanitized - vendors see limited data)
  customerName    String?
  shippingCity    String?
  shippingState   String?
  shippingCountry String  @default("NG")

  // Totals (NGN)
  currency      String  @default("NGN")
  subtotal      Decimal @db.Decimal(14, 2)
  shippingTotal Decimal @default(0) @db.Decimal(12, 2)
  taxTotal      Decimal @default(0) @db.Decimal(12, 2)
  discountTotal Decimal @default(0) @db.Decimal(12, 2)
  grandTotal    Decimal @db.Decimal(14, 2)

  // Commission (calculated at order time)
  commissionRate   Decimal @db.Decimal(5, 2) // Rate applied
  commissionAmount Decimal @db.Decimal(12, 2) // Platform fee
  vendorPayout     Decimal @db.Decimal(14, 2) // Vendor receives

  // Fulfillment
  shippingMethod    String?
  shippingCarrier   String?
  trackingNumber    String?
  trackingUrl       String?
  shippedAt         DateTime?
  estimatedDelivery DateTime?
  deliveredAt       DateTime?

  // Workflow Timestamps
  confirmedAt  DateTime?
  confirmedBy  String?
  processingAt DateTime?
  cancelledAt  DateTime?
  cancelledBy  String?
  cancelReason String?

  // Notes
  vendorNotes String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  parentOrder mvm_parent_order     @relation(fields: [parentOrderId], references: [id], onDelete: Cascade)
  vendor      mvm_vendor           @relation(fields: [vendorId], references: [id])
  items       mvm_sub_order_item[]
  commission  mvm_commission?

  @@index([tenantId])
  @@index([parentOrderId])
  @@index([vendorId])
  @@index([status])
  @@index([createdAt])
}

// --------------------------------------------------------------------------
// MVM SUB ORDER ITEM - Line items for each vendor sub-order
// --------------------------------------------------------------------------
model mvm_sub_order_item {
  id         String @id @default(cuid())
  subOrderId String

  // Product
  productId   String
  variantId   String?
  productName String
  variantName String?
  sku         String?
  imageUrl    String?

  // Quantity & Price (NGN)
  quantity  Int
  unitPrice Decimal @db.Decimal(12, 2)
  discount  Decimal @default(0) @db.Decimal(10, 2)
  tax       Decimal @default(0) @db.Decimal(10, 2)
  lineTotal Decimal @db.Decimal(14, 2)

  // Fulfillment
  fulfilledQuantity Int @default(0)

  // Timestamps
  createdAt DateTime @default(now())

  // Relations
  subOrder mvm_sub_order @relation(fields: [subOrderId], references: [id], onDelete: Cascade)

  @@index([subOrderId])
  @@index([productId])
}

// --------------------------------------------------------------------------
// MVM COMMISSION - Track commission per sub-order
// --------------------------------------------------------------------------
model mvm_commission {
  id         String @id @default(cuid())
  tenantId   String
  subOrderId String @unique
  vendorId   String

  // Amounts (NGN)
  saleAmount       Decimal @db.Decimal(14, 2) // Gross sale
  vatAmount        Decimal @default(0) @db.Decimal(12, 2) // 7.5% VAT
  commissionRate   Decimal @db.Decimal(5, 2) // Rate applied
  commissionAmount Decimal @db.Decimal(12, 2) // Platform commission
  vendorPayout     Decimal @db.Decimal(14, 2) // Net to vendor

  // Status
  status MvmCommissionStatus @default(PENDING)

  // Clearing (commission clears after order delivered)
  clearsAt  DateTime? // When commission becomes clearable
  clearedAt DateTime? // When actually cleared

  // Payout Linkage
  payoutId String?
  paidAt   DateTime?

  // Dispute
  disputedAt      DateTime?
  disputedBy      String?
  disputeReason   String?
  resolvedAt      DateTime?
  resolvedBy      String?
  resolutionNotes String?

  // Reversal
  reversedAt     DateTime?
  reversedBy     String?
  reversalReason String?

  // Timestamps
  calculatedAt DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  subOrder mvm_sub_order @relation(fields: [subOrderId], references: [id], onDelete: Cascade)
  vendor   mvm_vendor    @relation(fields: [vendorId], references: [id])
  payout   mvm_payout?   @relation(fields: [payoutId], references: [id])

  @@index([tenantId])
  @@index([vendorId])
  @@index([status])
  @@index([payoutId])
  @@index([clearsAt])
}

// --------------------------------------------------------------------------
// MVM PAYOUT - Batch payouts to vendors
// --------------------------------------------------------------------------
model mvm_payout {
  id       String @id @default(cuid())
  tenantId String
  vendorId String

  // Payout Identity
  payoutNumber String @unique

  // Period
  periodStart DateTime
  periodEnd   DateTime

  // Amounts (NGN)
  currency    String  @default("NGN")
  grossAmount Decimal @db.Decimal(14, 2) // Total cleared commissions
  deductions  Decimal @default(0) @db.Decimal(12, 2) // Fees, adjustments
  netAmount   Decimal @db.Decimal(14, 2) // Final payout

  // Status
  status MvmPayoutStatus @default(PENDING)

  // Payment Details
  payoutMethod  MvmPayoutMethod @default(BANK_TRANSFER)
  bankName      String?
  bankCode      String?
  accountNumber String?
  accountName   String?

  // Processing
  scheduledAt   DateTime?
  processedAt   DateTime?
  completedAt   DateTime?
  failedAt      DateTime?
  failureReason String?

  // Reference
  paymentRef String? // Bank reference / transaction ID

  // Approval
  approvedAt DateTime?
  approvedBy String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  vendor      mvm_vendor       @relation(fields: [vendorId], references: [id])
  commissions mvm_commission[]

  @@index([tenantId])
  @@index([vendorId])
  @@index([status])
  @@index([periodStart, periodEnd])
  @@index([createdAt])
}

// --------------------------------------------------------------------------
// MVM MARKETPLACE CONFIG - Tenant-level marketplace settings
// --------------------------------------------------------------------------
model mvm_marketplace_config {
  id                 String  @id @default(cuid())
  tenantId           String  @unique
  platformInstanceId String?

  // Marketplace Info
  marketplaceName String?
  marketplaceSlug String?
  description     String?
  logo            String?

  // Default Commission (NGN)
  defaultCommissionRate Decimal @default(15.00) @db.Decimal(5, 2) // 15%
  vatRate               Decimal @default(7.50) @db.Decimal(5, 2) // 7.5% Nigerian VAT

  // Vendor Settings
  autoApproveVendors  Boolean @default(false)
  requireVerification Boolean @default(true)

  // Payout Settings
  payoutCycleDays Int     @default(14) // Bi-weekly
  minPayoutAmount Decimal @default(5000) @db.Decimal(12, 2) // 5,000 minimum
  clearanceDays   Int     @default(7) // Days after delivery

  // Features
  vendorPricing  Boolean @default(true) // Vendors can set prices
  vendorShipping Boolean @default(false) // Vendors handle shipping

  // Status
  isActive Boolean @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([platformInstanceId])
}

// ============================================================================
// EDUCATION SUITE (Platform Standardisation v2)
// ============================================================================
// Nigeria-first education management system
// - 3-term academic calendar (default)
// - Education fees are VAT-exempt
// - NGN currency assumed
// - Commerce Reuse: Education emits fee facts  Billing  Payments  Accounting
// ============================================================================

// --------------------------------------------------------------------------
// EDUCATION ENUMS
// --------------------------------------------------------------------------

enum EduStudentStatus {
  PROSPECTIVE // Applied, not yet enrolled
  ACTIVE // Currently enrolled
  SUSPENDED // Temporarily suspended
  WITHDRAWN // Left school voluntarily
  EXPELLED // Dismissed from school
  GRADUATED // Completed programme
  TRANSFERRED_OUT // Transferred to another school
}

enum EduEnrollmentStatus {
  PENDING // Application submitted
  APPROVED // Accepted, awaiting enrollment
  ENROLLED // Actively enrolled
  DEFERRED // Postponed start
  REJECTED // Application rejected
  CANCELLED // Enrollment cancelled
}

enum EduGuardianRelation {
  FATHER
  MOTHER
  GUARDIAN
  SPONSOR
  SIBLING
  GRANDPARENT
  UNCLE
  AUNT
  OTHER
}

enum EduTermNumber {
  TERM_1
  TERM_2
  TERM_3
}

enum EduSessionStatus {
  PLANNED // Future session
  ACTIVE // Current session
  COMPLETED // Past session
  ARCHIVED // Archived
}

enum EduTermStatus {
  PLANNED
  ACTIVE
  COMPLETED
  ARCHIVED
}

enum EduAttendanceStatus {
  PRESENT
  ABSENT
  LATE
  EXCUSED
  HALF_DAY
}

enum EduGradeScale {
  PERCENTAGE // 0-100
  LETTER_AF // A, B, C, D, E, F
  GPA_4 // 4.0 scale
  GPA_5 // 5.0 scale
  CUSTOM
}

enum EduAssessmentType {
  CONTINUOUS_ASSESSMENT
  TEST
  QUIZ
  ASSIGNMENT
  PROJECT
  MID_TERM_EXAM
  FINAL_EXAM
  PRACTICAL
}

enum EduResultStatus {
  DRAFT // Being entered
  SUBMITTED // Submitted by teacher
  APPROVED // Approved by admin
  RELEASED // Visible to parents
  LOCKED // Cannot be modified
}

enum EduFeeType {
  TUITION
  REGISTRATION
  DEVELOPMENT_LEVY
  PTA_DUES
  EXAM_FEE
  LAB_FEE
  LIBRARY_FEE
  SPORTS_FEE
  UNIFORM
  BOOKS
  TRANSPORT
  BOARDING
  OTHER
}

enum EduFeeAssignmentStatus {
  PENDING // Not yet billed
  BILLED // Invoice created in Billing Suite
  PARTIALLY_PAID // Some payment received
  PAID // Fully paid
  WAIVED // Fee waived
  CANCELLED // Cancelled
}

enum EduStaffRole {
  TEACHER
  CLASS_TEACHER
  HEAD_OF_DEPARTMENT
  VICE_PRINCIPAL
  PRINCIPAL
  BURSAR
  REGISTRAR
  LIBRARIAN
  COUNSELOR
  ADMIN
}

// --------------------------------------------------------------------------
// EDUCATION SESSION - Academic year (e.g., 2025/2026)
// --------------------------------------------------------------------------
model edu_session {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Session Identity
  name      String // e.g., "2025/2026 Academic Session"
  code      String // e.g., "2025-2026"
  startDate DateTime
  endDate   DateTime

  // Status
  status    EduSessionStatus @default(PLANNED)
  isCurrent Boolean          @default(false)

  // Nigeria-First: 3 terms default
  termCount Int @default(3)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  terms       edu_term[]
  enrollments edu_enrollment[]
  results     edu_result[]

  @@unique([tenantId, code])
  @@index([tenantId])
  @@index([status])
  @@index([isCurrent])
}

// --------------------------------------------------------------------------
// EDUCATION TERM - Term within a session
// --------------------------------------------------------------------------
model edu_term {
  id        String @id @default(cuid())
  tenantId  String
  sessionId String

  // Term Identity
  termNumber EduTermNumber
  name       String // e.g., "First Term"
  startDate  DateTime
  endDate    DateTime

  // Mid-term break (optional)
  midTermBreakStart DateTime?
  midTermBreakEnd   DateTime?

  // Status
  status    EduTermStatus @default(PLANNED)
  isCurrent Boolean       @default(false)

  // Result Settings
  resultReleaseDate DateTime?
  resultsLocked     Boolean   @default(false)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  session       edu_session         @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  attendances   edu_attendance[]
  assessments   edu_assessment[]
  results       edu_result[]
  feeStructures edu_fee_structure[]

  @@unique([sessionId, termNumber])
  @@index([tenantId])
  @@index([sessionId])
  @@index([status])
  @@index([isCurrent])
}

// --------------------------------------------------------------------------
// EDUCATION CLASS - Class/Level (e.g., JSS1, SS2, Year 1)
// --------------------------------------------------------------------------
model edu_class {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Class Identity
  name        String // e.g., "JSS 1", "SS 2", "Year 1"
  code        String // e.g., "JSS1", "SS2"
  level       Int // Numeric order (1, 2, 3...)
  description String?

  // Capacity
  capacity Int? // Max students

  // Class Teacher (optional)
  classTeacherId String?

  // Arms/Streams (e.g., JSS1A, JSS1B)
  arm String? // e.g., "A", "B", "Science", "Art"

  // Status
  isActive Boolean @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  classTeacher  edu_staff?          @relation("ClassTeacher", fields: [classTeacherId], references: [id])
  enrollments   edu_enrollment[]
  subjects      edu_class_subject[]
  attendances   edu_attendance[]
  assessments   edu_assessment[]
  results       edu_result[]
  feeStructures edu_fee_structure[]

  @@unique([tenantId, code, arm])
  @@index([tenantId])
  @@index([level])
  @@index([isActive])
}

// --------------------------------------------------------------------------
// EDUCATION SUBJECT - Subject/Course catalog
// --------------------------------------------------------------------------
model edu_subject {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Subject Identity
  name        String // e.g., "Mathematics"
  code        String // e.g., "MATH"
  shortName   String? // e.g., "Maths"
  description String?

  // Classification
  category     String? // e.g., "Science", "Arts", "Commercial"
  isCompulsory Boolean @default(false)
  creditUnits  Int? // For tertiary (optional)

  // Status
  isActive Boolean @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  classSubjects edu_class_subject[]
  assessments   edu_assessment[]
  results       edu_result[]

  @@unique([tenantId, code])
  @@index([tenantId])
  @@index([isActive])
}

// --------------------------------------------------------------------------
// EDUCATION CLASS SUBJECT - Subject-Class-Teacher mapping
// --------------------------------------------------------------------------
model edu_class_subject {
  id        String @id @default(cuid())
  tenantId  String
  classId   String
  subjectId String

  // Teacher Assignment
  teacherId String?

  // Assessment Weighting (Nigeria-first: CA 40%, Exam 60% default)
  caWeight   Decimal @default(40) @db.Decimal(5, 2)
  examWeight Decimal @default(60) @db.Decimal(5, 2)

  // Status
  isActive Boolean @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  class   edu_class   @relation(fields: [classId], references: [id], onDelete: Cascade)
  subject edu_subject @relation(fields: [subjectId], references: [id], onDelete: Cascade)
  teacher edu_staff?  @relation(fields: [teacherId], references: [id])

  @@unique([classId, subjectId])
  @@index([tenantId])
  @@index([classId])
  @@index([subjectId])
  @@index([teacherId])
}

// --------------------------------------------------------------------------
// EDUCATION STUDENT - Core student entity
// --------------------------------------------------------------------------
model edu_student {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Student Identity
  studentId  String // e.g., "STU-2025-0001"
  firstName  String
  lastName   String
  middleName String?
  fullName   String? // Computed/denormalized

  // Demographics
  dateOfBirth   DateTime?
  gender        String? // "M", "F", "Other"
  nationality   String    @default("Nigerian")
  stateOfOrigin String?
  lga           String? // Local Government Area

  // Contact
  email   String?
  phone   String?
  address String?
  city    String?
  state   String?

  // Medical (PII - restricted access)
  bloodGroup   String?
  genotype     String?
  allergies    String?
  medicalNotes String?

  // Photo
  photoUrl String?

  // Status
  status          EduStudentStatus @default(PROSPECTIVE)
  statusChangedAt DateTime?
  statusReason    String?

  // Admission
  admissionDate   DateTime?
  admissionNumber String?
  previousSchool  String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  guardians      edu_student_guardian[]
  enrollments    edu_enrollment[]
  attendances    edu_attendance[]
  assessments    edu_assessment[]
  results        edu_result[]
  feeAssignments edu_fee_assignment[]

  @@unique([tenantId, studentId])
  @@index([tenantId])
  @@index([status])
  @@index([firstName, lastName])
  @@index([admissionNumber])
}

// --------------------------------------------------------------------------
// EDUCATION GUARDIAN - Parent/Guardian entity
// --------------------------------------------------------------------------
model edu_guardian {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Guardian Identity
  firstName  String
  lastName   String
  middleName String?
  fullName   String? // Computed/denormalized

  // Contact (Nigeria-first: WhatsApp/SMS primary)
  email    String?
  phone    String // Required - primary contact
  whatsapp String? // WhatsApp number if different
  address  String?
  city     String?
  state    String?

  // Occupation (for records)
  occupation String?
  employer   String?

  // Communication Preferences
  preferSms      Boolean @default(true)
  preferEmail    Boolean @default(false)
  preferWhatsApp Boolean @default(true)

  // Status
  isActive Boolean @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  students edu_student_guardian[]

  @@index([tenantId])
  @@index([phone])
  @@index([email])
}

// --------------------------------------------------------------------------
// EDUCATION STUDENT-GUARDIAN LINK - Many-to-many with relationship type
// --------------------------------------------------------------------------
model edu_student_guardian {
  id         String @id @default(cuid())
  tenantId   String
  studentId  String
  guardianId String

  // Relationship
  relation  EduGuardianRelation @default(GUARDIAN)
  isPrimary Boolean             @default(false) // Primary contact
  canPickup Boolean             @default(true) // Authorized for pickup

  // Financial Responsibility
  isFinancialContact Boolean @default(false) // Bills sent to this guardian

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  student  edu_student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  guardian edu_guardian @relation(fields: [guardianId], references: [id], onDelete: Cascade)

  @@unique([studentId, guardianId])
  @@index([tenantId])
  @@index([studentId])
  @@index([guardianId])
  @@index([isPrimary])
}

// --------------------------------------------------------------------------
// EDUCATION STAFF - Teachers and administrative staff (light)
// --------------------------------------------------------------------------
model edu_staff {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Staff Identity
  staffId    String // e.g., "TCH-2025-001"
  firstName  String
  lastName   String
  middleName String?
  fullName   String?

  // Contact
  email String?
  phone String?

  // Role
  role           EduStaffRole @default(TEACHER)
  department     String?
  qualifications String?

  // Employment
  employmentDate DateTime?
  isActive       Boolean   @default(true)

  // Linked User (optional - for login)
  userId String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  classesAsTeacher   edu_class[]         @relation("ClassTeacher")
  subjectAssignments edu_class_subject[]
  attendancesMarked  edu_attendance[]
  assessmentsGraded  edu_assessment[]
  resultsApproved    edu_result[]        @relation("ResultApprover")

  @@unique([tenantId, staffId])
  @@index([tenantId])
  @@index([role])
  @@index([isActive])
  @@index([userId])
}

// --------------------------------------------------------------------------
// EDUCATION ENROLLMENT - Student-Class-Session enrollment
// --------------------------------------------------------------------------
model edu_enrollment {
  id        String @id @default(cuid())
  tenantId  String
  studentId String
  classId   String
  sessionId String

  // Enrollment Identity
  enrollmentNumber String? // e.g., "ENR-2025-0001"

  // Status
  status          EduEnrollmentStatus @default(PENDING)
  statusChangedAt DateTime?
  statusReason    String?

  // Dates
  enrollmentDate DateTime?
  withdrawalDate DateTime?

  // Repeat?
  isRepeating  Boolean @default(false)
  repeatReason String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  student edu_student @relation(fields: [studentId], references: [id], onDelete: Cascade)
  class   edu_class   @relation(fields: [classId], references: [id])
  session edu_session @relation(fields: [sessionId], references: [id])

  @@unique([studentId, classId, sessionId])
  @@index([tenantId])
  @@index([studentId])
  @@index([classId])
  @@index([sessionId])
  @@index([status])
}

// --------------------------------------------------------------------------
// EDUCATION FEE STRUCTURE - Fee definitions per class/term
// --------------------------------------------------------------------------
model edu_fee_structure {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Scope
  classId String? // If null, applies to all classes
  termId  String? // If null, applies to all terms (annual)

  // Fee Identity
  name        String // e.g., "Tuition Fee - JSS1 Term 1"
  feeType     EduFeeType
  description String?

  // Amount (NGN - Education is VAT-exempt)
  currency    String  @default("NGN")
  amount      Decimal @db.Decimal(12, 2)
  isVatExempt Boolean @default(true) // Nigeria: Education VAT-exempt

  // Payment Options
  allowInstallments Boolean @default(true)
  installmentCount  Int     @default(3) // Max installments

  // Due Date
  dueDate         DateTime?
  gracePeriodDays Int       @default(14)

  // Late Fee (optional)
  lateFeeAmount  Decimal? @db.Decimal(10, 2)
  lateFeePercent Decimal? @db.Decimal(5, 2)

  // Status
  isActive Boolean @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  class          edu_class?           @relation(fields: [classId], references: [id])
  term           edu_term?            @relation(fields: [termId], references: [id])
  feeAssignments edu_fee_assignment[]

  @@index([tenantId])
  @@index([classId])
  @@index([termId])
  @@index([feeType])
  @@index([isActive])
}

// --------------------------------------------------------------------------
// EDUCATION FEE ASSIGNMENT - Fee assigned to a student
// IMPORTANT: This is the "fact" that gets emitted to Billing Suite
// Education owns the fact; Billing owns the invoice
// --------------------------------------------------------------------------
model edu_fee_assignment {
  id             String @id @default(cuid())
  tenantId       String
  studentId      String
  feeStructureId String

  // Assignment Identity
  assignmentNumber String? // e.g., "FEE-2025-0001"

  // Amount (may differ from structure due to discount/waiver)
  originalAmount Decimal @db.Decimal(12, 2)
  discountAmount Decimal @default(0) @db.Decimal(12, 2)
  discountReason String? // e.g., "Sibling discount", "Scholarship"
  finalAmount    Decimal @db.Decimal(12, 2) // originalAmount - discountAmount

  // Status
  status EduFeeAssignmentStatus @default(PENDING)

  // Commerce Integration: Link to Billing Suite invoice
  // Education emits the fact, Billing creates the invoice
  billingInvoiceId  String? // Reference to billing_invoices.id
  billingInvoiceRef String? // Invoice number for display

  // Payment Tracking (denormalized from Billing for quick access)
  amountPaid        Decimal   @default(0) @db.Decimal(12, 2)
  amountOutstanding Decimal   @db.Decimal(12, 2)
  lastPaymentDate   DateTime?

  // Due Date
  dueDate DateTime?

  // Notes
  notes String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  student      edu_student       @relation(fields: [studentId], references: [id], onDelete: Cascade)
  feeStructure edu_fee_structure @relation(fields: [feeStructureId], references: [id])

  @@index([tenantId])
  @@index([studentId])
  @@index([feeStructureId])
  @@index([status])
  @@index([billingInvoiceId])
  @@index([dueDate])
}

// --------------------------------------------------------------------------
// EDUCATION ATTENDANCE - Daily attendance records
// --------------------------------------------------------------------------
model edu_attendance {
  id        String @id @default(cuid())
  tenantId  String
  studentId String
  classId   String
  termId    String

  // Date
  attendanceDate DateTime @db.Date

  // Status
  status EduAttendanceStatus @default(PRESENT)

  // Time (if tracking arrival time)
  arrivalTime   DateTime?
  departureTime DateTime?

  // Notes
  notes        String?
  excuseReason String? // If status is EXCUSED

  // Marked By
  markedById String?
  markedAt   DateTime @default(now())

  // Backfill tracking (for offline tolerance)
  isBackfilled Boolean   @default(false)
  backfilledAt DateTime?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  student  edu_student @relation(fields: [studentId], references: [id], onDelete: Cascade)
  class    edu_class   @relation(fields: [classId], references: [id])
  term     edu_term    @relation(fields: [termId], references: [id])
  markedBy edu_staff?  @relation(fields: [markedById], references: [id])

  @@unique([studentId, classId, attendanceDate])
  @@index([tenantId])
  @@index([studentId])
  @@index([classId])
  @@index([termId])
  @@index([attendanceDate])
  @@index([status])
}

// --------------------------------------------------------------------------
// EDUCATION ASSESSMENT - Individual assessment scores (CA, tests, exams)
// --------------------------------------------------------------------------
model edu_assessment {
  id        String @id @default(cuid())
  tenantId  String
  studentId String
  classId   String
  subjectId String
  termId    String

  // Assessment Identity
  assessmentType EduAssessmentType
  assessmentName String? // e.g., "First CA", "Mid-Term Exam"

  // Score
  maxScore Decimal @default(100) @db.Decimal(6, 2)
  score    Decimal @db.Decimal(6, 2)

  // Graded By
  gradedById String?
  gradedAt   DateTime?

  // Comments
  teacherComment String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  student  edu_student @relation(fields: [studentId], references: [id], onDelete: Cascade)
  class    edu_class   @relation(fields: [classId], references: [id])
  subject  edu_subject @relation(fields: [subjectId], references: [id])
  term     edu_term    @relation(fields: [termId], references: [id])
  gradedBy edu_staff?  @relation(fields: [gradedById], references: [id])

  @@index([tenantId])
  @@index([studentId])
  @@index([classId])
  @@index([subjectId])
  @@index([termId])
  @@index([assessmentType])
}

// --------------------------------------------------------------------------
// EDUCATION RESULT - Computed term result per subject
// Append-only design for transcript integrity
// --------------------------------------------------------------------------
model edu_result {
  id        String @id @default(cuid())
  tenantId  String
  studentId String
  classId   String
  subjectId String
  termId    String
  sessionId String

  // Scores (computed from assessments)
  caScore      Decimal @db.Decimal(6, 2) // Total CA score
  caMaxScore   Decimal @default(40) @db.Decimal(6, 2)
  examScore    Decimal @db.Decimal(6, 2) // Exam score
  examMaxScore Decimal @default(60) @db.Decimal(6, 2)
  totalScore   Decimal @db.Decimal(6, 2) // CA + Exam

  // Grade (computed based on grading scale)
  grade      String? // e.g., "A", "B1", "C4"
  gradePoint Decimal? @db.Decimal(3, 2) // e.g., 4.0, 3.5
  remark     String? // e.g., "Excellent", "Good", "Fair"

  // Position (optional - culturally expected in Nigeria)
  classPosition Int? // Position in class for this subject
  classSize     Int? // Total students in class

  // Status (for approval workflow)
  status EduResultStatus @default(DRAFT)

  // Approval
  submittedAt   DateTime?
  submittedById String?
  approvedAt    DateTime?
  approvedById  String?
  releasedAt    DateTime?

  // Teacher Comment
  teacherComment String?

  // Lock for transcript integrity
  isLocked     Boolean   @default(false)
  lockedAt     DateTime?
  lockedReason String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  student    edu_student @relation(fields: [studentId], references: [id], onDelete: Cascade)
  class      edu_class   @relation(fields: [classId], references: [id])
  subject    edu_subject @relation(fields: [subjectId], references: [id])
  term       edu_term    @relation(fields: [termId], references: [id])
  session    edu_session @relation(fields: [sessionId], references: [id])
  approvedBy edu_staff?  @relation("ResultApprover", fields: [approvedById], references: [id])

  @@unique([studentId, subjectId, termId])
  @@index([tenantId])
  @@index([studentId])
  @@index([classId])
  @@index([subjectId])
  @@index([termId])
  @@index([sessionId])
  @@index([status])
  @@index([isLocked])
}

// --------------------------------------------------------------------------
// EDUCATION GRADING SCALE - Configurable grading rules per institution
// --------------------------------------------------------------------------
model edu_grading_scale {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Scale Identity
  name      String // e.g., "Standard Secondary Grading"
  scaleType EduGradeScale @default(LETTER_AF)

  // Is Default for this tenant?
  isDefault Boolean @default(false)

  // Grade Boundaries (stored as JSON for flexibility)
  // Format: [{ "grade": "A", "minScore": 70, "maxScore": 100, "gradePoint": 4.0, "remark": "Excellent" }, ...]
  boundaries Json

  // Status
  isActive Boolean @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tenantId])
  @@index([isDefault])
  @@index([isActive])
}

// --------------------------------------------------------------------------
// EDUCATION CONFIG - Tenant-level education settings
// --------------------------------------------------------------------------
model edu_config {
  id                 String  @id @default(cuid())
  tenantId           String  @unique
  platformInstanceId String?

  // Institution Info
  institutionName String?
  institutionType String? // "Primary", "Secondary", "Tertiary", "Training"
  institutionCode String?
  motto           String?
  logo            String?

  // Academic Settings
  defaultTermCount Int     @default(3) // Nigeria: 3 terms
  currentSessionId String?
  currentTermId    String?

  // Grading Settings
  defaultGradingScaleId String?
  defaultCaWeight       Decimal @default(40) @db.Decimal(5, 2)
  defaultExamWeight     Decimal @default(60) @db.Decimal(5, 2)
  showPositions         Boolean @default(true) // Show class position

  // Fee Settings
  blockResultsOnOutstanding Boolean @default(true) // Block results if fees unpaid
  sendFeeReminders          Boolean @default(true)
  reminderDaysBefore        Int     @default(7)

  // Communication
  sendSmsNotifications      Boolean @default(true)
  sendEmailNotifications    Boolean @default(false)
  sendWhatsAppNotifications Boolean @default(true)

  // ID Generation
  studentIdPrefix  String @default("STU")
  staffIdPrefix    String @default("TCH")
  studentIdNextSeq Int    @default(1)
  staffIdNextSeq   Int    @default(1)

  // Status
  isActive Boolean @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([platformInstanceId])
  @@index([currentSessionId])
}

// ==========================================================================
// HEALTH SUITE - Clinics, Hospitals, Diagnostic Centers
// Platform Standardisation v2 Compliant - S2 Schema
// Nigeria-First, Append-Only Clinical Records, Commerce Reuse Boundary
// ==========================================================================

// --------------------------------------------------------------------------
// HEALTH ENUMS
// --------------------------------------------------------------------------

enum HealthPatientStatus {
  ACTIVE
  INACTIVE
  DECEASED
  TRANSFERRED
}

enum HealthGender {
  MALE
  FEMALE
  OTHER
}

enum HealthBloodGroup {
  A_POSITIVE
  A_NEGATIVE
  B_POSITIVE
  B_NEGATIVE
  AB_POSITIVE
  AB_NEGATIVE
  O_POSITIVE
  O_NEGATIVE
  UNKNOWN
}

enum HealthGenotype {
  AA
  AS
  SS
  AC
  SC
  CC
  UNKNOWN
}

enum HealthFacilityType {
  CLINIC
  HOSPITAL
  DIAGNOSTIC_CENTER
  PHARMACY
  LABORATORY
  IMAGING_CENTER
}

enum HealthProviderRole {
  DOCTOR
  NURSE
  PHARMACIST
  LAB_TECHNICIAN
  RADIOLOGIST
  RECEPTIONIST
  ADMIN
  CONSULTANT
}

enum HealthAppointmentStatus {
  SCHEDULED
  CONFIRMED
  CHECKED_IN
  IN_PROGRESS
  COMPLETED
  CANCELLED
  NO_SHOW
  RESCHEDULED
}

enum HealthAppointmentType {
  CONSULTATION
  FOLLOW_UP
  PROCEDURE
  LAB_TEST
  IMAGING
  VACCINATION
  EMERGENCY
  WALK_IN
}

enum HealthVisitStatus {
  REGISTERED
  WAITING
  IN_CONSULTATION
  IN_LAB
  IN_PHARMACY
  COMPLETED
  DISCHARGED
  REFERRED
}

enum HealthEncounterStatus {
  IN_PROGRESS
  COMPLETED
  AMENDED
}

enum HealthDiagnosisType {
  PRIMARY
  SECONDARY
  DIFFERENTIAL
  RULED_OUT
}

enum HealthDiagnosisStatus {
  ACTIVE
  RESOLVED
  CHRONIC
  RULED_OUT
}

enum HealthNoteType {
  CHIEF_COMPLAINT
  HISTORY
  EXAMINATION
  ASSESSMENT
  PLAN
  PROGRESS
  PROCEDURE
  DISCHARGE
  AMENDMENT
}

enum HealthPrescriptionStatus {
  ACTIVE
  DISPENSED
  PARTIALLY_DISPENSED
  CANCELLED
  EXPIRED
}

enum HealthLabOrderStatus {
  ORDERED
  SAMPLE_COLLECTED
  PROCESSING
  COMPLETED
  CANCELLED
  REJECTED
}

enum HealthLabOrderUrgency {
  ROUTINE
  URGENT
  STAT
}

enum HealthResultInterpretation {
  NORMAL
  ABNORMAL
  CRITICAL
  INCONCLUSIVE
}

enum HealthBillingFactType {
  CONSULTATION
  PROCEDURE
  LAB_TEST
  IMAGING
  MEDICATION
  SUPPLIES
  ADMISSION
  OTHER
}

enum HealthBillingFactStatus {
  PENDING
  BILLED
  WAIVED
  CANCELLED
}

// --------------------------------------------------------------------------
// HEALTH FACILITY - Clinic, Hospital, Diagnostic Center
// --------------------------------------------------------------------------
model health_facility {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Facility Identity
  name        String
  code        String? // Internal facility code
  type        HealthFacilityType
  description String?

  // Contact
  phone    String?
  email    String?
  address  Json? // { street, city, state, lga, country }
  location Json? // { lat, lng }

  // Operations
  operatingHours Json? // { monday: { open, close }, ... }
  isActive       Boolean @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  providers    health_provider[]
  appointments health_appointment[]
  visits       health_visit[]
  encounters   health_encounter[]

  @@unique([tenantId, code])
  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([type])
}

// --------------------------------------------------------------------------
// HEALTH PROVIDER - Doctors, Nurses, Staff
// --------------------------------------------------------------------------
model health_provider {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Provider Identity
  firstName      String
  lastName       String
  title          String? // Dr., Nurse, etc.
  role           HealthProviderRole
  specialty      String? // e.g., "General Practice", "Pediatrics"
  licenseNumber  String? // MDCN, Nursing Council, etc.
  qualifications String?

  // Contact
  phone String?
  email String?

  // Assignment
  facilityId String?
  facility   health_facility? @relation(fields: [facilityId], references: [id])

  // Status
  isActive Boolean @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  appointments  health_appointment[]
  visits        health_visit[]
  encounters    health_encounter[]
  prescriptions health_prescription[]
  labOrders     health_lab_order[]

  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([facilityId])
  @@index([role])
  @@index([specialty])
}

// --------------------------------------------------------------------------
// HEALTH PATIENT - Patient Registry (Privacy-First)
// --------------------------------------------------------------------------
model health_patient {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Patient Identity (Minimal PII)
  mrn        String // Medical Record Number (facility-specific)
  firstName  String
  lastName   String
  middleName String?

  // Demographics
  dateOfBirth DateTime?
  gender      HealthGender?
  bloodGroup  HealthBloodGroup @default(UNKNOWN)
  genotype    HealthGenotype   @default(UNKNOWN)

  // Contact (Privacy-Sensitive)
  phone   String?
  email   String?
  address Json? // { street, city, state, lga, country }

  // Nigerian Identity (Optional)
  nationalId String? // NIN

  // Emergency Contact / Next of Kin
  nextOfKin Json? // { name, relationship, phone, address }

  // Medical Alerts
  allergies  Json? // Array of known allergies
  conditions Json? // Array of chronic conditions

  // Status
  status   HealthPatientStatus @default(ACTIVE)
  isActive Boolean             @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  guardians     health_patient_guardian[]
  appointments  health_appointment[]
  visits        health_visit[]
  encounters    health_encounter[]
  prescriptions health_prescription[]
  labOrders     health_lab_order[]
  billingFacts  health_billing_fact[]

  @@unique([tenantId, mrn])
  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([status])
  @@index([lastName, firstName])
}

// --------------------------------------------------------------------------
// HEALTH PATIENT GUARDIAN - For Minors/Dependents
// --------------------------------------------------------------------------
model health_patient_guardian {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Links
  patientId String
  patient   health_patient @relation(fields: [patientId], references: [id], onDelete: Cascade)

  // Guardian Info
  fullName     String
  relationship String // Parent, Spouse, Sibling, etc.
  phone        String
  email        String?
  address      Json?

  // Consent
  isPrimaryContact Boolean @default(false)
  canAuthorize     Boolean @default(true) // Can authorize treatment

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tenantId])
  @@index([patientId])
}

// --------------------------------------------------------------------------
// HEALTH APPOINTMENT - Scheduled Visits
// --------------------------------------------------------------------------
model health_appointment {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Patient
  patientId String
  patient   health_patient @relation(fields: [patientId], references: [id])

  // Provider
  providerId String?
  provider   health_provider? @relation(fields: [providerId], references: [id])

  // Facility
  facilityId String?
  facility   health_facility? @relation(fields: [facilityId], references: [id])

  // Scheduling
  appointmentDate DateTime
  appointmentTime String? // "09:00", "14:30"
  duration        Int      @default(30) // minutes

  // Type & Status
  type     HealthAppointmentType   @default(CONSULTATION)
  status   HealthAppointmentStatus @default(SCHEDULED)
  isWalkIn Boolean                 @default(false)

  // Details
  reason String? // Chief complaint / reason for visit
  notes  String?

  // Confirmation
  confirmedAt DateTime?
  confirmedBy String?
  checkedInAt DateTime?

  // Cancellation
  cancelledAt        DateTime?
  cancelledBy        String?
  cancellationReason String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  visit health_visit?

  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([patientId])
  @@index([providerId])
  @@index([facilityId])
  @@index([appointmentDate])
  @@index([status])
}

// --------------------------------------------------------------------------
// HEALTH VISIT - Patient Visit Instance (Walk-in or Scheduled)
// --------------------------------------------------------------------------
model health_visit {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Patient
  patientId String
  patient   health_patient @relation(fields: [patientId], references: [id])

  // Appointment (optional - null for walk-ins)
  appointmentId String?             @unique
  appointment   health_appointment? @relation(fields: [appointmentId], references: [id])

  // Provider
  providerId String?
  provider   health_provider? @relation(fields: [providerId], references: [id])

  // Facility
  facilityId String?
  facility   health_facility? @relation(fields: [facilityId], references: [id])

  // Visit Info
  visitNumber String // Auto-generated visit number
  visitDate   DateTime @default(now())
  isWalkIn    Boolean  @default(false)

  // Chief Complaint
  chiefComplaint String?

  // Status
  status HealthVisitStatus @default(REGISTERED)

  // Timing
  registeredAt   DateTime  @default(now())
  consultStartAt DateTime?
  consultEndAt   DateTime?
  dischargedAt   DateTime?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  encounters   health_encounter[]
  billingFacts health_billing_fact[]

  @@unique([tenantId, visitNumber])
  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([patientId])
  @@index([providerId])
  @@index([facilityId])
  @@index([visitDate])
  @@index([status])
}

// --------------------------------------------------------------------------
// HEALTH CLINICAL ENCOUNTER - Append-Only Clinical Documentation
// --------------------------------------------------------------------------
model health_encounter {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Patient
  patientId String
  patient   health_patient @relation(fields: [patientId], references: [id])

  // Visit
  visitId String
  visit   health_visit @relation(fields: [visitId], references: [id])

  // Provider
  providerId String
  provider   health_provider @relation(fields: [providerId], references: [id])

  // Facility
  facilityId String?
  facility   health_facility? @relation(fields: [facilityId], references: [id])

  // Encounter Info
  encounterDate DateTime @default(now())

  // Vitals (Snapshot at encounter time)
  vitals Json? // { bloodPressure, temperature, pulse, weight, height, spo2, respiratoryRate }

  // Status (APPEND-ONLY: Can only progress, never go back)
  status HealthEncounterStatus @default(IN_PROGRESS)

  // Completion
  completedAt DateTime?
  completedBy String?

  // Amendment (for corrections - creates audit trail)
  amendedAt       DateTime?
  amendedBy       String?
  amendmentReason String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations (All append-only)
  notes         health_note[]
  diagnoses     health_diagnosis[]
  prescriptions health_prescription[]
  labOrders     health_lab_order[]
  billingFacts  health_billing_fact[]

  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([patientId])
  @@index([visitId])
  @@index([providerId])
  @@index([encounterDate])
  @@index([status])
}

// --------------------------------------------------------------------------
// HEALTH NOTE - Clinical Notes (Append-Only, Immutable)
// --------------------------------------------------------------------------
model health_note {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Encounter
  encounterId String
  encounter   health_encounter @relation(fields: [encounterId], references: [id])

  // Note Details
  noteType HealthNoteType
  content  String         @db.Text // Full note content

  // Author
  authorId   String // Provider ID
  authorName String // Denormalized for audit

  // Amendment (notes are never edited, only amended)
  amendsNoteId String? // If this note amends a previous note

  // Timestamps (IMMUTABLE after creation)
  createdAt DateTime @default(now())

  @@index([tenantId])
  @@index([encounterId])
  @@index([noteType])
  @@index([authorId])
  @@index([amendsNoteId])
}

// --------------------------------------------------------------------------
// HEALTH DIAGNOSIS - Diagnosis Facts (Append-Only)
// --------------------------------------------------------------------------
model health_diagnosis {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Encounter
  encounterId String
  encounter   health_encounter @relation(fields: [encounterId], references: [id])

  // Diagnosis (ICD-10)
  icdCode     String? // ICD-10 code (optional)
  description String // Human-readable diagnosis

  // Classification
  type   HealthDiagnosisType   @default(PRIMARY)
  status HealthDiagnosisStatus @default(ACTIVE)

  // Clinical Context
  onsetDate       DateTime? // When symptoms started
  diagnosedAt     DateTime  @default(now())
  diagnosedBy     String // Provider ID
  diagnosedByName String // Denormalized

  // Resolution (for resolved diagnoses)
  resolvedAt     DateTime?
  resolvedBy     String?
  resolutionNote String?

  // Timestamps (IMMUTABLE)
  createdAt DateTime @default(now())

  @@index([tenantId])
  @@index([encounterId])
  @@index([icdCode])
  @@index([status])
  @@index([diagnosedAt])
}

// --------------------------------------------------------------------------
// HEALTH PRESCRIPTION - Prescription Facts (No Fulfillment)
// --------------------------------------------------------------------------
model health_prescription {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Patient
  patientId String
  patient   health_patient @relation(fields: [patientId], references: [id])

  // Encounter
  encounterId String
  encounter   health_encounter @relation(fields: [encounterId], references: [id])

  // Prescriber
  prescriberId String
  prescriber   health_provider @relation(fields: [prescriberId], references: [id])

  // Medication Details
  medication   String // Drug name
  dosage       String // e.g., "500mg"
  frequency    String // e.g., "3 times daily"
  duration     String // e.g., "7 days"
  quantity     Int? // Number of units
  route        String? // e.g., "Oral", "IV", "IM"
  instructions String? // Special instructions

  // Status (Fact-based, not fulfillment)
  status HealthPrescriptionStatus @default(ACTIVE)

  // Timestamps
  prescribedAt DateTime  @default(now())
  expiresAt    DateTime? // Prescription validity

  // Dispensing (recorded by external pharmacy or internal callback)
  dispensedAt    DateTime?
  dispensedBy    String?
  dispensingNote String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([patientId])
  @@index([encounterId])
  @@index([prescriberId])
  @@index([status])
  @@index([prescribedAt])
}

// --------------------------------------------------------------------------
// HEALTH LAB ORDER - Lab/Diagnostic Orders (Facts Only)
// --------------------------------------------------------------------------
model health_lab_order {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Patient
  patientId String
  patient   health_patient @relation(fields: [patientId], references: [id])

  // Encounter
  encounterId String
  encounter   health_encounter @relation(fields: [encounterId], references: [id])

  // Ordering Provider
  orderedById String
  orderedBy   health_provider @relation(fields: [orderedById], references: [id])

  // Test Details
  testName String // e.g., "Complete Blood Count"
  testCode String? // Lab code
  testType String? // "Blood", "Urine", "Imaging", "Pathology"

  // Order Info
  urgency      HealthLabOrderUrgency @default(ROUTINE)
  clinicalInfo String? // Clinical information for lab

  // Status
  status HealthLabOrderStatus @default(ORDERED)

  // Timing
  orderedAt         DateTime  @default(now())
  sampleCollectedAt DateTime?
  processedAt       DateTime?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  results health_lab_result[]

  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([patientId])
  @@index([encounterId])
  @@index([orderedById])
  @@index([status])
  @@index([orderedAt])
}

// --------------------------------------------------------------------------
// HEALTH LAB RESULT - Lab Results (Append-Only, Immutable)
// --------------------------------------------------------------------------
model health_lab_result {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Lab Order
  labOrderId String
  labOrder   health_lab_order @relation(fields: [labOrderId], references: [id])

  // Result Details
  parameterName  String // e.g., "Hemoglobin", "WBC"
  resultValue    String // The actual result
  unit           String? // e.g., "g/dL", "cells/L"
  referenceRange String? // e.g., "12.0 - 16.0"

  // Interpretation
  interpretation HealthResultInterpretation @default(NORMAL)
  comment        String? // Pathologist comments

  // Resulted By
  resultedAt     DateTime @default(now())
  resultedBy     String? // Lab technician ID
  resultedByName String? // Denormalized

  // Verification
  verifiedAt     DateTime?
  verifiedBy     String?
  verifiedByName String?

  // Timestamps (IMMUTABLE after creation)
  createdAt DateTime @default(now())

  @@index([tenantId])
  @@index([labOrderId])
  @@index([interpretation])
  @@index([resultedAt])
}

// --------------------------------------------------------------------------
// HEALTH BILLING FACT - Care Facts for Commerce (FACT ONLY, NO MONEY)
// --------------------------------------------------------------------------
model health_billing_fact {
  id                 String  @id @default(cuid())
  tenantId           String
  platformInstanceId String?

  // Patient
  patientId String
  patient   health_patient @relation(fields: [patientId], references: [id])

  // Visit (optional)
  visitId String?
  visit   health_visit? @relation(fields: [visitId], references: [id])

  // Encounter (optional)
  encounterId String?
  encounter   health_encounter? @relation(fields: [encounterId], references: [id])

  // Billing Fact Details
  factType    HealthBillingFactType
  description String // e.g., "General Consultation", "CBC Test"
  code        String? // Service code (if applicable)

  // Amount (FACT ONLY - Health does NOT calculate totals)
  amount   Decimal @db.Decimal(15, 2) // Unit amount in NGN
  quantity Int     @default(1)
  // NOTE: Health does NOT apply VAT (healthcare is VAT-exempt)

  // Provider (who rendered the service)
  providerId   String?
  providerName String? // Denormalized

  // Service Date
  serviceDate DateTime @default(now())

  // Status (Commerce handles actual billing)
  status HealthBillingFactStatus @default(PENDING)

  // Commerce Link (populated when billed)
  billingInvoiceId String? // Link to Commerce Billing invoice
  billedAt         DateTime?

  // Waiver (if fee waived)
  waivedAt     DateTime?
  waivedBy     String?
  waiverReason String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tenantId])
  @@index([platformInstanceId])
  @@index([patientId])
  @@index([visitId])
  @@index([encounterId])
  @@index([factType])
  @@index([status])
  @@index([serviceDate])
  @@index([billingInvoiceId])
}

// --------------------------------------------------------------------------
// HEALTH CONFIG - Tenant-level Health Suite Configuration
// --------------------------------------------------------------------------
model health_config {
  id                 String  @id @default(cuid())
  tenantId           String  @unique
  platformInstanceId String?

  // Facility Info
  facilityName    String?
  facilityType    HealthFacilityType?
  facilityCode    String?
  facilityLicense String? // Operating license

  // ID Generation
  patientMrnPrefix   String @default("MRN")
  patientMrnNextSeq  Int    @default(1)
  visitNumberPrefix  String @default("VST")
  visitNumberNextSeq Int    @default(1)

  // Appointment Settings
  defaultAppointmentDuration Int     @default(30) // minutes
  allowWalkIns               Boolean @default(true)
  allowOnlineBooking         Boolean @default(false)

  // Clinical Settings
  requireVitalsOnEncounter Boolean @default(true)
  requireDiagnosisOnClose  Boolean @default(false)

  // Billing Settings (Commerce reuse)
  autoCreateBillingFacts Boolean @default(true)
  defaultConsultationFee Decimal @default(5000) @db.Decimal(15, 2) // NGN

  // Privacy Settings (Strong defaults)
  requireConsentOnRegistration Boolean @default(true)
  allowPatientPortalAccess     Boolean @default(false)

  // Status
  isActive Boolean @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([platformInstanceId])
}


// ==========================================================================
// HOSPITALITY SUITE - Nigeria-First Hotel & Restaurant Operations
// ==========================================================================
// Platform Standardisation v2 - S2 Schema
// Commerce Boundary: Emits charge facts only  Billing  Payments  Accounting
// ==========================================================================

// --------------------------------------------------------------------------
// HOSPITALITY ENUMS
// --------------------------------------------------------------------------

enum HospitalityVenueType {
  RESTAURANT
  HOTEL
  GUEST_HOUSE
  SHORT_LET
  CAFE
  BAR
  LOUNGE
  BEACH_RESORT
  EVENT_CENTER
}

enum HospitalityRoomType {
  STANDARD
  DELUXE
  EXECUTIVE
  SUITE
  PRESIDENTIAL
  STUDIO
  APARTMENT
  DORMITORY
}

enum HospitalityTableStatus {
  AVAILABLE
  OCCUPIED
  RESERVED
  CLEANING
  OUT_OF_SERVICE
}

enum HospitalityRoomStatus {
  AVAILABLE
  OCCUPIED
  DIRTY
  CLEANING
  MAINTENANCE
  OUT_OF_ORDER
  BLOCKED
}

enum HospitalityReservationType {
  TABLE
  ROOM
}

enum HospitalityReservationStatus {
  PENDING
  CONFIRMED
  CHECKED_IN
  COMPLETED
  CANCELLED
  NO_SHOW
}

enum HospitalityStayStatus {
  RESERVED
  CHECKED_IN
  IN_HOUSE
  CHECKED_OUT
  NO_SHOW
  CANCELLED
  EXTENDED
}

enum HospitalityOrderType {
  DINE_IN
  TAKEAWAY
  ROOM_SERVICE
  DELIVERY
}

enum HospitalityOrderStatus {
  PLACED
  CONFIRMED
  PREPARING
  READY
  SERVED
  COMPLETED
  CANCELLED
}

enum HospitalityOrderItemStatus {
  PENDING
  PREPARING
  READY
  SERVED
  CANCELLED
}

enum HospitalityServiceEventType {
  HOUSEKEEPING
  MAINTENANCE
  LAUNDRY
  ROOM_SERVICE
  CONCIERGE
  WAKE_UP_CALL
  MINIBAR_REFILL
}

enum HospitalityServiceEventStatus {
  REQUESTED
  ASSIGNED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum HospitalityStaffRole {
  MANAGER
  SUPERVISOR
  RECEPTIONIST
  WAITER
  CHEF
  COOK
  BARTENDER
  HOUSEKEEPING
  MAINTENANCE
  SECURITY
  CONCIERGE
  PORTER
}

enum HospitalityShiftType {
  MORNING
  AFTERNOON
  NIGHT
  SPLIT
  FULL_DAY
}

enum HospitalityShiftStatus {
  SCHEDULED
  ACTIVE
  COMPLETED
  CANCELLED
  NO_SHOW
}

enum HospitalityChargeFactType {
  ROOM_NIGHT
  FOOD_BEVERAGE
  ROOM_SERVICE
  SERVICE_CHARGE
  MINIBAR
  LAUNDRY
  PARKING
  SPA
  LATE_CHECKOUT
  EARLY_CHECKIN
  CANCELLATION_FEE
  DAMAGE
  OTHER
}

enum HospitalityChargeFactStatus {
  PENDING
  BILLED
  WAIVED
  CANCELLED
}

// --------------------------------------------------------------------------
// HOSPITALITY CONFIG - Tenant-level Configuration
// --------------------------------------------------------------------------
model hospitality_config {
  id                 String  @id @default(cuid())
  tenantId           String  @unique
  platformInstanceId String?

  // Venue Info
  venueName String?
  venueType HospitalityVenueType?
  venueCode String?

  // ID Generation
  guestIdPrefix       String @default("GST")
  guestIdNextSeq      Int    @default(1)
  reservationPrefix   String @default("RES")
  reservationNextSeq  Int    @default(1)
  orderPrefix         String @default("ORD")
  orderNextSeq        Int    @default(1)
  stayNumberPrefix    String @default("STY")
  stayNumberNextSeq   Int    @default(1)

  // Reservation Settings
  defaultTableReservationDuration Int     @default(120) // minutes
  defaultCheckInTime              String  @default("14:00")
  defaultCheckOutTime             String  @default("12:00")
  allowWalkIns                    Boolean @default(true)
  allowOnlineBooking              Boolean @default(false)
  requireDeposit                  Boolean @default(false)
  depositPercent                  Int     @default(50)

  // Service Settings
  defaultServiceChargePercent Int     @default(10)
  autoAddServiceCharge        Boolean @default(true)
  allowSplitBills             Boolean @default(true)
  allowPartialPayments        Boolean @default(true)

  // Room Settings (Hotel)
  lateCheckoutFee    Decimal @default(5000) @db.Decimal(15, 2)
  earlyCheckinFee    Decimal @default(5000) @db.Decimal(15, 2)
  cancellationHours  Int     @default(24)

  // Billing Settings (Commerce reuse)
  autoCreateChargeFacts Boolean @default(true)

  // Status
  isActive Boolean @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([platformInstanceId])
}

// --------------------------------------------------------------------------
// HOSPITALITY VENUE - Hotels, Restaurants, etc.
// --------------------------------------------------------------------------
model hospitality_venue {
  id       String @id @default(cuid())
  tenantId String

  name        String
  code        String?
  type        HospitalityVenueType
  description String?

  // Contact
  phone String?
  email String?

  // Address (JSON for flexibility)
  address Json?

  // Operating Hours (JSON)
  operatingHours Json?

  // Capacity
  totalTables Int @default(0)
  totalRooms  Int @default(0)
  totalSeats  Int @default(0)

  // Status
  isActive Boolean @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  floors       hospitality_floor[]
  tables       hospitality_table[]
  rooms        hospitality_room[]
  staff        hospitality_staff[]
  reservations hospitality_reservation[]
  orders       hospitality_order[]
  stays        hospitality_stay[]

  @@unique([tenantId, code])
  @@index([tenantId])
  @@index([type])
}

// --------------------------------------------------------------------------
// HOSPITALITY FLOOR - Floor/Area Organization
// --------------------------------------------------------------------------
model hospitality_floor {
  id       String @id @default(cuid())
  tenantId String
  venueId  String

  name        String // e.g., "Ground Floor", "VIP Section", "Pool Area"
  code        String?
  floorNumber Int?
  description String?

  // Status
  isActive Boolean @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  venue  hospitality_venue   @relation(fields: [venueId], references: [id])
  tables hospitality_table[]
  rooms  hospitality_room[]

  @@unique([tenantId, venueId, code])
  @@index([tenantId])
  @@index([venueId])
}

// --------------------------------------------------------------------------
// HOSPITALITY TABLE - Restaurant Tables
// --------------------------------------------------------------------------
model hospitality_table {
  id       String @id @default(cuid())
  tenantId String
  venueId  String
  floorId  String?

  tableNumber String
  capacity    Int    @default(4)
  minCapacity Int    @default(1)

  // Location
  location    String? // e.g., "Near window", "Private corner"
  coordinates Json?   // For floor plan mapping

  // Status
  status   HospitalityTableStatus @default(AVAILABLE)
  isActive Boolean                @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  venue        hospitality_venue         @relation(fields: [venueId], references: [id])
  floor        hospitality_floor?        @relation(fields: [floorId], references: [id])
  reservations hospitality_reservation[]
  orders       hospitality_order[]

  @@unique([tenantId, venueId, tableNumber])
  @@index([tenantId])
  @@index([venueId])
  @@index([status])
}

// --------------------------------------------------------------------------
// HOSPITALITY ROOM - Hotel Rooms
// --------------------------------------------------------------------------
model hospitality_room {
  id       String @id @default(cuid())
  tenantId String
  venueId  String
  floorId  String?

  roomNumber String
  roomType   HospitalityRoomType @default(STANDARD)
  bedCount   Int                 @default(1)
  bedType    String?             // e.g., "King", "Twin", "Queen"

  // Capacity
  maxOccupancy Int @default(2)
  maxAdults    Int @default(2)
  maxChildren  Int @default(1)

  // Rate (base rate, actual price from Billing)
  baseRate Decimal @default(0) @db.Decimal(15, 2)

  // Amenities (JSON array)
  amenities Json? // ["AC", "TV", "WiFi", "Minibar", "Balcony"]

  // Status
  status   HospitalityRoomStatus @default(AVAILABLE)
  isActive Boolean               @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  venue         hospitality_venue         @relation(fields: [venueId], references: [id])
  floor         hospitality_floor?        @relation(fields: [floorId], references: [id])
  reservations  hospitality_reservation[]
  stays         hospitality_stay[]
  serviceEvents hospitality_service_event[]

  @@unique([tenantId, venueId, roomNumber])
  @@index([tenantId])
  @@index([venueId])
  @@index([status])
  @@index([roomType])
}

// --------------------------------------------------------------------------
// HOSPITALITY GUEST - Guest Profiles (Operational, Not CRM)
// --------------------------------------------------------------------------
model hospitality_guest {
  id       String @id @default(cuid())
  tenantId String

  guestNumber String @unique

  // Name
  firstName  String
  lastName   String
  middleName String?
  title      String? // Mr., Mrs., Chief, Dr.

  // Contact
  phone String?
  email String?

  // Identity (for check-in)
  nationalId   String? // NIN
  idType       String? // NIN, Passport, Driver's License
  idNumber     String?
  nationality  String  @default("Nigerian")

  // Address
  address Json?

  // Preferences (JSON)
  preferences Json? // { "roomType": "DELUXE", "floor": "high", "dietary": ["vegetarian"] }

  // Notes
  notes String?

  // VIP Status
  isVip    Boolean @default(false)
  vipNotes String?

  // Status
  isActive Boolean @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  reservations hospitality_reservation[]
  stays        hospitality_stay[]
  orders       hospitality_order[]
  chargeFacts  hospitality_charge_fact[]

  @@index([tenantId])
  @@index([phone])
  @@index([email])
  @@index([lastName])
}

// --------------------------------------------------------------------------
// HOSPITALITY RESERVATION - Table and Room Reservations
// --------------------------------------------------------------------------
model hospitality_reservation {
  id       String @id @default(cuid())
  tenantId String
  venueId  String

  reservationNumber String @unique

  // Type
  reservationType HospitalityReservationType

  // Guest
  guestId    String?
  guestName  String // For walk-ins without profile
  guestPhone String?
  guestEmail String?
  partySize  Int    @default(1)

  // Table Reservation
  tableId String?

  // Room Reservation
  roomId       String?
  checkInDate  DateTime?
  checkOutDate DateTime?
  nights       Int?

  // Restaurant Reservation
  reservationDate DateTime?
  reservationTime String?   // "19:00"
  duration        Int?      // minutes

  // Special Requests
  specialRequests String?
  occasion        String? // Birthday, Anniversary, Business

  // Status
  status HospitalityReservationStatus @default(PENDING)

  // Source
  source String? // Walk-in, Phone, Online, OTA

  // Deposit (fact only, payment via Commerce)
  depositRequired Boolean @default(false)
  depositAmount   Decimal @default(0) @db.Decimal(15, 2)
  depositPaid     Boolean @default(false)

  // Cancellation
  cancelledAt     DateTime?
  cancellationReason String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  venue hospitality_venue  @relation(fields: [venueId], references: [id])
  guest hospitality_guest? @relation(fields: [guestId], references: [id])
  table hospitality_table? @relation(fields: [tableId], references: [id])
  room  hospitality_room?  @relation(fields: [roomId], references: [id])
  stay  hospitality_stay?

  @@index([tenantId])
  @@index([venueId])
  @@index([guestId])
  @@index([status])
  @@index([reservationType])
  @@index([reservationDate])
  @@index([checkInDate])
}

// --------------------------------------------------------------------------
// HOSPITALITY STAY - Hotel Stays (Check-in to Check-out)
// --------------------------------------------------------------------------
model hospitality_stay {
  id       String @id @default(cuid())
  tenantId String
  venueId  String

  stayNumber String @unique

  // Guest
  guestId    String
  guestCount Int    @default(1)
  adults     Int    @default(1)
  children   Int    @default(0)

  // Room Assignment
  roomId String

  // Reservation Link
  reservationId String? @unique

  // Dates
  checkInDate   DateTime
  checkOutDate  DateTime
  actualCheckIn DateTime?
  actualCheckOut DateTime?
  nights        Int       @default(1)

  // Rate (per night, actual billing via Commerce)
  nightlyRate Decimal @default(0) @db.Decimal(15, 2)

  // Status
  status HospitalityStayStatus @default(RESERVED)

  // Extensions
  extendedTo   DateTime?
  extensionCount Int @default(0)

  // Notes
  notes String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  venue         hospitality_venue   @relation(fields: [venueId], references: [id])
  guest         hospitality_guest   @relation(fields: [guestId], references: [id])
  room          hospitality_room    @relation(fields: [roomId], references: [id])
  reservation   hospitality_reservation? @relation(fields: [reservationId], references: [id])
  orders        hospitality_order[]
  serviceEvents hospitality_service_event[]
  chargeFacts   hospitality_charge_fact[]

  @@index([tenantId])
  @@index([venueId])
  @@index([guestId])
  @@index([roomId])
  @@index([status])
  @@index([checkInDate])
  @@index([checkOutDate])
}

// --------------------------------------------------------------------------
// HOSPITALITY ORDER - Food & Beverage Orders
// --------------------------------------------------------------------------
model hospitality_order {
  id       String @id @default(cuid())
  tenantId String
  venueId  String

  orderNumber String @unique

  // Order Type
  orderType HospitalityOrderType @default(DINE_IN)

  // Guest/Table
  guestId String?
  tableId String?
  stayId  String? // For room service

  // Guest Info (for walk-ins)
  guestName  String?
  guestPhone String?

  // Covers (number of people eating)
  covers Int @default(1)

  // Status
  status HospitalityOrderStatus @default(PLACED)

  // Assigned Staff
  serverId   String?
  serverName String?

  // Kitchen Notes
  kitchenNotes String?
  specialRequests String?

  // Timing
  placedAt    DateTime  @default(now())
  confirmedAt DateTime?
  preparedAt  DateTime?
  servedAt    DateTime?
  completedAt DateTime?
  cancelledAt DateTime?

  // Split Bill Support
  isSplitBill Boolean @default(false)
  splitCount  Int     @default(1)

  // Notes
  notes String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  venue       hospitality_venue        @relation(fields: [venueId], references: [id])
  guest       hospitality_guest?       @relation(fields: [guestId], references: [id])
  table       hospitality_table?       @relation(fields: [tableId], references: [id])
  stay        hospitality_stay?        @relation(fields: [stayId], references: [id])
  items       hospitality_order_item[]
  chargeFacts hospitality_charge_fact[]

  @@index([tenantId])
  @@index([venueId])
  @@index([guestId])
  @@index([tableId])
  @@index([status])
  @@index([placedAt])
}

// --------------------------------------------------------------------------
// HOSPITALITY ORDER ITEM - Individual Items in an Order
// --------------------------------------------------------------------------
model hospitality_order_item {
  id       String @id @default(cuid())
  tenantId String
  orderId  String

  // Item Details (from menu/inventory)
  itemCode        String?
  itemName        String
  itemDescription String?
  category        String? // Starters, Mains, Drinks, Desserts

  // Quantity & Price
  quantity  Int     @default(1)
  unitPrice Decimal @default(0) @db.Decimal(15, 2)

  // Modifiers (JSON)
  modifiers Json? // [{"name": "Extra spicy", "price": 200}]

  // Special Instructions
  specialInstructions String?

  // Status
  status HospitalityOrderItemStatus @default(PENDING)

  // Prep Station
  prepStation String? // Kitchen, Bar, Grill

  // Timing
  sentToKitchenAt DateTime?
  preparedAt      DateTime?
  servedAt        DateTime?

  // Split Assignment (for split bills)
  splitAssignment Int @default(1)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  order hospitality_order @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([orderId])
  @@index([status])
}

// --------------------------------------------------------------------------
// HOSPITALITY SERVICE EVENT - Housekeeping, Maintenance, etc.
// --------------------------------------------------------------------------
model hospitality_service_event {
  id       String @id @default(cuid())
  tenantId String
  venueId  String
  roomId   String?
  stayId   String?

  // Event Type
  eventType HospitalityServiceEventType

  // Description
  description String?
  priority    String  @default("NORMAL") // LOW, NORMAL, HIGH, URGENT

  // Assignment
  assignedToId   String?
  assignedToName String?

  // Status
  status HospitalityServiceEventStatus @default(REQUESTED)

  // Timing
  requestedAt  DateTime  @default(now())
  scheduledFor DateTime?
  startedAt    DateTime?
  completedAt  DateTime?

  // Notes
  notes           String?
  completionNotes String?

  // Chargeable
  isChargeable Boolean @default(false)
  chargeAmount Decimal @default(0) @db.Decimal(15, 2)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  room hospitality_room? @relation(fields: [roomId], references: [id])
  stay hospitality_stay? @relation(fields: [stayId], references: [id])

  @@index([tenantId])
  @@index([roomId])
  @@index([stayId])
  @@index([status])
  @@index([eventType])
}

// --------------------------------------------------------------------------
// HOSPITALITY STAFF - Operational Staff Profiles
// --------------------------------------------------------------------------
model hospitality_staff {
  id       String @id @default(cuid())
  tenantId String
  venueId  String

  // User Link (optional)
  userId String?

  // Name
  firstName  String
  lastName   String
  middleName String?

  // Contact
  phone String?
  email String?

  // Role
  role        HospitalityStaffRole
  department  String?
  designation String?

  // Employment
  employeeId String?
  hireDate   DateTime?

  // Status
  isActive Boolean @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  venue  hospitality_venue   @relation(fields: [venueId], references: [id])
  shifts hospitality_shift[]

  @@unique([tenantId, venueId, employeeId])
  @@index([tenantId])
  @@index([venueId])
  @@index([role])
}

// --------------------------------------------------------------------------
// HOSPITALITY SHIFT - Staff Shift Management
// --------------------------------------------------------------------------
model hospitality_shift {
  id       String @id @default(cuid())
  tenantId String
  staffId  String

  // Shift Details
  shiftType HospitalityShiftType
  shiftDate DateTime

  // Timing
  scheduledStart DateTime
  scheduledEnd   DateTime
  actualStart    DateTime?
  actualEnd      DateTime?

  // Status
  status HospitalityShiftStatus @default(SCHEDULED)

  // Assignment
  station String? // Table section, floor, kitchen station
  notes   String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  staff hospitality_staff @relation(fields: [staffId], references: [id])

  @@index([tenantId])
  @@index([staffId])
  @@index([shiftDate])
  @@index([status])
}

// --------------------------------------------------------------------------
// HOSPITALITY CHARGE FACT - Commerce Boundary (Facts Only)
// --------------------------------------------------------------------------
// CRITICAL: This table emits FACTS only. No invoicing, no payment recording.
// Flow: Hospitality [Charge Facts]  Billing [Invoice]  Payments  Accounting
// --------------------------------------------------------------------------
model hospitality_charge_fact {
  id       String @id @default(cuid())
  tenantId String

  // Source
  guestId String?
  stayId  String?
  orderId String?

  // Charge Details
  factType    HospitalityChargeFactType
  description String
  quantity    Int     @default(1)
  unitAmount  Decimal @db.Decimal(15, 2)
  amount      Decimal @db.Decimal(15, 2) // quantity * unitAmount

  // Service Info
  serviceDate    DateTime @default(now())
  servicedById   String?
  servicedByName String?

  // Status (Billing tracks actual payment status)
  status HospitalityChargeFactStatus @default(PENDING)

  // Commerce Link (set when billed)
  billingInvoiceId String?
  billedAt         DateTime?

  // Waiver
  waivedAt     DateTime?
  waivedBy     String?
  waiverReason String?

  // Reference
  referenceType String? // ORDER, SERVICE_EVENT, STAY
  referenceId   String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  guest hospitality_guest? @relation(fields: [guestId], references: [id])
  stay  hospitality_stay?  @relation(fields: [stayId], references: [id])
  order hospitality_order? @relation(fields: [orderId], references: [id])

  @@index([tenantId])
  @@index([guestId])
  @@index([stayId])
  @@index([orderId])
  @@index([factType])
  @@index([status])
  @@index([serviceDate])
  @@index([billingInvoiceId])
}

// ============================================================================
// CIVIC / GOVTECH SUITE
// Platform Standardisation v2 - S2 Schema
// ============================================================================

// ----------------------------------------------------------------------------
// CIVIC ENUMS
// ----------------------------------------------------------------------------

enum CivicRequestStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  PENDING_DOCUMENTS
  PENDING_PAYMENT
  PENDING_INSPECTION
  APPROVED
  REJECTED
  CANCELLED
  EXPIRED
}

enum CivicCaseStatus {
  OPEN
  ASSIGNED
  IN_PROGRESS
  PENDING_ACTION
  ESCALATED
  RESOLVED
  CLOSED
}

enum CivicCasePriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum CivicInspectionStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  RESCHEDULED
}

enum CivicInspectionResult {
  PASSED
  FAILED
  CONDITIONAL
  PENDING
}

enum CivicApprovalDecision {
  APPROVED
  REJECTED
  DEFERRED
  CONDITIONAL
}

enum CivicBillingFactType {
  SERVICE_FEE
  PERMIT_FEE
  LICENSE_FEE
  INSPECTION_FEE
  PENALTY
  LATE_FEE
  RENEWAL_FEE
  APPLICATION_FEE
  PROCESSING_FEE
  OTHER
}

enum CivicBillingFactStatus {
  PENDING
  BILLED
  WAIVED
  CANCELLED
}

enum CivicDocumentType {
  IDENTITY
  PROOF_OF_ADDRESS
  OWNERSHIP
  SURVEY_PLAN
  TAX_CLEARANCE
  RECEIPT
  PHOTOGRAPH
  SIGNATURE
  SUPPORTING
  OTHER
}

enum CivicDocumentStatus {
  PENDING
  VERIFIED
  REJECTED
  EXPIRED
}

enum CivicStaffRole {
  ADMIN
  DIRECTOR
  MANAGER
  OFFICER
  CLERK
  INSPECTOR
  REVIEWER
}

enum CivicServiceCategory {
  PERMITS
  LICENSES
  CERTIFICATES
  REGISTRATIONS
  APPROVALS
  RENEWALS
  COMPLAINTS
  INQUIRIES
  OTHER
}

// ----------------------------------------------------------------------------
// CIVIC CONFIG
// ----------------------------------------------------------------------------

model civic_config {
  id       String @id @default(uuid())
  tenantId String @unique

  // Agency Info
  agencyName     String
  agencyCode     String?
  jurisdiction   String? // e.g., "Lagos State", "Federal"
  
  // Defaults
  defaultSlaBusinessDays Int     @default(14)
  workingHoursStart      String  @default("08:00")
  workingHoursEnd        String  @default("16:00")
  workingDays            Json?   // ["MON", "TUE", "WED", "THU", "FRI"]
  
  // Settings
  requirePaymentBeforeProcessing Boolean @default(true)
  autoAssignCases                Boolean @default(false)
  allowAnonymousComplaints       Boolean @default(false)
  enablePublicTracking           Boolean @default(true)
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ----------------------------------------------------------------------------
// CITIZEN & ORGANIZATION REGISTRY
// ----------------------------------------------------------------------------

model civic_citizen {
  id       String @id @default(uuid())
  tenantId String

  // Identity Reference (NOT NIN replacement)
  citizenNumber String @unique // e.g., "CIT-2026-00001"
  
  // Basic Info
  firstName  String
  lastName   String
  middleName String?
  title      String? // Mr., Mrs., Dr., Chief, etc.
  
  // Contact
  phone    String?
  email    String?
  address  Json?   // { street, area, lga, state, country }
  
  // Identity References (optional, for verification)
  nationalIdRef String? // Reference only, not the actual NIN
  voterIdRef    String?
  passportRef   String?
  driverLicenseRef String?
  
  // Demographics
  dateOfBirth DateTime?
  gender      String?
  occupation  String?
  
  // Status
  isActive   Boolean @default(true)
  isVerified Boolean @default(false)
  verifiedAt DateTime?
  verifiedBy String?
  
  // Notes
  notes String?
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  documents    civic_citizen_document[]
  requests     civic_request[]
  billingFacts civic_billing_fact[]

  @@index([tenantId])
  @@index([citizenNumber])
  @@index([phone])
  @@index([email])
  @@index([lastName])
}

model civic_organization {
  id       String @id @default(uuid())
  tenantId String

  // Identification
  orgNumber String @unique // e.g., "ORG-2026-00001"
  
  // Basic Info
  name          String
  tradeName     String?
  registrationType String? // LLC, NGO, Sole Proprietorship, etc.
  rcNumber      String?    // CAC Registration Number
  taxId         String?
  
  // Contact
  phone    String?
  email    String?
  website  String?
  address  Json?   // { street, area, lga, state, country }
  
  // Representatives
  contactPerson      String?
  contactPersonPhone String?
  contactPersonEmail String?
  
  // Status
  isActive   Boolean @default(true)
  isVerified Boolean @default(false)
  verifiedAt DateTime?
  verifiedBy String?
  
  // Notes
  notes String?
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  documents civic_citizen_document[]
  requests  civic_request[]

  @@index([tenantId])
  @@index([orgNumber])
  @@index([name])
  @@index([rcNumber])
}

model civic_citizen_document {
  id       String @id @default(uuid())
  tenantId String

  // Owner (citizen OR organization)
  citizenId      String?
  organizationId String?
  
  // Document Info
  documentType CivicDocumentType
  documentName String
  description  String?
  
  // File Reference
  fileUrl     String?
  fileName    String?
  fileSize    Int?
  mimeType    String?
  
  // Verification
  status       CivicDocumentStatus @default(PENDING)
  verifiedAt   DateTime?
  verifiedBy   String?
  verifierNote String?
  expiryDate   DateTime?
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  citizen      civic_citizen?      @relation(fields: [citizenId], references: [id])
  organization civic_organization? @relation(fields: [organizationId], references: [id])

  @@index([tenantId])
  @@index([citizenId])
  @@index([organizationId])
  @@index([documentType])
  @@index([status])
}

// ----------------------------------------------------------------------------
// AGENCY STRUCTURE
// ----------------------------------------------------------------------------

model civic_agency {
  id       String @id @default(uuid())
  tenantId String

  // Identity
  code String // e.g., "LASG-LANDS"
  name String
  
  // Details
  description String?
  jurisdiction String? // State, Federal, LGA
  parentAgencyId String?
  
  // Contact
  phone   String?
  email   String?
  address Json?
  website String?
  
  // Head
  headName  String?
  headTitle String?
  
  // Status
  isActive Boolean @default(true)
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  departments civic_department[]
  services    civic_service[]
  staff       civic_staff[]

  @@unique([tenantId, code])
  @@index([tenantId])
  @@index([name])
}

model civic_department {
  id       String @id @default(uuid())
  tenantId String
  agencyId String

  // Identity
  code String
  name String
  
  // Details
  description String?
  
  // Head
  headName  String?
  headTitle String?
  
  // Status
  isActive Boolean @default(true)
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  agency civic_agency  @relation(fields: [agencyId], references: [id])
  units  civic_unit[]
  staff  civic_staff[]

  @@unique([tenantId, agencyId, code])
  @@index([tenantId])
  @@index([agencyId])
}

model civic_unit {
  id           String @id @default(uuid())
  tenantId     String
  departmentId String

  // Identity
  code String
  name String
  
  // Details
  description String?
  
  // Status
  isActive Boolean @default(true)
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  department civic_department @relation(fields: [departmentId], references: [id])
  staff      civic_staff[]

  @@unique([tenantId, departmentId, code])
  @@index([tenantId])
  @@index([departmentId])
}

model civic_staff {
  id       String @id @default(uuid())
  tenantId String

  // Assignment
  agencyId     String?
  departmentId String?
  unitId       String?
  
  // Link to Platform User
  userId String?
  
  // Basic Info
  staffNumber String // e.g., "STAFF-001"
  firstName   String
  lastName    String
  middleName  String?
  
  // Contact
  phone String?
  email String?
  
  // Role
  role        CivicStaffRole @default(OFFICER)
  designation String?
  
  // Status
  isActive Boolean @default(true)
  hireDate DateTime?
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  agency      civic_agency?      @relation(fields: [agencyId], references: [id])
  department  civic_department?  @relation(fields: [departmentId], references: [id])
  unit        civic_unit?        @relation(fields: [unitId], references: [id])
  assignments civic_case_assignment[]
  inspections civic_inspection[]
  approvals   civic_approval[]

  @@unique([tenantId, staffNumber])
  @@index([tenantId])
  @@index([agencyId])
  @@index([departmentId])
  @@index([unitId])
  @@index([role])
}

// ----------------------------------------------------------------------------
// SERVICE CATALOGUE
// ----------------------------------------------------------------------------

model civic_service {
  id       String @id @default(uuid())
  tenantId String
  agencyId String

  // Identity
  code String
  name String
  
  // Details
  description   String?
  category      CivicServiceCategory @default(OTHER)
  eligibility   String?              // Who can apply
  processFlow   String?              // Brief process description
  
  // Requirements (JSON array of requirement IDs or descriptions)
  requiredDocuments Json? // ["IDENTITY", "PROOF_OF_ADDRESS", ...]
  
  // Fees
  baseFee          Decimal? @db.Decimal(15, 2)
  processingFee    Decimal? @db.Decimal(15, 2)
  inspectionFee    Decimal? @db.Decimal(15, 2)
  vatApplicable    Boolean  @default(false)
  
  // SLA
  slaBusinessDays Int @default(14)
  
  // Validity
  validityDays     Int?    // How long the result is valid
  renewalRequired  Boolean @default(false)
  renewalNoticeDays Int?   // Days before expiry to notify
  
  // Status
  isActive Boolean @default(true)
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  agency   civic_agency    @relation(fields: [agencyId], references: [id])
  requests civic_request[]

  @@unique([tenantId, agencyId, code])
  @@index([tenantId])
  @@index([agencyId])
  @@index([category])
  @@index([isActive])
}

// ----------------------------------------------------------------------------
// REQUESTS & CASE WORKFLOW
// ----------------------------------------------------------------------------

model civic_request {
  id       String @id @default(uuid())
  tenantId String

  // Request Number
  requestNumber String @unique // e.g., "REQ-2026-00001"
  
  // Applicant (citizen OR organization)
  citizenId      String?
  organizationId String?
  applicantName  String  // Cached for display
  applicantPhone String?
  applicantEmail String?
  
  // Service
  serviceId   String
  serviceName String // Cached
  
  // Request Details
  subject     String?
  description String?
  location    Json?   // Property/service location if applicable
  
  // Submitted Documents (JSON array of document IDs)
  submittedDocuments Json?
  
  // Status
  status        CivicRequestStatus @default(DRAFT)
  submittedAt   DateTime?
  acknowledgedAt DateTime?
  
  // Outcome
  outcomeDate   DateTime?
  outcomeNote   String?
  certificateId String? // If a certificate/permit is issued
  
  // Expiry (for permits/licenses)
  validUntil DateTime?
  
  // Payment Reference
  isPaid      Boolean @default(false)
  paidAt      DateTime?
  paymentRef  String?
  totalAmount Decimal? @db.Decimal(15, 2)
  
  // Public Tracking
  trackingCode String? @unique // For public status check
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  citizen      civic_citizen?      @relation(fields: [citizenId], references: [id])
  organization civic_organization? @relation(fields: [organizationId], references: [id])
  service      civic_service       @relation(fields: [serviceId], references: [id])
  cases        civic_case[]
  billingFacts civic_billing_fact[]

  @@index([tenantId])
  @@index([requestNumber])
  @@index([citizenId])
  @@index([organizationId])
  @@index([serviceId])
  @@index([status])
  @@index([trackingCode])
  @@index([submittedAt])
}

model civic_case {
  id        String @id @default(uuid())
  tenantId  String
  requestId String

  // Case Number
  caseNumber String @unique // e.g., "CASE-2026-00001"
  
  // Status
  status   CivicCaseStatus  @default(OPEN)
  priority CivicCasePriority @default(NORMAL)
  
  // Assignment
  currentAssigneeId String?
  
  // SLA
  slaDeadline DateTime?
  slaBreached Boolean @default(false)
  
  // Resolution
  resolvedAt   DateTime?
  closedAt     DateTime?
  resolution   String?
  
  // Escalation
  isEscalated    Boolean @default(false)
  escalatedAt    DateTime?
  escalatedBy    String?
  escalationNote String?
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  request     civic_request          @relation(fields: [requestId], references: [id])
  assignments civic_case_assignment[]
  notes       civic_case_note[]
  statusHistory civic_case_status_change[]
  inspections civic_inspection[]
  approvals   civic_approval[]

  @@index([tenantId])
  @@index([caseNumber])
  @@index([requestId])
  @@index([status])
  @@index([priority])
  @@index([currentAssigneeId])
  @@index([slaDeadline])
}

model civic_case_assignment {
  id       String @id @default(uuid())
  tenantId String
  caseId   String
  staffId  String

  // Assignment Details
  assignedAt   DateTime @default(now())
  assignedBy   String?
  assignerNote String?
  
  // Status
  isActive    Boolean @default(true)
  completedAt DateTime?
  
  // Timestamps
  createdAt DateTime @default(now())

  // Relations
  case  civic_case  @relation(fields: [caseId], references: [id])
  staff civic_staff @relation(fields: [staffId], references: [id])

  @@index([tenantId])
  @@index([caseId])
  @@index([staffId])
  @@index([isActive])
}

// APPEND-ONLY: Case notes cannot be edited or deleted
model civic_case_note {
  id       String @id @default(uuid())
  tenantId String
  caseId   String

  // Note Content
  noteType   String  @default("INTERNAL") // INTERNAL, EXTERNAL, SYSTEM
  content    String
  isInternal Boolean @default(true)
  
  // Author
  authorId   String?
  authorName String
  
  // Timestamps (no updatedAt - append-only)
  createdAt DateTime @default(now())

  // Relations
  case civic_case @relation(fields: [caseId], references: [id])

  @@index([tenantId])
  @@index([caseId])
  @@index([noteType])
  @@index([createdAt])
}

// APPEND-ONLY: Status changes cannot be edited or deleted
model civic_case_status_change {
  id       String @id @default(uuid())
  tenantId String
  caseId   String

  // Status Change
  fromStatus CivicCaseStatus?
  toStatus   CivicCaseStatus
  reason     String?
  
  // Author
  changedById   String?
  changedByName String
  
  // Timestamps (no updatedAt - append-only)
  createdAt DateTime @default(now())

  // Relations
  case civic_case @relation(fields: [caseId], references: [id])

  @@index([tenantId])
  @@index([caseId])
  @@index([createdAt])
}

// ----------------------------------------------------------------------------
// INSPECTIONS & APPROVALS
// ----------------------------------------------------------------------------

model civic_inspection {
  id       String @id @default(uuid())
  tenantId String
  caseId   String

  // Inspection Number
  inspectionNumber String @unique // e.g., "INSP-2026-00001"
  
  // Schedule
  scheduledDate DateTime
  scheduledTime String?
  location      Json?   // Inspection location
  
  // Inspector
  inspectorId   String?
  inspectorName String?
  
  // Status
  status CivicInspectionStatus @default(SCHEDULED)
  
  // Execution
  startedAt   DateTime?
  completedAt DateTime?
  
  // Result
  result       CivicInspectionResult?
  resultNote   String?
  
  // Reschedule
  rescheduledFrom DateTime?
  rescheduleNote  String?
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  case      civic_case              @relation(fields: [caseId], references: [id])
  inspector civic_staff?            @relation(fields: [inspectorId], references: [id])
  findings  civic_inspection_finding[]

  @@index([tenantId])
  @@index([inspectionNumber])
  @@index([caseId])
  @@index([inspectorId])
  @@index([status])
  @@index([scheduledDate])
}

// APPEND-ONLY: Findings cannot be edited or deleted
model civic_inspection_finding {
  id           String @id @default(uuid())
  tenantId     String
  inspectionId String

  // Finding Details
  category    String  // e.g., "STRUCTURE", "COMPLIANCE", "SAFETY"
  description String
  severity    String? // LOW, MEDIUM, HIGH, CRITICAL
  
  // Evidence
  photoUrls   Json?   // Array of photo URLs
  notes       String?
  
  // Author
  recordedById   String?
  recordedByName String
  
  // Timestamps (no updatedAt - append-only)
  createdAt DateTime @default(now())

  // Relations
  inspection civic_inspection @relation(fields: [inspectionId], references: [id])

  @@index([tenantId])
  @@index([inspectionId])
  @@index([category])
  @@index([createdAt])
}

// APPEND-ONLY: Approval decisions cannot be edited or deleted
model civic_approval {
  id       String @id @default(uuid())
  tenantId String
  caseId   String

  // Approval Number
  approvalNumber String @unique // e.g., "APR-2026-00001"
  
  // Decision
  decision     CivicApprovalDecision
  decisionDate DateTime              @default(now())
  
  // Approver
  approverId   String?
  approverName String
  approverRole String?
  
  // Rationale
  rationale  String?
  conditions String? // If conditional approval
  
  // Reference
  referenceNote String? // Any reference documents or policies
  
  // Timestamps (no updatedAt - append-only)
  createdAt DateTime @default(now())

  // Relations
  case      civic_case  @relation(fields: [caseId], references: [id])
  approver  civic_staff? @relation(fields: [approverId], references: [id])

  @@index([tenantId])
  @@index([approvalNumber])
  @@index([caseId])
  @@index([approverId])
  @@index([decision])
  @@index([decisionDate])
}

// ----------------------------------------------------------------------------
// BILLING FACTS (Commerce Boundary)
// ----------------------------------------------------------------------------

model civic_billing_fact {
  id       String @id @default(uuid())
  tenantId String

  // References
  requestId String?
  citizenId String?
  
  // Charge Details
  factType    CivicBillingFactType
  description String
  quantity    Int     @default(1)
  unitAmount  Decimal @db.Decimal(15, 2)
  amount      Decimal @db.Decimal(15, 2) // quantity * unitAmount

  // Service Info
  serviceDate    DateTime @default(now())
  servicedById   String?
  servicedByName String?

  // Status (Commerce tracks actual payment status)
  status CivicBillingFactStatus @default(PENDING)

  // Commerce Link (set when billed)
  billingInvoiceId String?
  billedAt         DateTime?

  // Waiver
  waivedAt     DateTime?
  waivedBy     String?
  waiverReason String?

  // Due Date
  dueDate DateTime?
  
  // Reference
  referenceType String? // REQUEST, INSPECTION, PENALTY
  referenceId   String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  request civic_request? @relation(fields: [requestId], references: [id])
  citizen civic_citizen? @relation(fields: [citizenId], references: [id])

  @@index([tenantId])
  @@index([requestId])
  @@index([citizenId])
  @@index([factType])
  @@index([status])
  @@index([serviceDate])
  @@index([billingInvoiceId])
  @@index([dueDate])
}

// ----------------------------------------------------------------------------
// AUDIT LOG (Append-Only)
// ----------------------------------------------------------------------------

model civic_audit_log {
  id       String @id @default(uuid())
  tenantId String

  // Action
  action     String // CREATE, UPDATE, STATUS_CHANGE, VIEW, EXPORT, etc.
  entityType String // REQUEST, CASE, INSPECTION, APPROVAL, etc.
  entityId   String

  // Actor
  actorId   String?
  actorName String
  actorRole String?
  actorIp   String?
  
  // Details
  description String?
  changes     Json?   // { field: { old, new } }
  metadata    Json?   // Additional context
  
  // Timestamps (no updatedAt - append-only)
  createdAt DateTime @default(now())

  @@index([tenantId])
  @@index([action])
  @@index([entityType])
  @@index([entityId])
  @@index([actorId])
  @@index([createdAt])
}

// ----------------------------------------------------------------------------
// PUBLIC STATUS (Transparency View)
// ----------------------------------------------------------------------------

model civic_public_status {
  id       String @id @default(uuid())
  tenantId String

  // Request Reference
  trackingCode String @unique
  requestId    String

  // Public Info (redacted/summarized)
  serviceName    String
  submittedDate  DateTime
  currentStatus  String
  lastUpdateDate DateTime
  
  // Progress (percentage or stage)
  progressStage  Int     @default(0) // 0-100
  progressNote   String?
  
  // Estimated Completion
  estimatedCompletionDate DateTime?
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tenantId])
  @@index([trackingCode])
  @@index([requestId])
}


// ============================================================================
// POLITICAL SUITE - Phase 1: Party & Campaign Operations
// ============================================================================
// Authorization: January 8, 2026
// Classification: HIGH-RISK VERTICAL
// Governance: Audit-First, Non-Partisan, INEC-Safe
// ============================================================================

// ----------------------------------------------------------------------------
// POLITICAL SUITE ENUMS
// ----------------------------------------------------------------------------

enum PolPartyStatus {
  ACTIVE
  SUSPENDED
  DEREGISTERED
  MERGED
}

enum PolPartyOrganLevel {
  NATIONAL
  ZONAL
  STATE
  LGA
  WARD
}

enum PolMemberStatus {
  PENDING
  VERIFIED
  SUSPENDED
  EXPELLED
  DECEASED
  RESIGNED
}

enum PolMemberRole {
  MEMBER
  EXECUTIVE
  DELEGATE
  AGENT
  CANDIDATE
}

enum PolCampaignStatus {
  DRAFT
  ACTIVE
  SUSPENDED
  COMPLETED
  CANCELLED
}

enum PolCampaignType {
  PRESIDENTIAL
  GUBERNATORIAL
  SENATORIAL
  HOUSE_OF_REPS
  STATE_ASSEMBLY
  LOCAL_GOVERNMENT
  COUNCILLORSHIP
  PARTY_PRIMARY
  BY_ELECTION
}

enum PolCandidateStatus {
  NOMINATED
  SCREENED
  CLEARED
  DISQUALIFIED
  WITHDRAWN
  ELECTED
  NOT_ELECTED
}

enum PolEventType {
  RALLY
  TOWN_HALL
  DEBATE
  STAKEHOLDER_MEETING
  DOOR_TO_DOOR
  MEDIA_APPEARANCE
  FUNDRAISER
  PARTY_MEETING
  INAUGURATION
  OTHER
}

enum PolEventStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  POSTPONED
}

enum PolVolunteerStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  COMPLETED
}

enum PolVolunteerRole {
  CANVASSER
  COORDINATOR
  POLL_AGENT
  DRIVER
  SECURITY
  MEDIA
  LOGISTICS
  ADMIN
  OTHER
}

enum PolAuditAction {
  CREATE
  UPDATE
  DELETE
  STATUS_CHANGE
  VERIFY
  CERTIFY
  EXPORT
  ACCESS
  LOGIN
  LOGOUT
}

// ----------------------------------------------------------------------------
// POLITICAL PARTY REGISTRY
// ----------------------------------------------------------------------------

model pol_party {
  id       String @id @default(uuid())
  tenantId String

  // Party Identity
  name           String
  acronym        String
  registrationNo String? // Electoral commission registration
  motto          String?
  slogan         String?
  
  // Branding
  logoUrl       String?
  primaryColor  String?
  secondaryColor String?
  
  // Status
  status         PolPartyStatus @default(ACTIVE)
  foundedDate    DateTime?
  registeredDate DateTime?
  
  // Contact
  headquarters   String?
  phone          String?
  email          String?
  website        String?
  
  // Jurisdiction (Nigeria-first)
  country        String @default("NG")
  
  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  
  // Relations
  organs     pol_party_organ[]
  members    pol_member[]
  campaigns  pol_campaign[]
  donationFacts pol_donation_fact[]
  expenseFacts  pol_expense_fact[]
  disclosures   pol_disclosure[]
  primaries     pol_primary[]
  // Phase 4: Governance & Post-Election
  petitions           pol_petition[]
  engagements         pol_engagement[]
  regulatorAccess     pol_regulator_access[]
  transparencyReports pol_transparency_report[]
  
  @@unique([tenantId, acronym])
  @@index([tenantId])
  @@index([status])
  @@index([acronym])
}

// ----------------------------------------------------------------------------
// PARTY ORGANIZATIONAL STRUCTURE
// ----------------------------------------------------------------------------

model pol_party_organ {
  id       String @id @default(uuid())
  tenantId String
  partyId  String

  // Organ Identity
  name  String
  level PolPartyOrganLevel
  
  // Jurisdiction Scoping (Nigeria)
  zone    String? // e.g., South-West, North-Central
  state   String? // e.g., Lagos, Kano
  lga     String? // Local Government Area
  ward    String? // Ward name/number
  
  // Parent Organ (hierarchy)
  parentOrganId String?
  parentOrgan   pol_party_organ?  @relation("OrganHierarchy", fields: [parentOrganId], references: [id])
  childOrgans   pol_party_organ[] @relation("OrganHierarchy")
  
  // Leadership
  chairmanName    String?
  secretaryName   String?
  treasurerName   String?
  
  // Contact
  officeAddress   String?
  phone           String?
  email           String?
  
  // Status
  isActive Boolean @default(true)
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  
  // Relations
  party   pol_party @relation(fields: [partyId], references: [id], onDelete: Cascade)
  members pol_member[]
  
  @@index([tenantId])
  @@index([partyId])
  @@index([level])
  @@index([state])
  @@index([lga])
  @@index([ward])
}

// ----------------------------------------------------------------------------
// PARTY MEMBERSHIP
// ----------------------------------------------------------------------------

model pol_member {
  id       String @id @default(uuid())
  tenantId String
  partyId  String
  organId  String?

  // Personal Information
  firstName   String
  lastName    String
  otherNames  String?
  dateOfBirth DateTime?
  gender      String?
  
  // Contact
  phone       String
  email       String?
  address     String?
  
  // Jurisdiction (registration location)
  state       String?
  lga         String?
  ward        String?
  pollingUnit String?
  
  // Membership Details
  membershipNo     String?
  registrationDate DateTime @default(now())
  role             PolMemberRole @default(MEMBER)
  status           PolMemberStatus @default(PENDING)
  
  // Verification
  isVerified       Boolean @default(false)
  verifiedAt       DateTime?
  verifiedBy       String?
  
  // ID Documents (references only, no storage)
  voterCardNo      String?
  ninNo            String?
  
  // Photo
  photoUrl         String?
  
  // Notes
  notes            String?
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  
  // Relations
  party             pol_party        @relation(fields: [partyId], references: [id], onDelete: Cascade)
  organ             pol_party_organ? @relation(fields: [organId], references: [id])
  volunteerRecords  pol_volunteer[]
  candidateRecords  pol_candidate[]
  primaryAspirants  pol_primary_aspirant[]
  
  @@unique([tenantId, partyId, phone])
  @@index([tenantId])
  @@index([partyId])
  @@index([organId])
  @@index([status])
  @@index([state])
  @@index([lga])
  @@index([ward])
}

// ----------------------------------------------------------------------------
// CAMPAIGN MANAGEMENT
// ----------------------------------------------------------------------------

model pol_campaign {
  id       String @id @default(uuid())
  tenantId String
  partyId  String

  // Campaign Identity
  name        String
  description String?
  type        PolCampaignType
  
  // Jurisdiction Scope
  country     String @default("NG")
  zone        String?
  state       String?
  constituency String? // Federal/State constituency
  lga         String?
  ward        String?
  
  // Timeline
  startDate   DateTime
  endDate     DateTime?
  electionDate DateTime?
  
  // Status
  status      PolCampaignStatus @default(DRAFT)
  statusNote  String?
  
  // Campaign HQ
  headquarters String?
  phone        String?
  email        String?
  website      String?
  
  // Social Media
  facebookUrl  String?
  twitterUrl   String?
  instagramUrl String?
  
  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  
  // Relations
  party      pol_party       @relation(fields: [partyId], references: [id], onDelete: Cascade)
  candidates pol_candidate[]
  events     pol_event[]
  volunteers pol_volunteer[]
  donationFacts pol_donation_fact[]
  expenseFacts  pol_expense_fact[]
  disclosures   pol_disclosure[]
  // Phase 4: Governance & Post-Election
  petitions    pol_petition[]
  engagements  pol_engagement[]
  
  @@index([tenantId])
  @@index([partyId])
  @@index([type])
  @@index([status])
  @@index([state])
  @@index([electionDate])
}

// ----------------------------------------------------------------------------
// CANDIDATE MANAGEMENT
// ----------------------------------------------------------------------------

model pol_candidate {
  id         String @id @default(uuid())
  tenantId   String
  campaignId String
  memberId   String?

  // Candidate Identity (if not linked to member)
  firstName   String
  lastName    String
  otherNames  String?
  dateOfBirth DateTime?
  gender      String?
  
  // Contact
  phone       String
  email       String?
  
  // Position
  position    String // e.g., "Governor", "Senator", "House of Reps"
  
  // Jurisdiction (what they're running for)
  constituency String?
  zone         String?
  state        String?
  lga          String?
  ward         String?
  
  // Status
  status       PolCandidateStatus @default(NOMINATED)
  statusNote   String?
  
  // Nomination
  nominatedAt  DateTime?
  nominatedBy  String?
  
  // Screening
  screenedAt   DateTime?
  screenedBy   String?
  screeningNote String?
  
  // Clearance
  clearedAt    DateTime?
  clearedBy    String?
  clearanceNote String?
  
  // Profile
  biography    String?
  manifesto    String?
  photoUrl     String?
  
  // Social Media
  facebookUrl  String?
  twitterUrl   String?
  instagramUrl String?
  
  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  
  // Relations
  campaign pol_campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  member   pol_member?  @relation(fields: [memberId], references: [id])
  
  @@index([tenantId])
  @@index([campaignId])
  @@index([memberId])
  @@index([status])
  @@index([state])
}

// ----------------------------------------------------------------------------
// CAMPAIGN EVENTS
// ----------------------------------------------------------------------------

model pol_event {
  id         String @id @default(uuid())
  tenantId   String
  campaignId String

  // Event Details
  name        String
  description String?
  type        PolEventType
  
  // Location
  venue       String?
  address     String?
  state       String?
  lga         String?
  ward        String?
  coordinates String? // "lat,lng"
  
  // Schedule
  startDateTime DateTime
  endDateTime   DateTime?
  timezone      String @default("Africa/Lagos")
  
  // Status
  status      PolEventStatus @default(SCHEDULED)
  statusNote  String?
  
  // Attendance
  expectedAttendance Int?
  actualAttendance   Int?
  
  // Organizer
  organizerId   String?
  organizerName String?
  organizerPhone String?
  
  // Notes
  notes         String?
  internalNotes String?
  
  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  
  // Relations
  campaign    pol_campaign    @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  volunteers  pol_volunteer[]
  
  @@index([tenantId])
  @@index([campaignId])
  @@index([type])
  @@index([status])
  @@index([startDateTime])
  @@index([state])
}

// ----------------------------------------------------------------------------
// VOLUNTEER MANAGEMENT
// ----------------------------------------------------------------------------

model pol_volunteer {
  id         String @id @default(uuid())
  tenantId   String
  campaignId String
  memberId   String?
  eventId    String?

  // Volunteer Identity (if not linked to member)
  firstName   String
  lastName    String
  phone       String
  email       String?
  
  // Assignment
  role        PolVolunteerRole
  assignment  String? // Specific assignment description
  
  // Jurisdiction
  state       String?
  lga         String?
  ward        String?
  pollingUnit String?
  
  // Availability
  availableFrom DateTime?
  availableTo   DateTime?
  isFullTime    Boolean @default(false)
  
  // Status
  status      PolVolunteerStatus @default(ACTIVE)
  statusNote  String?
  
  // Supervisor
  supervisorId   String?
  supervisorName String?
  
  // Training
  isTrainedAgent Boolean @default(false)
  trainedAt      DateTime?
  
  // Activity Log
  hoursLogged    Int @default(0)
  tasksCompleted Int @default(0)
  
  // Notes
  notes       String?
  
  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  
  // Relations
  campaign pol_campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  member   pol_member?  @relation(fields: [memberId], references: [id])
  event    pol_event?   @relation(fields: [eventId], references: [id])
  
  @@index([tenantId])
  @@index([campaignId])
  @@index([memberId])
  @@index([eventId])
  @@index([role])
  @@index([status])
  @@index([state])
  @@index([ward])
}

// ----------------------------------------------------------------------------
// POLITICAL AUDIT LOG (Append-Only)
// ----------------------------------------------------------------------------

model pol_audit_log {
  id       String @id @default(uuid())
  tenantId String

  // Action
  action     PolAuditAction
  entityType String // e.g., "party", "member", "campaign"
  entityId   String
  
  // Actor
  actorId    String
  actorEmail String?
  actorName  String?
  actorRole  String?
  
  // Context
  ipAddress  String?
  userAgent  String?
  
  // Change Details
  description String?
  changes     Json?   // { field: { old: x, new: y } }
  metadata    Json?   // Additional context
  
  // Jurisdiction Context
  state       String?
  lga         String?
  ward        String?
  
  // Immutable Timestamp (no updatedAt - append-only)
  createdAt DateTime @default(now())
  
  @@index([tenantId])
  @@index([action])
  @@index([entityType])
  @@index([entityId])
  @@index([actorId])
  @@index([createdAt])
  @@index([state])
}



// ============================================================================
// POLITICAL SUITE - Phase 2: Fundraising (FACTS ONLY)
// ============================================================================
// Authorization: January 8, 2026 (Checkpoint A Approved)
// Classification: HIGH-RISK VERTICAL
// Commerce Boundary: STRICTLY ENFORCED  Facts only, NO execution
// ============================================================================

// ----------------------------------------------------------------------------
// PHASE 2 ENUMS
// ----------------------------------------------------------------------------

enum PolDonationSource {
  INDIVIDUAL
  CORPORATE
  PARTY_FUND
  POLITICAL_ACTION_COMMITTEE
  ANONYMOUS_SMALL
  IN_KIND
  SELF_FUNDING
  OTHER
}

enum PolDonationStatus {
  RECORDED
  ACKNOWLEDGED
  DISCLOSED
  FLAGGED
}

enum PolExpenseCategory {
  ADVERTISING
  MEDIA_PRODUCTION
  PRINTING
  TRANSPORTATION
  ACCOMMODATION
  CATERING
  VENUE_RENTAL
  EQUIPMENT
  STAFF_SALARY
  CONSULTANT_FEE
  SECURITY
  COMMUNICATION
  OFFICE_SUPPLIES
  DONATION_TO_CHARITY
  OTHER
}

enum PolExpenseStatus {
  RECORDED
  VERIFIED
  DISCLOSED
  FLAGGED
}

enum PolDisclosureType {
  PRE_ELECTION
  POST_ELECTION
  QUARTERLY
  ANNUAL
  AD_HOC
  COURT_ORDERED
}

enum PolDisclosureStatus {
  DRAFT
  SUBMITTED
  ACCEPTED
  REJECTED
  AMENDED
}

// ----------------------------------------------------------------------------
// DONATION FACT (APPEND-ONLY)
// ----------------------------------------------------------------------------

model pol_donation_fact {
  id         String @id @default(uuid())
  tenantId   String
  campaignId String?
  partyId    String?

  amount        Decimal  @db.Decimal(15, 2)
  currency      String   @default("NGN")
  source        PolDonationSource
  
  donorType     String?
  donorName     String?
  donorAddress  String?
  donorPhone    String?
  donorEmail    String?
  donorOccupation String?
  donorEmployer String?
  
  companyName   String?
  companyRegNo  String?
  
  state         String?
  lga           String?
  ward          String?
  
  donationDate  DateTime
  receiptDate   DateTime?
  description   String?
  purpose       String?
  
  inKindDescription String?
  inKindValue       Decimal? @db.Decimal(15, 2)
  
  status        PolDonationStatus @default(RECORDED)
  
  isAnonymous           Boolean @default(false)
  exceedsThreshold      Boolean @default(false)
  requiresDisclosure    Boolean @default(true)
  complianceNote        String?
  
  commerceRefId         String?
  
  recordedBy    String
  recordedAt    DateTime @default(now())
  
  campaign      pol_campaign? @relation(fields: [campaignId], references: [id])
  party         pol_party?    @relation(fields: [partyId], references: [id])
  
  @@index([tenantId])
  @@index([campaignId])
  @@index([partyId])
  @@index([donationDate])
  @@index([source])
  @@index([status])
  @@index([state])
  @@index([requiresDisclosure])
}

// ----------------------------------------------------------------------------
// EXPENSE FACT (APPEND-ONLY)
// ----------------------------------------------------------------------------

model pol_expense_fact {
  id         String @id @default(uuid())
  tenantId   String
  campaignId String?
  partyId    String?

  amount        Decimal  @db.Decimal(15, 2)
  currency      String   @default("NGN")
  category      PolExpenseCategory
  
  beneficiaryType   String?
  beneficiaryName   String
  beneficiaryAddress String?
  beneficiaryPhone  String?
  beneficiaryBank   String?
  beneficiaryAccount String?
  
  state         String?
  lga           String?
  ward          String?
  
  expenseDate   DateTime
  paymentDate   DateTime?
  description   String
  purpose       String?
  invoiceNo     String?
  receiptNo     String?
  
  hasInvoice    Boolean @default(false)
  hasReceipt    Boolean @default(false)
  documentRefs  String?
  
  status        PolExpenseStatus @default(RECORDED)
  
  isVerified    Boolean @default(false)
  verifiedBy    String?
  verifiedAt    DateTime?
  verificationNote String?
  
  exceedsThreshold      Boolean @default(false)
  requiresDisclosure    Boolean @default(true)
  complianceNote        String?
  
  commerceRefId         String?
  
  recordedBy    String
  recordedAt    DateTime @default(now())
  
  campaign      pol_campaign? @relation(fields: [campaignId], references: [id])
  party         pol_party?    @relation(fields: [partyId], references: [id])
  
  @@index([tenantId])
  @@index([campaignId])
  @@index([partyId])
  @@index([expenseDate])
  @@index([category])
  @@index([status])
  @@index([state])
  @@index([requiresDisclosure])
}

// ----------------------------------------------------------------------------
// DISCLOSURE (Reporting)
// ----------------------------------------------------------------------------

model pol_disclosure {
  id         String @id @default(uuid())
  tenantId   String
  campaignId String?
  partyId    String?

  title         String
  type          PolDisclosureType
  
  periodStart   DateTime
  periodEnd     DateTime
  
  jurisdiction  String?
  state         String?
  
  totalDonations    Decimal @db.Decimal(15, 2)
  donationCount     Int
  totalExpenses     Decimal @db.Decimal(15, 2)
  expenseCount      Int
  netBalance        Decimal @db.Decimal(15, 2)
  
  donationsBySource Json?
  expensesByCategory Json?
  
  topDonors         Json?
  largeExpenses     Json?
  
  status            PolDisclosureStatus @default(DRAFT)
  statusNote        String?
  
  submittedAt       DateTime?
  submittedBy       String?
  submittedTo       String?
  
  responseDate      DateTime?
  responseNote      String?
  
  disclaimer        String @default("UNOFFICIAL - FOR INTERNAL PARTY USE ONLY. NOT AN OFFICIAL REGULATORY FILING.")
  
  generatedAt       DateTime @default(now())
  generatedBy       String
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  campaign          pol_campaign? @relation(fields: [campaignId], references: [id])
  party             pol_party?    @relation(fields: [partyId], references: [id])
  
  @@index([tenantId])
  @@index([campaignId])
  @@index([partyId])
  @@index([type])
  @@index([status])
  @@index([periodStart])
  @@index([periodEnd])
}



// ============================================================================
// POLITICAL SUITE - Phase 3: Internal Elections & Primaries
// ============================================================================
// Authorization: January 8, 2026 (Checkpoint B Approved)
// Classification: HIGH-RISK PHASE  HEIGHTENED CONTROLS
// 
// MANDATORY LABELS:
// - UNOFFICIAL
// - INTERNAL / PARTY-LEVEL ONLY
// - NOT INEC / NOT GOVERNMENT / NOT CERTIFICATION
//
// ABSOLUTE PROHIBITIONS:
// - No general election logic
// - No voter register (public or private)
// - No biometrics or identity verification
// - No certification, validation, or endorsement
// - No INEC integration (direct or indirect)
// - No public-facing "official results"
// ============================================================================

// ----------------------------------------------------------------------------
// PHASE 3 ENUMS
// ----------------------------------------------------------------------------

enum PolPrimaryType {
  PRESIDENTIAL
  GUBERNATORIAL
  SENATORIAL
  HOUSE_OF_REPS
  STATE_ASSEMBLY
  LOCAL_GOVERNMENT
  COUNCILLORSHIP
  PARTY_EXECUTIVE
  DELEGATE_SELECTION
}

enum PolPrimaryStatus {
  DRAFT
  SCHEDULED
  NOMINATION_OPEN
  NOMINATION_CLOSED
  VOTING_OPEN
  VOTING_CLOSED
  COUNTING
  RESULTS_DECLARED
  CANCELLED
}

enum PolVotingMethod {
  DIRECT
  DELEGATE
  AFFIRMATION
  CONSENSUS
}

enum PolVoteStatus {
  CAST
  VOID
  CHALLENGED
}

enum PolResultStatus {
  PROVISIONAL
  DECLARED
  CHALLENGED
  NULLIFIED
}

enum PolPrimaryCapability {
  PRIMARY_SETUP
  PRIMARY_MANAGE
  NOMINATION_MANAGE
  VOTE_CAPTURE
  RESULTS_VIEW
  RESULTS_DECLARE
  AUDIT_VIEW
}

// ----------------------------------------------------------------------------
// PRIMARY ELECTION (Party-Level Only)
// ----------------------------------------------------------------------------
// DISCLAIMER: This is for INTERNAL PARTY USE ONLY.
// NOT an official election. NOT INEC-affiliated.
// Results are UNOFFICIAL and have no legal standing.
// ----------------------------------------------------------------------------

model pol_primary {
  id         String @id @default(uuid())
  tenantId   String
  partyId    String

  // Primary Identity
  title         String
  type          PolPrimaryType
  description   String?
  
  // Jurisdiction Hard-Scoping (MANDATORY)
  // All operations must respect this scope
  country       String @default("NG")
  zone          String?
  state         String?
  constituency  String?
  lga           String?
  ward          String?
  
  // Office Being Contested
  office        String   // e.g., "Governor", "Senator", "Party Chairman"
  
  // Voting Configuration
  votingMethod  PolVotingMethod @default(DIRECT)
  isSecretBallot Boolean @default(true)
  maxVotesPerVoter Int @default(1)
  
  // Timeline
  nominationStart DateTime?
  nominationEnd   DateTime?
  votingStart     DateTime?
  votingEnd       DateTime?
  
  // Status
  status          PolPrimaryStatus @default(DRAFT)
  statusNote      String?
  
  // Eligibility Rules
  voterEligibility String?  // JSON: { membershipMinDays: 180, roles: ["DELEGATE"] }
  candidateEligibility String?  // JSON: { membershipMinYears: 2, clearanceRequired: true }
  
  // Delegate Count (if delegate voting)
  totalDelegates    Int?
  delegatesPresent  Int?
  quorumRequired    Int?
  
  // MANDATORY DISCLAIMERS (Stored)
  disclaimer        String @default("UNOFFICIAL - INTERNAL PARTY USE ONLY. NOT AN OFFICIAL ELECTION. NOT INEC-AFFILIATED. RESULTS HAVE NO LEGAL STANDING.")
  
  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String
  
  // Relations
  party       pol_party @relation(fields: [partyId], references: [id], onDelete: Cascade)
  aspirants   pol_primary_aspirant[]
  votes       pol_internal_vote[]
  results     pol_primary_result[]
  // Phase 4: Governance & Post-Election
  petitions   pol_petition[]
  engagements pol_engagement[]
  
  @@index([tenantId])
  @@index([partyId])
  @@index([type])
  @@index([status])
  @@index([state])
  @@index([votingStart])
}

// ----------------------------------------------------------------------------
// PRIMARY ASPIRANT (Candidate in Primary)
// ----------------------------------------------------------------------------

model pol_primary_aspirant {
  id         String @id @default(uuid())
  tenantId   String
  primaryId  String
  memberId   String?

  // Aspirant Identity
  firstName   String
  lastName    String
  otherNames  String?
  
  // Contact
  phone       String
  email       String?
  
  // Nomination
  nominatedAt DateTime @default(now())
  nominatedBy String?
  
  // Screening (Party-Level Only)
  isScreened      Boolean @default(false)
  screenedAt      DateTime?
  screenedBy      String?
  screeningNote   String?
  screeningPassed Boolean?
  
  // Clearance (Party-Level Only)
  isCleared       Boolean @default(false)
  clearedAt       DateTime?
  clearedBy       String?
  clearanceNote   String?
  
  // Withdrawal
  hasWithdrawn    Boolean @default(false)
  withdrawnAt     DateTime?
  withdrawalNote  String?
  
  // Profile
  biography       String?
  photoUrl        String?
  
  // Order on Ballot
  ballotPosition  Int?
  
  // Status
  isActive        Boolean @default(true)
  
  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  primary   pol_primary @relation(fields: [primaryId], references: [id], onDelete: Cascade)
  member    pol_member? @relation(fields: [memberId], references: [id])
  votes     pol_internal_vote[]
  results   pol_primary_result[]
  
  @@index([tenantId])
  @@index([primaryId])
  @@index([memberId])
  @@index([isCleared])
  @@index([isActive])
}

// ----------------------------------------------------------------------------
// INTERNAL VOTE (APPEND-ONLY)
// ----------------------------------------------------------------------------
// CRITICAL: Votes are APPEND-ONLY. Once cast, cannot be modified or deleted.
// This is for INTERNAL PARTY voting only. NOT a public election.
// ----------------------------------------------------------------------------

model pol_internal_vote {
  id         String @id @default(uuid())
  tenantId   String
  primaryId  String
  aspirantId String

  // Voter Reference (NOT a voter register)
  // This is a party member ID, NOT a public voter ID
  voterId       String   // Party member ID
  voterDelegate String?  // If delegate voting, delegate ID
  
  // Vote Details
  voteWeight    Int @default(1)  // For weighted voting systems
  status        PolVoteStatus @default(CAST)
  
  // Jurisdiction Context (Hard-Scoped)
  state         String?
  lga           String?
  ward          String?
  pollingPoint  String?  // Internal party polling point
  
  // Vote Capture Context
  capturedBy    String   // Person who captured the vote
  capturedAt    DateTime @default(now())
  captureMethod String?  // "MANUAL", "ELECTRONIC", "ACCLAMATION"
  
  // Verification (Party-Level Only)
  isVerified    Boolean @default(false)
  verifiedBy    String?
  verifiedAt    DateTime?
  
  // Challenge (if disputed)
  isChallenged  Boolean @default(false)
  challengeNote String?
  challengedBy  String?
  challengedAt  DateTime?
  
  // MANDATORY DISCLAIMER
  disclaimer    String @default("INTERNAL PARTY VOTE - UNOFFICIAL - NOT A PUBLIC ELECTION")
  
  // Audit Fields (IMMUTABLE - No updatedAt)
  recordedAt    DateTime @default(now())
  
  // Relations
  primary   pol_primary @relation(fields: [primaryId], references: [id], onDelete: Cascade)
  aspirant  pol_primary_aspirant @relation(fields: [aspirantId], references: [id], onDelete: Cascade)
  
  @@index([tenantId])
  @@index([primaryId])
  @@index([aspirantId])
  @@index([voterId])
  @@index([state])
  @@index([status])
  @@index([recordedAt])
}

// ----------------------------------------------------------------------------
// PRIMARY RESULT (APPEND-ONLY)
// ----------------------------------------------------------------------------
// CRITICAL: Results are APPEND-ONLY. Once declared, cannot be modified.
// Results are UNOFFICIAL and for INTERNAL PARTY USE ONLY.
// NO LEGAL STANDING. NOT INEC-CERTIFIED.
// ----------------------------------------------------------------------------

model pol_primary_result {
  id         String @id @default(uuid())
  tenantId   String
  primaryId  String
  aspirantId String

  // Result Scope (Jurisdiction)
  scope         String   // "OVERALL", "STATE", "LGA", "WARD"
  state         String?
  lga           String?
  ward          String?
  
  // Vote Counts
  votesReceived Int
  votePercentage Decimal @db.Decimal(5, 2)
  
  // Ranking
  position      Int      // 1st, 2nd, 3rd, etc.
  
  // Status
  status        PolResultStatus @default(PROVISIONAL)
  
  // Declaration
  declaredAt    DateTime?
  declaredBy    String?
  
  // Winner Flag
  isWinner      Boolean @default(false)
  
  // Challenge/Nullification
  isChallenged  Boolean @default(false)
  challengeNote String?
  isNullified   Boolean @default(false)
  nullificationNote String?
  
  // MANDATORY DISCLAIMERS (Multiple for emphasis)
  disclaimer1   String @default("UNOFFICIAL RESULT")
  disclaimer2   String @default("INTERNAL PARTY USE ONLY")
  disclaimer3   String @default("NOT INEC-CERTIFIED - NO LEGAL STANDING")
  
  // Audit Fields (IMMUTABLE - No updatedAt)
  recordedBy    String
  recordedAt    DateTime @default(now())
  
  // Relations
  primary   pol_primary @relation(fields: [primaryId], references: [id], onDelete: Cascade)
  aspirant  pol_primary_aspirant @relation(fields: [aspirantId], references: [id], onDelete: Cascade)
  
  @@unique([primaryId, aspirantId, scope, state, lga, ward])
  @@index([tenantId])
  @@index([primaryId])
  @@index([aspirantId])
  @@index([status])
  @@index([isWinner])
  @@index([recordedAt])
}

// ============================================================================
// POLITICAL SUITE - PHASE 4: GOVERNANCE & POST-ELECTION
// Authorization: January 8, 2026 (Checkpoint C Approved)
// Classification: HIGH-RISK PHASE  GOVERNANCE CONTROLS
// 
// SCOPE:
// - Petitions & grievance handling
// - Post-election community engagement
// - Regulator/observer read-only access
// - Audit trails & evidence export
// - Transparency publishing (clearly labeled, non-partisan)
//
// CONSTRAINTS:
// - No payments or financial execution
// - No official election certification
// - No INEC integration
// - Append-only rules for petitions and audit records
// ============================================================================

// Petition Types
enum PolPetitionType {
  ELECTORAL_MALPRACTICE
  PROCEDURAL_VIOLATION
  RESULT_CHALLENGE
  CANDIDATE_ELIGIBILITY
  VOTER_INTIMIDATION
  BALLOT_IRREGULARITY
  COUNTING_ERROR
  OTHER
}

// Petition Status
enum PolPetitionStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  EVIDENCE_REQUESTED
  HEARING_SCHEDULED
  DECIDED
  APPEALED
  CLOSED
  WITHDRAWN
}

// Engagement Type
enum PolEngagementType {
  TOWN_HALL
  PRESS_RELEASE
  COMMUNITY_MEETING
  STAKEHOLDER_BRIEFING
  THANK_YOU_MESSAGE
  POLICY_ANNOUNCEMENT
  TRANSITION_UPDATE
}

// Regulator Access Level
enum PolRegulatorAccessLevel {
  OBSERVER         // Can view public data only
  AUDITOR          // Can view audit logs
  INVESTIGATOR     // Can view evidence and petitions
  COMPLIANCE       // Full read access (no write)
}

// Evidence Type
enum PolEvidenceType {
  DOCUMENT
  PHOTO
  VIDEO
  AUDIO
  WITNESS_STATEMENT
  OFFICIAL_RECORD
  AFFIDAVIT
  OTHER
}

// Transparency Report Type
enum PolTransparencyType {
  FINANCIAL_SUMMARY
  ACTIVITY_REPORT
  ELECTION_RESULT_SUMMARY
  MEMBERSHIP_STATISTICS
  AUDIT_SUMMARY
  COMPLIANCE_REPORT
}

// ============================================================================
// PETITIONS & GRIEVANCE HANDLING (APPEND-ONLY)
// ============================================================================

model pol_petition {
  id         String @id @default(uuid())
  tenantId   String
  partyId    String
  
  // Petition Details
  type        PolPetitionType
  title       String
  description String @db.Text
  status      PolPetitionStatus @default(DRAFT)
  
  // Related Entity (optional)
  primaryId   String?  // If related to a primary
  campaignId  String?  // If related to a campaign
  
  // Jurisdiction
  state       String?
  lga         String?
  ward        String?
  
  // Petitioner Info (Party Member Only)
  petitionerId   String   // Party member ID
  petitionerName String
  petitionerRole String?
  
  // Respondent (if applicable)
  respondentId   String?
  respondentName String?
  
  // Timeline
  incidentDate   DateTime?
  submittedAt    DateTime?
  reviewStartedAt DateTime?
  decidedAt      DateTime?
  
  // Decision (if decided)
  decision       String? @db.Text
  decidedBy      String?
  isUpheld       Boolean?
  
  // Appeal
  isAppealed     Boolean @default(false)
  appealNote     String? @db.Text
  appealedAt     DateTime?
  
  // MANDATORY DISCLAIMERS
  disclaimer1    String @default("INTERNAL PARTY GRIEVANCE")
  disclaimer2    String @default("NOT A LEGAL PROCEEDING")
  disclaimer3    String @default("NO OFFICIAL STANDING")
  
  // Audit Fields (APPEND-ONLY for core data)
  createdBy      String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  // Relations
  party          pol_party @relation(fields: [partyId], references: [id], onDelete: Cascade)
  primary        pol_primary? @relation(fields: [primaryId], references: [id])
  campaign       pol_campaign? @relation(fields: [campaignId], references: [id])
  evidence       pol_evidence[]
  auditLogs      pol_governance_audit[]
  
  @@index([tenantId])
  @@index([partyId])
  @@index([status])
  @@index([type])
  @@index([petitionerId])
  @@index([submittedAt])
}

// ============================================================================
// EVIDENCE RECORDS (APPEND-ONLY / IMMUTABLE)
// ============================================================================

model pol_evidence {
  id         String @id @default(uuid())
  tenantId   String
  petitionId String
  
  // Evidence Details
  type        PolEvidenceType
  title       String
  description String? @db.Text
  
  // File Reference (if applicable)
  fileUrl     String?
  fileName    String?
  fileSize    Int?
  mimeType    String?
  
  // Witness Statement (if applicable)
  witnessName    String?
  witnessContact String?
  statement      String? @db.Text
  
  // Verification
  isVerified     Boolean @default(false)
  verifiedBy     String?
  verifiedAt     DateTime?
  verificationNote String?
  
  // Chain of Custody
  submittedBy    String
  submittedAt    DateTime @default(now())
  
  // IMMUTABLE: No updatedAt - Evidence cannot be modified
  recordedAt     DateTime @default(now())
  
  // MANDATORY DISCLAIMER
  disclaimer     String @default("EVIDENCE SUBMITTED - INTERNAL PARTY USE ONLY")
  
  // Relations
  petition       pol_petition @relation(fields: [petitionId], references: [id], onDelete: Cascade)
  
  @@index([tenantId])
  @@index([petitionId])
  @@index([type])
  @@index([isVerified])
}

// ============================================================================
// POST-ELECTION COMMUNITY ENGAGEMENT
// ============================================================================

model pol_engagement {
  id         String @id @default(uuid())
  tenantId   String
  partyId    String
  
  // Engagement Details
  type        PolEngagementType
  title       String
  description String @db.Text
  content     String? @db.Text  // Full content/message
  
  // Related Context
  campaignId  String?
  primaryId   String?
  
  // Target Audience
  targetAudience String?  // e.g., "All Members", "Lagos State", "Ward Leaders"
  
  // Jurisdiction Scope
  state       String?
  lga         String?
  ward        String?
  
  // Schedule
  scheduledAt DateTime?
  publishedAt DateTime?
  
  // Status
  isDraft     Boolean @default(true)
  isPublished Boolean @default(false)
  
  // Metrics (if tracked)
  viewCount   Int @default(0)
  
  // MANDATORY NON-PARTISAN LABELS
  disclaimer1 String @default("NON-PARTISAN COMMUNITY ENGAGEMENT")
  disclaimer2 String @default("FOR INFORMATIONAL PURPOSES ONLY")
  
  // Audit Fields
  createdBy   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  party       pol_party @relation(fields: [partyId], references: [id], onDelete: Cascade)
  campaign    pol_campaign? @relation(fields: [campaignId], references: [id])
  primary     pol_primary? @relation(fields: [primaryId], references: [id])
  
  @@index([tenantId])
  @@index([partyId])
  @@index([type])
  @@index([isPublished])
  @@index([scheduledAt])
}

// ============================================================================
// REGULATOR/OBSERVER ACCESS (READ-ONLY)
// ============================================================================

model pol_regulator_access {
  id         String @id @default(uuid())
  tenantId   String
  partyId    String
  
  // Regulator Details
  regulatorName   String   // e.g., "INEC Observer", "Civil Society Monitor"
  regulatorType   String   // e.g., "GOVERNMENT", "NGO", "INTERNATIONAL"
  contactName     String
  contactEmail    String
  contactPhone    String?
  
  // Access Configuration
  accessLevel     PolRegulatorAccessLevel @default(OBSERVER)
  
  // Access Scope (what they can see)
  canViewParties      Boolean @default(true)
  canViewCampaigns    Boolean @default(true)
  canViewPrimaries    Boolean @default(true)
  canViewResults      Boolean @default(true)
  canViewAuditLogs    Boolean @default(false)
  canViewPetitions    Boolean @default(false)
  canViewEvidence     Boolean @default(false)
  canViewFinancials   Boolean @default(false)
  
  // Access Validity
  grantedAt       DateTime @default(now())
  expiresAt       DateTime?
  isActive        Boolean @default(true)
  
  // Revocation
  revokedAt       DateTime?
  revokedBy       String?
  revocationReason String?
  
  // MANDATORY LABELS
  disclaimer1     String @default("READ-ONLY ACCESS")
  disclaimer2     String @default("NO WRITE PERMISSIONS")
  disclaimer3     String @default("AUDIT LOGGED")
  
  // Audit Fields
  grantedBy       String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  party           pol_party @relation(fields: [partyId], references: [id], onDelete: Cascade)
  accessLogs      pol_regulator_access_log[]
  
  @@index([tenantId])
  @@index([partyId])
  @@index([regulatorName])
  @@index([accessLevel])
  @@index([isActive])
}

// Regulator Access Audit Log (APPEND-ONLY)
model pol_regulator_access_log {
  id         String @id @default(uuid())
  tenantId   String
  accessId   String  // Reference to pol_regulator_access
  
  // Access Event Details
  action      String   // "VIEW", "EXPORT", "SEARCH"
  resource    String   // What was accessed
  resourceId  String?  // Specific record ID if applicable
  
  // Context
  ipAddress   String?
  userAgent   String?
  
  // IMMUTABLE: No updatedAt
  accessedAt  DateTime @default(now())
  
  // Relations
  regulatorAccess pol_regulator_access @relation(fields: [accessId], references: [id], onDelete: Cascade)
  
  @@index([tenantId])
  @@index([accessId])
  @@index([action])
  @@index([accessedAt])
}

// ============================================================================
// GOVERNANCE AUDIT TRAIL (APPEND-ONLY / IMMUTABLE)
// ============================================================================

model pol_governance_audit {
  id         String @id @default(uuid())
  tenantId   String
  
  // What was audited
  entityType   String   // "petition", "engagement", "regulator_access", "evidence"
  entityId     String
  
  // Action taken
  action       String   // "CREATE", "UPDATE", "STATUS_CHANGE", "SUBMIT", "DECIDE"
  
  // Actor
  actorId      String
  actorType    String?  // "MEMBER", "ADMIN", "SYSTEM", "REGULATOR"
  
  // Change Details
  previousState String? @db.Text  // JSON snapshot before change
  newState      String? @db.Text  // JSON snapshot after change
  changeNote    String? @db.Text
  
  // Context
  ipAddress    String?
  userAgent    String?
  
  // Jurisdiction Context
  partyId      String?
  state        String?
  lga          String?
  ward         String?
  
  // IMMUTABLE: No updatedAt - Audit logs can never be modified
  recordedAt   DateTime @default(now())
  
  // Hash for integrity verification (optional)
  recordHash   String?
  
  // Relations
  petition     pol_petition? @relation(fields: [entityId], references: [id])
  
  @@index([tenantId])
  @@index([entityType])
  @@index([entityId])
  @@index([actorId])
  @@index([action])
  @@index([recordedAt])
}

// ============================================================================
// TRANSPARENCY PUBLISHING
// ============================================================================

model pol_transparency_report {
  id         String @id @default(uuid())
  tenantId   String
  partyId    String
  
  // Report Details
  type        PolTransparencyType
  title       String
  period      String   // e.g., "Q1 2026", "2025 Annual"
  
  // Report Content
  summary     String @db.Text
  content     String? @db.Text  // Full report content
  
  // Data Snapshot (JSON)
  dataSnapshot String? @db.Text
  
  // File Reference (if exported)
  fileUrl     String?
  fileName    String?
  
  // Publication
  isDraft     Boolean @default(true)
  isPublished Boolean @default(false)
  publishedAt DateTime?
  publishedBy String?
  
  // MANDATORY NON-PARTISAN LABELS
  disclaimer1 String @default("TRANSPARENCY REPORT")
  disclaimer2 String @default("NON-PARTISAN - FOR PUBLIC INFORMATION")
  disclaimer3 String @default("UNOFFICIAL - NOT GOVERNMENT CERTIFIED")
  
  // Audit Fields
  createdBy   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  party       pol_party @relation(fields: [partyId], references: [id], onDelete: Cascade)
  
  @@index([tenantId])
  @@index([partyId])
  @@index([type])
  @@index([isPublished])
  @@index([publishedAt])
}


// ============================================================================
// CHURCH SUITE  PHASE 1: REGISTRY & MEMBERSHIP
// Authorization: January 8, 2026
// Classification: HIGH-RISK VERTICAL (faith, money, minors, trust)
// Commerce Boundary: FACTS ONLY  Church Suite does NOT process payments
// ============================================================================

// --- ENUMS ---

enum ChuMemberStatus {
  VISITOR
  NEW_CONVERT
  MEMBER
  WORKER
  INACTIVE
  TRANSFERRED
  DECEASED
}

enum ChuChurchUnitLevel {
  DENOMINATION    // Level 0 - Root church
  DIOCESE         // Level 1 - Regional grouping
  ZONE            // Level 2 - Area grouping
  DISTRICT        // Level 3 - District grouping
  PARISH          // Level 4 - Local church
}

enum ChuRoleType {
  SENIOR_PASTOR
  ASSOCIATE_PASTOR
  PASTOR
  ELDER
  DEACON
  DEACONESS
  TRUSTEE
  CHURCH_ADMIN
  TREASURER
  SECRETARY
  DEPARTMENT_HEAD
  CELL_LEADER
  WORKER
  MEMBER
}

enum ChuGender {
  MALE
  FEMALE
}

// --- CHURCH REGISTRY & STRUCTURE (5 tables) ---

// Root church entity (denomination-neutral)
model chu_church {
  id              String    @id @default(uuid())
  tenantId        String
  
  // Church Identity
  name            String
  acronym         String?
  motto           String?
  vision          String?   @db.Text
  mission         String?   @db.Text
  
  // Registration (Nigeria: CAC/NGO)
  registrationNo  String?
  registeredDate  DateTime?
  
  // Location
  headquarters    String?
  address         String?
  city            String?
  state           String?
  country         String    @default("Nigeria")
  
  // Contact
  phone           String?
  email           String?
  website         String?
  
  // Branding
  logoUrl         String?
  primaryColor    String?
  secondaryColor  String?
  
  // Hierarchy Settings
  maxHierarchyLevels Int @default(5)
  
  // Metadata
  status          String    @default("ACTIVE")
  createdBy       String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  units           chu_church_unit[]
  members         chu_member[]
  cellGroups      chu_cell_group[]
  roles           chu_role[]
  roleAssignments chu_role_assignment[]
  auditLogs       chu_audit_log[]
  
  @@unique([tenantId, name])
  @@index([tenantId])
  @@index([state])
  @@index([status])
}

// Church structural units (diocese, zone, district, parish)
model chu_church_unit {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  
  // Unit Identity
  name            String
  code            String?   // e.g., "LM-IKJ-001"
  level           ChuChurchUnitLevel
  
  // Hierarchy
  parentUnitId    String?
  hierarchyPath   String?   // e.g., "/root/diocese-1/zone-2/parish-3"
  
  // Location (Nigeria-first)
  address         String?
  city            String?
  lga             String?   // Local Government Area
  state           String?
  
  // Contact
  phone           String?
  email           String?
  
  // Leadership (current - assignment history is separate)
  currentLeaderId String?
  currentLeaderTitle String?
  
  // Status
  status          String    @default("ACTIVE")
  establishedDate DateTime?
  
  // Metadata
  createdBy       String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  church          chu_church @relation(fields: [churchId], references: [id], onDelete: Cascade)
  parentUnit      chu_church_unit? @relation("UnitHierarchy", fields: [parentUnitId], references: [id])
  childUnits      chu_church_unit[] @relation("UnitHierarchy")
  members         chu_member[]
  cellGroups      chu_cell_group[]
  roleAssignments chu_role_assignment[]
  
  @@unique([tenantId, churchId, code])
  @@index([tenantId])
  @@index([churchId])
  @@index([parentUnitId])
  @@index([level])
  @@index([state])
  @@index([status])
}

// Cell/Fellowship groups (lowest level - Nigeria-specific)
model chu_cell_group {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  unitId          String?   // Parent parish/unit
  
  // Cell Identity
  name            String
  code            String?   // e.g., "CELL-001"
  
  // Location (usually in member's home)
  hostName        String?
  hostPhone       String?
  address         String?
  area            String?   // Neighborhood
  
  // Schedule
  meetingDay      String?   // e.g., "WEDNESDAY"
  meetingTime     String?   // e.g., "18:00"
  
  // Leadership
  cellLeaderId    String?
  assistantLeaderId String?
  
  // Capacity
  maxMembers      Int?      @default(15)
  
  // Status
  status          String    @default("ACTIVE")
  establishedDate DateTime?
  
  // Metadata
  createdBy       String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  church          chu_church @relation(fields: [churchId], references: [id], onDelete: Cascade)
  unit            chu_church_unit? @relation(fields: [unitId], references: [id])
  members         chu_cell_membership[]
  
  @@unique([tenantId, churchId, code])
  @@index([tenantId])
  @@index([churchId])
  @@index([unitId])
  @@index([status])
}

// Role definitions (Pastor, Elder, Deacon, etc.)
model chu_role {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  
  // Role Definition
  name            String
  type            ChuRoleType
  description     String?   @db.Text
  
  // Scope (can role be assigned at unit level?)
  canAssignAtUnit Boolean   @default(true)
  
  // Permissions (JSON array of capability keys)
  permissions     String?   @db.Text
  
  // Status
  isActive        Boolean   @default(true)
  
  // Metadata
  createdBy       String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  church          chu_church @relation(fields: [churchId], references: [id], onDelete: Cascade)
  assignments     chu_role_assignment[]
  
  @@unique([tenantId, churchId, name])
  @@index([tenantId])
  @@index([churchId])
  @@index([type])
}

// Role assignments (time-bound, APPEND-ONLY for history)
model chu_role_assignment {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  
  // Who is assigned
  memberId        String
  roleId          String
  
  // Where (optional - church-wide or unit-specific)
  unitId          String?
  
  // When
  assignedDate    DateTime  @default(now())
  effectiveDate   DateTime?
  endDate         DateTime? // Null = active
  
  // Who assigned
  assignedBy      String
  
  // Termination (if ended)
  terminatedBy    String?
  terminationReason String?
  
  // Status
  isActive        Boolean   @default(true)
  
  // APPEND-ONLY: Can't modify, only terminate
  createdAt       DateTime  @default(now())
  
  // Relations
  church          chu_church @relation(fields: [churchId], references: [id], onDelete: Cascade)
  member          chu_member @relation(fields: [memberId], references: [id])
  role            chu_role @relation(fields: [roleId], references: [id])
  unit            chu_church_unit? @relation(fields: [unitId], references: [id])
  
  @@index([tenantId])
  @@index([churchId])
  @@index([memberId])
  @@index([roleId])
  @@index([unitId])
  @@index([isActive])
}

// --- MEMBERSHIP & PASTORAL CARE (7 tables) ---

// Member record with safeguarding flags
model chu_member {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  unitId          String?   // Home parish/unit
  
  // Personal Information
  firstName       String
  middleName      String?
  lastName        String
  gender          ChuGender?
  dateOfBirth     DateTime?
  
  //  SAFEGUARDING: Minors flag
  isMinor         Boolean   @default(false)
  
  // Contact
  phone           String?
  email           String?
  address         String?
  city            String?
  lga             String?
  state           String?
  
  // Membership
  membershipNo    String?   // Church-assigned ID
  status          ChuMemberStatus @default(VISITOR)
  joinDate        DateTime?
  baptismDate     DateTime?
  confirmationDate DateTime?
  
  // Origin
  previousChurch  String?
  transferLetter  Boolean   @default(false)
  
  // Occupation (Nigeria context)
  occupation      String?
  employer        String?
  
  // Emergency Contact
  emergencyContactName  String?
  emergencyContactPhone String?
  emergencyContactRelation String?
  
  // Photo
  photoUrl        String?
  
  // Metadata
  registeredBy    String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  church          chu_church @relation(fields: [churchId], references: [id], onDelete: Cascade)
  unit            chu_church_unit? @relation(fields: [unitId], references: [id])
  statusHistory   chu_member_status[]
  guardianLinks   chu_guardian_link[] @relation("MinorGuardianLinks")
  guardiansOf     chu_guardian_link[] @relation("GuardianForMinors")
  cellMemberships chu_cell_membership[]
  roleAssignments chu_role_assignment[]
  familyUnit      chu_family_unit?  @relation(fields: [familyUnitId], references: [id])
  familyUnitId    String?
  
  @@unique([tenantId, churchId, membershipNo])
  @@index([tenantId])
  @@index([churchId])
  @@index([unitId])
  @@index([status])
  @@index([isMinor])
  @@index([state])
}

// Member status history (APPEND-ONLY)
model chu_member_status {
  id              String    @id @default(uuid())
  tenantId        String
  memberId        String
  
  // Status Change
  previousStatus  ChuMemberStatus?
  newStatus       ChuMemberStatus
  reason          String?
  
  // Who changed
  changedBy       String
  
  // APPEND-ONLY: No updates or deletes
  changedAt       DateTime  @default(now())
  
  // Relations
  member          chu_member @relation(fields: [memberId], references: [id], onDelete: Cascade)
  
  @@index([tenantId])
  @@index([memberId])
  @@index([newStatus])
  @@index([changedAt])
}

// Guardian linkage for minors ( SAFEGUARDING)
model chu_guardian_link {
  id              String    @id @default(uuid())
  tenantId        String
  
  // Minor (the protected person)
  minorId         String
  
  // Guardian (must be adult member)
  guardianId      String
  
  // Relationship
  relationship    String    // "FATHER", "MOTHER", "GUARDIAN", etc.
  isPrimaryGuardian Boolean @default(false)
  
  // Verification
  isVerified      Boolean   @default(false)
  verifiedBy      String?
  verifiedAt      DateTime?
  
  // Consent
  consentGiven    Boolean   @default(false)
  consentDate     DateTime?
  
  // Status
  isActive        Boolean   @default(true)
  
  // Metadata
  createdBy       String
  createdAt       DateTime  @default(now())
  
  // Relations
  minor           chu_member @relation("MinorGuardianLinks", fields: [minorId], references: [id], onDelete: Cascade)
  guardian        chu_member @relation("GuardianForMinors", fields: [guardianId], references: [id], onDelete: Cascade)
  
  @@unique([minorId, guardianId])
  @@index([tenantId])
  @@index([minorId])
  @@index([guardianId])
  @@index([isActive])
}

// Family/Household unit (Nigeria-first: extended families common)
model chu_family_unit {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  
  // Family Identity
  familyName      String    // e.g., "The Adeyemi Family"
  
  // Head of Family
  headId          String?
  
  // Address (single family address)
  address         String?
  city            String?
  state           String?
  
  // Status
  isActive        Boolean   @default(true)
  
  // Metadata
  createdBy       String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  members         chu_member[]
  
  @@index([tenantId])
  @@index([churchId])
}

// Cell group membership (APPEND-ONLY for history)
model chu_cell_membership {
  id              String    @id @default(uuid())
  tenantId        String
  memberId        String
  cellGroupId     String
  
  // Membership Period
  joinedDate      DateTime  @default(now())
  leftDate        DateTime?
  
  // Role in cell
  role            String?   // "LEADER", "ASSISTANT", "HOST", "MEMBER"
  
  // Status
  isActive        Boolean   @default(true)
  
  // Who registered
  registeredBy    String
  
  // APPEND-ONLY: Can't modify, only mark as left
  createdAt       DateTime  @default(now())
  
  // Relations
  member          chu_member @relation(fields: [memberId], references: [id], onDelete: Cascade)
  cellGroup       chu_cell_group @relation(fields: [cellGroupId], references: [id], onDelete: Cascade)
  
  @@unique([memberId, cellGroupId, joinedDate])
  @@index([tenantId])
  @@index([memberId])
  @@index([cellGroupId])
  @@index([isActive])
}

// --- AUDIT LOG (APPEND-ONLY) ---

model chu_audit_log {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  
  // What was audited
  entityType      String    // "church", "unit", "member", "role_assignment", etc.
  entityId        String
  
  // Action taken
  action          String    // "CREATE", "UPDATE", "STATUS_CHANGE", "ASSIGN", "TERMINATE"
  
  // Actor
  actorId         String
  actorType       String?   // "MEMBER", "ADMIN", "SYSTEM"
  
  // Change Details
  previousState   String?   @db.Text  // JSON snapshot
  newState        String?   @db.Text  // JSON snapshot
  changeNote      String?   @db.Text
  
  // Context
  ipAddress       String?
  userAgent       String?
  
  // Jurisdiction
  unitId          String?
  
  // APPEND-ONLY: No updatedAt - Audit logs can never be modified
  recordedAt      DateTime  @default(now())
  
  // Hash for integrity verification
  recordHash      String?
  
  // Relations
  church          chu_church @relation(fields: [churchId], references: [id], onDelete: Cascade)
  
  @@index([tenantId])
  @@index([churchId])
  @@index([entityType])
  @@index([entityId])
  @@index([actorId])
  @@index([action])
  @@index([recordedAt])
}

// ============================================================================
// CHURCH SUITE  PHASE 2: MINISTRIES, SERVICES & EVENTS
// Authorization: January 8, 2026 (Checkpoint A Approved)
// Classification: MEDIUM RISK
// ============================================================================

// --- PHASE 2 ENUMS ---

enum ChuMinistryType {
  CHOIR
  USHERING
  MEDIA
  WELFARE
  CHILDREN
  YOUTH
  MEN
  WOMEN
  EVANGELISM
  PRAYER
  OTHER
}

enum ChuServiceType {
  SUNDAY_SERVICE
  MIDWEEK_SERVICE
  SPECIAL_SERVICE
  PRAYER_MEETING
  BIBLE_STUDY
  VIGIL
  CRUSADE
  CONFERENCE
}

enum ChuEventStatus {
  DRAFT
  SCHEDULED
  ONGOING
  COMPLETED
  CANCELLED
}

// --- MINISTRIES & DEPARTMENTS (5 tables) ---

// Ministry - Choir, Youth, Men, Women, etc.
model chu_ministry {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  unitId          String?   // Scope to specific unit (optional)
  
  // Ministry Identity
  name            String
  type            ChuMinistryType
  description     String?   @db.Text
  
  // Leadership
  leaderId        String?
  assistantLeaderId String?
  
  // Schedule
  meetingDay      String?   // e.g., "SATURDAY"
  meetingTime     String?   // e.g., "16:00"
  meetingLocation String?
  
  // Status
  isActive        Boolean   @default(true)
  establishedDate DateTime?
  
  // Metadata
  createdBy       String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  departments     chu_department[]
  assignments     chu_ministry_assignment[]
  volunteerLogs   chu_volunteer_log[]
  
  @@unique([tenantId, churchId, name])
  @@index([tenantId])
  @@index([churchId])
  @@index([unitId])
  @@index([type])
  @@index([isActive])
}

// Department - Sub-units within church administration
model chu_department {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  ministryId      String?   // Optional parent ministry
  
  // Department Identity
  name            String
  code            String?   // e.g., "FIN", "ADM"
  description     String?   @db.Text
  
  // Leadership
  headId          String?
  deputyHeadId    String?
  
  // Status
  isActive        Boolean   @default(true)
  
  // Metadata
  createdBy       String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  ministry        chu_ministry? @relation(fields: [ministryId], references: [id])
  assignments     chu_ministry_assignment[]
  
  @@unique([tenantId, churchId, name])
  @@index([tenantId])
  @@index([churchId])
  @@index([ministryId])
  @@index([isActive])
}

// Ministry Assignment - Member to Ministry/Department
model chu_ministry_assignment {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  
  // Assignment
  memberId        String
  ministryId      String?
  departmentId    String?
  
  // Role in ministry
  role            String?   // e.g., "LEADER", "ASSISTANT", "MEMBER"
  
  // Period
  assignedDate    DateTime  @default(now())
  effectiveDate   DateTime?
  endDate         DateTime?
  
  // Who assigned
  assignedBy      String
  
  // Status
  isActive        Boolean   @default(true)
  
  // Metadata
  createdAt       DateTime  @default(now())
  
  // Relations
  ministry        chu_ministry? @relation(fields: [ministryId], references: [id], onDelete: SetNull)
  department      chu_department? @relation(fields: [departmentId], references: [id], onDelete: SetNull)
  
  @@index([tenantId])
  @@index([churchId])
  @@index([memberId])
  @@index([ministryId])
  @@index([departmentId])
  @@index([isActive])
}

// Training Record - Member training history
model chu_training_record {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  memberId        String
  
  // Training Details
  title           String
  description     String?   @db.Text
  trainingType    String?   // "WORKSHOP", "SEMINAR", "COURSE", "ORIENTATION"
  
  // Provider
  provider        String?   // Internal or external
  facilitator     String?
  
  // Schedule
  startDate       DateTime
  endDate         DateTime?
  durationHours   Int?
  
  // Completion
  isCompleted     Boolean   @default(false)
  completedDate   DateTime?
  certificateUrl  String?
  
  // Metadata
  createdBy       String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@index([tenantId])
  @@index([churchId])
  @@index([memberId])
  @@index([isCompleted])
}

// Volunteer Log - Service activity (APPEND-ONLY)
model chu_volunteer_log {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  memberId        String
  ministryId      String?
  
  // Activity
  activity        String
  description     String?
  
  // Time
  serviceDate     DateTime
  hoursServed     Float?
  
  // Context
  eventId         String?   // Link to event if applicable
  serviceId       String?   // Link to church service if applicable
  
  // Verified by
  verifiedBy      String?
  verifiedAt      DateTime?
  
  // APPEND-ONLY: No updatedAt
  createdAt       DateTime  @default(now())
  
  // Relations
  ministry        chu_ministry? @relation(fields: [ministryId], references: [id])
  event           chu_event? @relation(fields: [eventId], references: [id])
  service         chu_service? @relation(fields: [serviceId], references: [id])
  
  @@index([tenantId])
  @@index([churchId])
  @@index([memberId])
  @@index([ministryId])
  @@index([serviceDate])
}

// --- SERVICES & EVENTS (6 tables) ---

// Church Service - Regular worship services
model chu_service {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  unitId          String?   // Scope to specific unit
  
  // Service Identity
  name            String
  type            ChuServiceType
  description     String?   @db.Text
  
  // Schedule (recurring)
  dayOfWeek       Int?      // 0 = Sunday, 1 = Monday, etc.
  startTime       String?   // e.g., "09:00"
  endTime         String?   // e.g., "12:00"
  
  // Location
  location        String?
  
  // Leadership (default)
  defaultPreacherId String?
  
  // Status
  isActive        Boolean   @default(true)
  
  // Metadata
  createdBy       String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  schedules       chu_event_schedule[]
  attendance      chu_attendance_fact[]
  volunteerLogs   chu_volunteer_log[]
  speakerInvites  chu_speaker_invite[]
  
  @@unique([tenantId, churchId, name])
  @@index([tenantId])
  @@index([churchId])
  @@index([unitId])
  @@index([type])
  @@index([isActive])
}

// Event - Programs, crusades, conferences
model chu_event {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  unitId          String?
  
  // Event Identity
  title           String
  description     String?   @db.Text
  type            String?   // "CRUSADE", "CONFERENCE", "RETREAT", "SEMINAR"
  
  // Theme
  theme           String?
  
  // Location
  venue           String?
  address         String?
  city            String?
  state           String?
  
  // Registration
  requiresRegistration Boolean @default(false)
  maxAttendees    Int?
  registrationUrl String?
  
  // Pricing (informational only - NO PAYMENT PROCESSING)
  isFree          Boolean   @default(true)
  suggestedDonation Float?
  
  // Status
  status          ChuEventStatus @default(DRAFT)
  
  // Dates
  startDate       DateTime
  endDate         DateTime?
  
  // Media
  bannerUrl       String?
  
  // Metadata
  createdBy       String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  schedules       chu_event_schedule[]
  attendance      chu_attendance_fact[]
  volunteerLogs   chu_volunteer_log[]
  speakerInvites  chu_speaker_invite[]
  eventLogs       chu_event_log[]
  
  @@index([tenantId])
  @@index([churchId])
  @@index([unitId])
  @@index([status])
  @@index([startDate])
}

// Event Schedule - Specific dates/times for services and events
model chu_event_schedule {
  id              String    @id @default(uuid())
  tenantId        String
  
  // Link to service or event
  serviceId       String?
  eventId         String?
  
  // Schedule
  scheduledDate   DateTime
  startTime       String?
  endTime         String?
  
  // Location (override)
  location        String?
  
  // Leadership for this instance
  preacherId      String?
  topic           String?
  
  // Actual attendance (populated after)
  actualAttendance Int?
  
  // Status
  isCancelled     Boolean   @default(false)
  cancellationReason String?
  
  // Metadata
  createdBy       String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  service         chu_service? @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  event           chu_event? @relation(fields: [eventId], references: [id], onDelete: Cascade)
  attendance      chu_attendance_fact[]
  
  @@index([tenantId])
  @@index([serviceId])
  @@index([eventId])
  @@index([scheduledDate])
  @@index([isCancelled])
}

// Attendance Fact - Attendance counts (APPEND-ONLY for integrity)
model chu_attendance_fact {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  
  // What was attended
  scheduleId      String?
  serviceId       String?
  eventId         String?
  
  // When
  attendanceDate  DateTime
  
  // Counts (aggregated - NO individual tracking for minors safety)
  totalCount      Int
  adultCount      Int?
  childrenCount   Int?      //  Aggregated only - no individual minor tracking
  maleCount       Int?
  femaleCount     Int?
  firstTimers     Int?
  visitors        Int?
  
  // Additional metrics
  onlineCount     Int?      // For hybrid services
  
  // Notes
  notes           String?   @db.Text
  
  // Who recorded
  recordedBy      String
  
  // APPEND-ONLY: No updatedAt - attendance facts cannot be modified
  recordedAt      DateTime  @default(now())
  
  // Relations
  schedule        chu_event_schedule? @relation(fields: [scheduleId], references: [id])
  service         chu_service? @relation(fields: [serviceId], references: [id])
  event           chu_event? @relation(fields: [eventId], references: [id])
  
  @@index([tenantId])
  @@index([churchId])
  @@index([scheduleId])
  @@index([serviceId])
  @@index([eventId])
  @@index([attendanceDate])
}

// Speaker Invite - Guest ministers
model chu_speaker_invite {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  
  // Link to service or event
  serviceId       String?
  eventId         String?
  
  // Speaker Details
  speakerName     String
  title           String?   // e.g., "Rev.", "Pastor", "Bishop"
  organization    String?
  phone           String?
  email           String?
  
  // Topic
  topic           String?
  
  // Schedule
  scheduledDate   DateTime
  
  // Status
  status          String    @default("PENDING") // PENDING, CONFIRMED, DECLINED, COMPLETED
  confirmedAt     DateTime?
  
  // Notes
  notes           String?   @db.Text
  
  // Metadata
  createdBy       String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  service         chu_service? @relation(fields: [serviceId], references: [id])
  event           chu_event? @relation(fields: [eventId], references: [id])
  
  @@index([tenantId])
  @@index([churchId])
  @@index([serviceId])
  @@index([eventId])
  @@index([scheduledDate])
  @@index([status])
}

// Event Log - Event lifecycle (APPEND-ONLY)
model chu_event_log {
  id              String    @id @default(uuid())
  tenantId        String
  eventId         String
  
  // Status transition
  previousStatus  ChuEventStatus?
  newStatus       ChuEventStatus
  
  // Who changed
  changedBy       String
  
  // Note
  note            String?   @db.Text
  
  // APPEND-ONLY
  changedAt       DateTime  @default(now())
  
  // Relations
  event           chu_event @relation(fields: [eventId], references: [id], onDelete: Cascade)
  
  @@index([tenantId])
  @@index([eventId])
  @@index([changedAt])
}

// ============================================================================
// CHURCH SUITE  PHASE 3: GIVING & FINANCIAL FACTS
// Authorization: January 8, 2026 (Checkpoint B Approved - Continued)
// Classification: HIGH TRUST
// Commerce Boundary: FACTS ONLY  NO PAYMENT PROCESSING
// ============================================================================

// --- GIVING FACTS (ALL APPEND-ONLY) ---

// Tithe Fact - Record of tithe intention/fact (NOT payment)
model chu_giving_tithe_fact {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  unitId          String?
  
  // Member (optional - anonymous giving allowed)
  memberId        String?
  isAnonymous     Boolean   @default(false)
  
  // Fact Details (NOT payment)
  amount          Float
  currency        String    @default("NGN")
  
  // Period
  givingPeriod    String?   // e.g., "2026-01", "Q1-2026"
  
  // Purpose
  purpose         String    @default("TITHE")
  notes           String?
  
  // Method (informational only)
  givenMethod     String?   // "CASH", "TRANSFER", "CHEQUE", "CARD"
  
  // Recorded by
  recordedBy      String
  
  // COMMERCE BOUNDARY: Facts only - no execution
  // This is NOT a payment - just a record of giving
  
  // APPEND-ONLY: No updatedAt
  recordedAt      DateTime  @default(now())
  
  @@index([tenantId])
  @@index([churchId])
  @@index([unitId])
  @@index([memberId])
  @@index([recordedAt])
  @@index([givingPeriod])
}

// Offering Fact - Record of offering intention/fact (NOT payment)
model chu_giving_offering_fact {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  unitId          String?
  
  // Member (optional - anonymous giving allowed)
  memberId        String?
  isAnonymous     Boolean   @default(false)
  
  // Fact Details (NOT payment)
  amount          Float
  currency        String    @default("NGN")
  
  // Offering Type
  offeringType    String    // "GENERAL", "SPECIAL", "BUILDING", "MISSIONS", "THANKSGIVING", "FIRST_FRUIT"
  
  // Context
  serviceId       String?   // Link to service
  eventId         String?   // Link to event
  
  // Notes
  notes           String?
  
  // Method (informational only)
  givenMethod     String?
  
  // Recorded by
  recordedBy      String
  
  // COMMERCE BOUNDARY: Facts only
  
  // APPEND-ONLY
  recordedAt      DateTime  @default(now())
  
  @@index([tenantId])
  @@index([churchId])
  @@index([unitId])
  @@index([memberId])
  @@index([offeringType])
  @@index([recordedAt])
}

// Pledge Fact - Record of pledge made (commitment, not payment)
model chu_giving_pledge_fact {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  
  // Member (required for pledges)
  memberId        String
  
  // Pledge Details
  pledgeType      String    // "BUILDING", "MISSIONS", "ANNUAL", "PROJECT"
  projectName     String?   // Name of project if applicable
  
  // Amount
  pledgedAmount   Float
  currency        String    @default("NGN")
  
  // Schedule
  pledgeDate      DateTime
  fulfillmentDate DateTime? // Expected completion
  
  // Status (informational)
  status          String    @default("ACTIVE") // ACTIVE, FULFILLED, CANCELLED
  
  // Notes
  notes           String?
  
  // Recorded by
  recordedBy      String
  
  // APPEND-ONLY
  recordedAt      DateTime  @default(now())
  
  @@index([tenantId])
  @@index([churchId])
  @@index([memberId])
  @@index([pledgeType])
  @@index([status])
  @@index([recordedAt])
}

// Expense Fact - Record of expense (NOT payment execution)
model chu_expense_fact {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  unitId          String?
  
  // Expense Details
  category        String    // "UTILITIES", "SALARIES", "MAINTENANCE", "MINISTRY", "WELFARE", "ADMIN"
  description     String
  
  // Amount
  amount          Float
  currency        String    @default("NGN")
  
  // Vendor/Recipient (informational)
  vendor          String?
  recipientName   String?
  
  // Reference
  referenceNo     String?   // Invoice or receipt reference
  
  // Date
  expenseDate     DateTime
  
  // Approval
  approvedBy      String?
  approvalDate    DateTime?
  
  // Notes
  notes           String?
  
  // Supporting document
  attachmentUrl   String?
  
  // Recorded by
  recordedBy      String
  
  // COMMERCE BOUNDARY: Facts only
  
  // APPEND-ONLY
  recordedAt      DateTime  @default(now())
  
  @@index([tenantId])
  @@index([churchId])
  @@index([unitId])
  @@index([category])
  @@index([expenseDate])
  @@index([recordedAt])
}

// Budget Fact - Budget allocation record
model chu_budget_fact {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  unitId          String?
  
  // Budget Period
  fiscalYear      Int
  fiscalPeriod    String?   // "Q1", "Q2", "H1", "ANNUAL"
  
  // Category
  category        String
  subcategory     String?
  
  // Amount
  allocatedAmount Float
  currency        String    @default("NGN")
  
  // Approval
  approvedBy      String
  approvalDate    DateTime
  
  // Notes
  notes           String?
  
  // Recorded by
  recordedBy      String
  
  // APPEND-ONLY
  recordedAt      DateTime  @default(now())
  
  @@index([tenantId])
  @@index([churchId])
  @@index([fiscalYear])
  @@index([category])
  @@index([recordedAt])
}

// Financial Disclosure - Transparency report
model chu_financial_disclosure {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  
  // Report Period
  reportPeriod    String    // e.g., "2026-Q1", "2026-ANNUAL"
  reportType      String    // "QUARTERLY", "ANNUAL", "SPECIAL"
  
  // Summary (aggregated - no individual data)
  totalTithes     Float?
  totalOfferings  Float?
  totalExpenses   Float?
  currency        String    @default("NGN")
  
  // Report Content
  summaryText     String?   @db.Text
  
  // Approval
  preparedBy      String
  approvedBy      String?
  approvalDate    DateTime?
  
  // Publication
  isPublished     Boolean   @default(false)
  publishedAt     DateTime?
  
  // Attachment
  reportUrl       String?
  
  // APPEND-ONLY
  createdAt       DateTime  @default(now())
  
  @@unique([tenantId, churchId, reportPeriod, reportType])
  @@index([tenantId])
  @@index([churchId])
  @@index([reportPeriod])
  @@index([isPublished])
}

// ============================================================================
// CHURCH SUITE  PHASE 4: GOVERNANCE, AUDIT & TRANSPARENCY
// Authorization: January 8, 2026 (Continuing from Phase 3)
// Classification: LOW RISK (read-heavy, append-only)
// ============================================================================

// --- GOVERNANCE RECORDS (APPEND-ONLY) ---

// Governance Record - Decisions, resolutions, policies
model chu_governance_record {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  unitId          String?
  
  // Record Type
  recordType      String    // "RESOLUTION", "POLICY", "DECISION", "MINUTES", "CONSTITUTION"
  
  // Title and Content
  title           String
  summary         String?   @db.Text
  fullText        String?   @db.Text
  
  // Reference
  referenceNo     String?   // e.g., "RES-2026-001"
  
  // Meeting Context (if applicable)
  meetingDate     DateTime?
  meetingType     String?   // "AGM", "BOARD", "COUNCIL", "COMMITTEE"
  
  // Voting (if applicable)
  votesFor        Int?
  votesAgainst    Int?
  votesAbstain    Int?
  
  // Approval Chain
  proposedBy      String?
  secondedBy      String?
  approvedBy      String?
  approvalDate    DateTime?
  
  // Status
  status          String    @default("DRAFT") // DRAFT, PENDING, APPROVED, REJECTED, SUPERSEDED
  effectiveDate   DateTime?
  expiryDate      DateTime?
  
  // Superseded by (for policy updates)
  supersededById  String?
  
  // Attachments
  attachmentUrls  String?   @db.Text // JSON array
  
  // Recorded by
  recordedBy      String
  
  // APPEND-ONLY
  recordedAt      DateTime  @default(now())
  
  @@index([tenantId])
  @@index([churchId])
  @@index([unitId])
  @@index([recordType])
  @@index([status])
  @@index([effectiveDate])
  @@index([recordedAt])
}

// Evidence Bundle - Supporting documents for audits
model chu_evidence_bundle {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  
  // Bundle Identity
  bundleType      String    // "FINANCIAL_AUDIT", "GOVERNANCE_REVIEW", "INVESTIGATION", "COMPLIANCE_CHECK"
  title           String
  description     String?   @db.Text
  
  // Period Covered
  periodStart     DateTime?
  periodEnd       DateTime?
  
  // Evidence Items (JSON array)
  evidenceItems   String?   @db.Text // Array of {type, description, url, hash}
  
  // Integrity
  bundleHash      String?   // SHA-256 of all evidence hashes
  
  // Access Control
  accessLevel     String    @default("INTERNAL") // INTERNAL, RESTRICTED, CONFIDENTIAL
  authorizedViewers String? @db.Text // JSON array of user/role IDs
  
  // Status
  status          String    @default("OPEN") // OPEN, SEALED, ARCHIVED
  sealedBy        String?
  sealedAt        DateTime?
  
  // Notes
  notes           String?   @db.Text
  
  // Prepared by
  preparedBy      String
  
  // APPEND-ONLY
  createdAt       DateTime  @default(now())
  
  @@index([tenantId])
  @@index([churchId])
  @@index([bundleType])
  @@index([status])
  @@index([accessLevel])
  @@index([createdAt])
}

// Compliance Record - Regulatory compliance tracking
model chu_compliance_record {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  
  // Compliance Type
  complianceType  String    // "CAC_REGISTRATION", "TAX_EXEMPTION", "INSURANCE", "SAFETY", "CHILD_PROTECTION"
  
  // Details
  description     String
  requirement     String?   @db.Text
  
  // Status
  status          String    @default("PENDING") // PENDING, COMPLIANT, NON_COMPLIANT, EXPIRED
  
  // Dates
  dueDate         DateTime?
  completedDate   DateTime?
  expiryDate      DateTime?
  
  // Renewal
  renewalRequired Boolean   @default(false)
  renewalDate     DateTime?
  
  // Documentation
  documentUrl     String?
  referenceNo     String?
  
  // Verification
  verifiedBy      String?
  verifiedAt      DateTime?
  
  // Notes
  notes           String?   @db.Text
  
  // Recorded by
  recordedBy      String
  
  // Metadata
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@index([tenantId])
  @@index([churchId])
  @@index([complianceType])
  @@index([status])
  @@index([expiryDate])
}

// Regulator Access Log - Read-only access for oversight (APPEND-ONLY)
model chu_regulator_access_log {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  
  // Regulator Info
  regulatorId     String
  regulatorName   String?
  regulatorType   String?   // "CAC", "FIRS", "INTERNAL_AUDITOR", "EXTERNAL_AUDITOR"
  
  // Access Details
  accessType      String    // "VIEW", "EXPORT", "DOWNLOAD"
  resourceType    String    // "FINANCIAL_RECORDS", "GOVERNANCE_RECORDS", "MEMBERSHIP_STATS"
  resourceId      String?
  
  // Request Context
  requestReason   String?
  authorizationRef String?  // Reference to authorization document
  
  // Access Time
  accessedAt      DateTime  @default(now())
  
  // Client Info
  ipAddress       String?
  userAgent       String?
  
  // APPEND-ONLY: No modifications
  
  @@index([tenantId])
  @@index([churchId])
  @@index([regulatorId])
  @@index([accessType])
  @@index([resourceType])
  @@index([accessedAt])
}

// Transparency Report - Public transparency summary
model chu_transparency_report {
  id              String    @id @default(uuid())
  tenantId        String
  churchId        String
  
  // Report Period
  reportPeriod    String    // e.g., "2026-Q1", "2026-ANNUAL"
  reportType      String    // "QUARTERLY", "ANNUAL", "SPECIAL"
  
  // Content Sections (aggregated, non-financial sensitive data)
  membershipStats String?   @db.Text // JSON: {total, newMembers, etc.}
  ministryHighlights String? @db.Text // JSON: {activities, achievements}
  governanceActions String? @db.Text // JSON: {resolutions, policies}
  
  // Financial Summary (aggregated - NO individual data)
  financialSummary String?  @db.Text // JSON: {totalIncome, totalExpenses, majorProjects}
  
  // Compliance Status
  complianceStatus String?  @db.Text // JSON: {items}
  
  // Report Status
  status          String    @default("DRAFT") // DRAFT, REVIEW, PUBLISHED
  
  // Approval
  preparedBy      String
  reviewedBy      String?
  approvedBy      String?
  approvalDate    DateTime?
  
  // Publication
  publishedAt     DateTime?
  publicUrl       String?
  
  // APPEND-ONLY
  createdAt       DateTime  @default(now())
  
  @@unique([tenantId, churchId, reportPeriod, reportType])
  @@index([tenantId])
  @@index([churchId])
  @@index([reportPeriod])
  @@index([status])
}

// =============================================================================
// REAL ESTATE SUITE - Property Management
// Added: Phase D2.5 - Schema Implementation
// =============================================================================

model realestate_config {
  id              String    @id @default(uuid())
  tenantId        String
  partnerId       String
  
  // Configuration
  companyName     String
  companyLogo     String?
  currency        String    @default("NGN")
  timezone        String    @default("Africa/Lagos")
  
  // Settings
  defaultLeaseTermMonths Int    @default(12)
  lateFeePercentage      Float  @default(5.0)
  gracePeriodDays        Int    @default(7)
  
  // Contact
  address         String?
  phone           String?
  email           String?
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@unique([tenantId])
  @@index([partnerId])
}

model realestate_property {
  id              String    @id @default(uuid())
  tenantId        String
  partnerId       String
  
  // Property Details
  name            String
  propertyType    String    // "RESIDENTIAL", "COMMERCIAL", "MIXED_USE", "LAND"
  address         String
  city            String
  state           String
  country         String    @default("Nigeria")
  
  // Location
  lga             String?   // Local Government Area
  latitude        Float?
  longitude       Float?
  
  // Specs
  totalUnits      Int       @default(1)
  totalFloors     Int       @default(1)
  yearBuilt       Int?
  landSize        Float?    // in square meters
  
  // Financials
  marketValue     Float?
  acquisitionCost Float?
  acquisitionDate DateTime?
  
  // Status
  status          String    @default("ACTIVE")  // "ACTIVE", "INACTIVE", "UNDER_RENOVATION"
  
  // Media
  images          String?   @db.Text  // JSON array of image URLs
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  units           realestate_unit[]
  
  @@index([tenantId])
  @@index([partnerId])
  @@index([propertyType])
  @@index([status])
}

model realestate_unit {
  id              String    @id @default(uuid())
  tenantId        String
  partnerId       String
  propertyId      String
  
  // Unit Details
  unitNumber      String
  unitType        String    // "FLAT", "DUPLEX", "SHOP", "OFFICE", "WAREHOUSE"
  floor           Int?
  
  // Specs
  bedrooms        Int?
  bathrooms       Int?
  size            Float?    // in square meters
  
  // Pricing
  monthlyRent     Float
  securityDeposit Float?
  serviceCharge   Float?    @default(0)
  
  // Status
  status          String    @default("VACANT")  // "VACANT", "OCCUPIED", "RESERVED", "MAINTENANCE"
  
  // Amenities
  amenities       String?   @db.Text  // JSON array
  description     String?   @db.Text
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  property        realestate_property @relation(fields: [propertyId], references: [id])
  leases          realestate_lease[]
  
  @@index([tenantId])
  @@index([partnerId])
  @@index([propertyId])
  @@index([status])
}

model realestate_tenant_profile {
  id              String    @id @default(uuid())
  tenantId        String    // Platform tenant
  partnerId       String
  
  // Personal Info
  firstName       String
  lastName        String
  email           String
  phone           String
  alternatePhone  String?
  
  // Identification
  idType          String?   // "NIN", "VOTERS_CARD", "DRIVERS_LICENSE", "PASSPORT"
  idNumber        String?
  
  // Employment
  occupation      String?
  employer        String?
  employerAddress String?
  monthlyIncome   Float?
  
  // Emergency Contact
  emergencyName   String?
  emergencyPhone  String?
  emergencyRelation String?
  
  // Status
  status          String    @default("ACTIVE")  // "ACTIVE", "INACTIVE", "BLACKLISTED"
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  leases          realestate_lease[]
  payments        realestate_payment[]
  
  @@index([tenantId])
  @@index([partnerId])
  @@index([email])
  @@index([phone])
}

model realestate_lease {
  id              String    @id @default(uuid())
  tenantId        String
  partnerId       String
  unitId          String
  tenantProfileId String
  
  // Lease Terms
  startDate       DateTime
  endDate         DateTime
  monthlyRent     Float
  securityDeposit Float
  serviceCharge   Float     @default(0)
  
  // Payment Terms
  paymentDueDay   Int       @default(1)  // Day of month rent is due
  gracePeriodDays Int       @default(7)
  lateFeeType     String    @default("PERCENTAGE")  // "PERCENTAGE", "FIXED"
  lateFeeAmount   Float     @default(5.0)
  
  // Status
  status          String    @default("ACTIVE")  // "DRAFT", "ACTIVE", "EXPIRED", "TERMINATED"
  
  // Documents
  leaseDocument   String?   // URL to signed lease
  
  // Notes
  notes           String?   @db.Text
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  unit            realestate_unit @relation(fields: [unitId], references: [id])
  tenantProfile   realestate_tenant_profile @relation(fields: [tenantProfileId], references: [id])
  payments        realestate_payment[]
  
  @@index([tenantId])
  @@index([partnerId])
  @@index([unitId])
  @@index([tenantProfileId])
  @@index([status])
  @@index([endDate])
}

model realestate_payment {
  id              String    @id @default(uuid())
  tenantId        String
  partnerId       String
  leaseId         String
  tenantProfileId String
  
  // Payment Details
  paymentType     String    // "RENT", "SECURITY_DEPOSIT", "SERVICE_CHARGE", "LATE_FEE", "OTHER"
  amount          Float
  periodStart     DateTime?
  periodEnd       DateTime?
  dueDate         DateTime
  
  // Payment Info
  paymentDate     DateTime?
  paymentMethod   String?   // "BANK_TRANSFER", "CASH", "CARD", "USSD"
  paymentReference String?
  
  // Status
  status          String    @default("PENDING")  // "PENDING", "PAID", "PARTIAL", "OVERDUE", "CANCELLED"
  
  // Notes
  notes           String?
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  lease           realestate_lease @relation(fields: [leaseId], references: [id])
  tenantProfile   realestate_tenant_profile @relation(fields: [tenantProfileId], references: [id])
  
  @@index([tenantId])
  @@index([partnerId])
  @@index([leaseId])
  @@index([tenantProfileId])
  @@index([status])
  @@index([dueDate])
}

// =============================================================================
// POLITICAL SUITE - Campaign Management
// Added: Phase D2.5 - Schema Implementation
// =============================================================================

model political_config {
  id              String    @id @default(uuid())
  tenantId        String
  partnerId       String
  
  // Configuration
  organizationName String
  logo            String?
  currency        String    @default("NGN")
  timezone        String    @default("Africa/Lagos")
  
  // Settings
  donationMinimum Float     @default(1000)
  donationMaximum Float?
  enableAnonymousDonations Boolean @default(false)
  
  // Contact
  headquarters    String?
  phone           String?
  email           String?
  website         String?
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@unique([tenantId])
  @@index([partnerId])
}

model political_party {
  id              String    @id @default(uuid())
  tenantId        String
  partnerId       String
  
  // Party Info
  name            String
  abbreviation    String
  slogan          String?
  logo            String?
  
  // Details
  foundedDate     DateTime?
  ideology        String?
  description     String?   @db.Text
  
  // Contact
  headquarters    String?
  phone           String?
  email           String?
  website         String?
  
  // Status
  status          String    @default("ACTIVE")  // "ACTIVE", "INACTIVE", "SUSPENDED"
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  campaigns       political_campaign[]
  candidates      political_candidate[]
  members         political_member[]
  
  @@index([tenantId])
  @@index([partnerId])
  @@index([abbreviation])
}

model political_campaign {
  id              String    @id @default(uuid())
  tenantId        String
  partnerId       String
  partyId         String?
  
  // Campaign Info
  name            String
  electionType    String    // "PRESIDENTIAL", "GUBERNATORIAL", "SENATORIAL", "HOUSE_OF_REPS", "STATE_ASSEMBLY", "LOCAL_GOVT"
  position        String    // Position being contested
  constituency    String    // Area of coverage
  
  // Dates
  electionDate    DateTime?
  campaignStart   DateTime?
  campaignEnd     DateTime?
  
  // Financials
  budgetTarget    Float?
  budgetSpent     Float     @default(0)
  
  // Status
  status          String    @default("PLANNING")  // "PLANNING", "ACTIVE", "COMPLETED", "CANCELLED"
  
  // Description
  manifesto       String?   @db.Text
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  party           political_party? @relation(fields: [partyId], references: [id])
  candidates      political_candidate[]
  donations       political_donation[]
  events          political_event[]
  
  @@index([tenantId])
  @@index([partnerId])
  @@index([partyId])
  @@index([electionType])
  @@index([status])
}

model political_candidate {
  id              String    @id @default(uuid())
  tenantId        String
  partnerId       String
  partyId         String?
  campaignId      String?
  
  // Personal Info
  firstName       String
  lastName        String
  middleName      String?
  dateOfBirth     DateTime?
  gender          String?
  
  // Contact
  email           String?
  phone           String?
  address         String?
  
  // Political Info
  position        String    // Position contesting for
  constituency    String?
  
  // Profile
  education       String?   @db.Text  // JSON array
  experience      String?   @db.Text  // JSON array
  biography       String?   @db.Text
  photo           String?
  
  // Status
  status          String    @default("ACTIVE")  // "ACTIVE", "WITHDRAWN", "DISQUALIFIED", "ELECTED", "LOST"
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  party           political_party? @relation(fields: [partyId], references: [id])
  campaign        political_campaign? @relation(fields: [campaignId], references: [id])
  
  @@index([tenantId])
  @@index([partnerId])
  @@index([partyId])
  @@index([campaignId])
  @@index([status])
}

model political_member {
  id              String    @id @default(uuid())
  tenantId        String
  partnerId       String
  partyId         String
  
  // Personal Info
  firstName       String
  lastName        String
  email           String?
  phone           String
  alternatePhone  String?
  
  // Demographics
  dateOfBirth     DateTime?
  gender          String?
  occupation      String?
  
  // Location
  address         String?
  ward            String?
  lga             String?   // Local Government Area
  state           String?
  pollingUnit     String?
  
  // Membership
  membershipNumber String?
  membershipType   String   @default("ORDINARY")  // "ORDINARY", "EXECUTIVE", "PATRON"
  joinDate         DateTime @default(now())
  
  // Status
  status          String    @default("ACTIVE")  // "ACTIVE", "INACTIVE", "SUSPENDED"
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  party           political_party @relation(fields: [partyId], references: [id])
  donations       political_donation[]
  
  @@index([tenantId])
  @@index([partnerId])
  @@index([partyId])
  @@index([phone])
  @@index([ward])
  @@index([lga])
}

model political_donation {
  id              String    @id @default(uuid())
  tenantId        String
  partnerId       String
  campaignId      String?
  memberId        String?
  
  // Donor Info (if not member)
  donorName       String?
  donorEmail      String?
  donorPhone      String?
  isAnonymous     Boolean   @default(false)
  
  // Donation Details
  amount          Float
  currency        String    @default("NGN")
  donationType    String    @default("CASH")  // "CASH", "BANK_TRANSFER", "KIND", "PLEDGE"
  
  // Payment Info
  paymentDate     DateTime?
  paymentMethod   String?   // "BANK_TRANSFER", "CASH", "CARD", "USSD"
  paymentReference String?
  
  // Purpose
  purpose         String?   // "GENERAL", "CAMPAIGN", "RALLY", "MEDIA"
  
  // Status
  status          String    @default("PENDING")  // "PENDING", "RECEIVED", "PLEDGED", "CANCELLED"
  
  // Compliance
  receiptNumber   String?
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  campaign        political_campaign? @relation(fields: [campaignId], references: [id])
  member          political_member? @relation(fields: [memberId], references: [id])
  
  @@index([tenantId])
  @@index([partnerId])
  @@index([campaignId])
  @@index([memberId])
  @@index([status])
  @@index([paymentDate])
}

model political_event {
  id              String    @id @default(uuid())
  tenantId        String
  partnerId       String
  campaignId      String?
  
  // Event Info
  name            String
  eventType       String    // "RALLY", "TOWN_HALL", "FUNDRAISER", "DEBATE", "MEETING", "PRESS_CONFERENCE"
  description     String?   @db.Text
  
  // Location
  venue           String?
  address         String?
  city            String?
  state           String?
  lga             String?
  
  // Timing
  startDate       DateTime
  endDate         DateTime?
  
  // Attendance
  expectedAttendance Int?
  actualAttendance   Int?
  
  // Budget
  budgetAllocated Float?
  actualCost      Float?
  
  // Status
  status          String    @default("PLANNED")  // "PLANNED", "CONFIRMED", "IN_PROGRESS", "COMPLETED", "CANCELLED"
  
  // Media
  images          String?   @db.Text  // JSON array
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  campaign        political_campaign? @relation(fields: [campaignId], references: [id])
  
  @@index([tenantId])
  @@index([partnerId])
  @@index([campaignId])
  @@index([eventType])
  @@index([startDate])
  @@index([status])
}
